<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head id="head">
		<title>ENGI&#8482; Player Demo</title>
		<link href="vendor/bootstrap-3.1.1-dist/css/bootstrap.min.css" rel="Stylesheet" type="text/css"  />
		<link href="vendor/bootstrap-3.1.1-dist/css/bootstrap-theme.min.css" rel="Stylesheet" type="text/css"  />
		<link href="style/flex.css" rel="Stylesheet" type="text/css" />
		<link href="style/core.css" rel="Stylesheet" type="text/css" />
		<link href="style/icons/style.css" rel="Stylesheet" type="text/css" />
		<script type="text/javascript" src="node_modules/jquery/dist/jquery.min.js"></script>
		<script type="text/javascript" src="vendor/jquery.fastfix.js"></script>
		<script type="text/javascript" src="vendor/jquery.mousewheel.js"></script>
		<script type="text/javascript" src="vendor/gl-matrix.js"></script>
		<script type="text/javascript" src="scripts/util.js"></script>
		<script type="text/javascript" src="scripts/renderer.js"></script>
		<script type="text/javascript" src="scripts/plugin-group.js"></script>
		<script type="text/javascript" src="scripts/plugin-manager.js"></script>
		<script type="text/javascript" src="scripts/connection.js"></script>
		<script type="text/javascript" src="scripts/graph.js"></script>
		<script type="text/javascript" src="scripts/node.js"></script>
		<script type="text/javascript" src="scripts/node-ui.js"></script>
		<script type="text/javascript" src="scripts/registers.js"></script>
		<script type="text/javascript" src="scripts/player.js"></script>
		<script type="text/javascript" src="scripts/core.js"></script>
		<script type="text/javascript" src="scripts/application.js"></script>
		<script type="text/javascript" src="scripts/player.js"></script>
		<script type="text/javascript">
			function Slider(parent, on_change, lo, hi, value)
			{
				this.on_change = on_change;
				this.lo = lo;
				this.hi = hi;
				this.value = value;
				this.pos = 0;

				var table = make('table');
				var row = make('tr');
				var col = make('td');
				var slider = make('div');
				var handle = make('div');
	
				var slider_mouseup = function(data) { return function(e)
				{
					document.removeEventListener('mouseup', data.mouseup);
					document.removeEventListener('mousemove', data.mousemove);

					if(e.stopPropagation) e.stopPropagation();
					if(e.preventDefault) e.preventDefault();
					return false;
				}};

				var slider_mousemove = function(self, data) { return function(e)
				{
					var x_delta = e.pageX - data.last_x;
					var rng = self.hi - self.lo;
		
					data.last_x = e.pageX;
		
					var new_val = self.pos + x_delta;
					new_val = new_val < 0.0 ? 0.0 : new_val > 180.0 ? 180.0 : new_val;
		
					if(self.value !== new_val)
					{
						var mix = new_val / 180.0;
			
						self.pos = Math.floor(new_val);
						self.value = ((1.0 - mix) * self.lo) + (mix * self.hi);
						handle[0].style.left = '' + self.pos + 'px';
						self.on_change(self.value);
					}

					if(e.stopPropagation) e.stopPropagation();
					if(e.preventDefault) e.preventDefault();
					return false;				
				}};
	
				var slider_mousedown = function(self, handle) { return function(e)
				{
					var data = {
						last_x: e.pageX,
						handle: handle,
					};
		
					// Defer registration of event listeners until needed.
					data.mouseup = slider_mouseup(data);
					data.mousemove = slider_mousemove(self, data);
					document.addEventListener('mouseup', data.mouseup);
					document.addEventListener('mousemove', data.mousemove);
		
					if(e.stopPropagation) e.stopPropagation();
					if(e.preventDefault) e.preventDefault();
					return false;
				}};
	
				slider.addClass('slider slider-horizontal ui-widget corner-all');
				slider.css({ 'width': '180px', 'margin-left': '8px', 'margin-right': '8px' });
				handle.addClass('slider-handle state-hover corner-all');
				this.pos = ((this.value - this.lo) / (this.hi - this.lo)) * 180.0;
				handle[0].style.left = '' + this.pos + 'px';
				handle[0].addEventListener('mousedown', slider_mousedown(this, handle));
	
				slider.append(handle);
	
				table.css('width', '150px');
				table.addClass('pl_layout');
	
				var v_col = make('td');
	
				v_col.css('text-align', 'center');
	
				table.append(row);
				col.append(slider);
				row.append(col);
	
				var row2 = make('tr');
	
				row2.append(v_col);
				v_col.append();
				table.append(row2);
	
				this.v_col = v_col;
				this.on_change(this.value);
				this.slider = slider;
				this.handle = handle;
				
				parent.append(table);
			}
		</script>
		<script type="text/javascript">
			var player = null;
			
			var init_ui = function(player)
			{
				var params = [
					{ id: 'rotation-speed', min: 0.0, max: 180.0, def: 90.0 }
				];
				
				for(var i = 0, len = params.length; i < len; i++)
				{
					var param = params[i];
											
					param.slider = new Slider($('#' + param.id), function(p, id) { return function(value)
					{
						p.set_parameter(id, value);
					}}(player, param.id), param.min, param.max, param.def);
				}
				
				player.add_parameter_listener('abs-time', function(dom) { return function(value)
				{
					dom.text(value.toFixed(2));
				}}($('#abs-time')));
			};
			
			$(document).ready(function() 
			{
				$('#webgl-canvas').css({
					'position': 'absolute',
					'top': '10px',
					'left': '10px',
					'width': '640px',
					'height': '480px',
					'background-color': '#000'
				});
				
				player = CreatePlayer(function wait_for_init(player)
				{
					player.load_from_url('embedding_scene.json');
					init_ui(player);
					player.play();
				});
			});
		</script>
	</head>
	<body>
		<noscript>
			<div class="centered notification">
				<div style="float: left; display: table-cell; margin-right: 8px;"><img src="images/warning.png" width="64px" height="64px" /></div>
				<div>This page requires javascript in order to display properly. If you're running a script blocker - such as NoScript - please whitelist this page. If you have disabled javascript in your browser, please enable it and reload (F5).</div>
			</div>
		</noscript>
		<div id="main_layout" class="centered">
			<canvas id="webgl-canvas" class="webgl-canvas-normal" width="640" height="480" oncontextmenu="return false;"></canvas>
			<table style="position: absolute; top: 500px; left: 10px; width: 640px;">
				<tr>
					<td>Rotation speed: <div id="rotation-speed"></div></td>
					<td>Abs. time: <div id="abs-time">0.0</div></td>
				</tr>
			</table>
		</div>
	</body>
</html>
