;
!function(t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):"undefined"!=typeof window?window.when=t():"undefined"!=typeof global?global.when=t():"undefined"!=typeof self&&(self.when=t())}(function(){var t;return function n(t,e,r){function o(u,c){if(!e[u]){if(!t[u]){var f="function"==typeof require&&require;if(!c&&f)return f(u,!0);if(i)return i(u,!0);throw new Error("Cannot find module '"+u+"'")}var a=e[u]={exports:{}};t[u][0].call(a.exports,function(n){var e=t[u][1][n];return o(e?e:n)},a,a.exports,n,t,e,r)}return e[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(t,n){var e=n.exports=t("../when");e.callbacks=t("../callbacks"),e.cancelable=t("../cancelable"),e.delay=t("../delay"),e.fn=t("../function"),e.guard=t("../guard"),e.keys=t("../keys"),e.nodefn=e.node=t("../node"),e.parallel=t("../parallel"),e.pipeline=t("../pipeline"),e.poll=t("../poll"),e.sequence=t("../sequence"),e.timeout=t("../timeout")},{"../callbacks":2,"../cancelable":3,"../delay":4,"../function":5,"../guard":6,"../keys":7,"../node":26,"../parallel":27,"../pipeline":28,"../poll":29,"../sequence":30,"../timeout":31,"../when":32}],2:[function(n,e){!function(t){t(function(t){function n(t,n){return v(t,this,n||[])}function e(t,n,e,o){e.push(s(o.resolve,o),s(o.reject,o)),r(t,n,e,o)}function r(t,n,e,r){try{t.apply(n,e)}catch(o){r.reject(o)}}function o(t){return v(t,this,d.call(arguments,1))}function i(t){var n=arguments.length>1?d.call(arguments,1):[];return function(){return v(t,this,n.concat(d.call(arguments)))}}function u(t,n,e){return p(i,n,e,t)}function c(t,n){return function(){var e=this;return h.all(arguments).then(function(r){var o,i,u=h._defer();return"number"==typeof n.callback&&(o=f(r,n.callback)),"number"==typeof n.errback&&(i=f(r,n.errback)),o>i?(a(r,i,u._handler.reject,u._handler),a(r,o,u._handler.resolve,u._handler)):(a(r,o,u._handler.resolve,u._handler),a(r,i,u._handler.reject,u._handler)),t.apply(e,r),u})}}function f(t,n){return 0>n?t.length+n+2:n}function a(t,n,e,r){"number"==typeof n&&t.splice(n,0,s(e,r))}function s(t,n){return function(){arguments.length>1?t.call(n,d.call(arguments)):t.apply(n,arguments)}}var l=t("./when"),h=l.Promise,p=t("./lib/liftAll"),d=Array.prototype.slice,y=t("./lib/apply"),v=y(h,e);return{lift:i,liftAll:u,apply:n,call:o,promisify:c}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{"./lib/apply":11,"./lib/liftAll":23,"./when":32}],3:[function(n,e){!function(t){t(function(){return function(t,n){return t.cancel=function(){try{t.reject(n(t))}catch(e){t.reject(e)}return t.promise},t}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t()})},{}],4:[function(n,e){!function(t){t(function(t){var n=t("./when");return function(t,e){return n(e).delay(t)}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{"./when":32}],5:[function(n,e){!function(t){t(function(t){function n(t,n){return f(t,this,null==n?[]:a.call(n))}function e(t){var n=arguments.length>1?a.call(arguments,1):[];return function(){return f(t,this,n.concat(a.call(arguments)))}}function r(t,n,r){return c(e,n,r,t)}function o(t){var n=a.call(arguments,1);return function(){var e=this,r=a.call(arguments),o=u.apply(e,[t].concat(r));return i.reduce(n,function(t,n){return n.call(e,t)},o)}}var i=t("./when"),u=i["try"],c=t("./lib/liftAll"),f=t("./lib/apply")(i.Promise),a=Array.prototype.slice;return{lift:e,liftAll:r,call:u,apply:n,compose:o}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{"./lib/apply":11,"./lib/liftAll":23,"./when":32}],6:[function(n,e){!function(t){t(function(t){function n(t,n){return function(){var e=o.call(arguments);return r(t()).withThis(this).then(function(t){return r(n.apply(this,e))["finally"](t)})}}function e(t){function n(){e=Math.max(e-1,0),o.length>0&&o.shift()(n)}var e=0,o=[];return function(){return r.promise(function(r){t>e?r(n):o.push(r),e+=1})}}var r=t("./when"),o=Array.prototype.slice;return n.n=e,n})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{"./when":32}],7:[function(n,e){!function(t){"use strict";t(function(t){function n(t){function n(t,n,e){this[t]=n,0===--f&&e.resolve(u)}for(var e,r=o._defer(),i=o._handler(r),u={},c=Object.keys(t),f=c.length,a=0;a<c.length;++a)e=c[a],o._handler(t[e]).fold(n,e,u,i);return 0===f&&i.resolve(u),r}function e(t,e){function r(t,n){return e(n,t)}return i(t).then(function(t){return n(Object.keys(t).reduce(function(n,e){return n[e]=i(t[e]).fold(r,e),n},{}))})}var r=t("./when"),o=r.Promise,i=r.resolve;return{all:r.lift(n),map:e}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{"./when":32}],8:[function(n,e){!function(t){"use strict";t(function(t){var n=t("./makePromise"),e=t("./Scheduler"),r=t("./env").asap;return n({scheduler:new e(r)})})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{"./Scheduler":9,"./env":21,"./makePromise":24}],9:[function(n,e){!function(t){"use strict";t(function(){function t(t){this._async=t,this._running=!1,this._queue=this,this._queueLen=0,this._afterQueue={},this._afterQueueLen=0;var n=this;this.drain=function(){n._drain()}}return t.prototype.enqueue=function(t){this._queue[this._queueLen++]=t,this.run()},t.prototype.afterQueue=function(t){this._afterQueue[this._afterQueueLen++]=t,this.run()},t.prototype.run=function(){this._running||(this._running=!0,this._async(this.drain))},t.prototype._drain=function(){for(var t=0;t<this._queueLen;++t)this._queue[t].run(),this._queue[t]=void 0;for(this._queueLen=0,this._running=!1,t=0;t<this._afterQueueLen;++t)this._afterQueue[t].run(),this._afterQueue[t]=void 0;this._afterQueueLen=0},t})}("function"==typeof t&&t.amd?t:function(t){e.exports=t()})},{}],10:[function(n,e){!function(t){"use strict";t(function(){function t(n){Error.call(this),this.message=n,this.name=t.name,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t})}("function"==typeof t&&t.amd?t:function(t){e.exports=t()})},{}],11:[function(n,e){!function(t){"use strict";t(function(){function t(t,e){function r(n,r,i){var u=t._defer(),c=i.length,f=new Array(c);return o({f:n,thisArg:r,args:i,params:f,i:c-1,call:e},u._handler),u}function o(n,r){if(n.i<0)return e(n.f,n.thisArg,n.params,r);var o=t._handler(n.args[n.i]);o.fold(i,n,void 0,r)}function i(t,n,e){t.params[t.i]=n,t.i-=1,o(t,e)}return arguments.length<2&&(e=n),r}function n(t,n,e,r){try{r.resolve(t.apply(n,e))}catch(o){r.reject(o)}}return t.tryCatchResolve=n,t})}("function"==typeof t&&t.amd?t:function(t){e.exports=t()})},{}],12:[function(n,e){!function(t){"use strict";t(function(t){var n=t("../state"),e=t("../apply");return function(t){function r(n){function e(t){s=null,this.resolve(t)}function r(t){this.resolved||(s.push(t),0===--a&&this.reject(s))}for(var o,i,u=t._defer(),c=u._handler,f=n.length>>>0,a=f,s=[],l=0;f>l;++l)if(i=n[l],void 0!==i||l in n){if(o=t._handler(i),o.state()>0){c.become(o),t._visitRemaining(n,l,o);break}o.visit(c,e,r)}else--a;return 0===a&&c.reject(new RangeError("any(): array must not be empty")),u}function o(n,e){function r(t){this.resolved||(s.push(t),0===--p&&(l=null,this.resolve(s)))}function o(t){this.resolved||(l.push(t),0===--i&&(s=null,this.reject(l)))}var i,u,c,f=t._defer(),a=f._handler,s=[],l=[],h=n.length>>>0,p=0;for(c=0;h>c;++c)u=n[c],(void 0!==u||c in n)&&++p;for(e=Math.max(e,0),i=p-e+1,p=Math.min(e,p),e>p?a.reject(new RangeError("some(): array must contain at least "+e+" item(s), but had "+p)):0===p&&a.resolve(s),c=0;h>c;++c)u=n[c],(void 0!==u||c in n)&&t._handler(u).visit(a,r,o,a.notify);return f}function i(n,e){return t._traverse(e,n)}function u(n,e){var r=b.call(n);return t._traverse(e,r).then(function(t){return c(r,t)})}function c(n,e){for(var r=e.length,o=new Array(r),i=0,u=0;r>i;++i)e[i]&&(o[u++]=t._handler(n[i]).value);return o.length=u,o}function f(t){return y(t.map(a))}function a(e){var r=t._handler(e);return 0===r.state()?d(e).then(n.fulfilled,n.rejected):(r._unreport(),n.inspect(r))}function s(t,n){return arguments.length>2?v.call(t,h(n),arguments[2]):v.call(t,h(n))}function l(t,n){return arguments.length>2?m.call(t,h(n),arguments[2]):m.call(t,h(n))}function h(t){return function(n,e,r){return p(t,void 0,[n,e,r])}}var p=e(t),d=t.resolve,y=t.all,v=Array.prototype.reduce,m=Array.prototype.reduceRight,b=Array.prototype.slice;return t.any=r,t.some=o,t.settle=f,t.map=i,t.filter=u,t.reduce=s,t.reduceRight=l,t.prototype.spread=function(t){return this.then(y).then(function(n){return t.apply(this,n)})},t}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{"../apply":11,"../state":25}],13:[function(n,e){!function(t){"use strict";t(function(){function t(){throw new TypeError("catch predicate must be a function")}function n(t,n){return e(n)?t instanceof n:n(t)}function e(t){return t===Error||null!=t&&t.prototype instanceof Error}function r(t){return("object"==typeof t||"function"==typeof t)&&null!==t}function o(t){return t}return function(e){function i(t,e){return function(r){return n(r,e)?t.call(this,r):a(r)}}function u(t,n,e,o){var i=t.call(n);return r(i)?c(i,e,o):e(o)}function c(t,n,e){return f(t).then(function(){return n(e)})}var f=e.resolve,a=e.reject,s=e.prototype["catch"];return e.prototype.done=function(t,n){this._handler.visit(this._handler.receiver,t,n)},e.prototype["catch"]=e.prototype.otherwise=function(n){return arguments.length<2?s.call(this,n):"function"!=typeof n?this.ensure(t):s.call(this,i(arguments[1],n))},e.prototype["finally"]=e.prototype.ensure=function(t){return"function"!=typeof t?this:this.then(function(n){return u(t,this,o,n)},function(n){return u(t,this,a,n)})},e.prototype["else"]=e.prototype.orElse=function(t){return this.then(void 0,function(){return t})},e.prototype["yield"]=function(t){return this.then(function(){return t})},e.prototype.tap=function(t){return this.then(t)["yield"](this)},e}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t()})},{}],14:[function(n,e){!function(t){"use strict";t(function(){return function(t){return t.prototype.fold=function(n,e){var r=this._beget();return this._handler.fold(function(e,r,o){t._handler(e).fold(function(t,e,r){r.resolve(n.call(this,e,t))},r,this,o)},e,r._handler.receiver,r._handler),r},t}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t()})},{}],15:[function(n,e){!function(t){"use strict";t(function(t){var n=t("../state").inspect;return function(t){return t.prototype.inspect=function(){return n(t._handler(this))},t}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{"../state":25}],16:[function(n,e){!function(t){"use strict";t(function(){return function(t){function n(t,n,r,o){return e(function(n){return[n,t(n)]},n,r,o)}function e(t,n,o,i){function u(i,u){return r(o(i)).then(function(){return e(t,n,o,u)})}return r(i).then(function(e){return r(n(e)).then(function(n){return n?e:r(t(e)).spread(u)})})}var r=t.resolve;return t.iterate=n,t.unfold=e,t}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t()})},{}],17:[function(n,e){!function(t){"use strict";t(function(){return function(t){return t.prototype.progress=function(t){return this.then(void 0,void 0,t)},t}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t()})},{}],18:[function(n,e){!function(t){"use strict";t(function(t){function n(t,n,r,o){return e.setTimer(function(){t(r,o,n)},n)}var e=t("../env"),r=t("../TimeoutError");return function(t){function o(t,e,r){n(i,t,e,r)}function i(t,n){n.resolve(t)}function u(t,n,e){var o="undefined"==typeof t?new r("timed out after "+e+"ms"):t;n.reject(o)}return t.prototype.delay=function(t){var n=this._beget();return this._handler.fold(o,t,void 0,n._handler),n},t.prototype.timeout=function(t,r){var o=this._beget(),i=o._handler,c=n(u,t,r,o._handler);return this._handler.visit(i,function(t){e.clearTimer(c),this.resolve(t)},function(t){e.clearTimer(c),this.reject(t)},i.notify),o},t}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{"../TimeoutError":10,"../env":21}],19:[function(n,e){!function(t){"use strict";t(function(t){function n(t){throw t}function e(){}var r=t("../env").setTimer,o=t("../format");return function(t){function i(t){t.handled||(p.push(t),s("Potentially unhandled rejection ["+t.id+"] "+o.formatError(t.value)))}function u(t){var n=p.indexOf(t);n>=0&&(p.splice(n,1),l("Handled previous rejection ["+t.id+"] "+o.formatObject(t.value)))}function c(t,n){h.push(t,n),null===d&&(d=r(f,0))}function f(){for(d=null;h.length>0;)h.shift()(h.shift())}var a,s=e,l=e;"undefined"!=typeof console&&(a=console,s="undefined"!=typeof a.error?function(t){a.error(t)}:function(t){a.log(t)},l="undefined"!=typeof a.info?function(t){a.info(t)}:function(t){a.log(t)}),t.onPotentiallyUnhandledRejection=function(t){c(i,t)},t.onPotentiallyUnhandledRejectionHandled=function(t){c(u,t)},t.onFatalRejection=function(t){c(n,t.value)};var h=[],p=[],d=null;return t}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{"../env":21,"../format":22}],20:[function(n,e){!function(t){"use strict";t(function(){return function(t){return t.prototype["with"]=t.prototype.withThis=function(t){var n=this._beget(),e=n._handler;return e.receiver=t,this._handler.chain(e,t),n},t}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t()})},{}],21:[function(n,e){!function(t){"use strict";t(function(t){function n(){return"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process)}function e(){return"function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver}function r(t){function n(){var t=e;e=void 0,t()}var e,r=document.createTextNode(""),o=new t(n);o.observe(r,{characterData:!0});var i=0;return function(t){e=t,r.data=i^=1}}var o,i="undefined"!=typeof setTimeout&&setTimeout,u=function(t,n){return setTimeout(t,n)},c=function(t){return clearTimeout(t)},f=function(t){return i(t,0)};if(n())f=function(t){return process.nextTick(t)};else if(o=e())f=r(o);else if(!i){var a=t,s=a("vertx");u=function(t,n){return s.setTimer(n,t)},c=s.cancelTimer,f=s.runOnLoop||s.runOnContext}return{setTimer:u,clearTimer:c,asap:f}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{}],22:[function(n,e){!function(t){"use strict";t(function(){function t(t){var e="object"==typeof t&&null!==t&&t.stack?t.stack:n(t);return t instanceof Error?e:e+" (WARNING: non-Error used)"}function n(t){var n=String(t);return"[object Object]"===n&&"undefined"!=typeof JSON&&(n=e(t,n)),n}function e(t,n){try{return JSON.stringify(t)}catch(e){return n}}return{formatError:t,formatObject:n,tryStringify:e}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t()})},{}],23:[function(n,e){!function(t){"use strict";t(function(){function t(t,n,e){return t[e]=n,t}function n(t){return"function"==typeof t?t.bind():Object.create(t)}return function(e,r,o,i){return"undefined"==typeof r&&(r=t),Object.keys(i).reduce(function(t,n){var o=i[n];return"function"==typeof o?r(t,e(o),n):t},"undefined"==typeof o?n(i):o)}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t()})},{}],24:[function(n,e){!function(t){"use strict";t(function(){return function(t){function n(t,n){this._handler=t===g?n:e(t)}function e(t){function n(t){o.resolve(t)}function e(t){o.reject(t)}function r(t){o.notify(t)}var o=new w;try{t(n,e,r)}catch(i){e(i)}return o}function r(t){return L(t)?t:new n(g,new j(v(t)))}function o(t){return new n(g,new j(new A(t)))}function i(){return $}function u(){return new n(g,new w)}function c(t,n){var e=new w(t.receiver,t.join().context);return new n(g,e)}function f(t){return s(K,null,t)}function a(t,n){return s(N,t,n)}function s(t,e,r){function o(n,o,u){u.resolved||l(r,i,n,t(e,o,n),u)}function i(t,n,e){s[t]=n,0===--a&&e.become(new k(s))}for(var u,c="function"==typeof e?o:i,f=new w,a=r.length>>>0,s=new Array(a),h=0;h<r.length&&!f.resolved;++h)u=r[h],void 0!==u||h in r?l(r,c,h,u,f):--a;return 0===a&&f.become(new k(s)),new n(g,f)}function l(t,n,e,r,o){if(S(r)){var i=m(r),u=i.state();0===u?i.fold(n,e,void 0,o):u>0?n(e,i.value,o):(o.become(i),h(t,e+1,i))}else n(e,r,o)}function h(t,n,e){for(var r=n;r<t.length;++r)p(v(t[r]),e)}function p(t,n){if(t!==n){var e=t.state();0===e?t.visit(t,void 0,t._unreport):0>e&&t._unreport()}}function d(t){return"object"!=typeof t||null===t?o(new TypeError("non-iterable passed to race()")):0===t.length?i():1===t.length?r(t[0]):y(t)}function y(t){var e,r,o,i=new w;for(e=0;e<t.length;++e)if(r=t[e],void 0!==r||e in t){if(o=v(r),0!==o.state()){i.become(o),h(t,e+1,o);break}o.visit(i,i.resolve,i.reject)}return new n(g,i)}function v(t){return L(t)?t._handler.join():S(t)?b(t):new k(t)}function m(t){return L(t)?t._handler.join():b(t)}function b(t){try{var n=t.then;return"function"==typeof n?new x(n,t):new k(t)}catch(e){return new A(e)}}function g(){}function _(){}function w(t,e){n.createContext(this,e),this.consumers=void 0,this.receiver=t,this.handler=void 0,this.resolved=!1}function j(t){this.handler=t}function x(t,n){w.call(this),I.enqueue(new C(t,n,this))}function k(t){n.createContext(this),this.value=t}function A(t){n.createContext(this),this.id=++Y,this.value=t,this.handled=!1,this.reported=!1,this._report()}function T(t,n){this.rejection=t,this.context=n}function E(t){this.rejection=t}function R(){return new A(new TypeError("Promise cycle"))}function q(t,n){this.continuation=t,this.handler=n}function P(t,n){this.handler=n,this.value=t}function C(t,n,e){this._then=t,this.thenable=n,this.resolver=e}function O(t,n,e,r,o){try{t.call(n,e,r,o)}catch(i){r(i)}}function Q(t,n,e,r){this.f=t,this.z=n,this.c=e,this.to=r,this.resolver=X,this.receiver=this}function L(t){return t instanceof n}function S(t){return("object"==typeof t||"function"==typeof t)&&null!==t}function M(t,e,r,o){return"function"!=typeof t?o.become(e):(n.enterContext(e),F(t,e.value,r,o),void n.exitContext())}function U(t,e,r,o,i){return"function"!=typeof t?i.become(r):(n.enterContext(r),W(t,e,r.value,o,i),void n.exitContext())}function H(t,e,r,o,i){return"function"!=typeof t?i.notify(e):(n.enterContext(r),z(t,e,o,i),void n.exitContext())}function N(t,n,e){try{return t(n,e)}catch(r){return o(r)}}function F(t,n,e,r){try{r.become(v(t.call(e,n)))}catch(o){r.become(new A(o))}}function W(t,n,e,r,o){try{t.call(r,n,e,o)}catch(i){o.become(new A(i))}}function z(t,n,e,r){try{r.notify(t.call(e,n))}catch(o){r.notify(o)}}function J(t,n){n.prototype=V(t.prototype),n.prototype.constructor=n}function K(t,n){return n}function D(){}function G(){return"undefined"!=typeof process&&null!==process&&"function"==typeof process.emit?function(t,n){return"unhandledRejection"===t?process.emit(t,n.value,n):process.emit(t,n)}:"undefined"!=typeof self&&"function"==typeof CustomEvent?function(t,n,e){var r=!1;try{var o=new e("unhandledRejection");r=o instanceof e}catch(i){}return r?function(t,r){var o=new e(t,{detail:{reason:r.value,key:r},bubbles:!1,cancelable:!0});return!n.dispatchEvent(o)}:t}(D,self,CustomEvent):D}var I=t.scheduler,B=G(),V=Object.create||function(t){function n(){}return n.prototype=t,new n};n.resolve=r,n.reject=o,n.never=i,n._defer=u,n._handler=v,n.prototype.then=function(t,n,e){var r=this._handler,o=r.join().state();if("function"!=typeof t&&o>0||"function"!=typeof n&&0>o)return new this.constructor(g,r);var i=this._beget(),u=i._handler;return r.chain(u,r.receiver,t,n,e),i},n.prototype["catch"]=function(t){return this.then(void 0,t)},n.prototype._beget=function(){return c(this._handler,this.constructor)},n.all=f,n.race=d,n._traverse=a,n._visitRemaining=h,g.prototype.when=g.prototype.become=g.prototype.notify=g.prototype.fail=g.prototype._unreport=g.prototype._report=D,g.prototype._state=0,g.prototype.state=function(){return this._state},g.prototype.join=function(){for(var t=this;void 0!==t.handler;)t=t.handler;return t},g.prototype.chain=function(t,n,e,r,o){this.when({resolver:t,receiver:n,fulfilled:e,rejected:r,progress:o})},g.prototype.visit=function(t,n,e,r){this.chain(X,t,n,e,r)},g.prototype.fold=function(t,n,e,r){this.when(new Q(t,n,e,r))},J(g,_),_.prototype.become=function(t){t.fail()};var X=new _;J(g,w),w.prototype._state=0,w.prototype.resolve=function(t){this.become(v(t))},w.prototype.reject=function(t){this.resolved||this.become(new A(t))},w.prototype.join=function(){if(!this.resolved)return this;for(var t=this;void 0!==t.handler;)if(t=t.handler,t===this)return this.handler=R();return t},w.prototype.run=function(){var t=this.consumers,n=this.handler;this.handler=this.handler.join(),this.consumers=void 0;for(var e=0;e<t.length;++e)n.when(t[e])},w.prototype.become=function(t){this.resolved||(this.resolved=!0,this.handler=t,void 0!==this.consumers&&I.enqueue(this),void 0!==this.context&&t._report(this.context))},w.prototype.when=function(t){this.resolved?I.enqueue(new q(t,this.handler)):void 0===this.consumers?this.consumers=[t]:this.consumers.push(t)},w.prototype.notify=function(t){this.resolved||I.enqueue(new P(t,this))},w.prototype.fail=function(t){var n="undefined"==typeof t?this.context:t;this.resolved&&this.handler.join().fail(n)},w.prototype._report=function(t){this.resolved&&this.handler.join()._report(t)},w.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()},J(g,j),j.prototype.when=function(t){I.enqueue(new q(t,this))},j.prototype._report=function(t){this.join()._report(t)},j.prototype._unreport=function(){this.join()._unreport()},J(w,x),J(g,k),k.prototype._state=1,k.prototype.fold=function(t,n,e,r){U(t,n,this,e,r)},k.prototype.when=function(t){M(t.fulfilled,this,t.receiver,t.resolver)};var Y=0;J(g,A),A.prototype._state=-1,A.prototype.fold=function(t,n,e,r){r.become(this)},A.prototype.when=function(t){"function"==typeof t.rejected&&this._unreport(),M(t.rejected,this,t.receiver,t.resolver)},A.prototype._report=function(t){I.afterQueue(new T(this,t))},A.prototype._unreport=function(){this.handled||(this.handled=!0,I.afterQueue(new E(this)))},A.prototype.fail=function(t){this.reported=!0,B("unhandledRejection",this),n.onFatalRejection(this,void 0===t?this.context:t)},T.prototype.run=function(){this.rejection.handled||this.rejection.reported||(this.rejection.reported=!0,B("unhandledRejection",this.rejection)||n.onPotentiallyUnhandledRejection(this.rejection,this.context))},E.prototype.run=function(){this.rejection.reported&&(B("rejectionHandled",this.rejection)||n.onPotentiallyUnhandledRejectionHandled(this.rejection))},n.createContext=n.enterContext=n.exitContext=n.onPotentiallyUnhandledRejection=n.onPotentiallyUnhandledRejectionHandled=n.onFatalRejection=D;var Z=new g,$=new n(g,Z);return q.prototype.run=function(){this.handler.join().when(this.continuation)},P.prototype.run=function(){var t=this.handler.consumers;if(void 0!==t)for(var n,e=0;e<t.length;++e)n=t[e],H(n.progress,this.value,this.handler,n.receiver,n.resolver)},C.prototype.run=function(){function t(t){r.resolve(t)}function n(t){r.reject(t)}function e(t){r.notify(t)}var r=this.resolver;O(this._then,this.thenable,t,n,e)},Q.prototype.fulfilled=function(t){this.f.call(this.c,this.z,t,this.to)},Q.prototype.rejected=function(t){this.to.reject(t)},Q.prototype.progress=function(t){this.to.notify(t)},n}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t()})},{}],25:[function(n,e){!function(t){"use strict";t(function(){function t(){return{state:"pending"}}function n(t){return{state:"rejected",reason:t}}function e(t){return{state:"fulfilled",value:t}}function r(r){var o=r.state();return 0===o?t():o>0?e(r.value):n(r.value)}return{pending:t,fulfilled:e,rejected:n,inspect:r}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t()})},{}],26:[function(n,e){!function(t){t(function(t){function n(t,n){return p(t,this,n||[])}function e(t,n,e,r){var o=u(r);try{switch(e.length){case 2:t.call(n,e[0],e[1],o);break;case 1:t.call(n,e[0],o);break;case 0:t.call(n,o);break;default:e.push(o),t.apply(n,e)}}catch(i){r.reject(i)}}function r(t){return p(t,this,h.call(arguments,1))}function o(t){var n=arguments.length>1?h.call(arguments,1):[];return function(){var e,r=n.length,o=arguments.length,i=new Array(o+r);for(e=0;r>e;++e)i[e]=n[e];for(e=0;o>e;++e)i[e+r]=arguments[e];return p(t,this,i)}}function i(t,n,e){return s(o,n,e,t)}function u(t){return function(n,e){n?t.reject(n):t.resolve(arguments.length>2?h.call(arguments,1):e)}}function c(t,n){function e(t){r(null,t)}function r(t,e){l(function(){n(t,e)},0)}return t=a(t),n&&t.then(e,r),t}function f(t){return function(n){return c(n,t)}}var a=t("./when"),s=t("./lib/liftAll"),l=t("./lib/env").setTimer,h=Array.prototype.slice,p=t("./lib/apply")(a.Promise,e);return{lift:o,liftAll:i,apply:n,call:r,createCallback:u,bindCallback:c,liftCallback:f}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{"./lib/apply":11,"./lib/env":21,"./lib/liftAll":23,"./when":32}],27:[function(n,e){!function(t){t(function(t){var n=t("./when"),e=n.Promise.all,r=Array.prototype.slice;return function(t){return e(r.call(arguments,1)).then(function(e){return n.map(t,function(t){return t.apply(void 0,e)})})}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{"./when":32}],28:[function(n,e){!function(t){t(function(t){var n=t("./when"),e=n.Promise.all,r=Array.prototype.slice;return function(t){var o=function(t,n){return o=function(t,n){return n(t)},n.apply(null,t)};return e(r.call(arguments,1)).then(function(e){return n.reduce(t,function(t,n){return o(t,n)},e)})}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{"./when":32}],29:[function(n,e){!function(t){"use strict";t(function(t){var n=t("./when"),e=n["try"],r=t("./cancelable");return function(t,o,i,u){function c(t){s.resolve(t)}function f(t){e(o).then(a,h),void 0!==t&&s.notify(t)}function a(){l||n(t(),function(t){n(i(t),function(n){return n?c(t):f(t)},function(){f(t)})},h)}var s,l,h;return l=!1,s=r(n.defer(),function(){l=!0}),h=s.reject,i=i||function(){return!1},"function"!=typeof o&&(o=function(t){return function(){return n().delay(t)}}(o)),u?f():a(),s.promise=Object.create(s.promise),s.promise.cancel=s.cancel,s.promise}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{"./cancelable":3,"./when":32}],30:[function(n,e){!function(t){t(function(t){var n=t("./when"),e=n.Promise.all,r=Array.prototype.slice;return function(t){function o(t){return i.push(t),i}var i=[];return e(r.call(arguments,1)).then(function(e){return n.reduce(t,function(t,r){return n(r.apply(void 0,e),o)},i)})}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{"./when":32}],31:[function(n,e){!function(t){t(function(t){var n=t("./when");return function(t,e){return n(e).timeout(t)}})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{"./when":32}],32:[function(n,e){!function(t){"use strict";t(function(t){function n(t,n,e,r){var o=x.resolve(t);return arguments.length<2?o:o.then(n,e,r)}function e(t){return new x(t)}function r(t){return function(){for(var n=0,e=arguments.length,r=new Array(e);e>n;++n)r[n]=arguments[n];return k(t,this,r)}}function o(t){for(var n=0,e=arguments.length-1,r=new Array(e);e>n;++n)r[n]=arguments[n+1];return k(t,this,r)}function i(){return new u}function u(){function t(t){r._handler.resolve(t)}function n(t){r._handler.reject(t)}function e(t){r._handler.notify(t)}var r=x._defer();this.promise=r,this.resolve=t,this.reject=n,this.notify=e,this.resolver={resolve:t,reject:n,notify:e}}function c(t){return t&&"function"==typeof t.then}function f(){return x.all(arguments)}function a(t){return n(t,x.all)}function s(t){return n(t,x.settle)}function l(t,e){return n(t,function(t){return x.map(t,e)})}function h(t,e){return n(t,function(t){return x.filter(t,e)})}var p=t("./lib/decorators/timed"),d=t("./lib/decorators/array"),y=t("./lib/decorators/flow"),v=t("./lib/decorators/fold"),m=t("./lib/decorators/inspect"),b=t("./lib/decorators/iterate"),g=t("./lib/decorators/progress"),_=t("./lib/decorators/with"),w=t("./lib/decorators/unhandledRejection"),j=t("./lib/TimeoutError"),x=[d,y,v,b,g,m,_,p,w].reduce(function(t,n){return n(t)},t("./lib/Promise")),k=t("./lib/apply")(x);return n.promise=e,n.resolve=x.resolve,n.reject=x.reject,n.lift=r,n["try"]=o,n.attempt=o,n.iterate=x.iterate,n.unfold=x.unfold,n.join=f,n.all=a,n.settle=s,n.any=r(x.any),n.some=r(x.some),n.race=r(x.race),n.map=l,n.filter=h,n.reduce=r(x.reduce),n.reduceRight=r(x.reduceRight),n.isPromiseLike=c,n.Promise=x,n.defer=i,n.TimeoutError=j,n})}("function"==typeof t&&t.amd?t:function(t){e.exports=t(n)})},{"./lib/Promise":8,"./lib/TimeoutError":10,"./lib/apply":11,"./lib/decorators/array":12,"./lib/decorators/flow":13,"./lib/decorators/fold":14,"./lib/decorators/inspect":15,"./lib/decorators/iterate":16,"./lib/decorators/progress":17,"./lib/decorators/timed":18,"./lib/decorators/unhandledRejection":19,"./lib/decorators/with":20}]},{},[1])(1)});
;
(function(){"use strict";function e(){}function t(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function n(e){return function(){return this[e].apply(this,arguments)}}var r=e.prototype,i=this,s=i.EventEmitter;r.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t},r.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},r.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},r.addListener=function(e,n){var r,i=this.getListenersAsObject(e),s="object"==typeof n;for(r in i)i.hasOwnProperty(r)&&-1===t(i[r],n)&&i[r].push(s?n:{listener:n,once:!1});return this},r.on=n("addListener"),r.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},r.once=n("addOnceListener"),r.defineEvent=function(e){return this.getListeners(e),this},r.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},r.removeListener=function(e,n){var r,i,s=this.getListenersAsObject(e);for(i in s)s.hasOwnProperty(i)&&(r=t(s[i],n),-1!==r&&s[i].splice(r,1));return this},r.off=n("removeListener"),r.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},r.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},r.manipulateListeners=function(e,t,n){var r,i,s=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)s.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?s.call(this,r,i):o.call(this,r,i));return this},r.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},r.removeAllListeners=n("removeEvent"),r.emitEvent=function(e,t){var n,r,i,s,o=this.getListenersAsObject(e);for(i in o)if(o.hasOwnProperty(i))for(r=o[i].length;r--;)n=o[i][r],n.once===!0&&this.removeListener(e,n.listener),s=n.listener.apply(this,t||[]),s===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},r.trigger=n("emitEvent"),r.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},r.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},r._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},r._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return i.EventEmitter=s,e},"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof module&&module.exports?module.exports=e:i.EventEmitter=e}).call(this);
;
function Delegate(t,e,i){this.delegate=t,this.dt=e,this.count=i}function Core(){EventEmitter.apply(this,arguments),E2.core=this,E2.dt=this.datatypes={FLOAT:{id:0,name:"Float"},SHADER:{id:1,name:"Shader"},TEXTURE:{id:2,name:"Texture"},COLOR:{id:3,name:"Color"},MATRIX:{id:4,name:"Matrix"},VECTOR:{id:5,name:"Vector"},CAMERA:{id:6,name:"Camera"},BOOL:{id:7,name:"Boolean"},ANY:{id:8,name:"Arbitrary"},MESH:{id:9,name:"Mesh"},AUDIO:{id:10,name:"Audio"},SCENE:{id:11,name:"Scene"},MATERIAL:{id:12,name:"Material"},LIGHT:{id:13,name:"Light"},DELEGATE:{id:14,name:"Delegate"},TEXT:{id:15,name:"Text"},VIDEO:{id:16,name:"Video"},ARRAY:{id:17,name:"Typed Array"},OBJECT:{id:18,name:"Object"},GEOMETRY:{id:19,name:"Geometry"},QUATERNION:{id:20,name:"Quaternion"},OBJECT3D:{id:21,name:"Object3D"},VECTOR4:{id:22,name:"Vector 4"},ENVIRONMENTSETTINGS:{id:23,name:"Environment Settings"},CUBETEXTURE:{id:24,name:"CubeTexture"}},this.renderer={matrix_identity:(new THREE.Matrix4).identity(),vector_origin:new THREE.Vector3,material_default:new THREE.MeshBasicMaterial,color_white:new THREE.Color(16777215),color_black:new THREE.Color(0),blend_mode:{NORMAL:1}},this._listeners={},this.runtimeEvents=new EventEmitter,this.assetLoader=new AssetLoader,this.assetLoader.on("progress",function(t){console.log("core progress",t),E2.core.emit("progress",t)}),this.active_graph_dirty=!0,this.active_graph=this.root_graph=null,this.graphs=[],this.abs_t=0,this.delta_t=0,this.graph_uid=this.get_uid(),this.uidCounter=0,this.pluginManager=new PluginManager(this,"/plugins"),this.pluginManager.on("ready",function(){this.onPluginsLoaded()}.bind(this)),this.aux_scripts={},this.aux_styles={},this.resolve_dt=[],this.audioContext=null;for(var t in this.datatypes){var e=this.datatypes[t];this.resolve_dt[e.id]=e}window.AudioContext?this.audioContext=new AudioContext:window.webkitAudioContext?this.audioContext=new webkitAudioContext:msg("NOTE: This host has no AudioContext support.")}var URL_DATA="/data/",URL_GRAPHS="/graph/",URL_GRAPH_FILES=URL_DATA+"graph/",E2={};"undefined"!=typeof window&&(window.E2=E2),"undefined"!=typeof global&&(global.E2=E2),E2.app=null,E2.ui=null,E2.dom={},E2.plugins={},E2.slot_type={input:0,output:1},E2.erase_color="#ff3b3b",E2.COLOR_COMPATIBLE_SLOT="#080",E2.GRAPH_NODES=["graph","loop","array_function"],E2.uid=function(){for(var t="abcdefghjkmnpqrstuvwxyz23456789ABCDEFGHJKLMNPQRSTUVWXYZ",e="",i=0;12>i;i++)e+=t[Math.floor(Math.random()*t.length)];return e},Core.prototype=Object.create(EventEmitter.prototype),Core.prototype.get_uid=function(){return E2.uid()},Core.prototype.update=function(t,e){this.abs_t=t,this.delta_t=e,this.root_graph.update(e);var i=this.active_graph_dirty;return this.active_graph_dirty=!1,i},Core.prototype.create_dialog=function(t,e,i,r,o,a){function n(){d.unbind(),d.remove()}function s(){o(),d.modal("hide")}var d=bootbox.dialog({title:e,message:t,buttons:{OK:function(){}}});d.on("show.bs.modal",function(){$(".modal-dialog",d).css("width",i+40).addClass("patch-inspector")}),d.on("shown.bs.modal",function(){a&&a()}),d.on("hidden.bs.modal",n),d.modal({keyboard:!0}),d.on("keypress",function(t){13===t.keyCode&&"TEXTAREA"!==t.target.nodeName&&s()}),$("button:last",d).click(s)},Core.prototype.get_default_value=function(t){var e=this.datatypes;if(t===e.FLOAT)return 0;if(t===e.COLOR)return new THREE.Color(1,1,1,1);if(t===e.MATRIX)return new THREE.Matrix4;if(t===e.VECTOR)return new THREE.Vector3(0,0,0);if(t===e.CAMERA)return new THREE.PerspectiveCamera;if(t===e.BOOL)return!1;if(t===e.TEXT)return"";if(t===e.ARRAY){var i=new ArrayBuffer(0);return i.stride=i.datatype=1,i}return t===e.OBJECT?{}:null},Core.prototype.serialise=function(){var t={};return t.abs_t=Math.round(this.abs_t*Math.pow(10,4))/Math.pow(10,4),t.active_graph=this.active_graph.uid,t.graph_uid=this.graph_uid,t.root=this.root_graph.serialise(),JSON.stringify(t,void 0,4)},Core.prototype.deserialiseObject=function(t){this.abs_t=t.abs_t,this.delta_t=0,this.graph_uid=""+t.graph_uid,this.active_graph.destroy_ui(),this.graphs=[],this.root_graph=new Graph(this,null,null),this.root_graph.deserialise(t.root),this.graphs.push(this.root_graph),this.root_graph.patch_up(this.graphs),this.root_graph.initialise(this.graphs),this.active_graph=resolve_graph(this.graphs,""+t.active_graph),this.active_graph||(msg("ERROR: The active graph (ID: "+t.active_graph+") is invalid. Using the root graph."),this.active_graph=this.root_graph)},Core.prototype.deserialise=function(t){return this.deserialiseObject(JSON.parse(t))},Core.prototype.rebuild_structure_tree=function(){function t(e,i){var r=e.nodes;if(e.parent_graph){var o=e.parent_graph.tree_node,a=new TreeNode(o.tree,o,i,e);o.children.push(a)}for(var n=0,s=r.length;s>n;n++){var d=r[n];d.plugin.isGraph&&t(d.plugin.graph,d.get_disp_name())}}E2.dom.structure&&(E2.dom.structure.tree.reset(),this.root_graph.tree_node=E2.dom.structure.tree.root,E2.dom.structure.tree.root.graph=this.root_graph,t(this.root_graph,"Root"),E2.dom.structure.tree.root.rebuild_dom())},Core.prototype.add_aux_script=function(t,e){return this.aux_scripts.hasOwnProperty(t)?void(e&&e()):void load_script("/plugins/"+t,function(){this.aux_scripts[t]=!0,e&&e()}.bind(this))},Core.prototype.add_aux_style=function(t){this.aux_styles.hasOwnProperty(t)||(load_style("/plugins/"+t),this.aux_styles[t]=!0)},Core.prototype.onPluginsLoaded=function(){this.emit("ready")},"undefined"!=typeof module&&(module.exports=Core);
;
function clone_recursive(e,n){if(null==e||"object"!=typeof e)return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(e.constructor==Date||e.constructor==RegExp||e.constructor==Function||e.constructor==String||e.constructor==Number||e.constructor==Boolean)return new e.constructor(e);n=n||new e.constructor;for(var t in e)n[t]="undefined"==typeof n[t]?clone_recursive(e[t],null):n[t];return n}function clone(e){return clone_recursive(e,null)}function make(e){return $(document.createElement(e))}function makeButton(e,n,t){return e=e||"",n=n?' title="'+n+'"':"",t=t?" "+t:"",$('<button class="btn btn-xs'+t+'"'+n+">"+e+"</button>")}function resolve_graph(e,n){for(var t=0,o=e.length;o>t;t++)if(e[t].uid===n)return e[t];return-1!==n&&msg("ERROR: Failed to resolve graph("+n+")"),null}function load_style(e){var n=document.createElement("link");n.rel="stylesheet",n.href=e,document.getElementById("head").appendChild(n)}function sort_dict(e){var n,t=[];for(n in e)t.push(n);return t.sort(function(e,n){var t=e.toLowerCase(),o=n.toLowerCase();return o>t?-1:t>o?1:0}),t}function msg(e){var n=E2.dom.dbg;return void 0===n?void console.log(e):(e&&("ERROR: "===e.substring(0,7)?(console.error(e),n.append('<span style="color:#f20">'+e+"</span>\n")):"WARNING: "===e.substring(0,9)?(console.warn(e),n.append('<span style="color:#fa0">'+e+"</span>\n")):"INFO: "===e.substring(0,6)?(console.log(e),n.append('<span style="color:#04f">'+e+"</span>\n")):(console.log(e),n.append(e+"\n"))),void n.scrollTop(n[0].scrollHeight))}function ExpandableTextfield(e,n,t){var o=this;this.node=e,this.tf=n,this.def_width=t,this.update=function(){""+o.tf.val();o.node.geometry_updated()};var r=function(e){return function(){e.update()}}(this);n.change(r),n.keyup(r)}function load_script(e,n,t){var o=document.createElement("script");if(o.src=e,!n)throw new Error("load_script without listener");o.onload=n,o.onerror=t,document.getElementsByTagName("head")[0].appendChild(o)}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame}(),window.cancelAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame}(),E2.util={isFirstTime:function(){return void 0===Cookies.get("vizor100")},isMobile:function(){var e=!1;return function(n){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},isScrolledIntoView:function(e){var n=$(window).scrollTop(),t=n+$(window).height(),o=$(e).offset().top;return t>=o&&o>=n},isTextInputInFocus:function(e){var n=/INPUT|SELECT|TEXTAREA/i,t=n.test(e.target.tagName)||e.target.disabled||e.target.readOnly;return t},checkBrowser:function(){return VizorUI.checkCompatibleBrowser()},isFullscreen:function(){return!(!document.mozFullScreenElement&&!document.webkitFullscreenElement)}},"undefined"!=typeof module&&(module.exports.load_script=load_script);
;
function ConnectionUI(t){this.src_pos=[0,0],this.dst_pos=[0,0],this.src_slot_div=null,this.dst_slot_div=null,this.flow=!1,this.selected=!1,this.deleting=!1,this.parent_conn=t,this.color="#000"}function Connection(t,s,n,i,o){this.src_node=t,this.dst_node=s,this.src_slot=n,this.dst_slot=i,this.ui=null,this.uid=E2.uid(),this.offset=o||0}ConnectionUI.prototype.resolve_slot_divs=function(t){var s=this.parent_conn;t="undefined"==typeof t?!0:!!t,this.src_slot_div=s.src_node.ui.dom.find("#n"+s.src_node.uid+(s.src_slot.dynamic?"do"+s.src_slot.uid:"so"+s.src_slot.index)),this.dst_slot_div=s.dst_node.ui.dom.find("#n"+s.dst_node.uid+(s.dst_slot.dynamic?"di"+s.dst_slot.uid:"si"+s.dst_slot.index)),t&&E2.app.redrawConnection(s)},Connection.prototype.create_ui=function(){return this.ui=new ConnectionUI(this),this.ui},Connection.prototype.destroy_ui=function(){this.ui=null},Connection.prototype.reset=function(){this.ui&&this.ui.flow&&(this.ui.flow=!1,this.ui.color="#000")},Connection.prototype.updateInboundNodes=function(t){if(t.queued_update=1,"input_proxy"!==t.plugin.id){Node.isGraphPlugin(t.plugin.id)&&t.plugin.graph.roots.map(this.updateInboundNodes.bind(this));for(var s=0,n=t.inputs.length;n>s;s++)this.updateInboundNodes(t.inputs[s].src_node)}else{var i=t.parent_graph.plugin;i&&i.parent_node.queued_update<0&&this.updateInboundNodes(i.parent_node)}},Connection.prototype.updateOutboundNodes=function(t){if(t.queued_update=1,"output_proxy"!==t.plugin.id){E2.GRAPH_NODES.indexOf(t.plugin.id)>-1&&t.plugin.graph.roots.map(this.updateOutboundNodes.bind(this));for(var s=0,n=t.outputs.length;n>s;s++)this.updateOutboundNodes(t.outputs[s].dst_node)}else{var i=t.parent_graph.plugin;i&&i.parent_node.queued_update<0&&this.updateOutboundNodes(i.parent_node)}},Connection.prototype.signal_change=function(t){var s=this.src_node;s.plugin.connection_changed&&s.plugin.connection_changed(t,this,this.src_slot);var n=this.dst_node;n.inputs_changed=!0,!t&&n.plugin.update_input&&(void 0!==this.dst_slot.def?(n.plugin.update_input(this.dst_slot,clone(this.dst_slot.def)),n.plugin.updated=!0):(n.plugin.update_input(this.dst_slot,E2.app.player.core.get_default_value(this.dst_slot.dt)),n.plugin.updated=!0)),n.plugin.connection_changed&&(n.plugin.connection_changed(t,this,this.dst_slot),n.plugin.updated=!0),t&&(this.updateInboundNodes(n),this.updateOutboundNodes(n))},Connection.prototype.serialise=function(){var t={};return t.src_nuid=this.src_node.uid,t.dst_nuid=this.dst_node.uid,t.src_slot=this.src_slot.dynamic?this.src_slot.index:this.src_slot.name,t.dst_slot=this.dst_slot.dynamic?this.dst_slot.index:this.dst_slot.name,t.uid=this.uid,t.src_connected=this.src_slot.is_connected,t.dst_connected=this.dst_slot.is_connected,void 0!==this.src_slot.uid&&(t.src_dyn=!0),void 0!==this.dst_slot.uid&&(t.dst_dyn=!0),0!==this.offset&&(t.offset=this.offset),t},Connection.prototype.deserialise=function(t){this.src_node=""+t.src_nuid,this.dst_node=""+t.dst_nuid,this.uid=t.uid||E2.uid(),this.src_slot={dynamic:!!t.src_dyn,is_connected:t.src_connected},this.src_slot.dynamic?this.src_slot.index=t.src_slot:"number"==typeof t.src_slot?this.src_slot.index=t.src_slot:this.src_slot.name=t.src_slot,this.dst_slot={dynamic:!!t.dst_dyn,is_connected:t.dst_connected},this.dst_slot.dynamic?this.dst_slot.index=t.dst_slot:"number"==typeof t.dst_slot?this.dst_slot.index=t.dst_slot:this.dst_slot.name=t.dst_slot,this.offset=t.offset?t.offset:0},Connection.prototype.patch_up=function(t){function s(s){if(s instanceof Node)return s;for(var n=0,i=t.length;i>n;n++)if(t[n].uid===s)return t[n];return msg("ERROR: Failed to resolve node with uid = "+s),null}if(!(this.src_node instanceof Node&&this.dst_slot.is_connected&&this.src_slot.is_connected)){if(this.src_node=s(this.src_node),this.dst_node=s(this.dst_node),!this.src_node||!this.dst_node)return msg("ERROR: Source or destination node invalid - dropping connection."),console.log("Connection that failed",this),!1;var n=this.src_slot.dynamic?this.src_node.dyn_outputs[this.src_slot.index]:this.src_slot.name?this.src_node.findOutputSlotByName(this.src_slot.name):this.src_node.plugin.output_slots[this.src_slot.index],i=this.dst_slot.dynamic?this.dst_node.dyn_inputs[this.dst_slot.index]:this.dst_slot.name?this.dst_node.findInputSlotByName(this.dst_slot.name):this.dst_node.plugin.input_slots[this.dst_slot.index];if(!n||!i)return msg("ERROR: Source or destination slot invalid - dropping connection."),console.error("Connection that failed",this),!1;this.src_slot=n,this.dst_slot=i;var o=E2.dt.ANY;return this.src_slot.dt.id!==this.dst_slot.dt.id&&this.src_slot.dt.id!==o.id&&this.dst_slot.dt.id!==o.id?(msg("ERROR: Connection data type mismatch - dropping connection."),console.log("Connection that failed",this),!1):(this.src_node.addOutput(this),this.dst_node.addInput(this),this.dst_slot.is_connected=this.src_slot.is_connected=!0,!0)}},Connection.hydrate=function(t,s){var n=new Connection;return n.deserialise(s),n.patch_up(t.nodes),n},"undefined"!=typeof module&&(module.exports.Connection=Connection,module.exports.ConnectionUI=ConnectionUI);
;
!function(){function e(e){this.core=e,this.variables={}}e.prototype.lock=function(e,t,r){t in this.variables?(this.variables[t].ref_count++,r>0&&(this.variables[t].connections+=r)):this.variables[t]={dt:E2.dt.ANY,value:null,users:[],ref_count:1,connections:0};var a=this.variables[t].users;e in a||a.push(e)},e.prototype.unlock=function(e,t){if(t in this.variables){var r=this.variables[t];r.users.splice(r.users.indexOf(e),1),0===--r.ref_count&&delete this.variables[t]}},e.prototype.connection_changed=function(e,t){var r=this.variables[e];return t?r.connections++:(r.connections--,r.connections<=0&&(r.connections=0,this.set_datatype(e,E2.dt.ANY,!1))),r.connections},e.prototype.set_datatype=function(e,t,r){for(var a=this.variables[e],i=a.users,s=0,n=i.length;n>s;s++)i[s].variable_dt_changed(t,r);a.dt=t,a.array=r,this.write(e,this.core.get_default_value(t))},e.prototype.read=function(e){return this.variables[e].value},e.prototype.write=function(e,t){var r=this.variables[e],a=r.users;r.value=t;for(var i=0,s=a.length;s>i;i++){var n=a[i];n.variable_updated&&n.variable_updated(t)}},e.prototype.count=function(){var e=0;for(var t in this.variables)this.variables.hasOwnProperty(t)||e++;return e},e.prototype.serialise=function(e){var t=this.variables,r=[];for(id in t)t.hasOwnProperty(id)&&r.push({id:id,dt:t[id].dt.id,array:t[id].array});r.length>0&&(e.variables=r)},e.prototype.deserialise=function(e){for(var t=E2.app.player.core.resolve_dt,r=0,a=e.length;a>r;r++){var i=e[r],s=t[i.dt];this.variables[i.id]={dt:s,array:i.array,value:null,users:[],connections:0,ref_count:0},this.write(i.id,this.core.get_default_value(s))}},E2.Variables=e,"undefined"!=typeof module&&(module.exports.Variables=e)}();
;
function Graph(t,e,n){EventEmitter.call(this),this.nodes=[],this.connections=[],this.core=t,this.variables=new E2.Variables(t),this.parent_graph=e,this.roots=[],this.children=[],this.uid=void 0!==n?n:E2.uid()}if(Graph.prototype=Object.create(EventEmitter.prototype),Graph.prototype.get_node_uid=function(){return E2.core.get_uid()},Graph.prototype.update=function(){var t,e,n=this.nodes,i=this.roots,o=this.children,r=!1;for(t=0,e=n.length;e>t;t++)n[t].update_count=0;for(t=0,e=i.length;e>t;t++)r=i[t].update_recursive(this.connections)||r;for(t=0,e=o.length;e>t;t++)0===o[t].update_count&&(r=o[t].update_recursive(this.connections)||r);for(r&&this===E2.app.player.core.active_graph&&(E2.app.player.core.active_graph_dirty=r),t=0,e=n.length;e>t;t++)n[t].plugin.updated=!1;return r},Graph.prototype.enum_all=function(t,e){if(t)for(var n=this.nodes,i=0,o=n.length;o>i;i++)t(n[i]);if(e)for(var r=this.connections,i=0,o=r.length;o>i;i++)e(r[i])},Graph.prototype.reset=function(){var t,e,n=this.nodes,i=this.connections;for(t=0,e=n.length;e>t;t++)n[t].reset();for(t=0,e=i.length;e>t;t++)i[t].reset()},Graph.prototype.play=function(){this.enum_all(function(t){t.plugin.play&&t.plugin.play()},null)},Graph.prototype.pause=function(){this.enum_all(function(t){t.plugin.pause&&t.plugin.pause()},null)},Graph.prototype.stop=function(){this.enum_all(function(t){t.plugin.stop&&t.plugin.stop()},null)},Graph.prototype.addNode=function(t,e){return this.registerNode(t,e?e.order:null),this.emit("nodeAdded",t,e),t},Graph.prototype.registerNode=function(t,e){return e?this.nodes.splice(e[0],0,t):this.nodes.push(t),this.nuid_lut&&(this.nuid_lut[t.uid]=t),t.plugin.output_slots.length||t.dyn_outputs.length||this.roots.push(t),t.plugin.isGraph&&(e?this.children.splice(e[1],0,t):this.children.push(t),-1===E2.core.graphs.indexOf(t.plugin.graph)&&E2.core.graphs.push(t.plugin.graph)),t},Graph.prototype.removeNode=function(t){function e(e){return t!==e}return this.nodes=this.nodes.filter(e),this.nuid_lut&&delete this.nuid_lut[t.uid],t.plugin.output_slots.length||t.dyn_outputs.length||(this.roots=this.roots.filter(e)),t.plugin.isGraph&&(this.children=this.children.filter(e),E2.core.graphs.splice(E2.core.graphs.indexOf(t.plugin.graph),1)),t.plugin.stop&&t.plugin.stop(),t.plugin.destroy&&t.plugin.destroy(),this.emit("nodeRemoved",t),t},Graph.prototype.renameNode=function(t,e){t.title=e,this.emit("nodeRenamed",t)},Graph.prototype.addConnection=function(t){return this.connections.push(t),t},Graph.prototype.connect=function(t){return this.addConnection(t)},Graph.prototype.disconnect=function(t){var e=this.connections.indexOf(t);-1!==e&&this.connections.splice(e,1),t.dst_node&&t.dst_node.removeInput(t),t.src_node&&t.src_node.removeOutput(t)},Graph.prototype.create_ui=function(){this.nuid_lut=[];for(var t=0,e=this.nodes.length;e>t;t++){var n=this.nodes[t];this.nuid_lut[n.uid]=n}this.enum_all(function(t){t.create_ui(),t.plugin.state_changed&&t.plugin.state_changed(t.ui.pluginUI)},function(t){t.create_ui(),t.ui.resolve_slot_divs()})},Graph.prototype.destroy_ui=function(){this.enum_all(function(t){t.destroy_ui()},function(t){t.destroy_ui()}),delete this.nuid_lut},Graph.prototype.find_connection_to=function(t,e){if(e.type===E2.slot_type.input){var n=t.uid;return this.connections.filter(function(t){return t.dst_node.uid===n&&t.dst_slot===e})[0]}},Graph.prototype.find_connections_from=function(t,e){if(e.type!==E2.slot_type.output)return[];var n=t.uid;return this.connections.filter(function(t){return t.src_node.uid===n&&t.src_slot===e})},Graph.prototype.serialise=function(){var t={};return t.uid=this.uid,t.parent_uid=this.parent_graph?this.parent_graph.uid:-1,t.open=this.open,t.nodes=[],t.conns=[],this.enum_all(function(e){t.nodes.push(e.serialise())},function(e){t.conns.push(e.serialise())}),this.variables.serialise(t),t},Graph.prototype.deserialise=function(t){this.uid=""+t.uid,this.parent_graph=t.parent_uid,this.nodes=[],this.roots=[],this.children=[],this.open=t.open||!1;var e,n;for(e=0,n=t.nodes.length;n>e;e++){var i=new Node;i.deserialise(this.uid,t.nodes[e])&&this.registerNode(i)}for(this.connections=[],e=0,n=t.conns.length;n>e;e++){var o=new Connection;o.deserialise(t.conns[e]),this.connections.push(o)}t.registers&&(t.variables=t.registers),t.variables&&this.variables.deserialise(t.variables)},Graph.prototype.patch_up=function(t){this.parent_graph instanceof Graph||(this.parent_graph=Graph.resolve_graph(t,this.parent_graph));var e,n,i=this.nodes,o=this.connections;for(e=0,n=i.length;n>e;e++)i[e].patch_up(t);var r=[];for(e=0,n=o.length;n>e;e++){var s=o[e];s.patch_up(this.nodes)||r.push(s)}for(e=0,n=r.length;n>e;e++){var p=o.indexOf(r[e]);p>-1&&o.splice(p,1)}},Graph.prototype.initialise=function(){for(var t=this.nodes,e=0,n=t.length;n>e;e++)t[e].initialise();this.reset()},Graph.prototype.getTitle=function(){return this.title},Graph.prototype.reorder_children=function(t,e,n){function i(i){var o=i.indexOf(t);o>-1&&i.splice(o,1);var r=i.indexOf(e);n&&r++,i.splice(r,0,t)}i(this.children),i(this.nodes)},Graph.prototype.findConnectionByUid=function(t){var e;return this.connections.some(function(n){return n.uid===t?(e=n,!0):void 0}),e},Graph.prototype.findNodeByUid=function(t){var e;return this.nodes.some(function(n){return n.uid===t?(e=n,!0):void 0}),e||(msg("ERROR: Failed to resolve node("+t+") in graph("+this.uid+")"),console.log("Graph nodes",this.nodes)),e},Graph.prototype.findNodeByPlugin=function(t){var e;return this.nodes.some(function(n){return n.plugin.id===t?(e=n,!0):void 0}),e||msg("ERROR: Failed to resolve node by plugin ("+t+") in graph("+this.uid+")"),e},Graph.lookup=function(t){return Graph.resolve_graph(E2.core.graphs,t)},Graph.resolve_graph=function(t,e){for(var n=0,i=t.length;i>n;n++)if(t[n].uid===e)return t[n];return-1!==e&&(msg("ERROR: Failed to resolve graph("+e+")"),console.log("Graphs",t)),null},"undefined"!=typeof module){module.exports=Graph;var Connection=require("./connection").Connection}
;
function Node(t,i,e,n){EventEmitter.call(this),this.x=0,this.y=0,this.inputs=[],this.outputs=[],this.queued_update=-1,this.dyn_inputs=[],this.dyn_outputs=[],this.uid=E2.uid(),i&&(this.parent_graph=t,this.x=e,this.y=n,this.ui=null,this.id=E2.core.pluginManager.keybyid[i],this.update_count=0,this.title=null,this.inputs_changed=!1,this.open=!0,this.set_plugin(E2.core.pluginManager.create(i,this)))}function LinkedSlotGroup(t,i,e,n){this.core=t,this.node=i,this.inputs=e,this.outputs=n,this.n_connected=0,this.dt=t.datatypes.ANY}Node.prototype=Object.create(EventEmitter.prototype),Node.prototype.getConnections=function(){return this.inputs.concat(this.outputs)},Node.prototype.getDynamicInputSlots=function(){return this.dyn_inputs},Node.prototype.getDynamicOutputSlots=function(){return this.dyn_outputs},Node.prototype.set_plugin=function(t){function i(i,n,s){if(i.type=s,i.index=n,e.indexOf(""+s+i.name)>-1)throw new Error("Double slot name "+i.name+" in "+t.id);e.push(""+s+i.name),i.dt||msg("ERROR: The slot '"+i.name+"' does not declare a datatype.")}this.plugin=t,this.plugin.updated=!0;for(var e=[],n=0,s=t.input_slots.length;s>n;n++)i(t.input_slots[n],n,E2.slot_type.input);for(var n=0,s=t.output_slots.length;s>n;n++)i(t.output_slots[n],n,E2.slot_type.output);this.plugin.parentNode=this},Node.prototype.setOpenState=function(t){this.open=t,this.emit("openStateChanged",t)},Node.prototype.create_ui=function(){this.ui=new NodeUI(this,this.x,this.y)},Node.prototype.destroy_ui=function(){this.ui&&(this.ui.destroy&&this.ui.destroy(),this.ui=null,this.plugin.destroy_ui&&this.plugin.destroy_ui())},Node.prototype.destroy=function(){var t=this.parent_graph,i=t.nodes.indexOf(this),e=[];this.plugin.destroy&&this.plugin.destroy(),-1!==i&&t.nodes.splice(i,1),e.push.apply(e,this.inputs),e.push.apply(e,this.outputs);for(var n=0,s=e.length;s>n;n++)t.disconnect(e[n]);this.destroy_ui()},Node.prototype.get_disp_name=function(){return this.title?this.title:this.id},Node.prototype.reset=function(){var t=this.plugin;t.reset&&(t.reset(),t.updated=!0)},Node.prototype.geometry_updated=function(){if(!(this.outputs.length<1)){for(var t=0,i=this.outputs.length;i>t;t++){var e=this.outputs[t];E2.app.getSlotPosition(e.src_node,e.ui.src_slot_div,E2.slot_type.output,e.ui.src_pos)}E2.app.updateCanvas(!0)}},Node.prototype.add_slot=function(t,i){var e=t===E2.slot_type.input,n=e?this.dyn_inputs:this.dyn_outputs;if((void 0===i.uid||null===i.uid)&&(i.uid=E2.uid()),!i.dt)return msg("ERROR: No datatype given for slot"),console.trace("No datatype given for slot"),!1;if(!i.name)return msg("ERROR: No name given for slot"),console.trace("No name given for slot"),!1;i.dynamic=!0,i.type=t,void 0===i.index&&(i.index=n.length),n.splice(i.index,0,i);for(var s=0,o=n.length;o>s;s++)n[s].index=s;return this.emit("slotAdded",i),i.uid},Node.prototype.remove_slot=function(t,i){var e,n,s,o=t===E2.slot_type.input,u=o?this.dyn_inputs:this.dyn_outputs;if(u.length){var p=null,r=-1;for(n=0,s=u.length;s>n;n++)if(e=u[n],e.uid===i){p=e,r=n,u.splice(n,1);break}if(p){if(u.length)for(n=0,s=u.length;s>n;n++)u[n].index=n;this.ui&&this.ui.redrawSlots();var d=o?this.inputs:this.outputs,a=[];for(n=0,s=d.length;s>n;n++){var h=d[n];e=o?h.dst_slot:h.src_slot,e===p&&a.push(h)}for(n=0,s=a.length;s>n;n++)this.parent_graph.disconnect(a[n]);this.emit("slotRemoved",p)}}},Node.prototype.findInputSlotByName=function(t){var i;return this.plugin.input_slots.some(function(e){return e.name===t?(i=e,!0):void 0}),i||console.error("findInputSlotByName not found",t),i},Node.prototype.findOutputSlotByName=function(t){var i;return this.plugin.output_slots.some(function(e){return e.name===t?(i=e,!0):void 0}),i||console.error("findOutputSlotByName not found",t),i},Node.prototype.findSlotByUid=function(t){var i;return this.dyn_inputs.concat(this.dyn_outputs).some(function(e){return e.uid===t?(i=e,!0):void 0}),i||console.error("Slot not found",t),i},Node.prototype.find_dynamic_slot=function(t,i){for(var e=t===E2.slot_type.input?this.dyn_inputs:this.dyn_outputs,n=0,s=e.length;s>n;n++)if(e[n].uid===i)return e[n];console.error("Slot not found",t,i)},Node.prototype.rename_slot=function(t,i,e){var n=this.find_dynamic_slot(t,i),s=!1;return n&&(n.name=e,this.ui&&(s=this.ui.renameSlot(n,e,i,t))),s},Node.prototype.change_slot_datatype=function(t,i,e,n){var s=this.find_dynamic_slot(t,i),o=this.parent_graph;if(s.array=n,s.dt.id===e.id)return!1;if(s.dt.id!==o.core.datatypes.ANY.id){for(var u=t===E2.slot_type.input?this.inputs:this.outputs,p=[],r=null,d=0,a=u.length;a>d;d++)r=u[d],(r.src_node===this||r.dst_node===this)&&p.push(r);for(var d=0,a=p.length;a>d;d++)o.disconnect(p[d])}return s.dt=e,!0},Node.prototype.addInput=function(t){var i=this.inputs.some(function(i,e){return i.dst_slot.index>t.dst_slot.index?(this.inputs.splice(e,0,t),!0):void 0}.bind(this));i||this.inputs.push(t)},Node.prototype.addOutput=function(t){this.outputs.push(t)},Node.prototype.removeOutput=function(t){t.dst_slot.is_connected=!1,this.outputs.splice(this.outputs.indexOf(t),1)},Node.prototype.removeInput=function(t){t.dst_slot.is_connected=!1,this.inputs.splice(this.inputs.indexOf(t),1)},Node.prototype.update_connections=function(){return this.outputs.forEach(function(t){E2.app.getSlotPosition(t.src_node,t.ui.src_slot_div,E2.slot_type.output,t.ui.src_pos)}),this.inputs.forEach(function(t){E2.app.getSlotPosition(t.dst_node,t.ui.dst_slot_div,E2.slot_type.input,t.ui.dst_pos)}),this.inputs.length+this.outputs.length},Node.prototype._cascadeFlowOff=function(t){if(t.ui.flow=!1,t.src_node.inputs.length)for(var i=0;i<t.src_node.inputs.length;i++)t.src_node.inputs[i].ui.flow&&this._cascadeFlowOff(t.src_node.inputs[i])},Node.prototype._cascadeForceUpdate=function(t){if(t.src_node.plugin.updated=!0,t.src_node.inputs.length)for(var i=0,e=t.src_node.inputs.length;e>i;i++)this._cascadeForceUpdate(t.src_node.inputs[i])},Node.prototype._update_input=function(t,i,e,n){var s={dirty:!1,needs_update:n},o=t.src_node;s.dirty=o.update_recursive(e);var u=o.plugin.update_output(t.src_slot);return!o.plugin.updated||o.plugin.query_output&&!o.plugin.query_output(t.src_slot)?t.ui&&t.ui.flow&&(t.ui.flow=!1,s.dirty=!0):(t.dst_slot.array&&!t.src_slot.array?u=[u]:!t.dst_slot.array&&t.src_slot.array&&(u=u[0]),i.update_input(t.dst_slot,t.dst_slot.validate?t.dst_slot.validate(u):u),i.updated=!0,s.needs_update=!0,t.ui&&!t.ui.flow&&(s.dirty=!0,t.ui.flow=!0)),s},Node.prototype.update_recursive=function(t){var i=!1;if(this.update_count>0)return i;this.update_count++;for(var e=this.inputs,n=this.plugin,s=this.inputs_changed||n.updated,o=[],u=0,p=e.length;p>u;++u){var r=e[u];r.dst_slot.inactive&&(r.ui&&r.ui.flow&&(this._cascadeFlowOff(r),i=!0),o.push(r))}for(var d=o.length>0,u=0,p=e.length;p>u;++u){var r=e[u];if(d){if(r.dst_slot.inactive)continue;if(-1!==o.indexOf(r))continue}var a=this._update_input(r,n,t,s);i=i||a.dirty,s=s||a.needs_update}for(var u=0,p=o.length;p>u;++u){var r=o[u];if(!r.dst_slot.inactive){this._cascadeForceUpdate(r);var a=this._update_input(r,n,t,s);i=i||a.dirty,s=s||a.needs_update}}return n.always_update||n.isGraph&&n.state.always_update?n.update_state():this.queued_update>-1?(n.update_state&&n.update_state(),n.updated=!0,this.queued_update--):s||0===n.output_slots.length&&(!this.outputs||0===this.outputs.length)?(n.update_state&&n.update_state(),this.inputs_changed=!1):0!==n.input_slots.length||this.inputs&&0!==this.inputs.length||n.update_state&&n.update_state(),i},Node.prototype.setPluginState=function(t,i){this.plugin.state[t]=i,this.plugin.updated=!0,this.plugin.dirty=!0,this.emit("pluginStateChanged",t,i)},Node.prototype.serialise=function(t){function i(t){for(var i=0,e=t.length;e>i;i++)delete t[i].desc,t[i].dt=t[i].dt.id}var e={};return e.plugin=this.plugin.id,e.x=Math.round(this.x),e.y=Math.round(this.y),e.uid=this.uid,this.open||(e.open=this.open),this.plugin.state&&(e.state=this.plugin.state),this.title&&(e.title=this.title),!t&&this.plugin.isGraph&&(e.graph=this.plugin.graph.serialise()),(this.dyn_inputs.length||this.dyn_outputs.length)&&(this.dyn_inputs.length&&(e.dyn_in=clone(this.dyn_inputs),i(e.dyn_in)),this.dyn_outputs.length&&(e.dyn_out=clone(this.dyn_outputs),i(e.dyn_out))),e},Node.prototype.fixStateSidsIssue135=function(t){function i(t){Object.keys(t).map(function(i){t[""+i]=""+t[i]})}t.input_sids&&i(t.input_sids),t.output_sids&&i(t.output_sids)},Node.prototype.deserialise=function(t,i){function e(t,i){for(var e=E2.core.resolve_dt,n=0;n<t.length;n++){var s=t[n];s.uid=""+s.uid,s.dynamic=!0,s.dt=e[s.dt],s.type=i}}var n={register_local_read:"variable_local_read",register_local_write:"variable_local_write"};n[i.plugin]&&(i.plugin=n[i.plugin]),this.parent_graph=t,this.x=i.x,this.y=i.y,this.id=E2.core.pluginManager.keybyid[i.plugin],this.uid=""+i.uid,this.open=void 0!==i.open?i.open:!0,this.title=i.title?i.title:null;var s=E2.core.pluginManager.create(i.plugin,this);if(!s)return msg("ERROR: Failed to instance node of type '"+i.plugin+"' with title '"+this.title+"' and UID = "+this.uid+"."),!1;if(this.set_plugin(s),this.plugin.isGraph&&(this.plugin.setGraph(new Graph(E2.core,null,null)),this.plugin.graph.plugin=this.plugin,this.plugin.graph.deserialise(i.graph),-1===E2.core.graphs.indexOf(this.plugin.graph)&&E2.core.graphs.push(this.plugin.graph)),i.state&&this.plugin.state){this.fixStateSidsIssue135(i.state);for(var o in i.state)i.state.hasOwnProperty(o)&&o in this.plugin.state&&(this.plugin.state[o]=i.state[o])}return(i.dyn_in||i.dyn_out)&&(i.dyn_in&&(this.dyn_inputs=i.dyn_in,e(this.dyn_inputs,E2.slot_type.input)),i.dyn_out&&(this.dyn_outputs=i.dyn_out,e(this.dyn_outputs,E2.slot_type.output))),!0},Node.prototype.patch_up=function(t){function i(t,e){if(e.parent_graph=t,e.plugin.isGraph){void 0===e.plugin.graph.uid&&(e.plugin.graph.uid=E2.core.get_uid()),e.plugin.graph.parent_graph=t;for(var n=e.plugin.graph.nodes,s=0,o=n.length;o>s;s++)i(e.plugin.graph,n[s])}}this.parent_graph instanceof Graph||(this.parent_graph=Graph.resolve_graph(t,this.parent_graph)),i(this.parent_graph,this),this.plugin.isGraph&&this.plugin.graph.patch_up(t)},Node.prototype.initialise=function(){this.plugin.state_changed&&this.plugin.state_changed(null),this.plugin.isGraph&&this.plugin.graph.initialise()},Node.hydrate=function(t,i){var e=new Node;return e.deserialise(t,i),e.patch_up(E2.core.graphs),e},Node.isGraphPlugin=function(t){return["graph","loop","array_function"].indexOf(t)>-1},LinkedSlotGroup.prototype.setArrayness=function(t){for(var i=0,e=this.inputs.length;e>i;i++)this.inputs[i].array=t;for(var i=0,e=this.outputs.length;e>i;i++)this.outputs[i].array=t},LinkedSlotGroup.prototype.set_dt=function(t){this.dt=t;for(var i=0,e=this.inputs.length;e>i;i++)this.inputs[i].dt=t;for(var i=0,e=this.outputs.length;e>i;i++)this.outputs[i].dt=t},LinkedSlotGroup.prototype.add_dyn_slot=function(t){(t.type===E2.slot_type.input?this.inputs:this.outputs).push(t)},LinkedSlotGroup.prototype.remove_dyn_slot=function(t){var i=t.type===E2.slot_type.input?this.inputs:this.outputs,e=i.indexOf(t);e>-1&&i.splice(e,1)},LinkedSlotGroup.prototype.connection_changed=function(t,i,e){if(-1!==this.inputs.indexOf(e)||-1!==this.outputs.indexOf(e)){if(this.n_connected+=t?1:-1,t&&1===this.n_connected){var n=e.type===E2.slot_type.input?i.src_slot:i.dst_slot;return this.set_dt(n.dt),this.setArrayness(n.array),!0}return t||0!==this.n_connected?!1:(this.set_dt(this.core.datatypes.ANY),this.setArrayness(!1),!0)}},LinkedSlotGroup.prototype.infer_dt=function(){for(var t=this.node,i=null,e=this.core.datatypes.ANY.id,n=!1,s=0,o=t.inputs.length;o>s;s++){var u=t.inputs[s];-1!==this.inputs.indexOf(u.dst_slot)&&(i=u.src_slot.dt.id!==e?u.src_slot.dt:i,u.src_slot.array&&(n=!0),this.n_connected++)}for(var s=0,o=t.outputs.length;o>s;s++){var u=t.outputs[s];-1!==this.outputs.indexOf(u.src_slot)&&(i=u.dst_slot.dt.id!==e?u.dst_slot.dt:i,u.dst_slot.array&&(n=!0),this.n_connected++)}return this.setArrayness(n),i?(this.set_dt(i),this.core.get_default_value(i)):null},LinkedSlotGroup.prototype.updateFreeSlots=function(){},"undefined"!=typeof module&&(module.exports.Node=Node,module.exports.LinkedSlotGroup=LinkedSlotGroup);
;
function AutoSlotGroup(){LinkedSlotGroup.apply(this,arguments)}AutoSlotGroup.prototype=Object.create(LinkedSlotGroup.prototype),AutoSlotGroup.prototype.updateFreeSlots=function(){function t(){E2.app.graphApi.addSlot(e.node.parent_graph,e.node,{type:E2.slot_type.input,name:n.length+"",dt:e.dt,array:n.length>0?n[0].array:!1})}function o(){var t=n;if(t){var o=t[t.length-1].uid;E2.app.graphApi.removeSlot(e.node.parent_graph,e.node,o)}}var e=this,n=this.node.getDynamicInputSlots(),p=n.length-1;if(p>0&&!n[p].is_connected)for(;p>0&&!n[p-1].is_connected;)o(),--p;else(0===n.length||n[n.length-1].is_connected)&&t()},"undefined"!=typeof module&&(module.exports.AutoSlotGroup=AutoSlotGroup);
;
function Plugin(t,e){var n=this;this.core=t,this.node=e,this.state={},this._oldState={},this.node.on("pluginStateChanged",function(){n.state_changed&&n.node.ui&&n.node.ui.pluginUI&&n.state_changed(n.node.ui.pluginUI)}),this.inputValues={}}Plugin.prototype.undoableSetState=function(t,e,n){E2.app.undoManager.execute(new E2.commands.graph.ChangePluginState(this.node.parent_graph,this.node,t,n,e))},Plugin.prototype.transientSetState=function(t,e){E2.app.dispatcher.dispatch({actionType:"uiPluginTransientStateChanged",graphUid:this.node.parent_graph.uid,nodeUid:this.node.uid,key:t,value:e})},Plugin.prototype.reset=function(){var t=this;this.inputValues={},this.input_slots.map(function(e){var n=void 0!==e.def?e.def:t.core.get_default_value(e.dt);t.inputValues[e.name]=n})},Plugin.prototype.update_input=function(t,e){this.inputValues[t.name]=e},Plugin.prototype.beginBatchModifyState=function(){var t=this,e=t.state,n=t._oldState;return n?Object.keys(n).forEach(function(t){delete n[t]}):n=this._oldState={},Object.keys(e).forEach(function(t){n[t]=e[t]}),!0},Plugin.prototype.endBatchModifyState=function(t){var e=this,n=e.state,i=e._oldState;if(i&&0!==Object.keys(i).length)return E2.app.undoManager.begin(t),Object.keys(n).forEach(function(t){i[t]!==n[t]&&e.undoableSetState(t,n[t],i[t])}),E2.app.undoManager.end(),Object.keys(i).forEach(function(t){delete i[t]}),!0},"undefined"!=typeof module&&(module.exports=Plugin);
;
function SubGraphPlugin(t,i){this.core=t,this.node=i,this.parent_node=i,this.updated_sids=[],this.input_nodes={},this.output_nodes={},this.ui=null,this.isGraph=!0}SubGraphPlugin.prototype.reset=function(){this.graph&&this.graph.reset()},SubGraphPlugin.prototype.play=function(){this.graph&&this.graph.play()},SubGraphPlugin.prototype.pause=function(){this.graph&&this.graph.pause()},SubGraphPlugin.prototype.stop=function(){this.graph&&this.graph.stop()},SubGraphPlugin.prototype.get_dt_name=function(t){return t&&t.name?t.name:"ERROR"},SubGraphPlugin.prototype.dbg=function(t){msg("Graph: "+t)},SubGraphPlugin.prototype.onProxySlotDisconnected=function(t,i){var u;if(i.type===E2.slot_type.input){var n=this.input_nodes[i.uid];if(!n)return;u=n.dyn_outputs[0],n.plugin.data=this.core.get_default_value(i.dt),n.reset()}else{for(var o=this.parent_node,e=0,p=0,s=o.outputs.length;s>p;p++)o.outputs[p].src_slot===i&&e++;0===e&&(u=this.output_nodes[i.uid].dyn_inputs[0])}u&&!u.connected&&(u.dt=i.dt=this.core.datatypes.ANY)},SubGraphPlugin.prototype.connection_changed=function(t,i,u){var n=null,o=this.core;if(t){var e=null;if(u.type===E2.slot_type.input){if(u.dt.id===E2.dt.ANY.id&&(u.dt=i.src_slot.dt,u.array=i.src_slot.array),e=this.input_nodes[u.uid],!e)return;n=e.dyn_outputs[0]}else{if(u.dt.id===E2.dt.ANY.id&&(u.dt=i.dst_slot.dt,u.array=i.dst_slot.array),e=this.output_nodes[u.uid],!e)return;n=e.dyn_inputs[0]}n.dt.id===E2.dt.ANY.id&&(n.dt=u.dt,n.array=u.array),this.graph&&this.graph.enum_all(function(t){t.plugin.updated=!0}),this.updated=!0,e.plugin.data=o.get_default_value(u.dt)}else this.onProxySlotDisconnected(i,u)},SubGraphPlugin.prototype.proxy_connection_changed=function(t,i,u,n,o){function e(t,i){for(var u in t)if(t[u].uid===i)return u;return msg("ERROR: Failed to resolve node("+i+") in graph("+r.graph.plugin.parent_node.title+")."),-1}function p(t){var i,u;if(t.type===E2.slot_type.input){for(i=0,u=l.inputs.length;u>i;i++)if(l.inputs[i].dst_slot===t)return!0}else for(i=0,u=l.outputs.length;u>i;i++)if(l.outputs[i].src_slot===t)return!0;return!1}function s(s,d){if(n.connected=!0,t)n.dt.id===a.datatypes.ANY.id&&(n.dt=o.dt,o.array&&(n.array=o.array),i.plugin.data=a.get_default_value(o.dt),d.dt=o.dt,d.array=o.array);else if(s){var _,h,y,g=l.parent_graph.connections,c=!1;for(_=0,h=g.length;h>_;_++){var f=g[_];if(f.dst_slot===d||f.src_slot===d){c=!0;break}}if(n.connected=!1,c||(n.dt=d.dt=a.datatypes.ANY),"input_proxy"===u.plugin.id){for(c=!1,_=0,h=u.outputs.length;h>_;_++)if(u.outputs[_].src_slot===o){c=!0;break}y=l.find_dynamic_slot(E2.slot_type.input,e(r.input_nodes,u.uid)),c||p(y)||(o.dt=y.dt=a.datatypes.ANY)}else"output_proxy"===u.plugin.id&&(y=l.find_dynamic_slot(E2.slot_type.output,e(r.output_nodes,u.uid)),p(rgsl)||(o.dt=y.dt=a.datatypes.ANY))}}var d,r=this,a=this.core,l=this.parent_node;"input_proxy"===i.plugin.id?(d=0===i.outputs.length,s(d,l.find_dynamic_slot(E2.slot_type.input,e(this.input_nodes,i.uid))),this.dbg("    Output count = "+i.outputs.length)):(d=0===i.inputs.length,s(d,l.find_dynamic_slot(E2.slot_type.output,e(this.output_nodes,i.uid))),this.dbg("    Input count = "+i.inputs.length))},SubGraphPlugin.prototype.update_output=function(t){return t.dynamic?this.output_nodes[t.uid].plugin.data:(this.updated=!0,this.texture)},SubGraphPlugin.prototype.query_output=function(t){return void 0===t.uid||this.updated_sids.indexOf(t.uid)>-1},SubGraphPlugin.prototype.destroy_slot=function(t,i){var u=t===E2.slot_type.input?this.state.input_sids:this.state.output_sids,n=u[i];delete u[i],this.parent_node.remove_slot(t,n)},SubGraphPlugin.prototype.setupProxies=function(){function t(t){var u=i.graph.findNodeByUid(t);if(!u)return msg("ERROR: Failed to find registered proxy node("+t+") in graph("+i.graph.plugin.parent_node.title+").");var n=u.plugin;return n.data=E2.core.get_default_value(("input_proxy"===n.id?u.dyn_outputs:u.dyn_inputs)[0].dt),u}var i=this;for(var u in this.state.input_sids)this.input_nodes[this.state.input_sids[u]]=t(u);for(var u in this.state.output_sids)this.output_nodes[this.state.output_sids[u]]=t(u)},SubGraphPlugin.prototype.setGraph=function(t){var i=this,u=this.parent_node;this.graph=t,this.graph.on("nodeAdded",function(t,n){var o,e=t.plugin.id,p={name:t.title,dt:E2.dt.ANY,index:n&&n.proxy?n.proxy.index:null,uid:n&&n.proxy?n.proxy.sid:null};"input_proxy"===e?(o=u.add_slot(E2.slot_type.input,p),i.state.input_sids[t.uid]=o,i.input_nodes[o]=t):"output_proxy"===e&&(o=u.add_slot(E2.slot_type.output,p),i.state.output_sids[t.uid]=o,i.output_nodes[o]=t)}).on("nodeRemoved",function(t){var u=t.plugin.id;"input_proxy"===u?i.destroy_slot(E2.slot_type.input,t.uid):"output_proxy"===u&&i.destroy_slot(E2.slot_type.output,t.uid)}).on("nodeRenamed",function(t){var n=t.plugin.id;"input_proxy"===n?u.rename_slot(E2.slot_type.input,i.state.input_sids[t.uid],t.title):"output_proxy"===n&&u.rename_slot(E2.slot_type.output,i.state.output_sids[t.uid],t.title)})},"undefined"!=typeof module&&(module.exports=SubGraphPlugin);
;
function ThreeObject3DPlugin(t){Plugin.apply(this,arguments),this.desc="THREE.js Object3D",this.input_slots=[{name:"position",dt:t.datatypes.VECTOR},{name:"rotation",dt:t.datatypes.VECTOR},{name:"scale",dt:t.datatypes.VECTOR,def:new THREE.Vector3(1,1,1)},{name:"visible",dt:t.datatypes.BOOL,def:!0},{name:"castShadow",dt:t.datatypes.BOOL},{name:"receiveShadow",dt:t.datatypes.BOOL},{name:"name",dt:t.datatypes.TEXT,def:""},{name:"stereo view",dt:t.datatypes.FLOAT,def:0,desc:"Affects how this object is rendered in stereo<br/>Stereo View - 0: both eyes, 1: left eye only, 2: right eye only"},{name:"lock transform",dt:t.datatypes.BOOL,def:!1,desc:"if enabled, this object's transform is locked and can't be adjusted in the 3d editor."}],this.output_slots=[{name:"object3d",dt:t.datatypes.OBJECT3D}],this.state={position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},quaternion:{_x:0,_y:0,_z:0,_w:1}},this.pivot={x:0,y:0,z:0},this.lockTransformControls=!1,this.graphInputs={position:new THREE.Vector3(0,0,0),scale:new THREE.Vector3(0,0,0),quaternion:new THREE.Quaternion(0,0,0,1)}}ThreeObject3DPlugin.prototype=Object.create(Plugin.prototype),ThreeObject3DPlugin.prototype.reset=function(){Plugin.prototype.reset.apply(this,arguments),this.object3d||(this.object3d=new THREE.Object3D),this.object3d.scale.set(this.state.scale.x,this.state.scale.y,this.state.scale.z),this.object3d.position.set(this.state.position.x,this.state.position.y,this.state.position.z),this.object3d.quaternion.set(this.state.quaternion._x,this.state.quaternion._y,this.state.quaternion._z,this.state.quaternion._w)},ThreeObject3DPlugin.prototype.update_input=function(t,e){if(this.object3d){this.inputValues[t.name]=e;var s=this,i=[function(){s.graphInputs.position.x=e.x,s.graphInputs.position.y=e.y,s.graphInputs.position.z=e.z},function(){s.graphInputs.quaternion.setFromEuler(new THREE.Euler(e.x,e.y,e.z,"YZX"))},function(){s.graphInputs.scale.x=e.x,s.graphInputs.scale.y=e.y,s.graphInputs.scale.z=e.z},function(){s.object3d.visible=e},function(){s.object3d.castShadow=e},function(){s.object3d.receiveShadow=e},function(){s.object3d.name=e},function(){s.object3d.layers.set(e)},function(){s.lockTransformControls=e}],n=this.node.plugin.input_slots.length-i.length,o=t.index-n;i[o]?void 0!==e&&i[o]():this.object3d[t.name]=e}},ThreeObject3DPlugin.prototype.update_output=function(){return this.object3d},ThreeObject3DPlugin.prototype.state_changed=function(t){},ThreeObject3DPlugin.prototype.update_state=function(){this.object3d.scale.set(this.graphInputs.scale.x+this.state.scale.x,this.graphInputs.scale.y+this.state.scale.y,this.graphInputs.scale.z+this.state.scale.z),this.object3d.position.set(this.graphInputs.position.x+this.state.position.x+this.pivot.x,this.graphInputs.position.y+this.state.position.y+this.pivot.y,this.graphInputs.position.z+this.state.position.z+this.pivot.z),this.object3d.quaternion.set(this.state.quaternion._x,this.state.quaternion._y,this.state.quaternion._z,this.state.quaternion._w),this.object3d.quaternion.multiply(this.graphInputs.quaternion)},"undefined"!=typeof module&&(module.exports=ThreeObject3DPlugin);
;
!function(){function t(t){function e(t){t.nodes&&t.nodes.map(function(t){return"graph"===t.plugin.id?e(t.plugin.graph):void(-1!==o.indexOf(t.plugin.id)&&n.push(t))})}var n=[];return e(t),n}function e(){var e={};return t(E2.core.root_graph).map(function(t){var n="Mesh";return t.parent_graph.plugin&&(n=t.parent_graph.plugin.node.title),e[n]?n=n+" "+ ++e[n]:e[n]=1,{title:n,node:t}})}function n(t){var e=this;Plugin.apply(this,arguments),this.input_slots=[],this.output_slots=[{name:"trigger",dt:t.datatypes.BOOL}],this.boundOnGazeIn=this.onGazeIn.bind(this),this.boundOnGazeOut=this.onGazeOut.bind(this),this.boundOnGazeClicked=this.onGazeClicked.bind(this),this.boundSetupChosenObject=this.setupChosenObject.bind(this),this.boundOnGraphNodesChanged=this.onGraphNodesChanged.bind(this),this.node.on("pluginStateChanged",function(){e.setupChosenObject()}),this.state.nodeRef=null,this.state.type=0,this.triggerState=!1}var o=["three_mesh"];n.prototype=Object.create(Plugin.prototype),n.prototype.reset=function(){this.graph=this.node.parent_graph},n.prototype.onGazeIn=function(){},n.prototype.onGazeOut=function(){},n.prototype.onGazeClicked=function(){},n.prototype.destroy=function(){this.clearClickerOnObject()},n.prototype.installClickerOnObject=function(){this.object3d.gazeClickers||(this.object3d.gazeClickers={}),this.object3d.gazeClickers[this.node.uid]=!0,this.object3d.gazeClickerCount=Object.keys(this.object3d.gazeClickers).length;for(var t=this.object3d.parent;t;)t.gazeClickerCount||(t.gazeClickerCount=0),t.gazeClickerCount++,t=t.parent;E2.core.runtimeEvents.on("gazeOut:"+this.object3d.uuid,this.boundOnGazeOut),E2.core.runtimeEvents.on("gazeIn:"+this.object3d.uuid,this.boundOnGazeIn),E2.core.runtimeEvents.on("gazeClicked:"+this.object3d.uuid,this.boundOnGazeClicked)},n.prototype.clearClickerOnObject=function(){if(this.object3d){delete this.object3d.gazeClickers[this.node.uid],this.object3d.gazeClickerCount=Object.keys(this.object3d.gazeClickers).length;for(var t=this.object3d.parent;t;)t.gazeClickerCount--,t=t.parent;this.targetNode.plugin.updated=!0,E2.core.runtimeEvents.off("gazeOut:"+this.object3d.uuid,this.boundOnGazeOut),E2.core.runtimeEvents.off("gazeIn:"+this.object3d.uuid,this.boundOnGazeIn),E2.core.runtimeEvents.off("gazeClicked:"+this.object3d.uuid,this.boundOnGazeClicked),this.object3d=void 0}},n.prototype.setupChosenObject=function(){if(!this.state.nodeRef)return this.clearClickerOnObject();var t=this.state.nodeRef.split("."),e=t[0],n=t[1],o=Graph.lookup(e);if(!o)return void console.warn("AbstractObjectGazePlugin.setupChosenObject() could not find Graph",e);var i=o.findNodeByUid(n);this.object3d&&this.object3d===i.plugin.object3d||(this.clearClickerOnObject(),this.targetNode&&this.targetNode.off("meshChanged",this.boundSetupChosenObject),this.targetNode=i,this.targetNode.on("meshChanged",this.boundSetupChosenObject),i.plugin.object3d&&(this.object3d=i.plugin.object3d,this.installClickerOnObject(),this.targetNode.plugin.updated=!0))},n.prototype.populateObjectSelector=function(){var t=this;t.$selectObject.empty(),$("<option>",{value:0,text:"Select Object"}).appendTo(t.$selectObject),e().map(function(e){$("<option>",{value:e.node.parent_graph.uid+"."+e.node.uid,text:e.title}).appendTo(t.$selectObject)})},n.prototype.onGraphNodesChanged=function(){this.populateObjectSelector()},n.prototype.create_ui=function(){var t=this,e=make("div"),n=$('<select class="trigger-type-sel" title="Select Trigger Type"/>'),o=this.$selectObject=$('<select class="object-sel" title="Select Object"/>');return this.populateObjectSelector(),$("<option>",{value:0,text:"Impulse"}).appendTo(n),$("<option>",{value:1,text:"Continuous"}).appendTo(n),o.change(function(){var e=o.val();0===e&&(e=null),t.undoableSetState("nodeRef",e,t.state.nodeRef)}),n.change(function(){t.undoableSetState("type",parseInt(n.val(),10),t.state.type)}),e.append(this.$selectObject),e.append(n),this.graph.on("nodeAdded",this.boundOnGraphNodesChanged),this.graph.on("nodeRemoved",this.boundOnGraphNodesChanged),this.graph.on("nodeRenamed",this.boundOnGraphNodesChanged),e},n.prototype.destroy_ui=function(){this.graph.off("nodeAdded",this.boundOnGraphNodesChanged),this.graph.off("nodeRemoved",this.boundOnGraphNodesChanged),this.graph.off("nodeRenamed",this.boundOnGraphNodesChanged)},n.prototype.update_output=function(){return this.triggerState},n.prototype.onGazeIn=function(){this.focused=!0,this.updated=!0},n.prototype.onGazeOut=function(){this.focused=!1,this.updated=!0},n.prototype.onGazeClicked=function(){this.triggerState=!0,this.updated=!0,this.node.queued_update=1},n.prototype.update_state=function(){this.lastState===this.triggerState&&0===this.state.type&&(this.triggerState=!1),this.focused||(this.triggerState=!1),this.lastState=this.triggerState},n.prototype.state_changed=function(t){t?(this.state.type&&t.find(".trigger-type-sel").val(this.state.type),this.state.nodeRef&&t.find(".object-sel").val(this.state.nodeRef)):this.state.nodeRef&&this.setupChosenObject()},window.AbstractObjectGazePlugin=n,"undefined"!=typeof module&&(module.exports=n)}();
;
function AbstractThreeLoaderObjPlugin(t){Plugin.apply(this,arguments),this.desc="THREE.js OBJ loader",this.dirty=!0,this.state={url:""},this.input_slots=[],this.output_slots=[{name:"geometry",dt:t.datatypes.GEOMETRY,array:!0},{name:"materials",dt:t.datatypes.MATERIAL,array:!0}],this.geometries=[new THREE.Geometry],this.materials=[new THREE.MeshBasicMaterial(16711680)]}AbstractThreeLoaderObjPlugin.prototype=Object.create(Plugin.prototype),AbstractThreeLoaderObjPlugin.prototype.update_input=function(){return Plugin.prototype.update_input.apply(this,arguments)},AbstractThreeLoaderObjPlugin.prototype.onObjLoaded=function(t,e){this.geometries=t,this.materials=e;for(var s=0;s<this.geometries.length;++s){var r=this.geometries[s]instanceof THREE.BufferGeometry&&void 0!==this.geometries[s].getAttribute("normal"),i=this.geometries[s].faces&&this.geometries[s].faces.length>0&&0!==this.geometries[s].faces[0].normal.lengthSq(),a=this.geometries[s].faces&&this.geometries[s].faces.length>0&&this.geometries[s].faces[0].vertexNormals.length>0;r||i||a||this.geometries[s].computeVertexNormals(!0)}msg("Finished loading "+this.state.url),this.updated=!0},AbstractThreeLoaderObjPlugin.prototype.state_changed=function(t){console.log("state_changed",this.state),this.state.url&&(t?t.attr("title",this.state.url):this.dirty=!0)},"undefined"!=typeof module&&(module.exports=AbstractThreeLoaderObjPlugin);
;
function AbstractThreeMaterialPlugin(t){Plugin.apply(this,arguments),this.input_slots=[{name:"opacity",dt:t.datatypes.FLOAT,def:1,desc:"Float in the range of 0.0 - 1.0 indicating how transparent the material is. A value of 0.0 indicates fully transparent, 1.0 is fully opaque. If transparent is not set to true for the material, the material will remain fully opaque and this value will only affect its color."},{name:"transparent",dt:t.datatypes.BOOL,def:!1,desc:"Defines whether this material is transparent. When set to true, the extent to which the material is transparent is controlled by setting opacity."},{name:"blending",dt:t.datatypes.FLOAT,def:1,desc:"Which blending to use when displaying objects with this material. Default is Normal. 0 = No, 1 = Normal, 2 = Additive, 3 = Subtractive, 4 = Multiply, 5 = Custom"},{name:"side",dt:t.datatypes.FLOAT,def:0,desc:"Defines which of the face sides will be rendered - front, back or both. 0 = Front, 1 = Back, 2 = Double Sided"}],this.output_slots=[{name:"material",dt:t.datatypes.MATERIAL}]}AbstractThreeMaterialPlugin.prototype=Object.create(Plugin.prototype),AbstractThreeMaterialPlugin.prototype.update_output=function(){return this.material},AbstractThreeMaterialPlugin.prototype.update_input=function(t,e){"texture"===t.name?this.material.map=e:this.material[t.name]=e,this.material.needsUpdate=!0},"undefined"!=typeof module&&(module.exports=AbstractThreeMaterialPlugin);
;
function AbstractThreeMeshPlugin(t){ThreeObject3DPlugin.apply(this,arguments),this.desc="THREE.js Mesh",this.input_slots=[{name:"geometry",dt:t.datatypes.GEOMETRY,array:!0,def:[new THREE.Geometry]},{name:"material",dt:t.datatypes.MATERIAL,array:!0,def:[new THREE.MeshBasicMaterial({color:65280})]}].concat(this.input_slots),this.createMeshRoot=function(){},this.createMesh=function(){},this.createAnimatedMesh=function(){}}AbstractThreeMeshPlugin.prototype=Object.create(ThreeObject3DPlugin.prototype),AbstractThreeMeshPlugin.prototype.reset=function(){this.object3d=this.createMeshRoot(),this.geoms=[new THREE.Geometry],this.mats=[new THREE.MeshBasicMaterial({color:65280})];var t=this.createMesh(this.geoms[0],this.mats[0]);this.object3d.add(t),this.object3d.backReference=this,ThreeObject3DPlugin.prototype.reset.apply(this)},AbstractThreeMeshPlugin.prototype.update_mesh=function(){var t,e;if(this.geoms_dirty&&this.geoms){for(this.always_update=!1,this.object3d=this.object3d.clone(!1),this.object3d.backReference=this,t=0;t<this.geoms.length;++t){if(this.geoms[t].morphTargets&&this.geoms[t].morphTargets.length>0){var s=this.mats&&this.mats.length>0?this.mats[t%this.mats.length].clone():void 0;e=this.createAnimatedMesh(this.geoms[t],s);var i=this.geoms[t].animations.length>0?this.geoms[t].animations[0].name:void 0;i&&e.playAnimation(i,100),e.material.morphTargets=!0,this.always_update=!0}else e=this.createMesh(this.geoms[t],this.mats[t%this.mats.length]);e.backReference=this,this.object3d.add(e)}this.geoms_dirty=this.mats_dirty=!1,this.node.emit("meshChanged")}if(this.mats_dirty&&this.mats&&this.mats.length>0){for(t=0;t<this.object3d.children.length;++t)this.object3d.children[t]instanceof THREE.MorphAnimMesh?(this.object3d.children[t].material=this.mats[t%this.mats.length].clone(),this.object3d.children[t].material.morphTargets=!0):this.object3d.children[t].material=this.mats[t%this.mats.length];this.mats_dirty=!1}},AbstractThreeMeshPlugin.prototype.update_input=function(t,e){"geometry"===t.name?(this.geoms=e,this.geoms_dirty=!0):"material"===t.name?(this.mats=e,this.mats_dirty=!0):ThreeObject3DPlugin.prototype.update_input.apply(this,arguments)},AbstractThreeMeshPlugin.prototype.update_state=function(){this.update_mesh(),ThreeObject3DPlugin.prototype.update_state.apply(this)},"undefined"!=typeof module&&(module.exports=AbstractThreeMeshPlugin);
;
var AbstractArrayBlendModulatorPlugin=function(t,e,n,i){Plugin.apply(this,arguments),this.datatype=n,this.lerpFunc=i;var s=this;this.desc="Set up n inputs, then choose which one to output. The output will animate from the previous input to the currently selected one over time duration and using the selected blending function",this.input_slots=[{name:"number",dt:E2.dt.FLOAT,def:0,desc:"Input number to select for output."},{name:"duration",dt:E2.dt.FLOAT,def:1,desc:"Duration of blend animation"}],this.output_slots=[{name:"value",dt:this.datatype,desc:"Emits the selected input."},{name:"length",dt:E2.dt.FLOAT,desc:"Emits the number of inputs = the length of the array."}],this.core=t,this.node=e,this.lsg=new AutoSlotGroup(t,e,[],[]),this.lsg.set_dt(this.datatype),this.node.on("slotAdded",function(){s.dynInputs=e.getDynamicInputSlots(),s.updated=!0}),this.node.on("slotRemoved",function(){s.dynInputs=e.getDynamicInputSlots(),s.updated=!0}),this.blendFunctions=new BlendFunctions,this.state={blendFuncId:this.blendFunctions.getByIndex(0).id},this.values=[]};AbstractArrayBlendModulatorPlugin.prototype=Object.create(Plugin.prototype),AbstractArrayBlendModulatorPlugin.prototype.create_ui=function(){var t=make("div"),e=this;return this.blendFunctions.createUi(t,function(t,n){e.undoableSetState("blendFuncId",n,e.state.blendFuncId),e.blendFunc=t}),t},AbstractArrayBlendModulatorPlugin.prototype.reset=function(){this.triggered=!1,this.oneShot=!1,this.duration=1,this.startTime=0,this.startValue=E2.core.get_default_value(this.datatype),this.endValue=E2.core.get_default_value(this.datatype),this.value=E2.core.get_default_value(this.datatype),this.nextTargetIndex=0,this.blendFunc=this.blendFunctions.getById(this.state.blendFuncId),Plugin.prototype.reset.apply(this,arguments)},AbstractArrayBlendModulatorPlugin.prototype.update_input=function(t,e){t.dynamic?this.values[t.index]=e:("number"===t.name?this.nextTargetIndex=e:"duration"===t.name&&(this.duration=e),Plugin.prototype.update_input.apply(this,arguments))},AbstractArrayBlendModulatorPlugin.prototype.connection_changed=function(t,e,n){n.dynamic&&!t&&delete this.values[n.index]},AbstractArrayBlendModulatorPlugin.prototype.update_output=function(t){return"value"===t.name?this.value:"length"===t.name?this.dynInputs.length:void 0},AbstractArrayBlendModulatorPlugin.prototype.update_state=function(){if(void 0!==this.nextTargetIndex&&this.values.length>0&&(this.nextTargetIndex=Math.min(Math.max(0,Math.floor(this.nextTargetIndex)),this.values.length-1),this.values[this.nextTargetIndex]!==this.endValue&&(this.startTime=this.core.abs_t,this.startValue=this.value,this.endValue=this.nextTargetIndex<this.values.length?this.values[this.nextTargetIndex]:E2.core.get_default_value(this.datatype),this.triggered=!0)),this.triggered){var t=this.core.abs_t-this.startTime;t<=this.duration&&this.duration>0?(this.value=this.lerpFunc(this.startValue,this.endValue,this.blendFunc.func(t/this.duration)),this.updated=!0,this.always_update=!0):this.value!==this.endValue&&(this.value=this.lerpFunc(this.startValue,this.endValue,this.blendFunc.func(1)),this.updated=!0,this.always_update=!1)}else this.value=this.lerpFunc(this.startValue,this.endValue,this.blendFunc.func(0)),this.always_update=!1},AbstractArrayBlendModulatorPlugin.prototype.state_changed=function(t){t&&this.blendFunctions.initialise(t,this.state.blendFuncId),this.dynInputs=this.node.getDynamicInputSlots(),this.dynInputs.length||(this.node.add_slot(E2.slot_type.input,{name:"0",dt:this.datatype,array:!1}),this.dynInputs=this.node.getDynamicInputSlots())},"undefined"!=typeof module&&(module.exports=AbstractArrayBlendModulatorPlugin);
;
var AbstractAnimateValueOnTriggerPlugin=function(t,e,a,i){Plugin.apply(this,arguments),this.desc="Animate value from startValue to endValue on trigger over time specified by duration",this.core=t,this.datatype=a,this.lerpFunc=i,this.input_slots=[{name:"trigger",dt:E2.dt.BOOL,def:!1,desc:"sending a boolean impulse to trigger will start the animation"},{name:"reset",dt:E2.dt.BOOL,def:!1,desc:"reset value back to start"},{name:"one-shot",dt:E2.dt.BOOL,def:!1,desc:"if true, only allow the animation to be triggered once (until reset)"},{name:"duration",dt:E2.dt.FLOAT,def:1,desc:"animation duration"},{name:"startValue",dt:this.datatype,def:E2.core.get_default_value(this.datatype),desc:"animation start value"},{name:"endValue",dt:this.datatype,def:E2.core.get_default_value(this.datatype),desc:"animation end value"}],this.output_slots=[{name:"value",dt:this.datatype,desc:"animated value"},{name:"active",dt:E2.dt.BOOL,desc:"true while the animation is active"}],this.blendFunctions=new BlendFunctions,this.state={blendFuncId:this.blendFunctions.getByIndex(0).id}};AbstractAnimateValueOnTriggerPlugin.prototype=Object.create(Plugin.prototype),AbstractAnimateValueOnTriggerPlugin.prototype.create_ui=function(){var t=make("div"),e=this;return this.blendFunctions.createUi(t,function(t,a){e.undoableSetState("blendFuncId",a,e.state.blendFuncId),e.blendFunc=t}),t},AbstractAnimateValueOnTriggerPlugin.prototype.reset=function(){this.triggered=!1,this.oneShot=!1,this.duration=1,this.startTime=0,this.startValue=E2.core.get_default_value(this.datatype),this.endValue=E2.core.get_default_value(this.datatype),this.blendFunc=this.blendFunctions.getById(this.state.blendFuncId)},AbstractAnimateValueOnTriggerPlugin.prototype.update_input=function(t,e){"trigger"!==t.name||!e||this.oneShot&&this.triggered?"reset"===t.name&&e?this.triggered=!1:"one-shot"===t.name?this.oneShot=e:"duration"===t.name?this.duration=e:"startValue"===t.name?this.startValue=e:"endValue"===t.name&&(this.endValue=e):(this.triggered=!0,this.startTime=this.core.abs_t)},AbstractAnimateValueOnTriggerPlugin.prototype.update_output=function(t){return"value"===t.name?this.value:"active"===t.name?this.triggered&&this.value<this.endValue:void 0},AbstractAnimateValueOnTriggerPlugin.prototype.update_state=function(){if(this.triggered){var t=this.core.abs_t-this.startTime;t<=this.duration&&this.duration>0?(this.value=this.lerpFunc(this.startValue,this.endValue,this.blendFunc.func(t/this.duration)),this.updated=!0,this.always_update=!0):this.value!==this.endValue&&(this.value=this.lerpFunc(this.startValue,this.endValue,this.blendFunc.func(1)),this.updated=!0,this.always_update=!1)}else this.value=this.lerpFunc(this.startValue,this.endValue,this.blendFunc.func(0)),this.always_update=!1},AbstractAnimateValueOnTriggerPlugin.prototype.state_changed=function(t){t&&this.blendFunctions.initialise(t,this.state.blendFuncId)},"undefined"!=typeof module&&(module.exports=AbstractAnimateValueOnTriggerPlugin);
;
var BlendFunctions=function(){this.functions=[{id:"linear-blend",name:"Linear",func:function(n){return n}},{id:"inverse-blend",name:"Inverse",func:function(n){return 1-n}},{id:"circular-blend",name:"Circular",func:function(n){return 1-Math.sqrt(1-n*n)}},{id:"cubic-blend",name:"Cubic",func:function(n){return n*n*n}},{id:"exponential-blend",name:"Exponential",func:function(n){return 0===n?0:Math.pow(1024,n-1)}},{id:"quadratic-blend",name:"Quadratic",func:function(n){return n*n}},{id:"quartic-blend",name:"Quartic",func:function(n){return n*n*n*n}},{id:"quintic-blend",name:"Quintic",func:function(n){return n*n*n*n*n}},{id:"sinusoidal-blend",name:"Sinusoidal",func:function(n){return 1-Math.cos(n*Math.PI/2)}},{id:"smoothstep-blend",name:"Smoothstep",func:function(n){return n*n*(3-2*n)}},{id:"smootherstep-blend",name:"Smootherstep",func:function(n){return n*n*n*(n*(6*n-15)+10)}}],this.getByIndex=function(n){return this.functions[n]},this.getById=function(n){for(var t=0,e=this.functions.length;e>t;++t)if(this.functions[t].id===n)return this.functions[t]},this.getIndex=function(n){return this.functions.indexOf(n)},this.createUi=function(n,t){for(var e=$('<select class="blend-type-sel" title="Select Blend Type"/>'),i=0,u=this.functions.length;u>i;++i){var c=this.functions[i];$("<option>",{value:i,text:c.name}).appendTo(e)}var r=this;e.change(function(){var n=r.getByIndex(e.val()),i=n.id;t(n,i)}),n.append(e)},this.initialise=function(n,t){var e=this.getById(t),i=this.getIndex(e);n.find(".blend-type-sel").val(i)}};"undefined"!=typeof module&&(module.exports=BlendFunctions);
;
function WorldEditor(e){this.domElement=e,this.showEditorHelpers=!0;var t=!1;this.activate=function(){t=!0,this.cameraSelector.transformControls.enabled=!0,this.cameraSelector.editorControls.enabled=!0,this.showEditorHelpers=!0},this.deactivate=function(){this.cameraSelector.transformControls.enabled=!1,this.cameraSelector.editorControls.enabled=!1,this.editorTree.parent&&this.editorTree.parent.remove(this.editorTree),t=!1},this.isActive=function(){return t},this.transformMode="translate",this.editorTree=new THREE.Object3D,this.gridHelper=new WorldEditorOriginGrid,this.radialHelper=new WorldEditorRadialHelper,this.editorTree.add(this.radialHelper.mesh),this.selectionTree=new THREE.Object3D,this.editorTree.add(this.selectionTree),this.handleTree=new THREE.Object3D,this.editorTree.add(this.handleTree),this.cameraSelector=new WorldEditorCameraSelector(this.domElement),this.cameraHelper=new VRCameraHelper;this.setupObjectPicking(),E2.ui.state.on("changed:modifyMode",this.setTransformMode.bind(this))}WorldEditor.prototype.setTransformMode=function(e){this.transformMode=e},WorldEditor.prototype.update=function(){if(this.isActive()){var e=function(t,r){return r>t/10?r:e(t,10*r)},t=this.cameraSelector.camera.position.clone().sub(this.cameraSelector.editorControls.center).length()||1,r=e(t,.01);if(this.gridHelper.scale(r),this.vrCamera){this.radialHelper.position(this.vrCamera.parent.position);var i=this.cameraSelector.camera.position.clone().sub(this.vrCamera.position).length()||1,r=e(i,.01);r=1>r?1:r,this.radialHelper.scale(r)}this.cameraSelector.update(this.transformMode)}},WorldEditor.prototype.preRenderUpdate=function(){var e=this.scene.children.indexOf(this.editorTree);this.showEditorHelpers&&0>e?this.scene.add(this.editorTree):!this.showEditorHelpers&&e>=0&&this.scene.remove(this.editorTree)},WorldEditor.prototype.getCamera=function(){return this.cameraSelector.camera},WorldEditor.prototype.updateHelperHandles=function(e,t){var r=[],i=[],o=[],n=function(e){(e instanceof THREE.PointLight||e instanceof THREE.DirectionalLight||e instanceof THREE.SpotLight||e instanceof THREE.HemisphereLight)&&r.push(e)};e&&e.children[0].traverse(n),t&&t.parent instanceof THREE.Camera&&r.push(t.parent),this.handleTree.traverse(function(e){-1===r.indexOf(e.helperObjectBackReference)&&o.push(e)});for(var a=0;a<o.length;++a)this.handleTree.remove(o[a]);i=r.slice(0);for(var a=0;a<this.handleTree.children.length;++a){var s=i.indexOf(this.handleTree.children[a].helperObjectBackReference);1!==s&&i.splice(s,1)}for(var a=0;a<i.length;++a){var c=i[a];if(c instanceof THREE.PointLight){var d=new THREE.PointLightHelper(c,.5);d.backReference=c.backReference,d.helperObjectBackReference=c,this.handleTree.add(d)}else if(c instanceof THREE.DirectionalLight){var d=new THREE.DirectionalLightHelper(c,.5);d.backReference=c.backReference,d.helperObjectBackReference=c,this.handleTree.add(d)}else if(c instanceof THREE.SpotLight){var d=new THREE.SpotLightHelper(c);d.backReference=c.backReference,d.helperObjectBackReference=c,this.handleTree.add(d)}else if(c instanceof THREE.HemisphereLight){var d=new THREE.HemisphereLightHelper(c,.5);d.backReference=c.backReference,d.helperObjectBackReference=c,this.handleTree.add(d)}else c instanceof THREE.Camera&&(this.cameraHelper.helperObjectBackReference=c,this.cameraHelper.attachCamera(c),this.handleTree.add(this.cameraHelper))}},WorldEditor.prototype.updateScene=function(e,t){this.scene=e,this.vrCamera=t,this.updateHelperHandles(e,t)},WorldEditor.prototype.getEditorSceneTree=function(){return this.editorTree},WorldEditor.prototype.setSelection=function(e){this.selectionTree.children=[];for(var t=!1,r=0;r<e.length;++r){var i=e[r];if(void 0!==i.backReference){this.cameraSelector.transformControls.attach(i),this.selectionTree.add(this.cameraSelector.transformControls),t=!0;break}}t||this.cameraSelector.transformControls.detach()},WorldEditor.prototype.onDelete=function(){this.cameraSelector.transformControls.detach()},WorldEditor.prototype.onPaste=function(e){function t(e){for(var t=e.plugin.output_slots,r=0;r<t.length;++r)if(t[r].dt===E2.core.datatypes.OBJECT3D)return{index:r,dynamic:!1};return{index:0,dynamic:!0}}function r(e){if(e.plugin&&e.plugin.object3d&&e.plugin.object3d.traverse(function(e){e.backReference&&d.push(e)}),e.plugin.graph)for(var t=0;t<e.plugin.graph.nodes.length;++t)r(e.plugin.graph.nodes[t])}if(e&&!(e.length<1)){var i=e[0];if(this.scene||this.currentGroup){var o=this.currentGroup||this.scene.backReference.parentNode;o.slots_dirty=!0;var n=o.getDynamicInputSlots(),a=n[n.length-1],s=t(i),c=Connection.hydrate(E2.core.root_graph,{src_nuid:i.uid,dst_nuid:o.uid,src_slot:s.index,src_dyn:s.dynamic,dst_slot:a.index,dst_dyn:!0});E2.app.graphApi.connect(E2.core.root_graph,c),E2.app.onLocalConnectionChanged(c),E2.app.markConnectionAsSelected(c);for(var d=[],h=0;h<e.length;++h){var l=e[h];r(l)}this.setSelection(d)}}},WorldEditor.prototype.selectMeshAndDependencies=function(e,t,r){function i(e,r){var n=e.outputs.concat(e.dyn_outputs);if("output_proxy"===e.plugin.id&&e.parent_graph&&e.parent_graph.plugin&&e.parent_graph.plugin.parentNode&&i(e.parent_graph.plugin.parentNode,t))return!1;for(var a=0;a<n.length;++a)if(n[a].src_slot.is_connected&&n[a].src_slot.dt===E2.core.datatypes.OBJECT3D){var s=n[a].dst_node,c=s===r,d=c||(s?i(s,r):!1);if(d)return-1===o.indexOf(e)&&o.push(e),!0}return!1}var o=[];if(E2.app.clearSelection(),this.currentGroup=void 0,e){if(i(e,t),0===o.length)return;if(r)for(var n=o.length-1;n>=0;--n)if(o[n].plugin instanceof E2.plugins.three_group){this.currentGroup=o[n],o.splice(0,n+1);break}for(var a=(o[o.length-1],o.slice(0)),n=0;n<a.length;++n){var s=a[n];s.plugin.object3d&&s.plugin instanceof E2.plugins.three_group&&s.plugin.object3d.traverse(function(e){e.backReference&&-1===o.indexOf(e.backReference.node)&&i(e.backReference.node,s)})}o.length>0&&o[0].parent_graph.tree_node.activate();for(var n=0;n<o.length;++n)E2.app.markNodeAsSelected(o[n]),o[n].getConnections().map(E2.app.markConnectionAsSelected.bind(E2.app))}},WorldEditor.prototype.pickObject=function(e){if(E2.app.noodlesVisible!==!0){var t=E2.ui.flags.pressedAlt,r=this.isActive(),i=new THREE.Vector3,o=(this.domElement.clientWidth,this.domElement.clientHeight,e.changedTouches?e.changedTouches[0]:e),n=this.domElement.getBoundingClientRect(),a=(o.clientX-n.left)/n.width,s=(o.clientY-n.top)/n.height;if(i.set(2*a-1,-(2*s)+1),this.scene&&this.scene.children&&this.scene.children.length>0){this.raycaster.setFromCamera(i,this.getCamera());for(var c=this.raycaster.intersectObjects(this.scene.children,!0),d=[],h=0;h<c.length;h++){for(var l=void 0,p=c[h].object;p&&(void 0!==p.helperObjectBackReference&&(p=p.helperObjectBackReference),!p.backReference||p===this.scene||(l=p,!t));)p=p.parent;if(l&&l.backReference.parentNode!==this.scene.backReference.parentNode){d.push(l);var f=l.backReference.parentNode,u=this.scene.backReference.parentNode;this.selectMeshAndDependencies(f,u,t);break}}r&&this.setSelection(d)}else r&&this.setSelection([])}},WorldEditor.prototype.mouseDown=function(e){this.isActive()&&(this.dragContext={startX:e.pageX,startY:e.pageY})},WorldEditor.prototype.mouseUp=function(e){this.dragContext&&e.pageX===this.dragContext.startX&&e.pageY===this.dragContext.startY&&this.pickObject(e)},WorldEditor.prototype.setupObjectPicking=function(){$(document).mousedown(this.mouseDown.bind(this)),$(document).mouseup(this.mouseUp.bind(this)),this.raycaster=new THREE.Raycaster},WorldEditor.prototype.getActiveSceneNode=function(){return this.scene.backReference.parentNode},WorldEditor.prototype.matchCamera=function(){var e=this.vrCamera.parent.backReference,t=this.getCamera();E2.app.undoManager.begin();var r=new THREE.Vector3(e.state.position.x,e.state.position.y,e.state.position.z);e.undoableSetState("position",t.position.clone(),r);var i=new THREE.Quaternion(e.state.quaternion._x,e.state.quaternion._y,e.state.quaternion._z,e.state.quaternion._w);e.undoableSetState("quaternion",t.quaternion.clone(),i),E2.app.undoManager.end()},WorldEditor.prototype.toggleGrid=function(){-1!==this.editorTree.children.indexOf(this.gridHelper.mesh)?(this.editorTree.remove(this.gridHelper.mesh),this.editorTree.add(this.radialHelper.mesh)):(this.editorTree.remove(this.radialHelper.mesh),this.editorTree.add(this.gridHelper.mesh))},WorldEditor.prototype.setCameraView=function(e){this.cameraSelector.setView(e)},WorldEditor.prototype.toggleCameraOrthographic=function(){var e=this.cameraSelector.transformControls.plugin,t=e?e.object3d:void 0;void 0!==t&&this.cameraSelector.transformControls.detach(),this.cameraSelector.selectCamera("orthographic"===this.cameraSelector.selectedCamera?"perspective":"orthographic"),void 0!==t&&this.setSelection([t])},WorldEditor.prototype.toggleEditorHelpers=function(){this.showEditorHelpers=!this.showEditorHelpers},WorldEditor.prototype.frameSelection=function(){var e=this.cameraSelector.transformControls.plugin,t=e?e.object3d:void 0,r=this.cameraSelector.camera.getWorldDirection(),i=new THREE.Vector3,o=1;if(void 0===t&&(t=this.scene.children[0]),t){i.copy(t.position),i.applyMatrix4(t.matrixWorld);var n=new THREE.Sphere;t.traverse(function(e){if(e.geometry){e.geometry.boundingSphere||e.geometry.computeBoundingSphere(),n.copy(e.geometry.boundingSphere),n.applyMatrix4(e.matrixWorld);var t=i.distanceTo(n.center)+n.radius;t>o&&(o=t)}}),this.cameraSelector.camera.position.copy(t.position.clone().sub(r.multiplyScalar(1.5*o))),this.cameraSelector.camera.lookAt(t.position),this.cameraSelector.editorControls.focus(t)}};
;
function WorldEditorCamera(e){this.domElement=e,this.camera=new THREE.PerspectiveCamera(90,this.domElement.clientWidth/this.domElement.clientHeight,.01,1e4),this.camera.position.set(5,5,5),this.camera.lookAt(new THREE.Vector3(0,0,0)),this.camera.layers.enable(1),E2.core.on("resize",this.resize.bind(this))}WorldEditorCamera.prototype.resize=function(){var e=E2.util.isFullscreen(),t={width:window.innerWidth,height:window.innerHeight};e||(t.width=this.domElement.clientWidth,t.height=this.domElement.clientHeight,"undefined"!=typeof E2.app.calculateCanvasArea&&(t=E2.app.calculateCanvasArea())),this.camera.aspect=t.width/t.height,this.camera.updateProjectionMatrix()},WorldEditorCamera.prototype.update=function(){};
;
function WorldEditorOrthographicCamera(t){this.domElement=t,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,-1e4,1e4),this.camera.zoom=10,this.aspect=1,this.camera.layers.enable(1),E2.core.on("resize",this.resize.bind(this))}WorldEditorOrthographicCamera.prototype.resize=function(){var t=E2.util.isFullscreen(),e={width:window.innerWidth,height:window.innerHeight};t||(e.width=this.domElement.clientWidth,e.height=this.domElement.clientHeight,"undefined"!=typeof E2.app.calculateCanvasArea&&(e=E2.app.calculateCanvasArea())),this.aspect=e.width/e.height,this.camera.left=-this.aspect,this.camera.right=this.aspect,this.camera.top=1,this.camera.bottom=-1},WorldEditorOrthographicCamera.prototype.update=function(){var t=this.camera.position.length(),e=1/t;this.camera.zoom!==e&&(this.camera.zoom=e,this.camera.updateProjectionMatrix())};
;
function WorldEditorCameraSelector(t){var r=new WorldEditorCamera(t),o=new WorldEditorOrthographicCamera(t);this.axisCameras={"+x":{position:new THREE.Vector3(-1,0,0)},"+y":{position:new THREE.Vector3(0,-1,0)},"+z":{position:new THREE.Vector3(0,0,-1)},"-x":{position:new THREE.Vector3(1,0,0)},"-y":{position:new THREE.Vector3(0,1,0)},"-z":{position:new THREE.Vector3(0,0,1)}},this.cameras={perspective:{camera:r,editorControls:new THREE.EditorControls(r.camera,t),transformControls:new THREE.TransformControls(r.camera,t)},orthographic:{camera:o,editorControls:new THREE.EditorControls(o.camera,t),transformControls:new THREE.TransformControls(o.camera,t)}},this.currentCameraId="perspective";var e=this;Object.keys(this.cameras).forEach(function(t){function r(){if(this.editorControls.enabled=!1,E2.ui.flags.pressedAlt){var t=E2.app.serialiseSelection();E2.app.onPaste(t)}}function o(){this.editorControls.enabled=!0}var a=e.cameras[t];a.editorControls.enabled=!1,a.transformControls.enabled=!1,a.transformControls.addEventListener("mouseDown",r.bind(a)),a.transformControls.addEventListener("mouseUp",o.bind(a))})}WorldEditorCameraSelector.prototype={constructor:WorldEditorCameraSelector,get camera(){return this.cameras[this.currentCameraId].camera.camera},get editorControls(){return this.cameras[this.currentCameraId].editorControls},get transformControls(){return this.cameras[this.currentCameraId].transformControls},get selectedCamera(){return this.currentCameraId},selectCamera:function(t){if(t!==this.currentCameraId){var r=this.transformControls.enabled,o=this.editorControls.enabled,e=this.camera.position.clone(),a=this.camera.rotation.clone(),n=this.camera.quaternion.clone(),s=this.camera.scale.clone();this.transformControls.enabled=!1,this.editorControls.enabled=!1,this.currentCameraId=t,this.transformControls.enabled=r,this.editorControls.enabled=o,this.camera.position.copy(e),this.camera.rotation.copy(a),this.camera.quaternion.copy(n),this.camera.scale.copy(s)}},setView:function(t){var r=this.axisCameras[t].position.clone(),o=this.transformControls.object,e=o?o.position:new THREE.Vector3(0,0,0);r.add(e),this.camera.position.copy(r),this.camera.lookAt(e),o&&this.editorControls.focus(o)},update:function(t){this.transformControls.setMode(t),this.transformControls.setSpace("local"),this.transformControls.updateTransformLock(),this.cameras[this.currentCameraId].camera.update()}};
;
function WorldEditorOriginGrid(){var e=function(e,t){this.color1=new THREE.Color(12303291),this.color2=new THREE.Color(8947848);for(var s=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,linewidth:1,fog:!1}),o=new THREE.Geometry,r=-e;e>=r;r+=t){o.vertices.push(new THREE.Vector3(-e,0,r),new THREE.Vector3(e,0,r),new THREE.Vector3(r,0,-e),new THREE.Vector3(r,0,e));var i=Math.abs(r)<t/2?this.color1:this.color2;o.colors.push(i,i,i,i)}THREE.LineSegments.call(this,o,s)};e.prototype=Object.create(THREE.LineSegments.prototype),e.prototype.constructor=THREE.GridHelper,this.mesh=new e(10,1),this.mesh.add(new e(1,.1));var t=THREE.FontUtils.generateShapes(""),s=new THREE.ShapeGeometry(t);this.textMesh1=new THREE.Mesh(s,new THREE.MeshBasicMaterial({color:this.mesh.color1,fog:!1})),this.textMesh1.scale.set(.001,.001,.001),this.textMesh1.position.set(1,0,-1),this.textMesh1.quaternion.setFromEuler(new THREE.Euler(-1.570795,0,0)),this.mesh.add(this.textMesh1);var o=new THREE.ShapeGeometry(t);this.textMesh2=new THREE.Mesh(o,new THREE.MeshBasicMaterial({color:this.mesh.color1,fog:!1})),this.textMesh2.scale.set(.002,.002,.002),this.textMesh2.position.set(10,0,-10),this.textMesh2.quaternion.setFromEuler(new THREE.Euler(-1.570795,0,0)),this.mesh.add(this.textMesh2),this.gridScale=0,this.scale(1)}WorldEditorOriginGrid.prototype.scale=function(e){if(e!==this.gridScale){var t=THREE.FontUtils.generateShapes(e.toString()+" m");this.textMesh1.geometry=new THREE.ShapeGeometry(t),t=THREE.FontUtils.generateShapes((10*e).toString()+" m"),this.textMesh2.geometry=new THREE.ShapeGeometry(t),this.gridScale=e,this.mesh.scale.set(e,e,e)}};
;
function WorldEditorRadialHelper(){var e=function(e,t,s){var o=t,r=new THREE.Geometry,i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,linewidth:1,fog:!1});this.color1=new THREE.Color(12303291),this.color2=new THREE.Color(8947848),r.vertices.push(new THREE.Vector3(-o,0,0),new THREE.Vector3(o,0,0),new THREE.Vector3(0,0,-o),new THREE.Vector3(0,0,o));var h=this.color1;r.colors.push(h,h,h,h);for(var a=100,n=e;t>=n;n+=s)for(var E=n,l=0;a+1>l;++l){var c=l/a,p=(l+1)/a,H=Math.sin(c*Math.PI*2)*E,R=Math.cos(c*Math.PI*2)*E,d=Math.sin(p*Math.PI*2)*E,T=Math.cos(p*Math.PI*2)*E;r.vertices.push(new THREE.Vector3(H,0,R),new THREE.Vector3(d,0,T));var h=this.color2;r.colors.push(h,h)}THREE.LineSegments.call(this,r,i)};e.prototype=Object.create(THREE.LineSegments.prototype),e.prototype.constructor=THREE.GridHelper,this.mesh=new e(2,10,1),this.mesh.add(new e(.2,1,.1));var t=[.2,.4,.6,.8,1,2,4,6,8,10],s=THREE.FontUtils.generateShapes(""),o=new THREE.Euler(-Math.PI/2,0,0);this.textMeshes=[];for(var r=0;r<t.length;++r){var i=new THREE.ShapeGeometry(s),h=new THREE.Mesh(i,new THREE.MeshBasicMaterial({color:this.mesh.color1,fog:!1})),a=t[r]<1?1e-4:.001;h.scale.set(a,a,a),h.position.set(t[r],0,0),h.quaternion.setFromEuler(o),this.textMeshes.push({mesh:h,radius:t[r]}),this.mesh.add(h)}this.gridScale=0,this.scale(1)}WorldEditorRadialHelper.prototype.scale=function(e){if(e!==this.gridScale){for(var t=0;t<this.textMeshes.length;++t){var s=this.textMeshes[t].radius*e,o=1>s?Math.round(100*s)+" cm":s+" m",r=THREE.FontUtils.generateShapes(o);this.textMeshes[t].mesh.geometry=new THREE.ShapeGeometry(r)}this.gridScale=e,this.mesh.scale.set(e,e,e)}},WorldEditorRadialHelper.prototype.position=function(e){this.mesh.position.x=e.x,this.mesh.position.y=0,this.mesh.position.z=e.z};
;
function ScreenshotRenderer(e,r){this.scene=e.clone(!1),this.scene.add(e.children[0].clone()),this.dollyCamera=r.parent.clone(),this.camera=this.dollyCamera.children[0],this.renderer=E2.core.renderer}ScreenshotRenderer.prototype.capture=function(e,r){var t=new THREE.WebGLRenderTarget(e,r,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat});this.camera.aspect=e/r,this.camera.updateProjectionMatrix(),this.renderer.setPixelRatio(1),this.renderer.setClearColor(new THREE.Color(0,0,0)),this.renderer.setRenderTarget(t),this.renderer.clear(),this.renderer.render(this.scene,this.camera,t);var a=new Uint8Array(e*r*4),n=this.renderer.getContext();n.readPixels(0,0,e,r,n.RGBA,n.UNSIGNED_BYTE,a);var i=document.createElement("canvas");i.width=e,i.height=r;var s=i.getContext("2d"),d=s.createImageData(e,r);return d.data.set(a),s.putImageData(d,0,0),this.renderer.setRenderTarget(null),i.toDataURL()};
;
!function(){function t(){EventEmitter.call(this)}t.prototype=Object.create(EventEmitter.prototype),t.prototype.errorHandler=function(t){this.emit("error",t)},t.prototype.progressHandler=function(t){return t.total?void this.emit("progress",t.loaded/t.total):void(lengthKnown=!1)},E2.Loader=t,E2.Loaders={},"undefined"!=typeof module&&(module.exports.Loader=t)}();
;
!function(){function e(e){E2.Loader.apply(this,arguments);var o=this,r=new Image,t=new XMLHttpRequest;t.open("GET",e,!0),t.crossOrigin="Anonymous",t.responseType="arraybuffer",t.onerror=function(){o.errorHandler(new Error(this.status))},t.onload=function(){if(console.time("Parse image"),this.status>=400)return this.onerror();var e=new Blob([this.response]);r.src=window.URL.createObjectURL(e),r.onload=function(){console.timeEnd("Parse image"),o.onImageLoaded(r)}},t.onprogress=function(e){e.total&&o.emit("progress",e.loaded/e.total)},t.send()}e.prototype=Object.create(E2.Loader.prototype),e.prototype.onImageLoaded=function(e){this.emit("loaded",e)},E2.Loaders.ImageLoader=e,"undefined"!=typeof module&&(module.exports.ImageLoader=e)}();
;
!function(){function e(){E2.Loaders.ImageLoader.apply(this,arguments)}e.prototype=Object.create(E2.Loaders.ImageLoader.prototype),e.prototype.onImageLoaded=function(e){var a=new THREE.Texture;a.wrapS=THREE.RepeatWrapping,a.wrapT=THREE.RepeatWrapping,a.image=e,a.needsUpdate=!0,this.emit("loaded",a)},E2.Loaders.TextureLoader=e,"undefined"!=typeof module&&(module.exports.TextureLoader=e)}();
;
!function(){function o(o){E2.Loader.apply(this,arguments);var e=o.substring(o.lastIndexOf("."));switch(e){case".obj":this.loadObj(o);break;case".js":case".json":this.loadJson(o);break;default:msg("ERROR: Don`t know how to load",o,e)}}"undefined"!=typeof module&&(E2.Loader=require("./loader.js").Loader),o.prototype=Object.create(E2.Loader.prototype),o.prototype.loadJson=function(o){var e=new THREE.JSONLoader;e.crossOrigin="Anonymous",e.load(o,this.onJsonLoaded.bind(this),this.progressHandler.bind(this),this.errorHandler.bind(this))},o.prototype.loadObj=function(o){var e=this,r=o.replace(".obj",".mtl");$.get("/stat"+r,function(d){if(void 0===d.error){var n=new THREE.MTLLoader;n.load(r,function(){var r=new THREE.OBJLoader;r.load(o,e.onObjLoaded.bind(e),e.progressHandler.bind(e),e.errorHandler.bind(e))},e.progressHandler.bind(e),e.errorHandler.bind(e))}else{var a=new THREE.OBJLoader;a.crossOrigin="Anonymous",a.load(o,e.onObjLoaded.bind(e),e.progressHandler.bind(e),e.errorHandler.bind(e))}})},o.prototype.onObjLoaded=function(o,e){this.emit("loaded",{geometries:o,materials:e})},o.prototype.onJsonLoaded=function(o,e){return this.onObjLoaded([o],e)},E2.Loaders.ModelLoader=o,"undefined"!=typeof module&&(module.exports.ModelLoader=o)}();
;
!function(){function e(){E2.Loaders.ModelLoader.apply(this,arguments)}e.prototype=Object.create(E2.Loaders.ModelLoader.prototype),e.prototype.loadJson=function(e){var t=new MultiObjectLoader;t.crossOrigin="Anonymous",t.load(e,this.onObjLoaded.bind(this),this.onHierarchyLoaded.bind(this),this.progressHandler.bind(this),this.errorHandler.bind(this))},e.prototype.onHierarchyLoaded=function(e){if(e.scene)for(this.object3d=new THREE.Object3D,this.object3d.copy(e.scene,!1);e.scene.children.length>0;){var t=e.scene.children[0];e.scene.remove(t),this.object3d.add(t)}else this.object3d=e;this.emit("loaded",this.object3d)},e.prototype.onObjLoaded=function(e,t){var o=e.length>0&&e[0].morphTargets&&e[0].morphTargets.length>0,n=o?function(e,t){return new THREE.MorphAnimMesh(e,t)}:function(e,t){return new THREE.Mesh(e,t)};if(1===e.length&&1===t.length)this.object3d=n(e[0],t[0]);else if(e.length>1&&t.length===e.length){this.object3d=new THREE.Group;for(var r=0;r<e.length;++r)this.object3d.add(n(e[r],t[r]))}else 1===e.length?this.object3d=THREE.SceneUtils.createMultiMaterialObject(e[0],t):console.error("ThreeLoaderScenePlugin: Invalid geometry + material combination",e.length,"geometries",t.length,"materials");this.emit("loaded",this.object3d)},E2.Loaders.SceneLoader=e,"undefined"!=typeof module&&(module.exports.SceneLoader=e)}();
;
!function(){function e(e){EventEmitter.call(this),this.loadingTexture=THREE.ImageUtils.loadTexture("/data/textures/loadingtex.png"),this.loadingTexture.wrapS=THREE.RepeatWrapping,this.loadingTexture.wrapT=THREE.RepeatWrapping,this.defaultTexture=THREE.ImageUtils.loadTexture("/data/textures/defaulttex.png"),this.defaultTexture.wrapS=THREE.RepeatWrapping,this.defaultTexture.wrapT=THREE.RepeatWrapping;var s={image:E2.Loaders.ImageLoader,texture:E2.Loaders.TextureLoader,model:E2.Loaders.ModelLoader,scene:E2.Loaders.SceneLoader,audiobuffer:E2.Loaders.AudioBufferLoader};this.loaders=e||s,this.assetPromises={},this.assetsLoaded=0,this.assetsFound=0}"undefined"!=typeof module&&(EventEmitter=require("events").EventEmitter,when=require("when"));var s={three_loader_model:"model",three_loader_scene:"scene",url_texture_generator:"texture",url_audio_buffer_generator:"audiobuffer"};e.prototype=Object.create(EventEmitter.prototype),e.prototype.loadAsset=function(e,s){var t=this,r=when.defer();if(this.assetPromises[s]){var o=this.assetPromises[s];if(o.progress<1)return o.promise;r.resolve(this.assetPromises[s].asset)}else{this.assetsFound++,this.assetPromises[s]={promise:r.promise,progress:0};var a=new this.loaders[e](s);a.on("progress",function(e){var r=0;t.assetPromises[s].progress=e,Object.keys(t.assetPromises).map(function(e){r+=t.assetPromises[e].progress}),r/=t.assetsFound,t.emit("progress",100*r)}).on("error",function(e){t.assetsLoaded++,t.totalProgress++,delete t.assetPromises[s],msg("ERROR: AssetLoader failed to load "+s+": "+e.toString()),r.reject(e)}).on("loaded",function(e){t.assetsLoaded++,t.totalProgress++,t.assetPromises[s].asset=e,t.assetPromises[s].progress=1,r.resolve(e)})}return r.promise},e.prototype.loadAssetsForGraph=function(e){var s=this,t=when.defer(),r=this.parse(e);this.totalProgress=0;var o=Object.keys(r);return o.map(function(e){var o=r[e];o.map(function(r){r&&(console.log("Loading",e,r),s.loadAsset(e,r).then(function(){s.assetsLoaded===s.assetsFound&&(s.emit("progress",100),t.resolve())}).catch(function(e){t.reject(e)}))})}),o.length||t.resolve(),t.promise},e.prototype.parse=function(e){function t(e){e.nodes&&e.nodes.map(function(e){if("graph"===e.plugin)return t(e.graph);var o=s[e.plugin];o&&(r[o]||(r[o]=[]),r[o].push(e.state.url))})}var r={};return t(e),r},"undefined"!=typeof module?module.exports.AssetLoader=e:window.AssetLoader=e}();
;
!function(){function o(o){E2.Loader.apply(this,arguments);var e=this,t=new XMLHttpRequest;t.open("GET",o,!0),t.crossOrigin="Anonymous",t.responseType="arraybuffer",t.onerror=function(){e.errorHandler(new Error(this.status))},t.onload=function(){return this.status>=400?this.onerror():void E2.core.audioContext.decodeAudioData(this.response,function(o){e.onLoaded(o)})},t.onprogress=function(o){o.total&&e.emit("progress",o.loaded/o.total)},t.send()}o.prototype=Object.create(E2.Loader.prototype),o.prototype.onLoaded=function(o){this.emit("loaded",o)},E2.Loaders.AudioBufferLoader=o,"undefined"!=typeof module&&(module.exports.AudioBufferLoader=o)}();
;
function MultiObjectLoader(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.objectLoader=new THREE.ObjectLoader(e),this.sceneLoader=new THREE.SceneLoader(e),this.jsonLoader=new THREE.JSONLoader(e),this.texturePath=""}MultiObjectLoader.prototype={constructor:MultiObjectLoader,load:function(e,t,r,a,s){var o=this;""===this.texturePath&&this.setTexturePath(e.substring(0,e.lastIndexOf("/")+1));var i=new THREE.XHRLoader(this.manager);i.setCrossOrigin(this.crossOrigin),i.load(e,function(a){var s=JSON.parse(a),i=s.metadata;if(!i||"object"!==i.type&&"Object"!==i.type)if(!i||"scene"!==i.type&&"Scene"!==i.type){var n=o.jsonLoader.parse(s,o.jsonLoader.texturePath);t([n.geometry],n.materials)}else o.sceneLoader.parse(s,r,e);else o.objectLoader.parse(s,r)},a,s)},setCrossOrigin:function(e){this.objectLoader.crossOrigin=e,this.sceneLoader.crossOrigin=e,this.jsonLoader.crossOrigin=e},setTexturePath:function(e){this.texturePath=e,this.objectLoader.texturePath=e,this.jsonLoader.texturePath=e},addGeometryHandler:function(e,t){this.sceneLoader.addGeometryHandler(t)},addHierarchyHandler:function(e,t){this.sceneLoader.addHierarchyHandler(t)}};
;
function PluginDocsCache(){this.cache={}}function PluginDocsLoader(e){var o="/docs/plugins/"+e,n=new XMLHttpRequest;n.open("GET",o,!0),n.crossOrigin="Anonymous",n.responseType="text";var r=this;n.onerror=function(){r.errorHandler(new Error(this.status))},n.onload=function(){return this.status>=400?this.onerror():void r.emit("loaded",JSON.parse(this.responseText))},n.send()}PluginDocsLoader.prototype=Object.create(E2.Loader.prototype),PluginDocsCache.prototype.loadDocs=function(e){var o=when.defer();if(this.cache[e])o.resolve(this.cache[e]);else{var n=new PluginDocsLoader(e),r=this;n.on("loaded",function(n){r.cache[e]=n,o.resolve(n)}).on("error",function(n){msg("Plugin docs loading failed for",e,n),o.reject(n)})}return o.promise},"undefined"!=typeof module&&(module.exports=PluginDocsCache);
;
var THREE={REVISION:"74"};"function"==typeof define&&define.amd?define("three",THREE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=THREE),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(e){return 0>e?-1:e>0?1:+e}),void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}}),void 0===Object.assign&&Object.defineProperty(Object,"assign",{writable:!0,configurable:!0,value:function(e){"use strict";if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),r=1,i=arguments.length;r!==i;++r){var n=arguments[r];if(void 0!==n&&null!==n){n=Object(n);for(var a=Object.keys(n),o=0,s=a.length;o!==s;++o){var h=a[o],c=Object.getOwnPropertyDescriptor(n,h);void 0!==c&&c.enumerable&&(t[h]=n[h])}}}return t}}),THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},THREE.CullFaceNone=0,THREE.CullFaceBack=1,THREE.CullFaceFront=2,THREE.CullFaceFrontBack=3,THREE.FrontFaceDirectionCW=0,THREE.FrontFaceDirectionCCW=1,THREE.BasicShadowMap=0,THREE.PCFShadowMap=1,THREE.PCFSoftShadowMap=2,THREE.FrontSide=0,THREE.BackSide=1,THREE.DoubleSide=2,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.CustomBlending=5,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.MinEquation=103,THREE.MaxEquation=104,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.NeverDepth=0,THREE.AlwaysDepth=1,THREE.LessDepth=2,THREE.LessEqualDepth=3,THREE.EqualDepth=4,THREE.GreaterEqualDepth=5,THREE.GreaterDepth=6,THREE.NotEqualDepth=7,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.AddOperation=2,THREE.UVMapping=300,THREE.CubeReflectionMapping=301,THREE.CubeRefractionMapping=302,THREE.EquirectangularReflectionMapping=303,THREE.EquirectangularRefractionMapping=304,THREE.SphericalReflectionMapping=305,THREE.RepeatWrapping=1e3,THREE.ClampToEdgeWrapping=1001,THREE.MirroredRepeatWrapping=1002,THREE.NearestFilter=1003,THREE.NearestMipMapNearestFilter=1004,THREE.NearestMipMapLinearFilter=1005,THREE.LinearFilter=1006,THREE.LinearMipMapNearestFilter=1007,THREE.LinearMipMapLinearFilter=1008,THREE.UnsignedByteType=1009,THREE.ByteType=1010,THREE.ShortType=1011,THREE.UnsignedShortType=1012,THREE.IntType=1013,THREE.UnsignedIntType=1014,THREE.FloatType=1015,THREE.HalfFloatType=1025,THREE.UnsignedShort4444Type=1016,THREE.UnsignedShort5551Type=1017,THREE.UnsignedShort565Type=1018,THREE.AlphaFormat=1019,THREE.RGBFormat=1020,THREE.RGBAFormat=1021,THREE.LuminanceFormat=1022,THREE.LuminanceAlphaFormat=1023,THREE.RGBEFormat=THREE.RGBAFormat,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.RGB_PVRTC_4BPPV1_Format=2100,THREE.RGB_PVRTC_2BPPV1_Format=2101,THREE.RGBA_PVRTC_4BPPV1_Format=2102,THREE.RGBA_PVRTC_2BPPV1_Format=2103,THREE.RGB_ETC1_Format=2151,THREE.LoopOnce=2200,THREE.LoopRepeat=2201,THREE.LoopPingPong=2202,THREE.InterpolateDiscrete=2300,THREE.InterpolateLinear=2301,THREE.InterpolateSmooth=2302,THREE.ZeroCurvatureEnding=2400,THREE.ZeroSlopeEnding=2401,THREE.WrapAroundEnding=2402,THREE.TrianglesDrawMode=0,THREE.TriangleStripDrawMode=1,THREE.TriangleFanDrawMode=2,THREE.Color=function(e){return 3===arguments.length?this.fromArray(arguments):this.set(e)},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(e){return e instanceof THREE.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){this.r=e,this.g=e,this.b=e},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(){function e(e,t,r){return 0>r&&(r+=1),r>1&&(r-=1),1/6>r?e+6*(t-e)*r:.5>r?t:2/3>r?e+6*(t-e)*(2/3-r):e}return function(t,r,i){if(t=THREE.Math.euclideanModulo(t,1),r=THREE.Math.clamp(r,0,1),i=THREE.Math.clamp(i,0,1),0===r)this.r=this.g=this.b=i;else{var n=.5>=i?i*(1+r):i+r-i*r,a=2*i-n;this.r=e(a,n,t+1/3),this.g=e(a,n,t),this.b=e(a,n,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var i,n=r[1],a=r[2];switch(n){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,h=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(o,s,h)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c=r[1],l=c.length;if(3===l)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}if(e&&e.length>0){var c=THREE.ColorKeywords[e];void 0!==c?this.setHex(c):console.warn("THREE.Color: Unknown color "+e)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,r,i=e||{h:0,s:0,l:0},n=this.r,a=this.g,o=this.b,s=Math.max(n,a,o),h=Math.min(n,a,o),c=(h+s)/2;if(h===s)t=0,r=0;else{var l=s-h;switch(r=.5>=c?l/(s+h):l/(2-s-h),s){case n:t=(a-o)/l+(o>a?6:0);break;case a:t=(o-n)/l+2;break;case o:t=(n-a)/l+4}t/=6}return i.h=t,i.s=r,i.l=c,i},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){var i=this.getHSL();return i.h+=e,i.s+=t,i.l+=r,this.setHSL(i.h,i.s,i.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Quaternion=function(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==i?i:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(e instanceof THREE.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var r=Math.cos(e._x/2),i=Math.cos(e._y/2),n=Math.cos(e._z/2),a=Math.sin(e._x/2),o=Math.sin(e._y/2),s=Math.sin(e._z/2),h=e.order;return"XYZ"===h?(this._x=a*i*n+r*o*s,this._y=r*o*n-a*i*s,this._z=r*i*s+a*o*n,this._w=r*i*n-a*o*s):"YXZ"===h?(this._x=a*i*n+r*o*s,this._y=r*o*n-a*i*s,this._z=r*i*s-a*o*n,this._w=r*i*n+a*o*s):"ZXY"===h?(this._x=a*i*n-r*o*s,this._y=r*o*n+a*i*s,this._z=r*i*s+a*o*n,this._w=r*i*n-a*o*s):"ZYX"===h?(this._x=a*i*n-r*o*s,this._y=r*o*n+a*i*s,this._z=r*i*s-a*o*n,this._w=r*i*n+a*o*s):"YZX"===h?(this._x=a*i*n+r*o*s,this._y=r*o*n+a*i*s,this._z=r*i*s-a*o*n,this._w=r*i*n-a*o*s):"XZY"===h&&(this._x=a*i*n-r*o*s,this._y=r*o*n-a*i*s,this._z=r*i*s+a*o*n,this._w=r*i*n+a*o*s),t!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,i=r[0],n=r[4],a=r[8],o=r[1],s=r[5],h=r[9],c=r[2],l=r[6],u=r[10],E=i+s+u;return E>0?(t=.5/Math.sqrt(E+1),this._w=.25/t,this._x=(l-h)*t,this._y=(a-c)*t,this._z=(o-n)*t):i>s&&i>u?(t=2*Math.sqrt(1+i-s-u),this._w=(l-h)/t,this._x=.25*t,this._y=(n+o)/t,this._z=(a+c)/t):s>u?(t=2*Math.sqrt(1+s-i-u),this._w=(a-c)/t,this._x=(n+o)/t,this._y=.25*t,this._z=(h+l)/t):(t=2*Math.sqrt(1+u-i-s),this._w=(o-n)/t,this._x=(a+c)/t,this._y=(h+l)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t,r=1e-6;return function(i,n){return void 0===e&&(e=new THREE.Vector3),t=i.dot(n)+1,r>t?(t=0,Math.abs(i.x)>Math.abs(i.z)?e.set(-i.y,i.x,0):e.set(0,-i.z,i.y)):e.crossVectors(i,n),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e._x,i=e._y,n=e._z,a=e._w,o=t._x,s=t._y,h=t._z,c=t._w;return this._x=r*c+a*o+i*h-n*s,this._y=i*c+a*s+n*o-r*h,this._z=n*c+a*h+r*s-i*o,this._w=a*c-r*o-i*s-n*h,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,i=this._y,n=this._z,a=this._w,o=a*e._w+r*e._x+i*e._y+n*e._z;if(0>o?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=r,this._y=i,this._z=n,this;var s=Math.sqrt(1-o*o);if(Math.abs(s)<.001)return this._w=.5*(a+this._w),this._x=.5*(r+this._x),this._y=.5*(i+this._y),this._z=.5*(n+this._z),this;var h=Math.atan2(s,o),c=Math.sin((1-t)*h)/s,l=Math.sin(t*h)/s;return this._w=a*c+this._w*l,this._x=r*c+this._x*l,this._y=i*c+this._y*l,this._z=n*c+this._z*l,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},Object.assign(THREE.Quaternion,{slerp:function(e,t,r,i){return r.copy(e).slerp(t,i)},slerpFlat:function(e,t,r,i,n,a,o){var s=r[i+0],h=r[i+1],c=r[i+2],l=r[i+3],u=n[a+0],E=n[a+1],p=n[a+2],d=n[a+3];if(l!==d||s!==u||h!==E||c!==p){var f=1-o,m=s*u+h*E+c*p+l*d,T=m>=0?1:-1,v=1-m*m;if(v>Number.EPSILON){var g=Math.sqrt(v),y=Math.atan2(g,m*T);f=Math.sin(f*y)/g,o=Math.sin(o*y)/g}var R=o*T;if(s=s*f+u*R,h=h*f+E*R,c=c*f+p*R,l=l*f+d*R,f===1-o){var H=1/Math.sqrt(s*s+h*h+c*c+l*l);s*=H,h*=H,c*=H,l*=H}}e[t]=s,e[t+1]=h,e[t+2]=c,e[t+3]=l}}),THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,get width(){return this.x},set width(e){this.x=e},get height(){return this.y},set height(e){this.y=e},set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e):(this.x=0,this.y=0),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e,t;return function(r,i){return void 0===e&&(e=new THREE.Vector2,t=new THREE.Vector2),e.set(r,r),t.set(i,i),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,r))/r),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var e=Math.atan2(this.y,this.x);return 0>e&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this},rotateAround:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=this.x-e.x,a=this.y-e.y;return this.x=n*r-a*i+e.x,this.y=n*i+a*r+e.y,this}},THREE.Vector3=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(t){return t instanceof THREE.Euler==!1&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),void 0===e&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromEuler(t)),this}}(),applyAxisAngle:function(){var e;return function(t,r){return void 0===e&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,r)),this}}(),applyMatrix3:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i+n[12],this.y=n[1]*t+n[5]*r+n[9]*i+n[13],this.z=n[2]*t+n[6]*r+n[10]*i+n[14],this},applyProjection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements,a=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*a,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*a,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*a,this},applyQuaternion:function(e){var t=this.x,r=this.y,i=this.z,n=e.x,a=e.y,o=e.z,s=e.w,h=s*t+a*i-o*r,c=s*r+o*t-n*i,l=s*i+n*r-a*t,u=-n*t-a*r-o*i;return this.x=h*s+u*-n+c*-o-l*-a,this.y=c*s+u*-a+l*-n-h*-o,this.z=l*s+u*-o+h*-a-c*-n,this},project:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyProjection(e)}}(),unproject:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e,t;return function(r,i){return void 0===e&&(e=new THREE.Vector3,t=new THREE.Vector3),e.set(r,r,r),t.set(i,i,i),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,r))/r),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var r=this.x,i=this.y,n=this.z;return this.x=i*e.z-n*e.y,this.y=n*e.x-r*e.z,this.z=r*e.y-i*e.x,this},crossVectors:function(e,t){var r=e.x,i=e.y,n=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-n*o,this.y=n*a-r*s,this.z=r*o-i*a,this},projectOnVector:function(){var e,t;return function(r){return void 0===e&&(e=new THREE.Vector3),e.copy(r).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(THREE.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),r=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),i=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=r,this.z=i,this},setFromMatrixColumn:function(e,t){var r=4*e,i=t.elements;return this.x=i[r],this.y=i[r+1],this.z=i[r+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this}},THREE.Vector4=function(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e,this.w*=e):(this.x=0,this.y=0,this.z=0,this.w=0),this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*i+a[12]*n,this.y=a[1]*t+a[5]*r+a[9]*i+a[13]*n,this.z=a[2]*t+a[6]*r+a[10]*i+a[14]*n,this.w=a[3]*t+a[7]*r+a[11]*i+a[15]*n,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,n,a=.01,o=.1,s=e.elements,h=s[0],c=s[4],l=s[8],u=s[1],E=s[5],p=s[9],d=s[2],f=s[6],m=s[10];if(Math.abs(c-u)<a&&Math.abs(l-d)<a&&Math.abs(p-f)<a){if(Math.abs(c+u)<o&&Math.abs(l+d)<o&&Math.abs(p+f)<o&&Math.abs(h+E+m-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var T=(h+1)/2,v=(E+1)/2,g=(m+1)/2,y=(c+u)/4,R=(l+d)/4,H=(p+f)/4;return T>v&&T>g?a>T?(r=0,i=.707106781,n=.707106781):(r=Math.sqrt(T),i=y/r,n=R/r):v>g?a>v?(r=.707106781,i=0,n=.707106781):(i=Math.sqrt(v),r=y/i,n=H/i):a>g?(r=.707106781,i=.707106781,n=0):(n=Math.sqrt(g),r=R/n,i=H/n),this.set(r,i,n,t),this}var x=Math.sqrt((f-p)*(f-p)+(l-d)*(l-d)+(u-c)*(u-c));return Math.abs(x)<.001&&(x=1),this.x=(f-p)/x,this.y=(l-d)/x,this.z=(u-c)/x,this.w=Math.acos((h+E+m-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(r,i){return void 0===e&&(e=new THREE.Vector4,t=new THREE.Vector4),e.set(r,r,r,r),t.set(i,i,i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this
},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,r){return void 0===r&&(r=0),t=t*e.itemSize+r,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this}},THREE.Euler=function(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._order=i||THREE.Euler.DefaultOrder},THREE.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],THREE.Euler.DefaultOrder="XYZ",THREE.Euler.prototype={constructor:THREE.Euler,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._order=i||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var i=THREE.Math.clamp,n=e.elements,a=n[0],o=n[4],s=n[8],h=n[1],c=n[5],l=n[9],u=n[2],E=n[6],p=n[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(E,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(h,c)):(this._y=Math.atan2(-u,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(E,-1,1)),Math.abs(E)<.99999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(h,a))):"ZYX"===t?(this._y=Math.asin(-i(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(E,p),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-o,c))):"YZX"===t?(this._z=Math.asin(i(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-u,a)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===t?(this._z=Math.asin(-i(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(E,c),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-l,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,r!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var e;return function(t,r,i){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,r,i),this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new THREE.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},THREE.Line3=function(e,t){this.start=void 0!==e?e:new THREE.Vector3,this.end=void 0!==t?t:new THREE.Vector3},THREE.Line3.prototype={constructor:THREE.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new THREE.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r,i){e.subVectors(r,this.start),t.subVectors(this.end,this.start);var n=t.dot(t),a=t.dot(e),o=a/n;return i&&(o=THREE.Math.clamp(o,0,1)),o}}(),closestPointToPoint:function(e,t,r){var i=this.closestPointToPointParameter(e,t),n=r||new THREE.Vector3;return this.delta(n).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},THREE.Box2=function(e,t){this.min=void 0!==e?e:new THREE.Vector2(+1/0,+1/0),this.max=void 0!==t?t:new THREE.Vector2(-1/0,-1/0)},THREE.Box2.prototype={constructor:THREE.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;r>t;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new THREE.Vector2;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=+1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new THREE.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e,t){var r=t||new THREE.Vector2;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){var r=t||new THREE.Vector2;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector2;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},THREE.Box3=function(e,t){this.min=void 0!==e?e:new THREE.Vector3(+1/0,+1/0,+1/0),this.max=void 0!==t?t:new THREE.Vector3(-1/0,-1/0,-1/0)},THREE.Box3.prototype={constructor:THREE.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){this.makeEmpty();for(var t=+1/0,r=+1/0,i=+1/0,n=-1/0,a=-1/0,o=-1/0,s=0,h=e.length;h>s;s+=3){var c=e[s],l=e[s+1],u=e[s+2];t=Math.min(t,c),r=Math.min(r,l),i=Math.min(i,u),n=Math.max(n,c),a=Math.max(a,l),o=Math.max(o,u)}this.min.set(t,r,i),this.max.set(n,a,o)},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;r>t;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new THREE.Vector3;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(){var e;return function(t){void 0===e&&(e=new THREE.Box3);var r=this;return this.makeEmpty(),t.updateMatrixWorld(!0),t.traverse(function(t){var i=t.geometry;void 0!==i&&(null===i.boundingBox&&i.computeBoundingBox(),e.copy(i.boundingBox),e.applyMatrix4(t.matrixWorld),r.union(e))}),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=+1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e,t){var r=t||new THREE.Vector3;return r.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},intersectsSphere:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){var t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=e.constant&&r>=e.constant},clampPoint:function(e,t){var r=t||new THREE.Vector3;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),getBoundingSphere:function(){var e=new THREE.Vector3;return function(t){var r=t||new THREE.Sphere;return r.center=this.center(),r.radius=.5*this.size(e).length(),r}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(e,t,r,i,n,a,o,s,h){var c=this.elements;return c[0]=e,c[3]=t,c[6]=r,c[1]=i,c[4]=n,c[7]=a,c[2]=o,c[5]=s,c[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},applyToVector3Array:function(){var e;return function(t,r,i){void 0===e&&(e=new THREE.Vector3),void 0===r&&(r=0),void 0===i&&(i=t.length);for(var n=0,a=r;i>n;n+=3,a+=3)e.fromArray(t,a),e.applyMatrix3(this),e.toArray(t,a);return t}}(),applyToBuffer:function(){var e;return function(t,r,i){void 0===e&&(e=new THREE.Vector3),void 0===r&&(r=0),void 0===i&&(i=t.length/t.itemSize);for(var n=0,a=r;i>n;n++,a++)e.x=t.getX(a),e.y=t.getY(a),e.z=t.getZ(a),e.applyMatrix3(this),t.setXYZ(e.x,e.y,e.z);return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],h=e[7],c=e[8];return t*a*c-t*o*h-r*n*c+r*o*s+i*n*h-i*a*s},getInverse:function(e,t){var r=e.elements,i=this.elements;i[0]=r[10]*r[5]-r[6]*r[9],i[1]=-r[10]*r[1]+r[2]*r[9],i[2]=r[6]*r[1]-r[2]*r[5],i[3]=-r[10]*r[4]+r[6]*r[8],i[4]=r[10]*r[0]-r[2]*r[8],i[5]=-r[6]*r[0]+r[2]*r[4],i[6]=r[9]*r[4]-r[5]*r[8],i[7]=-r[9]*r[0]+r[1]*r[8],i[8]=r[5]*r[0]-r[1]*r[4];var n=r[0]*i[0]+r[1]*i[3]+r[2]*i[6];if(0===n){var a="THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(a);return console.warn(a),this.identity(),this}return this.multiplyScalar(1/n),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}},THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,r,i,n,a,o,s,h,c,l,u,E,p,d,f){var m=this.elements;return m[0]=e,m[4]=t,m[8]=r,m[12]=i,m[1]=n,m[5]=a,m[9]=o,m[13]=s,m[2]=h,m[6]=c,m[10]=l,m[14]=u,m[3]=E,m[7]=p,m[11]=d,m[15]=f,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)},copy:function(e){return this.elements.set(e.elements),this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){var i=this.elements;return e.set(i[0],i[1],i[2]),t.set(i[4],i[5],i[6]),r.set(i[8],i[9],i[10]),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(){var e;return function(t){void 0===e&&(e=new THREE.Vector3);var r=this.elements,i=t.elements,n=1/e.set(i[0],i[1],i[2]).length(),a=1/e.set(i[4],i[5],i[6]).length(),o=1/e.set(i[8],i[9],i[10]).length();return r[0]=i[0]*n,r[1]=i[1]*n,r[2]=i[2]*n,r[4]=i[4]*a,r[5]=i[5]*a,r[6]=i[6]*a,r[8]=i[8]*o,r[9]=i[9]*o,r[10]=i[10]*o,this}}(),makeRotationFromEuler:function(e){e instanceof THREE.Euler==!1&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,i=e.y,n=e.z,a=Math.cos(r),o=Math.sin(r),s=Math.cos(i),h=Math.sin(i),c=Math.cos(n),l=Math.sin(n);if("XYZ"===e.order){var u=a*c,E=a*l,p=o*c,d=o*l;t[0]=s*c,t[4]=-s*l,t[8]=h,t[1]=E+p*h,t[5]=u-d*h,t[9]=-o*s,t[2]=d-u*h,t[6]=p+E*h,t[10]=a*s}else if("YXZ"===e.order){var f=s*c,m=s*l,T=h*c,v=h*l;t[0]=f+v*o,t[4]=T*o-m,t[8]=a*h,t[1]=a*l,t[5]=a*c,t[9]=-o,t[2]=m*o-T,t[6]=v+f*o,t[10]=a*s}else if("ZXY"===e.order){var f=s*c,m=s*l,T=h*c,v=h*l;t[0]=f-v*o,t[4]=-a*l,t[8]=T+m*o,t[1]=m+T*o,t[5]=a*c,t[9]=v-f*o,t[2]=-a*h,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var u=a*c,E=a*l,p=o*c,d=o*l;t[0]=s*c,t[4]=p*h-E,t[8]=u*h+d,t[1]=s*l,t[5]=d*h+u,t[9]=E*h-p,t[2]=-h,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var g=a*s,y=a*h,R=o*s,H=o*h;t[0]=s*c,t[4]=H-g*l,t[8]=R*l+y,t[1]=l,t[5]=a*c,t[9]=-o*c,t[2]=-h*c,t[6]=y*l+R,t[10]=g-H*l}else if("XZY"===e.order){var g=a*s,y=a*h,R=o*s,H=o*h;t[0]=s*c,t[4]=-l,t[8]=h*c,t[1]=g*l+H,t[5]=a*c,t[9]=y*l-R,t[2]=R*l-y,t[6]=o*c,t[10]=H*l+g}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z,a=e.w,o=r+r,s=i+i,h=n+n,c=r*o,l=r*s,u=r*h,E=i*s,p=i*h,d=n*h,f=a*o,m=a*s,T=a*h;return t[0]=1-(E+d),t[4]=l-T,t[8]=u+m,t[1]=l+T,t[5]=1-(c+d),t[9]=p-f,t[2]=u-m,t[6]=p+f,t[10]=1-(c+E),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e,t,r;return function(i,n,a){void 0===e&&(e=new THREE.Vector3),void 0===t&&(t=new THREE.Vector3),void 0===r&&(r=new THREE.Vector3);var o=this.elements;return r.subVectors(i,n).normalize(),0===r.lengthSq()&&(r.z=1),e.crossVectors(a,r).normalize(),0===e.lengthSq()&&(r.x+=1e-4,e.crossVectors(a,r).normalize()),t.crossVectors(r,e),o[0]=e.x,o[4]=t.x,o[8]=r.x,o[1]=e.y,o[5]=t.y,o[9]=r.y,o[2]=e.z,o[6]=t.z,o[10]=r.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,n=this.elements,a=r[0],o=r[4],s=r[8],h=r[12],c=r[1],l=r[5],u=r[9],E=r[13],p=r[2],d=r[6],f=r[10],m=r[14],T=r[3],v=r[7],g=r[11],y=r[15],R=i[0],H=i[4],x=i[8],b=i[12],M=i[1],_=i[5],w=i[9],S=i[13],C=i[2],L=i[6],A=i[10],P=i[14],D=i[3],U=i[7],I=i[11],k=i[15];return n[0]=a*R+o*M+s*C+h*D,n[4]=a*H+o*_+s*L+h*U,n[8]=a*x+o*w+s*A+h*I,n[12]=a*b+o*S+s*P+h*k,n[1]=c*R+l*M+u*C+E*D,n[5]=c*H+l*_+u*L+E*U,n[9]=c*x+l*w+u*A+E*I,n[13]=c*b+l*S+u*P+E*k,n[2]=p*R+d*M+f*C+m*D,n[6]=p*H+d*_+f*L+m*U,n[10]=p*x+d*w+f*A+m*I,n[14]=p*b+d*S+f*P+m*k,n[3]=T*R+v*M+g*C+y*D,n[7]=T*H+v*_+g*L+y*U,n[11]=T*x+v*w+g*A+y*I,n[15]=T*b+v*S+g*P+y*k,this},multiplyToArray:function(e,t,r){var i=this.elements;return this.multiplyMatrices(e,t),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToVector3Array:function(){var e;return function(t,r,i){void 0===e&&(e=new THREE.Vector3),void 0===r&&(r=0),void 0===i&&(i=t.length);for(var n=0,a=r;i>n;n+=3,a+=3)e.fromArray(t,a),e.applyMatrix4(this),e.toArray(t,a);return t}}(),applyToBuffer:function(){var e;return function(t,r,i){void 0===e&&(e=new THREE.Vector3),void 0===r&&(r=0),void 0===i&&(i=t.length/t.itemSize);for(var n=0,a=r;i>n;n++,a++)e.x=t.getX(a),e.y=t.getY(a),e.z=t.getZ(a),e.applyMatrix4(this),t.setXYZ(e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],a=e[1],o=e[5],s=e[9],h=e[13],c=e[2],l=e[6],u=e[10],E=e[14],p=e[3],d=e[7],f=e[11],m=e[15];return p*(+n*s*l-i*h*l-n*o*u+r*h*u+i*o*E-r*s*E)+d*(+t*s*E-t*h*u+n*a*u-i*a*E+i*h*c-n*s*c)+f*(+t*h*l-t*o*E-n*a*l+r*a*E+n*o*c-r*h*c)+m*(-i*o*c-t*s*l+t*o*u+i*a*l-r*a*u+r*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e},getPosition:function(){var e;return function(){void 0===e&&(e=new THREE.Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,i=e.elements,n=i[0],a=i[4],o=i[8],s=i[12],h=i[1],c=i[5],l=i[9],u=i[13],E=i[2],p=i[6],d=i[10],f=i[14],m=i[3],T=i[7],v=i[11],g=i[15];r[0]=l*f*T-u*d*T+u*p*v-c*f*v-l*p*g+c*d*g,r[4]=s*d*T-o*f*T-s*p*v+a*f*v+o*p*g-a*d*g,r[8]=o*u*T-s*l*T+s*c*v-a*u*v-o*c*g+a*l*g,r[12]=s*l*p-o*u*p-s*c*d+a*u*d+o*c*f-a*l*f,r[1]=u*d*m-l*f*m-u*E*v+h*f*v+l*E*g-h*d*g,r[5]=o*f*m-s*d*m+s*E*v-n*f*v-o*E*g+n*d*g,r[9]=s*l*m-o*u*m-s*h*v+n*u*v+o*h*g-n*l*g,r[13]=o*u*E-s*l*E+s*h*d-n*u*d-o*h*f+n*l*f,r[2]=c*f*m-u*p*m+u*E*T-h*f*T-c*E*g+h*p*g,r[6]=s*p*m-a*f*m-s*E*T+n*f*T+a*E*g-n*p*g,r[10]=a*u*m-s*c*m+s*h*T-n*u*T-a*h*g+n*c*g,r[14]=s*c*E-a*u*E-s*h*p+n*u*p+a*h*f-n*c*f,r[3]=l*p*m-c*d*m-l*E*T+h*d*T+c*E*v-h*p*v,r[7]=a*d*m-o*p*m+o*E*T-n*d*T-a*E*v+n*p*v,r[11]=o*c*m-a*l*m-o*h*T+n*l*T+a*h*v-n*c*v,r[15]=a*l*E-o*c*E+o*h*p-n*l*p-a*h*d+n*c*d;var y=n*r[0]+h*r[4]+E*r[8]+m*r[12];if(0===y){var R="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(R);return console.warn(R),this.identity(),this}return this.multiplyScalar(1/y),this},scale:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=1-r,a=e.x,o=e.y,s=e.z,h=n*a,c=n*o;return this.set(h*a+r,h*o-i*s,h*s+i*o,0,h*o+i*s,c*o+r,c*s-i*a,0,h*s-i*o,c*s+i*a,n*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},compose:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:function(){var e,t;return function(r,i,n){void 0===e&&(e=new THREE.Vector3),void 0===t&&(t=new THREE.Matrix4);var a=this.elements,o=e.set(a[0],a[1],a[2]).length(),s=e.set(a[4],a[5],a[6]).length(),h=e.set(a[8],a[9],a[10]).length(),c=this.determinant();0>c&&(o=-o),r.x=a[12],r.y=a[13],r.z=a[14],t.elements.set(this.elements);var l=1/o,u=1/s,E=1/h;return t.elements[0]*=l,t.elements[1]*=l,t.elements[2]*=l,t.elements[4]*=u,t.elements[5]*=u,t.elements[6]*=u,t.elements[8]*=E,t.elements[9]*=E,t.elements[10]*=E,i.setFromRotationMatrix(t),n.x=o,n.y=s,n.z=h,this}}(),makeFrustum:function(e,t,r,i,n,a){var o=this.elements,s=2*n/(t-e),h=2*n/(i-r),c=(t+e)/(t-e),l=(i+r)/(i-r),u=-(a+n)/(a-n),E=-2*a*n/(a-n);return o[0]=s,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=h,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=E,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(e,t,r,i){var n=r*Math.tan(THREE.Math.degToRad(.5*e)),a=-n,o=a*t,s=n*t;return this.makeFrustum(o,s,a,n,r,i)},makeOrthographic:function(e,t,r,i,n,a){var o=this.elements,s=t-e,h=r-i,c=a-n,l=(t+e)/s,u=(r+i)/h,E=(a+n)/c;return o[0]=2/s,o[4]=0,o[8]=0,o[12]=-l,o[1]=0,o[5]=2/h,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2/c,o[14]=-E,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;16>i;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}},THREE.Ray=function(e,t){this.origin=void 0!==e?e:new THREE.Vector3,this.direction=void 0!==t?t:new THREE.Vector3},THREE.Ray.prototype={constructor:THREE.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var r=t||new THREE.Vector3;return r.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){this.direction.copy(e).sub(this.origin).normalize()},recast:function(){var e=new THREE.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var r=t||new THREE.Vector3;r.subVectors(e,this.origin);var i=r.dot(this.direction);return 0>i?r.copy(this.origin):r.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new THREE.Vector3;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return 0>r?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(i,n,a,o){e.copy(i).add(n).multiplyScalar(.5),t.copy(n).sub(i).normalize(),r.copy(this.origin).sub(e);var s,h,c,l,u=.5*i.distanceTo(n),E=-this.direction.dot(t),p=r.dot(this.direction),d=-r.dot(t),f=r.lengthSq(),m=Math.abs(1-E*E);if(m>0)if(s=E*d-p,h=E*p-d,l=u*m,s>=0)if(h>=-l)if(l>=h){var T=1/m;s*=T,h*=T,c=s*(s+E*h+2*p)+h*(E*s+h+2*d)+f}else h=u,s=Math.max(0,-(E*h+p)),c=-s*s+h*(h+2*d)+f;else h=-u,s=Math.max(0,-(E*h+p)),c=-s*s+h*(h+2*d)+f;else-l>=h?(s=Math.max(0,-(-E*u+p)),h=s>0?-u:Math.min(Math.max(-u,-d),u),c=-s*s+h*(h+2*d)+f):l>=h?(s=0,h=Math.min(Math.max(-u,-d),u),c=h*(h+2*d)+f):(s=Math.max(0,-(E*u+p)),h=s>0?u:Math.min(Math.max(-u,-d),u),c=-s*s+h*(h+2*d)+f);else h=E>0?-u:u,s=Math.max(0,-(E*h+p)),c=-s*s+h*(h+2*d)+f;return a&&a.copy(this.direction).multiplyScalar(s).add(this.origin),o&&o.copy(t).multiplyScalar(h).add(e),c}}(),intersectSphere:function(){var e=new THREE.Vector3;return function(t,r){e.subVectors(t.center,this.origin);var i=e.dot(this.direction),n=e.dot(e)-i*i,a=t.radius*t.radius;if(n>a)return null;var o=Math.sqrt(a-n),s=i-o,h=i+o;return 0>s&&0>h?null:0>s?this.at(h,r):this.at(s,r)}}(),intersectsSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var r=e.normal.dot(this.direction);return 0>r*t?!0:!1},intersectBox:function(e,t){var r,i,n,a,o,s,h=1/this.direction.x,c=1/this.direction.y,l=1/this.direction.z,u=this.origin;return h>=0?(r=(e.min.x-u.x)*h,i=(e.max.x-u.x)*h):(r=(e.max.x-u.x)*h,i=(e.min.x-u.x)*h),c>=0?(n=(e.min.y-u.y)*c,a=(e.max.y-u.y)*c):(n=(e.max.y-u.y)*c,a=(e.min.y-u.y)*c),r>a||n>i?null:((n>r||r!==r)&&(r=n),(i>a||i!==i)&&(i=a),l>=0?(o=(e.min.z-u.z)*l,s=(e.max.z-u.z)*l):(o=(e.max.z-u.z)*l,s=(e.min.z-u.z)*l),r>s||o>i?null:((o>r||r!==r)&&(r=o),(i>s||i!==i)&&(i=s),0>i?null:this.at(r>=0?r:i,t)))},intersectsBox:function(){var e=new THREE.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3;return function(n,a,o,s,h){t.subVectors(a,n),r.subVectors(o,n),i.crossVectors(t,r);var c,l=this.direction.dot(i);if(l>0){if(s)return null;c=1}else{if(!(0>l))return null;c=-1,l=-l}e.subVectors(this.origin,n);var u=c*this.direction.dot(r.crossVectors(e,r));if(0>u)return null;var E=c*this.direction.dot(t.cross(e));if(0>E)return null;if(u+E>l)return null;var p=-c*e.dot(i);return 0>p?null:this.at(p/l,h)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},THREE.Sphere=function(e,t){this.center=void 0!==e?e:new THREE.Vector3,this.radius=void 0!==t?t:0},THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new THREE.Box3;return function(t,r){var i=this.center;void 0!==r?i.copy(r):e.setFromPoints(t).center(i);for(var n=0,a=0,o=t.length;o>a;a++)n=Math.max(n,i.distanceToSquared(t[a]));return this.radius=Math.sqrt(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(this.center.dot(e.normal)-e.constant)<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e),i=t||new THREE.Vector3;return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(e){var t=e||new THREE.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},THREE.Frustum=function(e,t,r,i,n,a){this.planes=[void 0!==e?e:new THREE.Plane,void 0!==t?t:new THREE.Plane,void 0!==r?r:new THREE.Plane,void 0!==i?i:new THREE.Plane,void 0!==n?n:new THREE.Plane,void 0!==a?a:new THREE.Plane]},THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(e,t,r,i,n,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(i),o[4].copy(n),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,r=0;6>r;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,i=r[0],n=r[1],a=r[2],o=r[3],s=r[4],h=r[5],c=r[6],l=r[7],u=r[8],E=r[9],p=r[10],d=r[11],f=r[12],m=r[13],T=r[14],v=r[15];return t[0].setComponents(o-i,l-s,d-u,v-f).normalize(),t[1].setComponents(o+i,l+s,d+u,v+f).normalize(),t[2].setComponents(o+n,l+h,d+E,v+m).normalize(),t[3].setComponents(o-n,l-h,d-E,v-m).normalize(),t[4].setComponents(o-a,l-c,d-p,v-T).normalize(),t[5].setComponents(o+a,l+c,d+p,v+T).normalize(),this
},intersectsObject:function(){var e=new THREE.Sphere;return function(t){var r=t.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),e.copy(r.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,i=-e.radius,n=0;6>n;n++){var a=t[n].distanceToPoint(r);if(i>a)return!1}return!0},intersectsBox:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r){for(var i=this.planes,n=0;6>n;n++){var a=i[n];e.x=a.normal.x>0?r.min.x:r.max.x,t.x=a.normal.x>0?r.max.x:r.min.x,e.y=a.normal.y>0?r.min.y:r.max.y,t.y=a.normal.y>0?r.max.y:r.min.y,e.z=a.normal.z>0?r.min.z:r.max.z,t.z=a.normal.z>0?r.max.z:r.min.z;var o=a.distanceToPoint(e),s=a.distanceToPoint(t);if(0>o&&0>s)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;6>r;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}},THREE.Plane=function(e,t){this.normal=void 0!==e?e:new THREE.Vector3(1,0,0),this.constant=void 0!==t?t:0},THREE.Plane.prototype={constructor:THREE.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r,i,n){var a=e.subVectors(n,i).cross(t.subVectors(r,i)).normalize();return this.setFromNormalAndCoplanarPoint(a,r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e),i=t||new THREE.Vector3;return i.copy(this.normal).multiplyScalar(r)},intersectLine:function(){var e=new THREE.Vector3;return function(t,r){var i=r||new THREE.Vector3,n=t.delta(e),a=this.normal.dot(n);if(0===a)return 0===this.distanceToPoint(t.start)?i.copy(t.start):void 0;var o=-(t.start.dot(this.normal)+this.constant)/a;return 0>o||o>1?void 0:i.copy(n).multiplyScalar(o).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return 0>t&&r>0||0>r&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){var t=e||new THREE.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Matrix3;return function(i,n){var a=n||r.getNormalMatrix(i),o=e.copy(this.normal).applyMatrix3(a),s=this.coplanarPoint(t);return s.applyMatrix4(i),this.setFromNormalAndCoplanarPoint(o,s),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},THREE.Math={generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),i=0;return function(){for(var n=0;36>n;n++)8===n||13===n||18===n||23===n?r[n]="-":14===n?r[n]="4":(2>=i&&(i=33554432+16777216*Math.random()|0),e=15&i,i>>=4,r[n]=t[19===n?3&e|8:e]);return r.join("")}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},smoothstep:function(e,t,r){return t>=e?0:e>=r?1:(e=(e-t)/(r-t),e*e*(3-2*e))},smootherstep:function(e,t,r){return t>=e?0:e>=r?1:(e=(e-t)/(r-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead."),Math.random()},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}},THREE.Spline=function(e){function t(e,t,r,i,n,a,o){var s=.5*(r-e),h=.5*(i-t);return(2*(t-r)+s+h)*o+(-3*(t-r)-2*s-h)*a+s*n+t}this.points=e;var r,i,n,a,o,s,h,c,l,u=[],E={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return r=(this.points.length-1)*e,i=Math.floor(r),n=r-i,u[0]=0===i?i:i-1,u[1]=i,u[2]=i>this.points.length-2?this.points.length-1:i+1,u[3]=i>this.points.length-3?this.points.length-1:i+2,s=this.points[u[0]],h=this.points[u[1]],c=this.points[u[2]],l=this.points[u[3]],a=n*n,o=n*a,E.x=t(s.x,h.x,c.x,l.x,n,a,o),E.y=t(s.y,h.y,c.y,l.y,n,a,o),E.z=t(s.z,h.z,c.z,l.z,n,a,o),E},this.getControlPointsArray=function(){var e,t,r=this.points.length,i=[];for(e=0;r>e;e++)t=this.points[e],i[e]=[t.x,t.y,t.z];return i},this.getLength=function(e){var t,r,i,n,a=0,o=0,s=0,h=new THREE.Vector3,c=new THREE.Vector3,l=[],u=0;for(l[0]=0,e||(e=100),i=this.points.length*e,h.copy(this.points[0]),t=1;i>t;t++)r=t/i,n=this.getPoint(r),c.copy(n),u+=c.distanceTo(h),h.copy(n),a=(this.points.length-1)*r,o=Math.floor(a),o!==s&&(l[o]=u,s=o);return l[l.length]=u,{chunks:l,total:u}},this.reparametrizeByArcLength=function(e){var t,r,i,n,a,o,s,h,c=[],l=new THREE.Vector3,u=this.getLength();for(c.push(l.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(o=u.chunks[t]-u.chunks[t-1],s=Math.ceil(e*o/u.total),n=(t-1)/(this.points.length-1),a=t/(this.points.length-1),r=1;s-1>r;r++)i=n+r*(1/s)*(a-n),h=this.getPoint(i),c.push(l.copy(h).clone());c.push(l.copy(this.points[t]).clone())}this.points=c}},THREE.Triangle=function(e,t,r){this.a=void 0!==e?e:new THREE.Vector3,this.b=void 0!==t?t:new THREE.Vector3,this.c=void 0!==r?r:new THREE.Vector3},THREE.Triangle.normal=function(){var e=new THREE.Vector3;return function(t,r,i,n){var a=n||new THREE.Vector3;a.subVectors(i,r),e.subVectors(t,r),a.cross(e);var o=a.lengthSq();return o>0?a.multiplyScalar(1/Math.sqrt(o)):a.set(0,0,0)}}(),THREE.Triangle.barycoordFromPoint=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(i,n,a,o,s){e.subVectors(o,n),t.subVectors(a,n),r.subVectors(i,n);var h=e.dot(e),c=e.dot(t),l=e.dot(r),u=t.dot(t),E=t.dot(r),p=h*u-c*c,d=s||new THREE.Vector3;if(0===p)return d.set(-2,-1,-1);var f=1/p,m=(u*l-c*E)*f,T=(h*E-c*l)*f;return d.set(1-m-T,T,m)}}(),THREE.Triangle.containsPoint=function(){var e=new THREE.Vector3;return function(t,r,i,n){var a=THREE.Triangle.barycoordFromPoint(t,r,i,n,e);return a.x>=0&&a.y>=0&&a.x+a.y<=1}}(),THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return THREE.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new THREE.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return THREE.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return THREE.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},THREE.Interpolant=function(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r},THREE.Interpolant.prototype={constructor:THREE.Interpolant,evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,i=t[r],n=t[r-1];e:{t:{var a;r:{i:if(!(i>e)){for(var o=r+2;;){if(void 0===i){if(n>e)break i;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,n)}if(r===o)break;if(n=i,i=t[++r],i>e)break t}a=t.length;break r}{if(e>=n)break e;var s=t[1];s>e&&(r=2,n=s);for(var o=r-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(r===o)break;if(i=n,n=t[--r-1],e>=n)break t}a=r,r=0}}for(;a>r;){var h=r+a>>>1;e<t[h]?a=h:r=h+1}if(i=t[r],n=t[r-1],void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,n,e)}this._cachedIndex=r,this.intervalChanged_(r,n,i)}return this.interpolate_(r,n,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i,a=0;a!==i;++a)t[a]=r[n+a];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}},Object.assign(THREE.Interpolant.prototype,{beforeStart_:THREE.Interpolant.prototype.copySampleValue_,afterEnd_:THREE.Interpolant.prototype.copySampleValue_}),THREE.CubicInterpolant=function(e,t,r,i){THREE.Interpolant.call(this,e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0},THREE.CubicInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.CubicInterpolant,DefaultSettings_:{endingStart:THREE.ZeroCurvatureEnding,endingEnd:THREE.ZeroCurvatureEnding},intervalChanged_:function(e,t,r){var i=this.parameterPositions,n=e-2,a=e+1,o=i[n],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case THREE.ZeroSlopeEnding:n=e,o=2*t-r;break;case THREE.WrapAroundEnding:n=i.length-2,o=t+i[n]-i[n+1];break;default:n=e,o=r}if(void 0===s)switch(this.getSettings_().endingEnd){case THREE.ZeroSlopeEnding:a=e,s=2*r-t;break;case THREE.WrapAroundEnding:a=1,s=r+i[1]-i[0];break;default:a=e-1,s=t}var h=.5*(r-t),c=this.valueSize;this._weightPrev=h/(t-o),this._weightNext=h/(s-r),this._offsetPrev=n*c,this._offsetNext=a*c},interpolate_:function(e,t,r,i){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,h=s-o,c=this._offsetPrev,l=this._offsetNext,u=this._weightPrev,E=this._weightNext,p=(r-t)/(i-t),d=p*p,f=d*p,m=-u*f+2*u*d-u*p,T=(1+u)*f+(-1.5-2*u)*d+(-.5+u)*p+1,v=(-1-E)*f+(1.5+E)*d+.5*p,g=E*f-E*d,y=0;y!==o;++y)n[y]=m*a[c+y]+T*a[h+y]+v*a[s+y]+g*a[l+y];return n}}),THREE.DiscreteInterpolant=function(e,t,r,i){THREE.Interpolant.call(this,e,t,r,i)},THREE.DiscreteInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.DiscreteInterpolant,interpolate_:function(e){return this.copySampleValue_(e-1)}}),THREE.LinearInterpolant=function(e,t,r,i){THREE.Interpolant.call(this,e,t,r,i)},THREE.LinearInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.LinearInterpolant,interpolate_:function(e,t,r,i){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,h=s-o,c=(r-t)/(i-t),l=1-c,u=0;u!==o;++u)n[u]=a[h+u]*l+a[s+u]*c;return n}}),THREE.QuaternionLinearInterpolant=function(e,t,r,i){THREE.Interpolant.call(this,e,t,r,i)},THREE.QuaternionLinearInterpolant.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:THREE.QuaternionLinearInterpolant,interpolate_:function(e,t,r,i){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,h=(r-t)/(i-t),c=s+o;s!==c;s+=4)THREE.Quaternion.slerpFlat(n,0,a,s-o,a,s,h);return n}}),THREE.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=performance.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=performance.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},THREE.EventDispatcher=function(){},THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(e){e.addEventListener=THREE.EventDispatcher.prototype.addEventListener,e.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener,e.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners,i=r[e];if(void 0!==i){var n=i.indexOf(t);-1!==n&&i.splice(n,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,r=t[e.type];if(void 0!==r){e.target=this;for(var i=[],n=r.length,a=0;n>a;a++)i[a]=r[a];for(var a=0;n>a;a++)i[a].call(this,e)}}}},THREE.Layers=function(){this.mask=1},THREE.Layers.prototype={constructor:THREE.Layers,set:function(e){this.mask=1<<e},enable:function(e){this.mask|=1<<e},toggle:function(e){this.mask^=1<<e},disable:function(e){this.mask&=~(1<<e)},test:function(e){return 0!==(this.mask&e.mask)}},function(e){function t(e,t){return e.distance-t.distance}function r(e,t,i,n){if(e.visible!==!1&&(e.raycast(t,i),n===!0))for(var a=e.children,o=0,s=a.length;s>o;o++)r(a[o],t,i,!0)}e.Raycaster=function(t,r,i,n){this.ray=new e.Ray(t,r),this.near=i||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})},e.Raycaster.prototype={constructor:e.Raycaster,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,r){r instanceof e.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(r.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(r).sub(this.ray.origin).normalize()):r instanceof e.OrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(r),this.ray.direction.set(0,0,-1).transformDirection(r.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,i){var n=[];return r(e,this,n,i),n.sort(t),n},intersectObjects:function(e,i){var n=[];if(Array.isArray(e)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var a=0,o=e.length;o>a;a++)r(e[a],this,n,i);return n.sort(t),n}}}(THREE),THREE.Object3D=function(){function e(){n.setFromEuler(i,!1)}function t(){i.setFromQuaternion(n,void 0,!1)}Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=THREE.Object3D.DefaultUp.clone();var r=new THREE.Vector3,i=new THREE.Euler,n=new THREE.Quaternion,a=new THREE.Vector3(1,1,1);i.onChange(e),n.onChange(t),Object.defineProperties(this,{position:{enumerable:!0,value:r},rotation:{enumerable:!0,value:i},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:a},modelViewMatrix:{value:new THREE.Matrix4},normalMatrix:{value:new THREE.Matrix3}}),this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixAutoUpdate=THREE.Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new THREE.Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0),THREE.Object3D.DefaultMatrixAutoUpdate=!0,THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new THREE.Quaternion;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new THREE.Vector3;return function(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new THREE.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new THREE.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e instanceof THREE.Object3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var r=this.children.indexOf(e);-1!==r&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(r,1))},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,i=this.children.length;i>r;r++){var n=this.children[r],a=n.getObjectByProperty(e,t);if(void 0!==a)return a}return void 0},getWorldPosition:function(e){var t=e||new THREE.Vector3;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r){var i=r||new THREE.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,i,t),i}}(),getWorldRotation:function(){var e=new THREE.Quaternion;return function(t){var r=t||new THREE.Euler;return this.getWorldQuaternion(e),r.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new THREE.Vector3,t=new THREE.Quaternion;return function(r){var i=r||new THREE.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,i),i}}(),getWorldDirection:function(){var e=new THREE.Quaternion;return function(t){var r=t||new THREE.Vector3;return this.getWorldQuaternion(e),r.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,i=t.length;i>r;r++)t[r].traverse(e)},traverseVisible:function(e){if(this.visible!==!1){e(this);for(var t=this.children,r=0,i=t.length;i>r;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||e===!0)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;r>t;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(e){function t(e){var t=[];for(var r in e){var i=e[r];delete i.metadata,t.push(i)}return t}var r=void 0===e,i={};r&&(e={geometries:{},materials:{},textures:{},images:{}},i.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var n={};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),n.matrix=this.matrix.toArray(),void 0!==this.geometry&&(void 0===e.geometries[this.geometry.uuid]&&(e.geometries[this.geometry.uuid]=this.geometry.toJSON(e)),n.geometry=this.geometry.uuid),void 0!==this.material&&(void 0===e.materials[this.material.uuid]&&(e.materials[this.material.uuid]=this.material.toJSON(e)),n.material=this.material.uuid),this.children.length>0){n.children=[];for(var a=0;a<this.children.length;a++)n.children.push(this.children[a].toJSON(e).object)}if(r){var o=t(e.geometries),s=t(e.materials),h=t(e.textures),c=t(e.images);o.length>0&&(i.geometries=o),s.length>0&&(i.materials=s),h.length>0&&(i.textures=h),c.length>0&&(i.images=c)}return i.object=n,i},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.rotationAutoUpdate=e.rotationAutoUpdate,this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(var r=0;r<e.children.length;r++){var i=e.children[r];this.add(i.clone())}return this}},THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype),THREE.Object3DIdCount=0,THREE.Face3=function(e,t,r,i,n,a){this.a=e,this.b=t,this.c=r,this.normal=i instanceof THREE.Vector3?i:new THREE.Vector3,this.vertexNormals=Array.isArray(i)?i:[],this.color=n instanceof THREE.Color?n:new THREE.Color,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==a?a:0},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;r>t;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,r=e.vertexColors.length;r>t;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}},THREE.BufferAttribute=function(e,t){this.uuid=THREE.Math.generateUUID(),this.array=e,this.itemSize=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get count(){return this.array.length/this.itemSize},set needsUpdate(e){e===!0&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var i=0,n=this.itemSize;n>i;i++)this.array[e+i]=t.array[r+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;n>i;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),a=new THREE.Color),t[r++]=a.r,t[r++]=a.g,t[r++]=a.b}return this},copyIndicesArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;n>i;i++){var a=e[i];t[r++]=a.a,t[r++]=a.b,t[r++]=a.c}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;n>i;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new THREE.Vector2),t[r++]=a.x,t[r++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;n>i;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new THREE.Vector3),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,i=0,n=e.length;n>i;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),a=new THREE.Vector4),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z,t[r++]=a.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this},setXYZW:function(e,t,r,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=n,this},clone:function(){return(new this.constructor).copy(this)}},THREE.Int8Attribute=function(e,t){return new THREE.BufferAttribute(new Int8Array(e),t)},THREE.Uint8Attribute=function(e,t){return new THREE.BufferAttribute(new Uint8Array(e),t)},THREE.Uint8ClampedAttribute=function(e,t){return new THREE.BufferAttribute(new Uint8ClampedArray(e),t)},THREE.Int16Attribute=function(e,t){return new THREE.BufferAttribute(new Int16Array(e),t)},THREE.Uint16Attribute=function(e,t){return new THREE.BufferAttribute(new Uint16Array(e),t)},THREE.Int32Attribute=function(e,t){return new THREE.BufferAttribute(new Int32Array(e),t)},THREE.Uint32Attribute=function(e,t){return new THREE.BufferAttribute(new Uint32Array(e),t)},THREE.Float32Attribute=function(e,t){return new THREE.BufferAttribute(new Float32Array(e),t)},THREE.Float64Attribute=function(e,t){return new THREE.BufferAttribute(new Float64Array(e),t)},THREE.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new THREE.BufferAttribute(e,t).setDynamic(!0)},THREE.InstancedBufferAttribute=function(e,t,r){THREE.BufferAttribute.call(this,e,t),this.meshPerAttribute=r||1},THREE.InstancedBufferAttribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.InstancedBufferAttribute.prototype.constructor=THREE.InstancedBufferAttribute,THREE.InstancedBufferAttribute.prototype.copy=function(e){return THREE.BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},THREE.InterleavedBuffer=function(e,t){this.uuid=THREE.Math.generateUUID(),this.array=e,this.stride=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},THREE.InterleavedBuffer.prototype={constructor:THREE.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(e){e===!0&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var i=0,n=this.stride;n>i;i++)this.array[e+i]=t.array[r+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)}},THREE.InstancedInterleavedBuffer=function(e,t,r){THREE.InterleavedBuffer.call(this,e,t),this.meshPerAttribute=r||1},THREE.InstancedInterleavedBuffer.prototype=Object.create(THREE.InterleavedBuffer.prototype),THREE.InstancedInterleavedBuffer.prototype.constructor=THREE.InstancedInterleavedBuffer,THREE.InstancedInterleavedBuffer.prototype.copy=function(e){return THREE.InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},THREE.InterleavedBufferAttribute=function(e,t,r){this.uuid=THREE.Math.generateUUID(),this.data=e,this.itemSize=t,this.offset=r},THREE.InterleavedBufferAttribute.prototype={constructor:THREE.InterleavedBufferAttribute,get length(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length},get count(){return this.data.count},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this},setXYZW:function(e,t,r,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=n,this}},THREE.Geometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){for(var t=(new THREE.Matrix3).getNormalMatrix(e),r=0,i=this.vertices.length;i>r;r++){var n=this.vertices[r];n.applyMatrix4(e)}for(var r=0,i=this.faces.length;i>r;r++){var a=this.faces[r];a.normal.applyMatrix3(t).normalize();for(var o=0,s=a.vertexNormals.length;s>o;o++)a.vertexNormals[o].applyMatrix3(t).normalize()}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0},rotateX:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e;
return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e;return function(t,r,i){return void 0===e&&(e=new THREE.Matrix4),e.makeTranslation(t,r,i),this.applyMatrix(e),this}}(),scale:function(){var e;return function(t,r,i){return void 0===e&&(e=new THREE.Matrix4),e.makeScale(t,r,i),this.applyMatrix(e),this}}(),lookAt:function(){var e;return function(t){void 0===e&&(e=new THREE.Object3D),e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){function t(e,t,i){var n=void 0!==o?[l[e].clone(),l[t].clone(),l[i].clone()]:[],a=void 0!==s?[r.colors[e].clone(),r.colors[t].clone(),r.colors[i].clone()]:[],p=new THREE.Face3(e,t,i,n,a);r.faces.push(p),void 0!==h&&r.faceVertexUvs[0].push([u[e].clone(),u[t].clone(),u[i].clone()]),void 0!==c&&r.faceVertexUvs[1].push([E[e].clone(),E[t].clone(),E[i].clone()])}var r=this,i=null!==e.index?e.index.array:void 0,n=e.attributes,a=n.position.array,o=void 0!==n.normal?n.normal.array:void 0,s=void 0!==n.color?n.color.array:void 0,h=void 0!==n.uv?n.uv.array:void 0,c=void 0!==n.uv2?n.uv2.array:void 0;void 0!==c&&(this.faceVertexUvs[1]=[]);for(var l=[],u=[],E=[],p=0,d=0;p<a.length;p+=3,d+=2)r.vertices.push(new THREE.Vector3(a[p],a[p+1],a[p+2])),void 0!==o&&l.push(new THREE.Vector3(o[p],o[p+1],o[p+2])),void 0!==s&&r.colors.push(new THREE.Color(s[p],s[p+1],s[p+2])),void 0!==h&&u.push(new THREE.Vector2(h[d],h[d+1])),void 0!==c&&E.push(new THREE.Vector2(c[d],c[d+1]));if(void 0!==i){var f=e.groups;if(f.length>0)for(var p=0;p<f.length;p++)for(var m=f[p],T=m.start,v=m.count,d=T,g=T+v;g>d;d+=3)t(i[d],i[d+1],i[d+2]);else for(var p=0;p<i.length;p+=3)t(i[p],i[p+1],i[p+2])}else for(var p=0;p<a.length/3;p+=3)t(p,p+1,p+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,i=new THREE.Matrix4;return i.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var e=new THREE.Vector3,t=new THREE.Vector3,r=0,i=this.faces.length;i>r;r++){var n=this.faces[r],a=this.vertices[n.a],o=this.vertices[n.b],s=this.vertices[n.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){void 0===e&&(e=!0);var t,r,i,n,a,o;for(o=new Array(this.vertices.length),t=0,r=this.vertices.length;r>t;t++)o[t]=new THREE.Vector3;if(e){var s,h,c,l=new THREE.Vector3,u=new THREE.Vector3;for(i=0,n=this.faces.length;n>i;i++)a=this.faces[i],s=this.vertices[a.a],h=this.vertices[a.b],c=this.vertices[a.c],l.subVectors(c,h),u.subVectors(s,h),l.cross(u),o[a.a].add(l),o[a.b].add(l),o[a.c].add(l)}else for(i=0,n=this.faces.length;n>i;i++)a=this.faces[i],o[a.a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(t=0,r=this.vertices.length;r>t;t++)o[t].normalize();for(i=0,n=this.faces.length;n>i;i++){a=this.faces[i];var E=a.vertexNormals;3===E.length?(E[0].copy(o[a.a]),E[1].copy(o[a.b]),E[2].copy(o[a.c])):(E[0]=o[a.a].clone(),E[1]=o[a.b].clone(),E[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,r,i,n;for(r=0,i=this.faces.length;i>r;r++)for(n=this.faces[r],n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;t>e;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var a=new THREE.Geometry;for(a.faces=this.faces,e=0,t=this.morphTargets.length;t>e;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o,s,h=this.morphNormals[e].faceNormals,c=this.morphNormals[e].vertexNormals;for(r=0,i=this.faces.length;i>r;r++)o=new THREE.Vector3,s={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3},h.push(o),c.push(s)}var l=this.morphNormals[e];a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals();var o,s;for(r=0,i=this.faces.length;i>r;r++)n=this.faces[r],o=l.faceNormals[r],s=l.vertexNormals[r],o.copy(n.normal),s.a.copy(n.vertexNormals[0]),s.b.copy(n.vertexNormals[1]),s.c.copy(n.vertexNormals[2])}for(r=0,i=this.faces.length;i>r;r++)n=this.faces[r],n.normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){for(var e=0,t=this.vertices,r=0,i=t.length;i>r;r++)r>0&&(e+=t[r].distanceTo(t[r-1])),this.lineDistances[r]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e instanceof THREE.Geometry==!1)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);var i,n=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,h=e.faces,c=this.faceVertexUvs[0],l=e.faceVertexUvs[0];void 0===r&&(r=0),void 0!==t&&(i=(new THREE.Matrix3).getNormalMatrix(t));for(var u=0,E=o.length;E>u;u++){var p=o[u],d=p.clone();void 0!==t&&d.applyMatrix4(t),a.push(d)}for(u=0,E=h.length;E>u;u++){var f,m,T,v=h[u],g=v.vertexNormals,y=v.vertexColors;f=new THREE.Face3(v.a+n,v.b+n,v.c+n),f.normal.copy(v.normal),void 0!==i&&f.normal.applyMatrix3(i).normalize();for(var R=0,H=g.length;H>R;R++)m=g[R].clone(),void 0!==i&&m.applyMatrix3(i).normalize(),f.vertexNormals.push(m);f.color.copy(v.color);for(var R=0,H=y.length;H>R;R++)T=y[R],f.vertexColors.push(T.clone());f.materialIndex=v.materialIndex+r,s.push(f)}for(u=0,E=l.length;E>u;u++){var x=l[u],b=[];if(void 0!==x){for(var R=0,H=x.length;H>R;R++)b.push(x[R].clone());c.push(b)}}},mergeMesh:function(e){return e instanceof THREE.Mesh==!1?void console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e):(e.matrixAutoUpdate&&e.updateMatrix(),void this.merge(e.geometry,e.matrix))},mergeVertices:function(){var e,t,r,i,n,a,o,s,h={},c=[],l=[],u=4,E=Math.pow(10,u);for(r=0,i=this.vertices.length;i>r;r++)e=this.vertices[r],t=Math.round(e.x*E)+"_"+Math.round(e.y*E)+"_"+Math.round(e.z*E),void 0===h[t]?(h[t]=r,c.push(this.vertices[r]),l[r]=c.length-1):l[r]=l[h[t]];var p=[];for(r=0,i=this.faces.length;i>r;r++){n=this.faces[r],n.a=l[n.a],n.b=l[n.b],n.c=l[n.c],a=[n.a,n.b,n.c];for(var d=-1,f=0;3>f;f++)if(a[f]===a[(f+1)%3]){d=f,p.push(r);break}}for(r=p.length-1;r>=0;r--){var m=p[r];for(this.faces.splice(m,1),o=0,s=this.faceVertexUvs.length;s>o;o++)this.faceVertexUvs[o].splice(m,1)}var T=this.vertices.length-c.length;return this.vertices=c,T},sortFacesByMaterialIndex:function(){function e(e,t){return e.materialIndex-t.materialIndex}for(var t=this.faces,r=t.length,i=0;r>i;i++)t[i]._id=i;t.sort(e);var n,a,o=this.faceVertexUvs[0],s=this.faceVertexUvs[1];o&&o.length===r&&(n=[]),s&&s.length===r&&(a=[]);for(var i=0;r>i;i++){var h=t[i]._id;n&&n.push(o[h]),a&&a.push(s[h])}n&&(this.faceVertexUvs[0]=n),a&&(this.faceVertexUvs[1]=a)},toJSON:function(){function e(e,t,r){return r?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==E[t]?E[t]:(E[t]=u.length/3,u.push(e.x,e.y,e.z),E[t])}function r(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==d[t]?d[t]:(d[t]=p.length,p.push(e.getHex()),d[t])}function i(e){var t=e.x.toString()+e.y.toString();return void 0!==m[t]?m[t]:(m[t]=f.length/2,f.push(e.x,e.y),m[t])}var n={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),void 0!==this.parameters){var a=this.parameters;for(var o in a)void 0!==a[o]&&(n[o]=a[o]);return n}for(var s=[],h=0;h<this.vertices.length;h++){var c=this.vertices[h];s.push(c.x,c.y,c.z)}for(var l=[],u=[],E={},p=[],d={},f=[],m={},h=0;h<this.faces.length;h++){var T=this.faces[h],v=!0,g=!1,y=void 0!==this.faceVertexUvs[0][h],R=T.normal.length()>0,H=T.vertexNormals.length>0,x=1!==T.color.r||1!==T.color.g||1!==T.color.b,b=T.vertexColors.length>0,M=0;if(M=e(M,0,0),M=e(M,1,v),M=e(M,2,g),M=e(M,3,y),M=e(M,4,R),M=e(M,5,H),M=e(M,6,x),M=e(M,7,b),l.push(M),l.push(T.a,T.b,T.c),l.push(T.materialIndex),y){var _=this.faceVertexUvs[0][h];l.push(i(_[0]),i(_[1]),i(_[2]))}if(R&&l.push(t(T.normal)),H){var w=T.vertexNormals;l.push(t(w[0]),t(w[1]),t(w[2]))}if(x&&l.push(r(T.color)),b){var S=T.vertexColors;l.push(r(S[0]),r(S[1]),r(S[2]))}}return n.data={},n.data.vertices=s,n.data.normals=u,p.length>0&&(n.data.colors=p),f.length>0&&(n.data.uvs=[f]),n.data.faces=l,n},clone:function(){return(new THREE.Geometry).copy(this)},copy:function(e){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]];for(var t=e.vertices,r=0,i=t.length;i>r;r++)this.vertices.push(t[r].clone());for(var n=e.faces,r=0,i=n.length;i>r;r++)this.faces.push(n[r].clone());for(var r=0,i=e.faceVertexUvs.length;i>r;r++){var a=e.faceVertexUvs[r];void 0===this.faceVertexUvs[r]&&(this.faceVertexUvs[r]=[]);for(var o=0,s=a.length;s>o;o++){for(var h=a[o],c=[],l=0,u=h.length;u>l;l++){var E=h[l];c.push(E.clone())}this.faceVertexUvs[r].push(c)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype),THREE.GeometryIdCount=0,THREE.DirectGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="DirectGeometry",this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1},THREE.DirectGeometry.prototype={constructor:THREE.DirectGeometry,computeBoundingBox:THREE.Geometry.prototype.computeBoundingBox,computeBoundingSphere:THREE.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(e){for(var t,r,i=[],n=e.faces,a=0;a<n.length;a++){var o=n[a];o.materialIndex!==r&&(r=o.materialIndex,void 0!==t&&(t.count=3*a-t.start,i.push(t)),t={start:3*a,materialIndex:r})}void 0!==t&&(t.count=3*a-t.start,i.push(t)),this.groups=i},fromGeometry:function(e){var t,r=e.faces,i=e.vertices,n=e.faceVertexUvs,a=n[0]&&n[0].length>0,o=n[1]&&n[1].length>0,s=e.morphTargets,h=s.length;if(h>0){t=[];for(var c=0;h>c;c++)t[c]=[];this.morphTargets.position=t}var l,u=e.morphNormals,E=u.length;if(E>0){l=[];for(var c=0;E>c;c++)l[c]=[];this.morphTargets.normal=l}for(var p=e.skinIndices,d=e.skinWeights,f=p.length===i.length,m=d.length===i.length,c=0;c<r.length;c++){var T=r[c];this.vertices.push(i[T.a],i[T.b],i[T.c]);var v=T.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{var g=T.normal;this.normals.push(g,g,g)}var y=T.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{var R=T.color;this.colors.push(R,R,R)}if(a===!0){var H=n[0][c];void 0!==H?this.uvs.push(H[0],H[1],H[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2))}if(o===!0){var H=n[1][c];void 0!==H?this.uvs2.push(H[0],H[1],H[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2))}for(var x=0;h>x;x++){var b=s[x].vertices;t[x].push(b[T.a],b[T.b],b[T.c])}for(var x=0;E>x;x++){var M=u[x].vertexNormals[c];l[x].push(M.a,M.b,M.c)}f&&this.skinIndices.push(p[T.a],p[T.b],p[T.c]),m&&this.skinWeights.push(d[T.a],d[T.b],d[T.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.DirectGeometry.prototype),THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,getIndex:function(){return this.index},setIndex:function(e){this.index=e},addAttribute:function(e,t){return t instanceof THREE.BufferAttribute==!1&&t instanceof THREE.InterleavedBufferAttribute==!1?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(e,new THREE.BufferAttribute(arguments[1],arguments[2]))):"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(t)):(this.attributes[e]=t,this)},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var r=this.attributes.normal;if(void 0!==r){var i=(new THREE.Matrix3).getNormalMatrix(e);i.applyToVector3Array(r.array),r.needsUpdate=!0}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere()},rotateX:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e;return function(t){return void 0===e&&(e=new THREE.Matrix4),e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e;return function(t,r,i){return void 0===e&&(e=new THREE.Matrix4),e.makeTranslation(t,r,i),this.applyMatrix(e),this}}(),scale:function(){var e;return function(t,r,i){return void 0===e&&(e=new THREE.Matrix4),e.makeScale(t,r,i),this.applyMatrix(e),this}}(),lookAt:function(){var e;return function(t){void 0===e&&(e=new THREE.Object3D),e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},setFromObject:function(e){var t=e.geometry;if(e instanceof THREE.Points||e instanceof THREE.Line){var r=new THREE.Float32Attribute(3*t.vertices.length,3),i=new THREE.Float32Attribute(3*t.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(t.vertices)),this.addAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var n=new THREE.Float32Attribute(t.lineDistances.length,1);this.addAttribute("lineDistance",n.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e instanceof THREE.Mesh&&t instanceof THREE.Geometry&&this.fromGeometry(t);return this},updateFromObject:function(e){var t=e.geometry;if(e instanceof THREE.Mesh){var r=t.__directGeometry;if(void 0===r)return this.fromGeometry(t);r.verticesNeedUpdate=t.verticesNeedUpdate,r.normalsNeedUpdate=t.normalsNeedUpdate,r.colorsNeedUpdate=t.colorsNeedUpdate,r.uvsNeedUpdate=t.uvsNeedUpdate,r.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=r}if(t.verticesNeedUpdate===!0){var i=this.attributes.position;void 0!==i&&(i.copyVector3sArray(t.vertices),i.needsUpdate=!0),t.verticesNeedUpdate=!1}if(t.normalsNeedUpdate===!0){var i=this.attributes.normal;void 0!==i&&(i.copyVector3sArray(t.normals),i.needsUpdate=!0),t.normalsNeedUpdate=!1}if(t.colorsNeedUpdate===!0){var i=this.attributes.color;void 0!==i&&(i.copyColorsArray(t.colors),i.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){var i=this.attributes.uv;void 0!==i&&(i.copyVector2sArray(t.uvs),i.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){var i=this.attributes.lineDistance;void 0!==i&&(i.copyArray(t.lineDistances),i.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new THREE.DirectGeometry).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new THREE.BufferAttribute(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(3*e.normals.length);this.addAttribute("normal",new THREE.BufferAttribute(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var i=new Float32Array(3*e.colors.length);this.addAttribute("color",new THREE.BufferAttribute(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var n=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new THREE.BufferAttribute(n,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var a=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new THREE.BufferAttribute(a,2).copyVector2sArray(e.uvs2))}if(e.indices.length>0){var o=e.vertices.length>65535?Uint32Array:Uint16Array,s=new o(3*e.indices.length);this.setIndex(new THREE.BufferAttribute(s,1).copyIndicesArray(e.indices))}this.groups=e.groups;for(var h in e.morphTargets){for(var c=[],l=e.morphTargets[h],u=0,E=l.length;E>u;u++){var p=l[u],d=new THREE.Float32Attribute(3*p.length,3);c.push(d.copyVector3sArray(p))}this.morphAttributes[h]=c}if(e.skinIndices.length>0){var f=new THREE.Float32Attribute(4*e.skinIndices.length,4);this.addAttribute("skinIndex",f.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var m=new THREE.Float32Attribute(4*e.skinWeights.length,4);this.addAttribute("skinWeight",m.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){new THREE.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.attributes.position.array;e&&this.boundingBox.setFromArray(e),(void 0===e||0===e.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}(),computeBoundingSphere:function(){var e=new THREE.Box3,t=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var r=this.attributes.position.array;if(r){var i=this.boundingSphere.center;e.setFromArray(r),e.center(i);for(var n=0,a=0,o=r.length;o>a;a+=3)t.fromArray(r,a),n=Math.max(n,i.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,r=this.groups;if(t.position){var i=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(i.length),3));else for(var n=t.normal.array,a=0,o=n.length;o>a;a++)n[a]=0;var s,h,c,l=t.normal.array,u=new THREE.Vector3,E=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3;if(e){var m=e.array;0===r.length&&this.addGroup(0,m.length);for(var T=0,v=r.length;v>T;++T)for(var g=r[T],y=g.start,R=g.count,a=y,o=y+R;o>a;a+=3)s=3*m[a+0],h=3*m[a+1],c=3*m[a+2],u.fromArray(i,s),E.fromArray(i,h),p.fromArray(i,c),d.subVectors(p,E),f.subVectors(u,E),d.cross(f),l[s]+=d.x,l[s+1]+=d.y,l[s+2]+=d.z,l[h]+=d.x,l[h+1]+=d.y,l[h+2]+=d.z,l[c]+=d.x,l[c+1]+=d.y,l[c+2]+=d.z}else for(var a=0,o=i.length;o>a;a+=9)u.fromArray(i,a),E.fromArray(i,a+3),p.fromArray(i,a+6),d.subVectors(p,E),f.subVectors(u,E),d.cross(f),l[a]=d.x,l[a+1]=d.y,l[a+2]=d.z,l[a+3]=d.x,l[a+4]=d.y,l[a+5]=d.z,l[a+6]=d.x,l[a+7]=d.y,l[a+8]=d.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e instanceof THREE.BufferGeometry==!1)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0);var r=this.attributes;for(var i in r)if(void 0!==e.attributes[i])for(var n=r[i],a=n.array,o=e.attributes[i],s=o.array,h=o.itemSize,c=0,l=h*t;c<s.length;c++,l++)a[l]=s[c];return this},normalizeNormals:function(){for(var e,t,r,i,n=this.attributes.normal.array,a=0,o=n.length;o>a;a+=3)e=n[a],t=n[a+1],r=n[a+2],i=1/Math.sqrt(e*e+t*t+r*r),n[a]*=i,n[a+1]*=i,n[a+2]*=i},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new THREE.BufferGeometry,t=this.index.array,r=this.attributes;for(var i in r){for(var n=r[i],a=n.array,o=n.itemSize,s=new a.constructor(t.length*o),h=0,c=0,l=0,u=t.length;u>l;l++){h=t[l]*o;for(var E=0;o>E;E++)s[c++]=a[h++]}e.addAttribute(i,new THREE.BufferAttribute(s,o))}return e},toJSON:function(){var e={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var i=this.index;if(null!==i){var n=Array.prototype.slice.call(i.array);e.data.index={type:i.array.constructor.name,array:n}}var a=this.attributes;for(var r in a){var o=a[r],n=Array.prototype.slice.call(o.array);e.data.attributes[r]={itemSize:o.itemSize,type:o.array.constructor.name,array:n}}var s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));var h=this.boundingSphere;return null!==h&&(e.data.boundingSphere={center:h.center.toArray(),radius:h.radius}),e},clone:function(){return(new THREE.BufferGeometry).copy(this)},copy:function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var r=e.attributes;for(var i in r){var n=r[i];this.addAttribute(i,n.clone())}for(var a=e.groups,o=0,s=a.length;s>o;o++){var h=a[o];this.addGroup(h.start,h.count)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype),THREE.BufferGeometry.MaxIndex=65535,THREE.InstancedBufferGeometry=function(){THREE.BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0},THREE.InstancedBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.InstancedBufferGeometry.prototype.constructor=THREE.InstancedBufferGeometry,THREE.InstancedBufferGeometry.prototype.addGroup=function(e,t,r){this.groups.push({start:e,count:t,instances:r})},THREE.InstancedBufferGeometry.prototype.copy=function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var r=e.attributes;for(var i in r){var n=r[i];this.addAttribute(i,n.clone())}for(var a=e.groups,o=0,s=a.length;s>o;o++){var h=a[o];this.addGroup(h.start,h.count,h.instances)}return this},THREE.EventDispatcher.prototype.apply(THREE.InstancedBufferGeometry.prototype),THREE.Uniform=function(e,t){this.type=e,this.value=t,this.dynamic=!1},THREE.Uniform.prototype={constructor:THREE.Uniform,onUpdate:function(e){return this.dynamic=!0,this.onUpdateCallback=e,this}},THREE.AnimationClip=function(e,t,r){this.name=e||THREE.Math.generateUUID(),this.tracks=r,this.duration=void 0!==t?t:-1,this.duration<0&&this.resetDuration(),this.trim(),this.optimize()},THREE.AnimationClip.prototype={constructor:THREE.AnimationClip,resetDuration:function(){for(var e=this.tracks,t=0,r=0,i=e.length;r!==i;++r){var n=this.tracks[r];t=Math.max(t,n.times[n.times.length-1])}this.duration=t},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},Object.assign(THREE.AnimationClip,{parse:function(e){for(var t=[],r=e.tracks,i=1/(e.fps||1),n=0,a=r.length;n!==a;++n)t.push(THREE.KeyframeTrack.parse(r[n]).scale(i));return new THREE.AnimationClip(e.name,e.duration,t)},toJSON:function(e){for(var t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t},n=0,a=r.length;n!==a;++n)t.push(THREE.KeyframeTrack.toJSON(r[n]));return i},CreateFromMorphTargetSequence:function(e,t,r){for(var i=t.length,n=[],a=0;i>a;a++){var o=[],s=[];o.push((a+i-1)%i,a,(a+1)%i),s.push(0,1,0);var h=THREE.AnimationUtils.getKeyframeOrder(o);o=THREE.AnimationUtils.sortedArray(o,1,h),s=THREE.AnimationUtils.sortedArray(s,1,h),0===o[0]&&(o.push(i),s.push(s[0])),n.push(new THREE.NumberKeyframeTrack(".morphTargetInfluences["+t[a].name+"]",o,s).scale(1/r))}return new THREE.AnimationClip(e,-1,n)},findByName:function(e,t){for(var r=0;r<e.length;r++)if(e[r].name===t)return e[r];return null},CreateClipsFromMorphTargetSequences:function(e,t){for(var r={},i=/^([\w-]*?)([\d]+)$/,n=0,a=e.length;a>n;n++){var o=e[n],s=o.name.match(i);if(s&&s.length>1){var h=s[1],c=r[h];c||(r[h]=c=[]),c.push(o)}}var l=[];for(var h in r)l.push(THREE.AnimationClip.CreateFromMorphTargetSequence(h,r[h],t));return l},parseAnimation:function(e,t){if(!e)return console.error("  no animation in JSONLoader data"),null;for(var r=function(e,t,r,i,n){if(0!==r.length){var a=[],o=[];THREE.AnimationUtils.flattenJSON(r,a,o,i),0!==a.length&&n.push(new e(t,a,o))}},i=[],n=e.name||"default",a=e.length||-1,o=e.fps||30,s=e.hierarchy||[],h=0;h<s.length;h++){var c=s[h].keys;if(c&&0!=c.length)if(c[0].morphTargets){for(var l={},u=0;u<c.length;u++)if(c[u].morphTargets)for(var E=0;E<c[u].morphTargets.length;E++)l[c[u].morphTargets[E]]=-1;for(var p in l){for(var d=[],f=[],E=0;E!==c[u].morphTargets.length;++E){var m=c[u];d.push(m.time),f.push(m.morphTarget===p?1:0)}i.push(new THREE.NumberKeyframeTrack(".morphTargetInfluence["+p+"]",d,f))}a=l.length*(o||1)}else{var T=".bones["+t[h].name+"]";r(THREE.VectorKeyframeTrack,T+".position",c,"pos",i),r(THREE.QuaternionKeyframeTrack,T+".quaternion",c,"rot",i),r(THREE.VectorKeyframeTrack,T+".scale",c,"scl",i)}}if(0===i.length)return null;var v=new THREE.AnimationClip(n,a,i);return v}}),THREE.AnimationMixer=function(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1},THREE.AnimationMixer.prototype={constructor:THREE.AnimationMixer,clipAction:function(e,t){var r,i=t||this._root,n=i.uuid,a="string"==typeof e?e:e.name,o=e!==a?e:null,s=this._actionsByClip[a];if(void 0!==s){var h=s.actionByRoot[n];if(void 0!==h)return h;if(r=s.knownActions[0],o=r._clip,e!==a&&e!==o)throw new Error("Different clips with the same name detected!")}if(null===o)return null;var c=new THREE.AnimationMixer._Action(this,o,t);return this._bindAction(c,r),this._addInactiveAction(c,a,n),c},existingAction:function(e,t){var r=t||this._root,i=r.uuid,n="string"==typeof e?e:e.name,a=this._actionsByClip[n];return void 0!==a?a.actionByRoot[i]||null:null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,r=this._bindings,i=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var n=0;n!==t;++n)e[n].reset();for(var n=0;n!==i;++n)r[n].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,i=this.time+=e,n=Math.sign(e),a=this._accuIndex^=1,o=0;o!==r;++o){var s=t[o];s.enabled&&s._update(i,e,n,a)}for(var h=this._bindings,c=this._nActiveBindings,o=0;o!==c;++o)h[o].apply(a);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,r=e.name,i=this._actionsByClip,n=i[r];if(void 0!==n){for(var a=n.knownActions,o=0,s=a.length;o!==s;++o){var h=a[o];this._deactivateAction(h);var c=h._cacheIndex,l=t[t.length-1];h._cacheIndex=null,h._byClipCacheIndex=null,l._cacheIndex=c,t[c]=l,t.pop(),this._removeInactiveBindingsForAction(h)}delete i[r]}},uncacheRoot:function(e){var t=e.uuid,r=this._actionsByClip;for(var i in r){var n=r[i].actionByRoot,a=n[t];void 0!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}var o=this._bindingsByRootAndName,s=o[t];if(void 0!==s)for(var h in s){var c=s[h];c.restoreOriginalState(),this._removeInactiveBinding(c)}},uncacheAction:function(e,t){var r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}},THREE.EventDispatcher.prototype.apply(THREE.AnimationMixer.prototype),THREE.AnimationMixer._Action=function(e,t,r){this._mixer=e,this._clip=t,this._localRoot=r||null;for(var i=t.tracks,n=i.length,a=new Array(n),o={endingStart:THREE.ZeroCurvatureEnding,endingEnd:THREE.ZeroCurvatureEnding},s=0;s!==n;++s){var h=i[s].createInterpolant(null);a[s]=h,h.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=THREE.LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0},THREE.AnimationMixer._Action.prototype={constructor:THREE.AnimationMixer._Action,play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){this._startTime;return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){this._mixer;if(e.fadeOut(t),this.fadeIn(t),r){var i=this._clip.duration,n=e._clip.duration,a=n/i,o=i/n;e.warp(1,a,t),this.warp(o,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()
},halt:function(e){return this.warp(this._currentTimeScale,0,e)},warp:function(e,t,r){var i=this._mixer,n=i.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,h=a.sampleValues;return s[0]=n,s[1]=n+r,h[0]=e/o,h[1]=t/o,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,r,i){var n=this._startTime;if(null!==n){var a=(e-n)*r;if(0>a||0===r)return;this._startTime=null,t=r*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var h=this._interpolants,c=this._propertyBindings,l=0,u=h.length;l!==u;++l)h[l].evaluate(o),c[l].accumulate(i,s)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(null!==r){var i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r){var i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.pause=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e;if(0===e)return t;var r=this._clip.duration,i=this.loop,n=this._loopCount,a=!1;switch(i){case THREE.LoopOnce:if(-1===n&&(this.loopCount=0,this._setEndings(!0,!0,!1)),t>=r)t=r;else{if(!(0>t))break;t=0}this.clampWhenFinished?this.pause=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:0>e?-1:1});break;case THREE.LoopPingPong:a=!0;case THREE.LoopRepeat:if(-1===n&&(e>0?(n=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),t>=r||0>t){var o=Math.floor(t/r);t-=r*o,n+=Math.abs(o);var s=this.repetitions-n;if(0>s){this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});break}if(0===s){var h=0>e;this._setEndings(h,!h,a)}else this._setEndings(!1,!1,a);this._loopCount=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}if(i===THREE.LoopPingPong&&1===(1&n))return this.time=t,r-t}return this.time=t,t},_setEndings:function(e,t,r){var i=this._interpolantSettings;r?(i.endingStart=THREE.ZeroSlopeEnding,i.endingEnd=THREE.ZeroSlopeEnding):(i.endingStart=e?this.zeroSlopeAtStart?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:THREE.WrapAroundEnding,i.endingEnd=t?this.zeroSlopeAtEnd?THREE.ZeroSlopeEnding:THREE.ZeroCurvatureEnding:THREE.WrapAroundEnding)},_scheduleFading:function(e,t,r){var i=this._mixer,n=i.time,a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=n,s[0]=t,o[1]=n+e,s[1]=r,this}},Object.assign(THREE.AnimationMixer.prototype,{_bindAction:function(e,t){var r=e._localRoot||this._root,i=e._clip.tracks,n=i.length,a=e._propertyBindings,o=e._interpolants,s=r.uuid,h=this._bindingsByRootAndName,c=h[s];void 0===c&&(c={},h[s]=c);for(var l=0;l!==n;++l){var u=i[l],E=u.name,p=c[E];if(void 0!==p)a[l]=p;else{if(p=a[l],void 0!==p){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,E));continue}var d=t&&t._propertyBindings[l].binding.parsedPath;p=new THREE.PropertyMixer(THREE.PropertyBinding.create(r,E,d),u.ValueTypeName,u.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,s,E),a[l]=p}o[l].resultBuffer=p.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,r=e._clip.name,i=this._actionsByClip[r];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,r,t)}for(var n=e._propertyBindings,a=0,o=n.length;a!==o;++a){var s=n[a];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,r=0,i=t.length;r!==i;++r){var n=t[r];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var i=this._actions,n=this._actionsByClip,a=n[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],i=e._cacheIndex;r._cacheIndex=i,t[i]=r,t.pop(),e._cacheIndex=null;var n=e._clip.name,a=this._actionsByClip,o=a[n],s=o.knownActions,h=s[s.length-1],c=e._byClipCacheIndex;h._byClipCacheIndex=c,s[c]=h,s.pop(),e._byClipCacheIndex=null;var l=o.actionByRoot,u=(t._localRoot||this._root).uuid;delete l[u],0===s.length&&delete a[n],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,r=0,i=t.length;r!==i;++r){var n=t[r];0===--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n},_addInactiveBinding:function(e,t,r){var i=this._bindingsByRootAndName,n=i[t],a=this._bindings;void 0===n&&(n={},i[t]=n),n[r]=e,e._cacheIndex=a.length,a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,i=r.rootNode.uuid,n=r.path,a=this._bindingsByRootAndName,o=a[i],s=t[t.length-1],h=e._cacheIndex;s._cacheIndex=h,t[h]=s,t.pop(),delete o[n];e:{for(var c in o)break e;delete a[i]}},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&(r=new THREE.LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),r.__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,n=t[i];e.__cacheIndex=i,t[i]=e,n.__cacheIndex=r,t[r]=n},_controlInterpolantsResultBuffer:new Float32Array(1)}),THREE.AnimationObjectGroup=function(){this.uuid=THREE.Math.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}},THREE.AnimationObjectGroup.prototype={constructor:THREE.AnimationObjectGroup,add:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,i=this._indicesByUUID,n=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,h=0,c=arguments.length;h!==c;++h){var l=arguments[h],u=l.uuid,E=i[u];if(void 0===E){E=t++,i[u]=E,e.push(l);for(var p=0,d=s;p!==d;++p)o[p].push(new THREE.PropertyBinding(l,n[p],a[p]))}else if(r>E){var f=e[E],m=--r,T=e[m];i[T.uuid]=E,e[E]=T,i[u]=m,e[m]=l;for(var p=0,d=s;p!==d;++p){var v=o[p],g=v[m],y=v[E];v[E]=g,void 0===y&&(y=new THREE.PropertyBinding(l,n[p],a[p])),v[m]=y}}else e[E]!==f&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=r},remove:function(){for(var e=this._objects,t=(e.length,this.nCachedObjects_),r=this._indicesByUUID,i=this._bindings,n=i.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],h=s.uuid,c=r[h];if(void 0!==c&&c>=t){var l=t++,u=e[l];r[u.uuid]=c,e[c]=u,r[h]=l,e[l]=s;for(var E=0,p=n;E!==p;++E){var d=i[E],f=d[l],m=d[c];d[c]=f,d[l]=m}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,i=this._indicesByUUID,n=this._bindings,a=n.length,o=0,s=arguments.length;o!==s;++o){var h=arguments[o],c=h.uuid,l=i[c];if(void 0!==l)if(delete i[c],r>l){var u=--r,E=e[u],p=--t,d=e[p];i[E.uuid]=l,e[l]=E,i[d.uuid]=u,e[u]=d,e.pop();for(var f=0,m=a;f!==m;++f){var T=n[f],v=T[u],g=T[p];T[l]=v,T[u]=g,T.pop()}}else{var p=--t,d=e[p];i[d.uuid]=l,e[l]=d,e.pop();for(var f=0,m=a;f!==m;++f){var T=n[f];T[l]=T[p],T.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){var r=this._bindingsIndicesByPath,i=r[e],n=this._bindings;if(void 0!==i)return n[i];var a=this._paths,o=this._parsedPaths,s=this._objects,h=s.length,c=this.nCachedObjects_,l=new Array(h);i=n.length,r[e]=i,a.push(e),o.push(t),n.push(l);for(var u=c,E=s.length;u!==E;++u){var p=s[u];l[u]=new THREE.PropertyBinding(p,e,t)}return l},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){var i=this._paths,n=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o],h=e[o];t[h]=r,a[r]=s,a.pop(),n[r]=n[o],n.pop(),i[r]=i[o],i.pop()}}},THREE.AnimationUtils={arraySlice:function(e,t,r){return THREE.AnimationUtils.isTypedArray(e)?new e.constructor(e.subarray(t,r)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){function t(t,r){return e[t]-e[r]}for(var r=e.length,i=new Array(r),n=0;n!==r;++n)i[n]=n;return i.sort(t),i},sortedArray:function(e,t,r){for(var i=e.length,n=new e.constructor(i),a=0,o=0;o!==i;++a)for(var s=r[a]*t,h=0;h!==t;++h)n[o++]=e[s+h];return n},flattenJSON:function(e,t,r,i){for(var n=1,a=e[0];void 0!==a&&void 0===a[i];)a=e[n++];if(void 0!==a){var o=a[i];if(void 0!==o)if(Array.isArray(o)){do o=a[i],void 0!==o&&(t.push(a.time),r.push.apply(r,o)),a=e[n++];while(void 0!==a)}else if(void 0!==o.toArray){do o=a[i],void 0!==o&&(t.push(a.time),o.toArray(r,r.length)),a=e[n++];while(void 0!==a)}else do o=a[i],void 0!==o&&(t.push(a.time),r.push(o)),a=e[n++];while(void 0!==a)}}},THREE.KeyframeTrack=function(e,t,r,i){if(void 0===e)throw new Error("track name is undefined");if(void 0===t||0===t.length)throw new Error("no keyframes in track named "+e);this.name=e,this.times=THREE.AnimationUtils.convertArray(t,this.TimeBufferType),this.values=THREE.AnimationUtils.convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation),this.validate(),this.optimize()},THREE.KeyframeTrack.prototype={constructor:THREE.KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:THREE.InterpolateLinear,InterpolantFactoryMethodDiscrete:function(e){return new THREE.DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new THREE.LinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new THREE.CubicInterpolant(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t=void 0;switch(e){case THREE.InterpolateDiscrete:t=this.InterpolantFactoryMethodDiscrete;break;case THREE.InterpolateLinear:t=this.InterpolantFactoryMethodLinear;break;case THREE.InterpolateSmooth:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return void console.warn(r)}this.createInterpolant=t},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return THREE.InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return THREE.InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return THREE.InterpolateSmooth}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]*=e;return this},trim:function(e,t){for(var r=this.times,i=r.length,n=0,a=i-1;n!==i&&r[n]<e;)++n;for(;-1!==a&&r[a]>t;)--a;if(++a,0!==n||a!==i){n>=a&&(a=Math.max(a,1),n=a-1);var o=this.getValueSize();this.times=THREE.AnimationUtils.arraySlice(r,n,a),this.values=THREE.AnimationUtils.arraySlice(this.values,n*o,a*o)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("invalid value size in track",this),e=!1);var r=this.times,i=this.values,n=r.length;0===n&&(console.error("track is empty",this),e=!1);for(var a=null,o=0;o!==n;o++){var s=r[o];if("number"==typeof s&&isNaN(s)){console.error("time is not a valid number",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("out of order keys",this,o,s,a),e=!1;break}a=s}if(void 0!==i&&THREE.AnimationUtils.isTypedArray(i))for(var o=0,h=i.length;o!==h;++o){var c=i[o];if(isNaN(c)){console.error("value is not a valid number",this,o,c),e=!1;break}}return e},optimize:function(){for(var e=this.times,t=this.values,r=this.getValueSize(),i=1,n=1,a=e.length-1;a>=n;++n){var o=!1,s=e[n],h=e[n+1];if(s!==h&&(1!==n||s!==s[0]))for(var c=n*r,l=c-r,u=c+r,E=0;E!==r;++E){var p=t[c+E];if(p!==t[l+E]||p!==t[u+E]){o=!0;break}}if(o){if(n!==i){e[i]=e[n];for(var d=n*r,f=i*r,E=0;E!==r;++E)t[f+E]=t[d+E]}++i}}return i!==e.length&&(this.times=THREE.AnimationUtils.arraySlice(e,0,i),this.values=THREE.AnimationUtils.arraySlice(t,0,i*r)),this}},Object.assign(THREE.KeyframeTrack,{parse:function(e){if(void 0===e.type)throw new Error("track type undefined, can not parse");var t=THREE.KeyframeTrack._getTrackTypeForValueTypeName(e.type);if(void 0===e.times){console.warn("legacy JSON format detected, converting");var r=[],i=[];THREE.AnimationUtils.flattenJSON(e.keys,r,i,"value"),e.times=r,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)},toJSON:function(e){var t,r=e.constructor;if(void 0!==r.toJSON)t=r.toJSON(e);else{t={name:e.name,times:THREE.AnimationUtils.convertArray(e.times,Array),values:THREE.AnimationUtils.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t},_getTrackTypeForValueTypeName:function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return THREE.NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return THREE.VectorKeyframeTrack;case"color":return THREE.ColorKeyframeTrack;case"quaternion":return THREE.QuaternionKeyframeTrack;case"bool":case"boolean":return THREE.BooleanKeyframeTrack;case"string":return THREE.StringKeyframeTrack}throw new Error("Unsupported typeName: "+e)}}),THREE.PropertyBinding=function(e,t,r){this.path=t,this.parsedPath=r||THREE.PropertyBinding.parseTrackName(t),this.node=THREE.PropertyBinding.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e},THREE.PropertyBinding.prototype={constructor:THREE.PropertyBinding,getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,i=t.propertyName,n=t.propertyIndex;if(e||(e=THREE.PropertyBinding.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("  trying to update node for track: "+this.path+" but it wasn't found.");if(r){var a=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("  can not bind to material as node does not have a material",this);if(!e.material.materials)return void console.error("  can not bind to material.materials as node.material does not have a materials array",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("  can not bind to bones as node does not have a skeleton",this);e=e.skeleton.bones;for(var o=0;o<e.length;o++)if(e[o].name===a){a=o;break}break;default:if(void 0===e[r])return void console.error("  can not bind to objectName of node, undefined",this);e=e[r]}if(void 0!==a){if(void 0===e[a])return void console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,e);e=e[a]}}var s=e[i];if(!s){var h=t.nodeName;return void console.error("  trying to update property for track: "+h+"."+i+" but it wasn't found.",e)}var c=this.Versioning.None;void 0!==e.needsUpdate?(c=this.Versioning.NeedsUpdate,this.targetObject=e):void 0!==e.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=e);var l=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);if(!e.geometry.morphTargets)return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);for(var o=0;o<this.node.geometry.morphTargets.length;o++)if(e.geometry.morphTargets[o].name===n){n=o;break}}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else void 0!==s.fromArray&&void 0!==s.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=s):void 0!==s.length?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][c]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}},Object.assign(THREE.PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:THREE.PropertyBinding.prototype.getValue,_setValue_unbound:THREE.PropertyBinding.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)e[t++]=r[i]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.node[this.propertyName]=e[t]},function(e,t){this.node[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.node[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++]},function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]]}),THREE.PropertyBinding.Composite=function(e,t,r){var i=r||THREE.PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)},THREE.PropertyBinding.Composite.prototype={constructor:THREE.PropertyBinding.Composite,getValue:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,i=this._bindings[r];void 0!==i&&i.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,i=this._targetGroup.nCachedObjects_,n=r.length;i!==n;++i)r[i].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}},THREE.PropertyBinding.create=function(e,t,r){return e instanceof THREE.AnimationObjectGroup?new THREE.PropertyBinding.Composite(e,t,r):new THREE.PropertyBinding(e,t,r)},THREE.PropertyBinding.parseTrackName=function(e){var t=/^(([\w]+\/)*)([\w-\d]+)?(\.([\w]+)(\[([\w\d\[\]\_. ]+)\])?)?(\.([\w.]+)(\[([\w\d\[\]\_. ]+)\])?)$/,r=t.exec(e);if(!r)throw new Error("cannot parse trackName at all: "+e);r.index===t.lastIndex&&t.lastIndex++;var i={nodeName:r[3],objectName:r[5],objectIndex:r[7],propertyName:r[9],propertyIndex:r[11]};if(null===i.propertyName||0===i.propertyName.length)throw new Error("can not parse propertyName from trackName: "+e);return i},THREE.PropertyBinding.findNode=function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=function(e){for(var r=0;r<e.bones.length;r++){var i=e.bones[r];if(i.name===t)return i}return null},i=r(e.skeleton);if(i)return i}if(e.children){var n=function(e){for(var r=0;r<e.length;r++){var i=e[r];if(i.name===t||i.uuid===t)return i;var a=n(i.children);if(a)return a}return null},a=n(e.children);if(a)return a}return null},THREE.PropertyMixer=function(e,t,r){this.binding=e,this.valueSize=r;var i,n=Float64Array;switch(t){case"quaternion":i=this._slerp;break;case"string":case"bool":n=Array,i=this._select;break;default:i=this._lerp}this.buffer=new n(4*r),this._mixBufferRegion=i,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0},THREE.PropertyMixer.prototype={constructor:THREE.PropertyMixer,accumulate:function(e,t){var r=this.buffer,i=this.valueSize,n=e*i+i,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==i;++o)r[n+o]=r[o];a=t}else{a+=t;var s=t/a;this._mixBufferRegion(r,n,0,s,i)}this.cumulativeWeight=a},apply:function(e){var t=this.valueSize,r=this.buffer,i=e*t+t,n=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,1>n){var o=3*t;this._mixBufferRegion(r,i,o,1-n,t)}for(var s=t,h=t+t;s!==h;++s)if(r[s]!==r[s+t]){a.setValue(r,i);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,i=3*r;e.getValue(t,i);for(var n=r,a=i;n!==a;++n)t[n]=t[i+n%r];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,r,i,n){if(i>=.5)for(var a=0;a!==n;++a)e[t+a]=e[r+a]},_slerp:function(e,t,r,i){THREE.Quaternion.slerpFlat(e,t,e,t,e,r,i)},_lerp:function(e,t,r,i,n){for(var a=1-i,o=0;o!==n;++o){var s=t+o;e[s]=e[s]*a+e[r+o]*i}}},THREE.BooleanKeyframeTrack=function(e,t,r){THREE.KeyframeTrack.call(this,e,t,r)},THREE.BooleanKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:THREE.IntepolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),THREE.NumberKeyframeTrack=function(e,t,r,i){THREE.KeyframeTrack.call(this,e,t,r,i)},THREE.NumberKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.NumberKeyframeTrack,ValueTypeName:"number"}),THREE.QuaternionKeyframeTrack=function(e,t,r,i){THREE.KeyframeTrack.call(this,e,t,r,i)},THREE.QuaternionKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:THREE.InterpolateLinear,InterpolantFactoryMethodLinear:function(e){return new THREE.QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),THREE.StringKeyframeTrack=function(e,t,r,i){THREE.KeyframeTrack.call(this,e,t,r,i)},THREE.StringKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:THREE.IntepolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),THREE.VectorKeyframeTrack=function(e,t,r,i){THREE.KeyframeTrack.call(this,e,t,r,i)},THREE.VectorKeyframeTrack.prototype=Object.assign(Object.create(THREE.KeyframeTrack.prototype),{constructor:THREE.VectorKeyframeTrack,ValueTypeName:"vector"}),THREE.Audio=function(e){THREE.Object3D.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filter=null},THREE.Audio.prototype=Object.create(THREE.Object3D.prototype),THREE.Audio.prototype.constructor=THREE.Audio,THREE.Audio.prototype.getOutput=function(){return this.gain},THREE.Audio.prototype.load=function(e){var t=new THREE.AudioBuffer(this.context);return t.load(e),this.setBuffer(t),this},THREE.Audio.prototype.setNodeSource=function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},THREE.Audio.prototype.setBuffer=function(e){var t=this;return e.onReady(function(e){t.source.buffer=e,t.sourceType="buffer",t.autoplay&&t.play()}),this},THREE.Audio.prototype.play=function(){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");var e=this.context.createBufferSource();e.buffer=this.source.buffer,e.loop=this.source.loop,e.onended=this.source.onended,e.start(0,this.startTime),e.playbackRate.value=this.playbackRate,this.isPlaying=!0,this.source=e,this.connect()},THREE.Audio.prototype.pause=function(){return this.hasPlaybackControl===!1?void console.warn("THREE.Audio: this Audio has no playback control."):(this.source.stop(),void(this.startTime=this.context.currentTime))},THREE.Audio.prototype.stop=function(){return this.hasPlaybackControl===!1?void console.warn("THREE.Audio: this Audio has no playback control."):(this.source.stop(),void(this.startTime=0))},THREE.Audio.prototype.connect=function(){null!==this.filter?(this.source.connect(this.filter),this.filter.connect(this.getOutput())):this.source.connect(this.getOutput())},THREE.Audio.prototype.disconnect=function(){null!==this.filter?(this.source.disconnect(this.filter),this.filter.disconnect(this.getOutput())):this.source.disconnect(this.getOutput())},THREE.Audio.prototype.getFilter=function(){return this.filter},THREE.Audio.prototype.setFilter=function(e){void 0===e&&(e=null),this.isPlaying===!0?(this.disconnect(),this.filter=e,this.connect()):this.filter=e},THREE.Audio.prototype.setPlaybackRate=function(e){return this.hasPlaybackControl===!1?void console.warn("THREE.Audio: this Audio has no playback control."):(this.playbackRate=e,void(this.isPlaying===!0&&(this.source.playbackRate.value=this.playbackRate)))},THREE.Audio.prototype.getPlaybackRate=function(){return this.playbackRate},THREE.Audio.prototype.onEnded=function(){this.isPlaying=!1},THREE.Audio.prototype.setLoop=function(e){return this.hasPlaybackControl===!1?void console.warn("THREE.Audio: this Audio has no playback control."):void(this.source.loop=e)},THREE.Audio.prototype.getLoop=function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.source.loop},THREE.Audio.prototype.setVolume=function(e){this.gain.gain.value=e},THREE.Audio.prototype.getVolume=function(){return this.gain.gain.value},THREE.AudioAnalyser=function(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)},THREE.AudioAnalyser.prototype={constructor:THREE.AudioAnalyser,getData:function(){return this.analyser.getByteFrequencyData(this.data),this.data}},THREE.AudioBuffer=function(e){this.context=e,this.ready=!1,this.readyCallbacks=[]},THREE.AudioBuffer.prototype.load=function(e){var t=this,r=new XMLHttpRequest;return r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){t.context.decodeAudioData(this.response,function(e){t.buffer=e,t.ready=!0;for(var r=0;r<t.readyCallbacks.length;r++)t.readyCallbacks[r](t.buffer);t.readyCallbacks=[]})},r.send(),this},THREE.AudioBuffer.prototype.onReady=function(e){this.ready?e(this.buffer):this.readyCallbacks.push(e)},THREE.PositionalAudio=function(e){THREE.Audio.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)},THREE.PositionalAudio.prototype=Object.create(THREE.Audio.prototype),THREE.PositionalAudio.prototype.constructor=THREE.PositionalAudio,THREE.PositionalAudio.prototype.getOutput=function(){return this.panner},THREE.PositionalAudio.prototype.setRefDistance=function(e){this.panner.refDistance=e},THREE.PositionalAudio.prototype.getRefDistance=function(){return this.panner.refDistance},THREE.PositionalAudio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e},THREE.PositionalAudio.prototype.getRolloffFactor=function(){return this.panner.rolloffFactor},THREE.PositionalAudio.prototype.setDistanceModel=function(e){this.panner.distanceModel=e},THREE.PositionalAudio.prototype.getDistanceModel=function(){return this.panner.distanceModel},THREE.PositionalAudio.prototype.setMaxDistance=function(e){this.panner.maxDistance=e},THREE.PositionalAudio.prototype.getMaxDistance=function(){return this.panner.maxDistance},THREE.PositionalAudio.prototype.updateMatrixWorld=function(){var e=new THREE.Vector3;return function(t){THREE.Object3D.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}(),THREE.AudioListener=function(){THREE.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null},THREE.AudioListener.prototype=Object.create(THREE.Object3D.prototype),THREE.AudioListener.prototype.constructor=THREE.AudioListener,THREE.AudioListener.prototype.getInput=function(){return this.gain},THREE.AudioListener.prototype.removeFilter=function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},THREE.AudioListener.prototype.setFilter=function(e){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},THREE.AudioListener.prototype.getFilter=function(){return this.filter},THREE.AudioListener.prototype.setMasterVolume=function(e){this.gain.gain.value=e},THREE.AudioListener.prototype.getMasterVolume=function(){return this.gain.gain.value},THREE.AudioListener.prototype.updateMatrixWorld=function(){var e=new THREE.Vector3,t=new THREE.Quaternion,r=new THREE.Vector3,i=new THREE.Vector3;
return function(n){THREE.Object3D.prototype.updateMatrixWorld.call(this,n);var a=this.context.listener,o=this.up;this.matrixWorld.decompose(e,t,r),i.set(0,0,-1).applyQuaternion(t),a.setPosition(e.x,e.y,e.z),a.setOrientation(i.x,i.y,i.z,o.x,o.y,o.z)}}(),THREE.Camera=function(){THREE.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.constructor=THREE.Camera,THREE.Camera.prototype.getWorldDirection=function(){var e=new THREE.Quaternion;return function(t){var r=t||new THREE.Vector3;return this.getWorldQuaternion(e),r.set(0,0,-1).applyQuaternion(e)}}(),THREE.Camera.prototype.lookAt=function(){var e=new THREE.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),THREE.Camera.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.Camera.prototype.copy=function(e){return THREE.Object3D.prototype.copy.call(this,e),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},THREE.CubeCamera=function(e,t,r){THREE.Object3D.call(this),this.type="CubeCamera";var i=90,n=1,a=new THREE.PerspectiveCamera(i,n,e,t);a.up.set(0,-1,0),a.lookAt(new THREE.Vector3(1,0,0)),this.add(a);var o=new THREE.PerspectiveCamera(i,n,e,t);o.up.set(0,-1,0),o.lookAt(new THREE.Vector3(-1,0,0)),this.add(o);var s=new THREE.PerspectiveCamera(i,n,e,t);s.up.set(0,0,1),s.lookAt(new THREE.Vector3(0,1,0)),this.add(s);var h=new THREE.PerspectiveCamera(i,n,e,t);h.up.set(0,0,-1),h.lookAt(new THREE.Vector3(0,-1,0)),this.add(h);var c=new THREE.PerspectiveCamera(i,n,e,t);c.up.set(0,-1,0),c.lookAt(new THREE.Vector3(0,0,1)),this.add(c);var l=new THREE.PerspectiveCamera(i,n,e,t);l.up.set(0,-1,0),l.lookAt(new THREE.Vector3(0,0,-1)),this.add(l);var u={format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter};this.renderTarget=new THREE.WebGLRenderTargetCube(r,r,u),this.updateCubeMap=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,i=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,a,r),r.activeCubeFace=1,e.render(t,o,r),r.activeCubeFace=2,e.render(t,s,r),r.activeCubeFace=3,e.render(t,h,r),r.activeCubeFace=4,e.render(t,c,r),r.texture.generateMipmaps=i,r.activeCubeFace=5,e.render(t,l,r),e.setRenderTarget(null)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.CubeCamera.prototype.constructor=THREE.CubeCamera,THREE.OrthographicCamera=function(e,t,r,i,n,a){THREE.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=void 0!==n?n:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera,THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(r-e,r+e,i+t,i-t,this.near,this.far)},THREE.OrthographicCamera.prototype.copy=function(e){return THREE.Camera.prototype.copy.call(this,e),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this},THREE.OrthographicCamera.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,t},THREE.PerspectiveCamera=function(e,t,r,i){THREE.Camera.call(this),this.type="PerspectiveCamera",this.focalLength=10,this.zoom=1,this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype),THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera,THREE.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*THREE.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,i,n,a){this.fullWidth=e,this.fullHeight=t,this.x=r,this.y=i,this.width=n,this.height=a,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=THREE.Math.radToDeg(2*Math.atan(Math.tan(.5*THREE.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight,r=Math.tan(THREE.Math.degToRad(.5*e))*this.near,i=-r,n=t*i,a=t*r,o=Math.abs(a-n),s=Math.abs(r-i);this.projectionMatrix.makeFrustum(n+this.x*o/this.fullWidth,n+(this.x+this.width)*o/this.fullWidth,r-(this.y+this.height)*s/this.fullHeight,r-this.y*s/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)},THREE.PerspectiveCamera.prototype.copy=function(e){return THREE.Camera.prototype.copy.call(this,e),this.focalLength=e.focalLength,this.zoom=e.zoom,this.fov=e.fov,this.aspect=e.aspect,this.near=e.near,this.far=e.far,this},THREE.PerspectiveCamera.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return t.object.focalLength=this.focalLength,t.object.zoom=this.zoom,t.object.fov=this.fov,t.object.aspect=this.aspect,t.object.near=this.near,t.object.far=this.far,t},THREE.StereoCamera=function(){this.type="StereoCamera",this.aspect=1,this.cameraL=new THREE.PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new THREE.PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1},THREE.StereoCamera.prototype={constructor:THREE.StereoCamera,update:function(){var e,t,r,i,n,a=new THREE.Matrix4,o=new THREE.Matrix4;return function(s){var h=e!==s.focalLength||t!==s.fov||r!==s.aspect*this.aspect||i!==s.near||n!==s.far;if(h){e=s.focalLength,t=s.fov,r=s.aspect*this.aspect,i=s.near,n=s.far;var c,l,u=s.projectionMatrix.clone(),E=.032,p=E*i/e,d=i*Math.tan(THREE.Math.degToRad(.5*t));o.elements[12]=-E,a.elements[12]=E,c=-d*r+p,l=d*r+p,u.elements[0]=2*i/(l-c),u.elements[8]=(l+c)/(l-c),this.cameraL.projectionMatrix.copy(u),c=-d*r-p,l=d*r-p,u.elements[0]=2*i/(l-c),u.elements[8]=(l+c)/(l-c),this.cameraR.projectionMatrix.copy(u)}this.cameraL.matrixWorld.copy(s.matrixWorld).multiply(o),this.cameraR.matrixWorld.copy(s.matrixWorld).multiply(a)}}()},THREE.Light=function(e,t){THREE.Object3D.call(this),this.type="Light",this.color=new THREE.Color(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0},THREE.Light.prototype=Object.create(THREE.Object3D.prototype),THREE.Light.prototype.constructor=THREE.Light,THREE.Light.prototype.copy=function(e){return THREE.Object3D.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},THREE.Light.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.exponent&&(t.object.exponent=this.exponent),t},THREE.LightShadow=function(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new THREE.Vector2(512,512),this.map=null,this.matrix=new THREE.Matrix4},THREE.LightShadow.prototype={constructor:THREE.LightShadow,copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)}},THREE.AmbientLight=function(e,t){THREE.Light.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0},THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype),THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.DirectionalLight=function(e,t){THREE.Light.call(this,e,t),this.type="DirectionalLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new THREE.Object3D,this.shadow=new THREE.LightShadow(new THREE.OrthographicCamera(-5,5,5,-5,.5,500))},THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.DirectionalLight.prototype.copy=function(e){return THREE.Light.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this},THREE.HemisphereLight=function(e,t,r){THREE.Light.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.set(0,1,0),this.updateMatrix(),this.groundColor=new THREE.Color(t)},THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype),THREE.HemisphereLight.prototype.constructor=THREE.HemisphereLight,THREE.HemisphereLight.prototype.copy=function(e){return THREE.Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this},THREE.PointLight=function(e,t,r,i){THREE.Light.call(this,e,t),this.type="PointLight",this.distance=void 0!==r?r:0,this.decay=void 0!==i?i:1,this.shadow=new THREE.LightShadow(new THREE.PerspectiveCamera(90,1,.5,500))},THREE.PointLight.prototype=Object.create(THREE.Light.prototype),THREE.PointLight.prototype.constructor=THREE.PointLight,THREE.PointLight.prototype.copy=function(e){return THREE.Light.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this},THREE.SpotLight=function(e,t,r,i,n,a){THREE.Light.call(this,e,t),this.type="SpotLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new THREE.Object3D,this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/3,this.exponent=void 0!==n?n:10,this.decay=void 0!==a?a:1,this.shadow=new THREE.LightShadow(new THREE.PerspectiveCamera(50,1,.5,500))},THREE.SpotLight.prototype=Object.create(THREE.Light.prototype),THREE.SpotLight.prototype.constructor=THREE.SpotLight,THREE.SpotLight.prototype.copy=function(e){return THREE.Light.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.exponent=e.exponent,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this},THREE.Cache={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){return this.enabled!==!1?this.files[e]:void 0},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},THREE.Loader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t,r){for(var i=[],n=0;n<e.length;++n)i[n]=this.createMaterial(e[n],t,r);return i},createMaterial:function(){var e,t,r;return function(i,n,a){function o(e,r,i,o,h){var c,l=n+e,u=THREE.Loader.Handlers.get(l);null!==u?c=u.load(l):(t.setCrossOrigin(a),c=t.load(l)),void 0!==r&&(c.repeat.fromArray(r),1!==r[0]&&(c.wrapS=THREE.RepeatWrapping),1!==r[1]&&(c.wrapT=THREE.RepeatWrapping)),void 0!==i&&c.offset.fromArray(i),void 0!==o&&("repeat"===o[0]&&(c.wrapS=THREE.RepeatWrapping),"mirror"===o[0]&&(c.wrapS=THREE.MirroredRepeatWrapping),"repeat"===o[1]&&(c.wrapT=THREE.RepeatWrapping),"mirror"===o[1]&&(c.wrapT=THREE.MirroredRepeatWrapping)),void 0!==h&&(c.anisotropy=h);var E=THREE.Math.generateUUID();return s[E]=c,E}void 0===e&&(e=new THREE.Color),void 0===t&&(t=new THREE.TextureLoader),void 0===r&&(r=new THREE.MaterialLoader);var s={},h={uuid:THREE.Math.generateUUID(),type:"MeshLambertMaterial"};for(var c in i){var l=i[c];switch(c){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":h.name=l;break;case"blending":h.blending=THREE[l];break;case"colorAmbient":console.warn("THREE.Loader.createMaterial: colorAmbient is no longer supported");break;case"colorDiffuse":h.color=e.fromArray(l).getHex();break;case"colorSpecular":h.specular=e.fromArray(l).getHex();break;case"colorEmissive":h.emissive=e.fromArray(l).getHex();break;case"specularCoef":h.shininess=l;break;case"shading":"basic"===l.toLowerCase()&&(h.type="MeshBasicMaterial"),"phong"===l.toLowerCase()&&(h.type="MeshPhongMaterial");break;case"mapDiffuse":h.map=o(l,i.mapDiffuseRepeat,i.mapDiffuseOffset,i.mapDiffuseWrap,i.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapLight":h.lightMap=o(l,i.mapLightRepeat,i.mapLightOffset,i.mapLightWrap,i.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":h.aoMap=o(l,i.mapAORepeat,i.mapAOOffset,i.mapAOWrap,i.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":h.bumpMap=o(l,i.mapBumpRepeat,i.mapBumpOffset,i.mapBumpWrap,i.mapBumpAnisotropy);break;case"mapBumpScale":h.bumpScale=l;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":h.normalMap=o(l,i.mapNormalRepeat,i.mapNormalOffset,i.mapNormalWrap,i.mapNormalAnisotropy);break;case"mapNormalFactor":h.normalScale=[l,l];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":h.specularMap=o(l,i.mapSpecularRepeat,i.mapSpecularOffset,i.mapSpecularWrap,i.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapAlpha":h.alphaMap=o(l,i.mapAlphaRepeat,i.mapAlphaOffset,i.mapAlphaWrap,i.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":h.side=THREE.BackSide;break;case"doubleSided":h.side=THREE.DoubleSide;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),h.opacity=l;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":h[c]=l;break;case"vertexColors":l===!0&&(h.vertexColors=THREE.VertexColors),"face"===l&&(h.vertexColors=THREE.FaceColors);break;default:console.error("THREE.Loader.createMaterial: Unsupported",c,l)}}return"MeshBasicMaterial"===h.type&&delete h.emissive,"MeshPhongMaterial"!==h.type&&delete h.specular,h.opacity<1&&(h.transparent=!0),r.setTextures(s),r.parse(h)}}()},THREE.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,r=0,i=t.length;i>r;r+=2){var n=t[r],a=t[r+1];if(n.test(e))return a}return null}},THREE.XHRLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(e,t,r,i){void 0!==this.path&&(e=this.path+e);var n=this,a=THREE.Cache.get(e);if(void 0!==a)return t&&setTimeout(function(){t(a)},0),a;var o=new XMLHttpRequest;return o.overrideMimeType("text/plain"),o.open("GET",e,!0),o.addEventListener("load",function(r){var a=r.target.response;THREE.Cache.add(e,a),200===this.status?(t&&t(a),n.manager.itemEnd(e)):0===this.status?(console.warn("THREE.XHRLoader: HTTP Status 0 received."),t&&t(a),n.manager.itemEnd(e)):(i&&i(r),n.manager.itemError(e))},!1),void 0!==r&&o.addEventListener("progress",function(e){r(e)},!1),o.addEventListener("error",function(t){i&&i(t),n.manager.itemError(e)},!1),void 0!==this.responseType&&(o.responseType=this.responseType),void 0!==this.withCredentials&&(o.withCredentials=this.withCredentials),o.send(null),n.manager.itemStart(e),o},setPath:function(e){this.path=e},setResponseType:function(e){this.responseType=e},setWithCredentials:function(e){this.withCredentials=e}},THREE.FontLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.FontLoader.prototype={constructor:THREE.FontLoader,load:function(e,t,r,i){var n=new THREE.XHRLoader(this.manager);n.load(e,function(e){t(new THREE.Font(JSON.parse(e.substring(65,e.length-2))))},r,i)}},THREE.ImageLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(e,t,r,i){void 0!==this.path&&(e=this.path+e);var n=this,a=THREE.Cache.get(e);if(void 0!==a)return n.manager.itemStart(e),t?setTimeout(function(){t(a),n.manager.itemEnd(e)},0):n.manager.itemEnd(e),a;var o=document.createElement("img");return o.addEventListener("load",function(){THREE.Cache.add(e,this),t&&t(this),n.manager.itemEnd(e)},!1),void 0!==r&&o.addEventListener("progress",function(e){r(e)},!1),o.addEventListener("error",function(t){i&&i(t),n.manager.itemError(e)},!1),void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),n.manager.itemStart(e),o.src=e,o},setCrossOrigin:function(e){this.crossOrigin=e},setPath:function(e){this.path=e}},THREE.JSONLoader=function(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.withCredentials=!1},THREE.JSONLoader.prototype={constructor:THREE.JSONLoader,get statusDomElement(){return void 0===this._statusDomElement&&(this._statusDomElement=document.createElement("div")),console.warn("THREE.JSONLoader: .statusDomElement has been removed."),this._statusDomElement},load:function(e,t,r,i){var n=this,a=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:THREE.Loader.prototype.extractUrlBase(e),o=new THREE.XHRLoader(this.manager);o.setWithCredentials(this.withCredentials),o.load(e,function(r){var i=JSON.parse(r),o=i.metadata;if(void 0!==o){var s=o.type;if(void 0!==s){if("object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.");if("scene"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.SceneLoader instead.")}}var h=n.parse(i,a);t(h.geometry,h.materials)},r,i)},setTexturePath:function(e){this.texturePath=e},parse:function(e,t){function r(t){function r(e,t){return e&1<<t}var i,n,a,s,h,c,l,u,E,p,d,f,m,T,v,g,y,R,H,x,b,M,_,w,S,C,L,A=e.faces,P=e.vertices,D=e.normals,U=e.colors,I=0;if(void 0!==e.uvs){for(i=0;i<e.uvs.length;i++)e.uvs[i].length&&I++;for(i=0;I>i;i++)o.faceVertexUvs[i]=[]}for(s=0,h=P.length;h>s;)R=new THREE.Vector3,R.x=P[s++]*t,R.y=P[s++]*t,R.z=P[s++]*t,o.vertices.push(R);for(s=0,h=A.length;h>s;)if(p=A[s++],d=r(p,0),f=r(p,1),m=r(p,3),T=r(p,4),v=r(p,5),g=r(p,6),y=r(p,7),d){if(x=new THREE.Face3,x.a=A[s],x.b=A[s+1],x.c=A[s+3],b=new THREE.Face3,b.a=A[s+1],b.b=A[s+2],b.c=A[s+3],s+=4,f&&(E=A[s++],x.materialIndex=E,b.materialIndex=E),a=o.faces.length,m)for(i=0;I>i;i++)for(w=e.uvs[i],o.faceVertexUvs[i][a]=[],o.faceVertexUvs[i][a+1]=[],n=0;4>n;n++)u=A[s++],C=w[2*u],L=w[2*u+1],S=new THREE.Vector2(C,L),2!==n&&o.faceVertexUvs[i][a].push(S),0!==n&&o.faceVertexUvs[i][a+1].push(S);if(T&&(l=3*A[s++],x.normal.set(D[l++],D[l++],D[l]),b.normal.copy(x.normal)),v)for(i=0;4>i;i++)l=3*A[s++],_=new THREE.Vector3(D[l++],D[l++],D[l]),2!==i&&x.vertexNormals.push(_),0!==i&&b.vertexNormals.push(_);if(g&&(c=A[s++],M=U[c],x.color.setHex(M),b.color.setHex(M)),y)for(i=0;4>i;i++)c=A[s++],M=U[c],2!==i&&x.vertexColors.push(new THREE.Color(M)),0!==i&&b.vertexColors.push(new THREE.Color(M));o.faces.push(x),o.faces.push(b)}else{if(H=new THREE.Face3,H.a=A[s++],H.b=A[s++],H.c=A[s++],f&&(E=A[s++],H.materialIndex=E),a=o.faces.length,m)for(i=0;I>i;i++)for(w=e.uvs[i],o.faceVertexUvs[i][a]=[],n=0;3>n;n++)u=A[s++],C=w[2*u],L=w[2*u+1],S=new THREE.Vector2(C,L),o.faceVertexUvs[i][a].push(S);if(T&&(l=3*A[s++],H.normal.set(D[l++],D[l++],D[l])),v)for(i=0;3>i;i++)l=3*A[s++],_=new THREE.Vector3(D[l++],D[l++],D[l]),H.vertexNormals.push(_);if(g&&(c=A[s++],H.color.setHex(U[c])),y)for(i=0;3>i;i++)c=A[s++],H.vertexColors.push(new THREE.Color(U[c]));o.faces.push(H)}}function i(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var r=0,i=e.skinWeights.length;i>r;r+=t){var n=e.skinWeights[r],a=t>1?e.skinWeights[r+1]:0,s=t>2?e.skinWeights[r+2]:0,h=t>3?e.skinWeights[r+3]:0;o.skinWeights.push(new THREE.Vector4(n,a,s,h))}if(e.skinIndices)for(var r=0,i=e.skinIndices.length;i>r;r+=t){var c=e.skinIndices[r],l=t>1?e.skinIndices[r+1]:0,u=t>2?e.skinIndices[r+2]:0,E=t>3?e.skinIndices[r+3]:0;o.skinIndices.push(new THREE.Vector4(c,l,u,E))}o.bones=e.bones,o.bones&&o.bones.length>0&&(o.skinWeights.length!==o.skinIndices.length||o.skinIndices.length!==o.vertices.length)&&console.warn("When skinning, number of vertices ("+o.vertices.length+"), skinIndices ("+o.skinIndices.length+"), and skinWeights ("+o.skinWeights.length+") should match.")}function n(t){if(void 0!==e.morphTargets)for(var r=0,i=e.morphTargets.length;i>r;r++){o.morphTargets[r]={},o.morphTargets[r].name=e.morphTargets[r].name,o.morphTargets[r].vertices=[];for(var n=o.morphTargets[r].vertices,a=e.morphTargets[r].vertices,s=0,h=a.length;h>s;s+=3){var c=new THREE.Vector3;c.x=a[s]*t,c.y=a[s+1]*t,c.z=a[s+2]*t,n.push(c)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');for(var l=o.faces,u=e.morphColors[0].colors,r=0,i=l.length;i>r;r++)l[r].color.fromArray(u,3*r)}}function a(){var t=[],r=[];void 0!==e.animation&&r.push(e.animation),void 0!==e.animations&&(e.animations.length?r=r.concat(e.animations):r.push(e.animations));for(var i=0;i<r.length;i++){var n=THREE.AnimationClip.parseAnimation(r[i],o.bones);n&&t.push(n)}if(o.morphTargets){var a=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(o.morphTargets,10);t=t.concat(a)}t.length>0&&(o.animations=t)}var o=new THREE.Geometry,s=void 0!==e.scale?1/e.scale:1;if(r(s),i(),n(s),a(),o.computeFaceNormals(),o.computeBoundingSphere(),void 0===e.materials||0===e.materials.length)return{geometry:o};var h=THREE.Loader.prototype.initMaterials(e.materials,t,this.crossOrigin);return{geometry:o,materials:h}}},THREE.LoadingManager=function(e,t,r){function i(){o+s===h&&(a=!1,(0===s||n.allowErrors)&&void 0!==n.onLoad&&n.onLoad())}var n=this,a=!1,o=0,s=0,h=0;this.allowErrors=!1,this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){h++,a===!1&&void 0!==n.onStart&&n.onStart(e,o,h),a=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,h),i()},this.itemError=function(e){s++,void 0!==n.onError&&n.onError(e),i()},this.setAllowErrors=function(e){this.allowErrors=e}},THREE.DefaultLoadingManager=new THREE.LoadingManager,THREE.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(e,t,r,i){var n=this,a=new THREE.XHRLoader(n.manager);a.load(e,function(e){t(n.parse(JSON.parse(e)))},r,i)},parse:function(e){var t=new THREE.BufferGeometry,r=e.data.index,i={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};if(void 0!==r){var n=new i[r.type](r.array);t.setIndex(new THREE.BufferAttribute(n,1))}var a=e.data.attributes;for(var o in a){var s=a[o],n=new i[s.type](s.array);t.addAttribute(o,new THREE.BufferAttribute(n,s.itemSize))}var h=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==h)for(var c=0,l=h.length;c!==l;++c){var u=h[c];t.addGroup(u.start,u.count,u.materialIndex)}var E=e.data.boundingSphere;if(void 0!==E){var p=new THREE.Vector3;void 0!==E.center&&p.fromArray(E.center),t.boundingSphere=new THREE.Sphere(p,E.radius)}return t}},THREE.MaterialLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.textures={}},THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(e,t,r,i){var n=this,a=new THREE.XHRLoader(n.manager);a.load(e,function(e){t(n.parse(JSON.parse(e)))},r,i)},setTextures:function(e){this.textures=e},getTexture:function(e){var t=this.textures;return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]},parse:function(e){var t=new THREE[e.type];if(void 0!==e.uuid&&(t.uuid=e.uuid),void 0!==e.name&&(t.name=e.name),void 0!==e.color&&t.color.setHex(e.color),void 0!==e.roughness&&(t.roughness=e.roughness),void 0!==e.metalness&&(t.metalness=e.metalness),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.uniforms&&(t.uniforms=e.uniforms),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.shading&&(t.shading=e.shading),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.alphaTest&&(t.alphaTest=e.alphaTest),void 0!==e.depthTest&&(t.depthTest=e.depthTest),void 0!==e.depthWrite&&(t.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(t.colorWrite=e.colorWrite),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(t.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.size&&(t.size=e.size),void 0!==e.sizeAttenuation&&(t.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(t.map=this.getTexture(e.map)),void 0!==e.alphaMap&&(t.alphaMap=this.getTexture(e.alphaMap),t.transparent=!0),void 0!==e.bumpMap&&(t.bumpMap=this.getTexture(e.bumpMap)),void 0!==e.bumpScale&&(t.bumpScale=e.bumpScale),void 0!==e.normalMap&&(t.normalMap=this.getTexture(e.normalMap)),void 0!==e.normalScale){var r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),t.normalScale=(new THREE.Vector2).fromArray(r)}if(void 0!==e.displacementMap&&(t.displacementMap=this.getTexture(e.displacementMap)),void 0!==e.displacementScale&&(t.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(t.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(t.roughnessMap=this.getTexture(e.roughnessMap)),void 0!==e.metalnessMap&&(t.metalnessMap=this.getTexture(e.metalnessMap)),void 0!==e.emissiveMap&&(t.emissiveMap=this.getTexture(e.emissiveMap)),void 0!==e.emissiveIntensity&&(t.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(t.specularMap=this.getTexture(e.specularMap)),void 0!==e.envMap&&(t.envMap=this.getTexture(e.envMap),t.combine=THREE.MultiplyOperation),e.reflectivity&&(t.reflectivity=e.reflectivity),void 0!==e.lightMap&&(t.lightMap=this.getTexture(e.lightMap)),void 0!==e.lightMapIntensity&&(t.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(t.aoMap=this.getTexture(e.aoMap)),void 0!==e.aoMapIntensity&&(t.aoMapIntensity=e.aoMapIntensity),void 0!==e.materials)for(var i=0,n=e.materials.length;n>i;i++)t.materials.push(this.parse(e.materials[i]));return t}},THREE.ObjectLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.texturePath=""},THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(e,t,r,i){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var n=this,a=new THREE.XHRLoader(n.manager);a.load(e,function(e){n.parse(JSON.parse(e),t)},r,i)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var r=this.parseGeometries(e.geometries),i=this.parseImages(e.images,function(){void 0!==t&&t(o)}),n=this.parseTextures(e.textures,i),a=this.parseMaterials(e.materials,n),o=this.parseObject(e.object,r,a);return e.animations&&(o.animations=this.parseAnimations(e.animations)),(void 0===e.images||0===e.images.length)&&void 0!==t&&t(o),o},parseGeometries:function(e){var t={};if(void 0!==e)for(var r=new THREE.JSONLoader,i=new THREE.BufferGeometryLoader,n=0,a=e.length;a>n;n++){var o,s=e[n];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new THREE[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"CubeGeometry":o=new THREE.BoxGeometry(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleBufferGeometry":o=new THREE.CircleBufferGeometry(s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CircleGeometry":o=new THREE.CircleGeometry(s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":o=new THREE.CylinderGeometry(s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":o=new THREE.SphereGeometry(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"SphereBufferGeometry":o=new THREE.SphereBufferGeometry(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":o=new THREE.DodecahedronGeometry(s.radius,s.detail);break;case"IcosahedronGeometry":o=new THREE.IcosahedronGeometry(s.radius,s.detail);break;case"OctahedronGeometry":o=new THREE.OctahedronGeometry(s.radius,s.detail);break;case"TetrahedronGeometry":o=new THREE.TetrahedronGeometry(s.radius,s.detail);break;case"RingGeometry":o=new THREE.RingGeometry(s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":o=new THREE.TorusGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":o=new THREE.TorusKnotGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.p,s.q,s.heightScale);break;case"LatheGeometry":o=new THREE.LatheGeometry(s.points,s.segments,s.phiStart,s.phiLength);break;case"BufferGeometry":o=i.parse(s);break;case"Geometry":o=r.parse(s.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),t[s.uuid]=o}return t},parseMaterials:function(e,t){var r={};if(void 0!==e){var i=new THREE.MaterialLoader;i.setTextures(t);for(var n=0,a=e.length;a>n;n++){var o=i.parse(e[n]);r[o.uuid]=o}}return r},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var i=THREE.AnimationClip.parse(e[r]);t.push(i)}return t},parseImages:function(e,t){function r(e){return i.manager.itemStart(e),o.load(e,function(){i.manager.itemEnd(e)},void 0,function(){i.manager.itemError(e)})}var i=this,n={};if(void 0!==e&&e.length>0){var a=new THREE.LoadingManager(t);a.setAllowErrors(!0);var o=new THREE.ImageLoader(a);o.setCrossOrigin(this.crossOrigin);for(var s=0,h=e.length;h>s;s++){var c=e[s],l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:i.texturePath+c.url;n[c.uuid]=r(l)}}return n},parseTextures:function(e,t){function r(e){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),THREE[e])}var i={};if(void 0!==e)for(var n=0,a=e.length;a>n;n++){var o=e[n];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);var s=new THREE.Texture(t[o.image]);s.needsUpdate=!0,s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.mapping&&(s.mapping=r(o.mapping)),void 0!==o.offset&&(s.offset=new THREE.Vector2(o.offset[0],o.offset[1])),void 0!==o.repeat&&(s.repeat=new THREE.Vector2(o.repeat[0],o.repeat[1])),void 0!==o.minFilter&&(s.minFilter=r(o.minFilter)),void 0!==o.magFilter&&(s.magFilter=r(o.magFilter)),void 0!==o.anisotropy&&(s.anisotropy=o.anisotropy),Array.isArray(o.wrap)&&(s.wrapS=r(o.wrap[0]),s.wrapT=r(o.wrap[1])),i[o.uuid]=s}return i},parseObject:function(){var e=new THREE.Matrix4;return function(t,r,i){function n(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),r[e]}function a(e){return void 0===e?void 0:(void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e])
}var o;switch(t.type){case"Scene":o=new THREE.Scene;break;case"PerspectiveCamera":o=new THREE.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":o=new THREE.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":o=new THREE.AmbientLight(t.color,t.intensity);break;case"DirectionalLight":o=new THREE.DirectionalLight(t.color,t.intensity);break;case"PointLight":o=new THREE.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":o=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay);break;case"HemisphereLight":o=new THREE.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":var s=n(t.geometry),h=a(t.material);o=s.bones&&s.bones.length>0?new THREE.SkinnedMesh(s,h):new THREE.Mesh(s,h);break;case"LOD":o=new THREE.LOD;break;case"Line":o=new THREE.Line(n(t.geometry),a(t.material),t.mode);break;case"PointCloud":case"Points":o=new THREE.Points(n(t.geometry),a(t.material));break;case"Sprite":o=new THREE.Sprite(a(t.material));break;case"Group":o=new THREE.Group;break;default:o=new THREE.Object3D}if(o.uuid=t.uuid,void 0!==t.name&&(o.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(o.position,o.quaternion,o.scale)):(void 0!==t.position&&o.position.fromArray(t.position),void 0!==t.rotation&&o.rotation.fromArray(t.rotation),void 0!==t.scale&&o.scale.fromArray(t.scale)),void 0!==t.castShadow&&(o.castShadow=t.castShadow),void 0!==t.receiveShadow&&(o.receiveShadow=t.receiveShadow),void 0!==t.visible&&(o.visible=t.visible),void 0!==t.userData&&(o.userData=t.userData),void 0!==t.children)for(var c in t.children)o.add(this.parseObject(t.children[c],r,i));if("LOD"===t.type)for(var l=t.levels,u=0;u<l.length;u++){var E=l[u],c=o.getObjectByProperty("uuid",E.object);void 0!==c&&o.addLevel(c,E.distance)}return o}}()},THREE.TextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(e,t,r,i){var n=new THREE.Texture,a=new THREE.ImageLoader(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){n.image=e,n.needsUpdate=!0,void 0!==t&&t(n)},r,i),n},setCrossOrigin:function(e){this.crossOrigin=e},setPath:function(e){this.path=e}},THREE.CubeTextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.CubeTextureLoader.prototype={constructor:THREE.CubeTextureLoader,load:function(e,t,r,i){function n(r){o.load(e[r],function(e){a.images[r]=e,s++,6===s&&(a.needsUpdate=!0,t&&t(a))},void 0,i)}var a=new THREE.CubeTexture([]),o=new THREE.ImageLoader(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);for(var s=0,h=0;h<e.length;++h)n(h);return a},setCrossOrigin:function(e){this.crossOrigin=e},setPath:function(e){this.path=e}},THREE.DataTextureLoader=THREE.BinaryTextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this._parser=null},THREE.BinaryTextureLoader.prototype={constructor:THREE.BinaryTextureLoader,load:function(e,t,r,i){var n=this,a=new THREE.DataTexture,o=new THREE.XHRLoader(this.manager);return o.setResponseType("arraybuffer"),o.load(e,function(e){var r=n._parser(e);r&&(void 0!==r.image?a.image=r.image:void 0!==r.data&&(a.image.width=r.width,a.image.height=r.height,a.image.data=r.data),a.wrapS=void 0!==r.wrapS?r.wrapS:THREE.ClampToEdgeWrapping,a.wrapT=void 0!==r.wrapT?r.wrapT:THREE.ClampToEdgeWrapping,a.magFilter=void 0!==r.magFilter?r.magFilter:THREE.LinearFilter,a.minFilter=void 0!==r.minFilter?r.minFilter:THREE.LinearMipMapLinearFilter,a.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.mipmaps&&(a.mipmaps=r.mipmaps),1===r.mipmapCount&&(a.minFilter=THREE.LinearFilter),a.needsUpdate=!0,t&&t(a,r))},r,i),a}},THREE.CompressedTextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this._parser=null},THREE.CompressedTextureLoader.prototype={constructor:THREE.CompressedTextureLoader,load:function(e,t,r,i){function n(n){h.load(e[n],function(e){var r=a._parser(e,!0);o[n]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},c+=1,6===c&&(1===r.mipmapCount&&(s.minFilter=THREE.LinearFilter),s.format=r.format,s.needsUpdate=!0,t&&t(s))},r,i)}var a=this,o=[],s=new THREE.CompressedTexture;s.image=o;var h=new THREE.XHRLoader(this.manager);if(h.setPath(this.path),h.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,l=0,u=e.length;u>l;++l)n(l);else h.load(e,function(e){var r=a._parser(e,!0);if(r.isCubemap)for(var i=r.mipmaps.length/r.mipmapCount,n=0;i>n;n++){o[n]={mipmaps:[]};for(var h=0;h<r.mipmapCount;h++)o[n].mipmaps.push(r.mipmaps[n*r.mipmapCount+h]),o[n].format=r.format,o[n].width=r.width,o[n].height=r.height}else s.image.width=r.width,s.image.height=r.height,s.mipmaps=r.mipmaps;1===r.mipmapCount&&(s.minFilter=THREE.LinearFilter),s.format=r.format,s.needsUpdate=!0,t&&t(s)},r,i);return s},setPath:function(e){this.path=e}},THREE.Material=function(){Object.defineProperty(this,"id",{value:THREE.MaterialIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="Material",this.side=THREE.FrontSide,this.opacity=1,this.transparent=!1,this.blending=THREE.NormalBlending,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=THREE.LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},THREE.Material.prototype={constructor:THREE.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){e===!0&&this.update(),this._needsUpdate=e},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r){var i=this[t];void 0!==i?i instanceof THREE.Color?i.set(r):i instanceof THREE.Vector3&&r instanceof THREE.Vector3?i.copy(r):this[t]="overdraw"===t?Number(r):r:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){function t(e){var t=[];for(var r in e){var i=e[r];delete i.metadata,t.push(i)}return t}var r=void 0===e;r&&(e={textures:{},images:{}});var i={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color instanceof THREE.Color&&(i.color=this.color.getHex()),.5!==this.roughness&&(i.roughness=this.roughness),this.metalness>0&&(i.metalness=this.metalness),this.emissive instanceof THREE.Color&&(i.emissive=this.emissive.getHex()),this.specular instanceof THREE.Color&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),this.map instanceof THREE.Texture&&(i.map=this.map.toJSON(e).uuid),this.alphaMap instanceof THREE.Texture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap instanceof THREE.Texture&&(i.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap instanceof THREE.Texture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap instanceof THREE.Texture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalScale=this.normalScale.toArray()),this.displacementMap instanceof THREE.Texture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap instanceof THREE.Texture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap instanceof THREE.Texture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap instanceof THREE.Texture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap instanceof THREE.Texture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap instanceof THREE.Texture&&(i.envMap=this.envMap.toJSON(e).uuid,i.reflectivity=this.reflectivity),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),void 0!==this.vertexColors&&this.vertexColors!==THREE.NoColors&&(i.vertexColors=this.vertexColors),void 0!==this.shading&&this.shading!==THREE.SmoothShading&&(i.shading=this.shading),void 0!==this.blending&&this.blending!==THREE.NormalBlending&&(i.blending=this.blending),void 0!==this.side&&this.side!==THREE.FrontSide&&(i.side=this.side),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),r){var n=t(e.textures),a=t(e.images);n.length>0&&(i.textures=n),a.length>0&&(i.images=a)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.side=e.side,this.opacity=e.opacity,this.transparent=e.transparent,this.blending=e.blending,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.alphaTest=e.alphaTest,this.overdraw=e.overdraw,this.visible=e.visible,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Material.prototype),THREE.MaterialIdCount=0,THREE.LineBasicMaterial=function(e){THREE.Material.call(this),this.type="LineBasicMaterial",this.color=new THREE.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=THREE.NoColors,this.fog=!0,this.setValues(e)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial,THREE.LineBasicMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.vertexColors=e.vertexColors,this.fog=e.fog,this},THREE.LineDashedMaterial=function(e){THREE.Material.call(this),this.type="LineDashedMaterial",this.color=new THREE.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=THREE.NoColors,this.fog=!0,this.setValues(e)},THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineDashedMaterial.prototype.constructor=THREE.LineDashedMaterial,THREE.LineDashedMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this.vertexColors=e.vertexColors,this.fog=e.fog,this},THREE.MeshBasicMaterial=function(e){THREE.Material.call(this),this.type="MeshBasicMaterial",this.color=new THREE.Color(16777215),this.map=null,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial,THREE.MeshBasicMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},THREE.MeshLambertMaterial=function(e){THREE.Material.call(this),this.type="MeshLambertMaterial",this.color=new THREE.Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new THREE.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial,THREE.MeshLambertMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},THREE.MeshPhongMaterial=function(e){THREE.Material.call(this),this.type="MeshPhongMaterial",this.color=new THREE.Color(16777215),this.specular=new THREE.Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new THREE.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial,THREE.MeshPhongMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},THREE.MeshStandardMaterial=function(e){THREE.Material.call(this),this.type="MeshStandardMaterial",this.color=new THREE.Color(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new THREE.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshStandardMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshStandardMaterial.prototype.constructor=THREE.MeshStandardMaterial,THREE.MeshStandardMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},THREE.MeshDepthMaterial=function(e){THREE.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial,THREE.MeshDepthMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial,THREE.MeshNormalMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},THREE.MultiMaterial=function(e){this.uuid=THREE.Math.generateUUID(),this.type="MultiMaterial",this.materials=e instanceof Array?e:[],this.visible=!0},THREE.MultiMaterial.prototype={constructor:THREE.MultiMaterial,toJSON:function(e){for(var t={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},r=this.materials,i=0,n=r.length;n>i;i++){var a=r[i].toJSON(e);delete a.metadata,t.materials.push(a)}return t.visible=this.visible,t},clone:function(){for(var e=new this.constructor,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e.visible=this.visible,e}},THREE.PointsMaterial=function(e){THREE.Material.call(this),this.type="PointsMaterial",this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=THREE.NoColors,this.fog=!0,this.setValues(e)},THREE.PointsMaterial.prototype=Object.create(THREE.Material.prototype),THREE.PointsMaterial.prototype.constructor=THREE.PointsMaterial,THREE.PointsMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.vertexColors=e.vertexColors,this.fog=e.fog,this},THREE.ShaderMaterial=function(e){THREE.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=THREE.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial,THREE.ShaderMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.defines=e.defines,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},THREE.ShaderMaterial.prototype.toJSON=function(e){var t=THREE.Material.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},THREE.RawShaderMaterial=function(e){THREE.ShaderMaterial.call(this,e),this.type="RawShaderMaterial"},THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype),THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial,THREE.SpriteMaterial=function(e){THREE.Material.call(this),this.type="SpriteMaterial",this.color=new THREE.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteMaterial.prototype.constructor=THREE.SpriteMaterial,THREE.SpriteMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.fog=e.fog,this},THREE.Texture=function(e,t,r,i,n,a,o,s,h){Object.defineProperty(this,"id",{value:THREE.TextureIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0!==e?e:THREE.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:THREE.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==i?i:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==n?n:THREE.LinearFilter,this.minFilter=void 0!==a?a:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==h?h:1,this.format=void 0!==o?o:THREE.RGBAFormat,this.type=void 0!==s?s:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.version=0,this.onUpdate=null},THREE.Texture.DEFAULT_IMAGE=void 0,THREE.Texture.DEFAULT_MAPPING=THREE.UVMapping,THREE.Texture.prototype={constructor:THREE.Texture,set needsUpdate(e){e===!0&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this},toJSON:function(e){function t(e){var t;return void 0!==e.toDataURL?t=e:(t=document.createElement("canvas"),t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height)),t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}if(void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(void 0!==this.image){var i=this.image;void 0===i.uuid&&(i.uuid=THREE.Math.generateUUID()),void 0===e.images[i.uuid]&&(e.images[i.uuid]={uuid:i.uuid,url:t(i)}),r.image=i.uuid}return e.textures[this.uuid]=r,r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping===THREE.UVMapping){if(e.multiply(this.repeat),e.add(this.offset),e.x<0||e.x>1)switch(this.wrapS){case THREE.RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case THREE.ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case THREE.MirroredRepeatWrapping:e.x=1===Math.abs(Math.floor(e.x)%2)?Math.ceil(e.x)-e.x:e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case THREE.RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case THREE.ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case THREE.MirroredRepeatWrapping:e.y=1===Math.abs(Math.floor(e.y)%2)?Math.ceil(e.y)-e.y:e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}}},THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype),THREE.TextureIdCount=0,THREE.CanvasTexture=function(e,t,r,i,n,a,o,s,h){THREE.Texture.call(this,e,t,r,i,n,a,o,s,h),this.needsUpdate=!0},THREE.CanvasTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CanvasTexture.prototype.constructor=THREE.CanvasTexture,THREE.CubeTexture=function(e,t,r,i,n,a,o,s,h){t=void 0!==t?t:THREE.CubeReflectionMapping,THREE.Texture.call(this,e,t,r,i,n,a,o,s,h),this.images=e,this.flipY=!1},THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CubeTexture.prototype.constructor=THREE.CubeTexture,THREE.CubeTexture.prototype.copy=function(e){return THREE.Texture.prototype.copy.call(this,e),this.images=e.images,this},THREE.CompressedTexture=function(e,t,r,i,n,a,o,s,h,c,l){THREE.Texture.call(this,null,a,o,s,h,c,i,n,l),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture,THREE.DataTexture=function(e,t,r,i,n,a,o,s,h,c,l){THREE.Texture.call(this,null,a,o,s,h,c,i,n,l),this.image={data:e,width:t,height:r},this.magFilter=void 0!==h?h:THREE.NearestFilter,this.minFilter=void 0!==c?c:THREE.NearestFilter,this.flipY=!1,this.generateMipmaps=!1},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.constructor=THREE.DataTexture,THREE.VideoTexture=function(e,t,r,i,n,a,o,s,h){function c(){requestAnimationFrame(c),e.readyState===e.HAVE_ENOUGH_DATA&&(l.needsUpdate=!0)}THREE.Texture.call(this,e,t,r,i,n,a,o,s,h),this.generateMipmaps=!1;var l=this;c()},THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype),THREE.VideoTexture.prototype.constructor=THREE.VideoTexture,THREE.Group=function(){THREE.Object3D.call(this),this.type="Group"},THREE.Group.prototype=Object.create(THREE.Object3D.prototype),THREE.Group.prototype.constructor=THREE.Group,THREE.Points=function(e,t){THREE.Object3D.call(this),this.type="Points",this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.PointsMaterial({color:16777215*Math.random()})},THREE.Points.prototype=Object.create(THREE.Object3D.prototype),THREE.Points.prototype.constructor=THREE.Points,THREE.Points.prototype.raycast=function(){var e=new THREE.Matrix4,t=new THREE.Ray,r=new THREE.Sphere;return function(i,n){function a(e,r){var a=t.distanceSqToPoint(e);if(u>a){var s=t.closestPointToPoint(e);s.applyMatrix4(h);var c=i.ray.origin.distanceTo(s);if(c<i.near||c>i.far)return;n.push({distance:c,distanceToRay:Math.sqrt(a),point:s.clone(),index:r,face:null,object:o})}}var o=this,s=this.geometry,h=this.matrixWorld,c=i.params.Points.threshold;if(null===s.boundingSphere&&s.computeBoundingSphere(),r.copy(s.boundingSphere),r.applyMatrix4(h),i.ray.intersectsSphere(r)!==!1){e.getInverse(h),t.copy(i.ray).applyMatrix4(e);var l=c/((this.scale.x+this.scale.y+this.scale.z)/3),u=l*l,E=new THREE.Vector3;if(s instanceof THREE.BufferGeometry){var p=s.index,d=s.attributes,f=d.position.array;if(null!==p)for(var m=p.array,T=0,v=m.length;v>T;T++){var g=m[T];E.fromArray(f,3*g),a(E,g)}else for(var T=0,y=f.length/3;y>T;T++)E.fromArray(f,3*T),a(E,T)}else for(var R=s.vertices,T=0,y=R.length;y>T;T++)a(R[T],T)}}}(),THREE.Points.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},THREE.Line=function(e,t,r){return 1===r?(console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new THREE.LineSegments(e,t)):(THREE.Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new THREE.Geometry,void(this.material=void 0!==t?t:new THREE.LineBasicMaterial({color:16777215*Math.random()})))},THREE.Line.prototype=Object.create(THREE.Object3D.prototype),THREE.Line.prototype.constructor=THREE.Line,THREE.Line.prototype.raycast=function(){var e=new THREE.Matrix4,t=new THREE.Ray,r=new THREE.Sphere;return function(i,n){var a=i.linePrecision,o=a*a,s=this.geometry,h=this.matrixWorld;if(null===s.boundingSphere&&s.computeBoundingSphere(),r.copy(s.boundingSphere),r.applyMatrix4(h),i.ray.intersectsSphere(r)!==!1){e.getInverse(h),t.copy(i.ray).applyMatrix4(e);var c=new THREE.Vector3,l=new THREE.Vector3,u=new THREE.Vector3,E=new THREE.Vector3,p=this instanceof THREE.LineSegments?2:1;if(s instanceof THREE.BufferGeometry){var d=s.index,f=s.attributes,m=f.position.array;if(null!==d)for(var T=d.array,v=0,g=T.length-1;g>v;v+=p){var y=T[v],R=T[v+1];c.fromArray(m,3*y),l.fromArray(m,3*R);var H=t.distanceSqToSegment(c,l,E,u);if(!(H>o)){E.applyMatrix4(this.matrixWorld);var x=i.ray.origin.distanceTo(E);x<i.near||x>i.far||n.push({distance:x,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(var v=0,g=m.length/3-1;g>v;v+=p){c.fromArray(m,3*v),l.fromArray(m,3*v+3);var H=t.distanceSqToSegment(c,l,E,u);if(!(H>o)){E.applyMatrix4(this.matrixWorld);var x=i.ray.origin.distanceTo(E);x<i.near||x>i.far||n.push({distance:x,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}else if(s instanceof THREE.Geometry)for(var b=s.vertices,M=b.length,v=0;M-1>v;v+=p){var H=t.distanceSqToSegment(b[v],b[v+1],E,u);if(!(H>o)){E.applyMatrix4(this.matrixWorld);var x=i.ray.origin.distanceTo(E);x<i.near||x>i.far||n.push({distance:x,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}}}(),THREE.Line.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)
},THREE.LineStrip=0,THREE.LinePieces=1,THREE.LineSegments=function(e,t){THREE.Line.call(this,e,t),this.type="LineSegments"},THREE.LineSegments.prototype=Object.create(THREE.Line.prototype),THREE.LineSegments.prototype.constructor=THREE.LineSegments,THREE.Mesh=function(e,t){THREE.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.MeshBasicMaterial({color:16777215*Math.random()}),this.drawMode=THREE.TrianglesDrawMode,this.updateMorphTargets()},THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Mesh.prototype.setDrawMode=function(e){this.drawMode=e},THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;t>e;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Mesh.prototype.raycast=function(){function e(e,t,r,i,n,a,o){return THREE.Triangle.barycoordFromPoint(e,t,r,i,f),n.multiplyScalar(f.x),a.multiplyScalar(f.y),o.multiplyScalar(f.z),n.add(a).add(o),n.clone()}function t(e,t,r,i,n,a,o){var s,h=e.material;if(s=h.side===THREE.BackSide?r.intersectTriangle(a,n,i,!0,o):r.intersectTriangle(i,n,a,h.side!==THREE.DoubleSide,o),null===s)return null;T.copy(o),T.applyMatrix4(e.matrixWorld);var c=t.ray.origin.distanceTo(T);return c<t.near||c>t.far?null:{distance:c,point:T.clone(),object:e}}function r(r,i,n,a,c,l,u,f){o.fromArray(a,3*l),s.fromArray(a,3*u),h.fromArray(a,3*f);var T=t(r,i,n,o,s,h,m);return T&&(c&&(E.fromArray(c,2*l),p.fromArray(c,2*u),d.fromArray(c,2*f),T.uv=e(m,o,s,h,E,p,d)),T.face=new THREE.Face3(l,u,f,THREE.Triangle.normal(o,s,h)),T.faceIndex=l),T}var i=new THREE.Matrix4,n=new THREE.Ray,a=new THREE.Sphere,o=new THREE.Vector3,s=new THREE.Vector3,h=new THREE.Vector3,c=new THREE.Vector3,l=new THREE.Vector3,u=new THREE.Vector3,E=new THREE.Vector2,p=new THREE.Vector2,d=new THREE.Vector2,f=new THREE.Vector3,m=new THREE.Vector3,T=new THREE.Vector3;return function(f,T){var v=this.geometry,g=this.material,y=this.matrixWorld;if(void 0!==g&&(null===v.boundingSphere&&v.computeBoundingSphere(),a.copy(v.boundingSphere),a.applyMatrix4(y),f.ray.intersectsSphere(a)!==!1&&(i.getInverse(y),n.copy(f.ray).applyMatrix4(i),null===v.boundingBox||n.intersectsBox(v.boundingBox)!==!1))){var R,H;if(v instanceof THREE.BufferGeometry){var x,b,M,_=v.index,w=v.attributes,S=w.position.array;if(void 0!==w.uv&&(R=w.uv.array),null!==_)for(var C=_.array,L=0,A=C.length;A>L;L+=3)x=C[L],b=C[L+1],M=C[L+2],H=r(this,f,n,S,R,x,b,M),H&&(H.faceIndex=Math.floor(L/3),T.push(H));else for(var L=0,A=S.length;A>L;L+=9)x=L/3,b=x+1,M=x+2,H=r(this,f,n,S,R,x,b,M),H&&(H.index=x,T.push(H))}else if(v instanceof THREE.Geometry){var P,D,U,I=g instanceof THREE.MultiMaterial,k=I===!0?g.materials:null,B=v.vertices,F=v.faces,V=v.faceVertexUvs[0];V.length>0&&(R=V);for(var N=0,O=F.length;O>N;N++){var G=F[N],z=I===!0?k[G.materialIndex]:g;if(void 0!==z){if(P=B[G.a],D=B[G.b],U=B[G.c],z.morphTargets===!0){var j=v.morphTargets,W=this.morphTargetInfluences;o.set(0,0,0),s.set(0,0,0),h.set(0,0,0);for(var X=0,q=j.length;q>X;X++){var Y=W[X];if(0!==Y){var Z=j[X].vertices;o.addScaledVector(c.subVectors(Z[G.a],P),Y),s.addScaledVector(l.subVectors(Z[G.b],D),Y),h.addScaledVector(u.subVectors(Z[G.c],U),Y)}}o.add(P),s.add(D),h.add(U),P=o,D=s,U=h}if(H=t(this,f,n,P,D,U,m)){if(R){var Q=R[N];E.copy(Q[0]),p.copy(Q[1]),d.copy(Q[2]),H.uv=e(m,P,D,U,E,p,d)}H.face=G,H.faceIndex=N,T.push(H)}}}}}}}(),THREE.Mesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},THREE.Bone=function(e){THREE.Object3D.call(this),this.type="Bone",this.skin=e},THREE.Bone.prototype=Object.create(THREE.Object3D.prototype),THREE.Bone.prototype.constructor=THREE.Bone,THREE.Bone.prototype.copy=function(e){return THREE.Object3D.prototype.copy.call(this,e),this.skin=e.skin,this},THREE.Skeleton=function(e,t,r){if(this.useVertexTexture=void 0!==r?r:!0,this.identityMatrix=new THREE.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture){var i=Math.sqrt(4*this.bones.length);i=THREE.Math.nextPowerOfTwo(Math.ceil(i)),i=Math.max(i,4),this.boneTextureWidth=i,this.boneTextureHeight=i,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType)}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var n=0,a=this.bones.length;a>n;n++)this.boneInverses.push(new THREE.Matrix4)}},THREE.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;t>e;e++){var r=new THREE.Matrix4;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},THREE.Skeleton.prototype.pose=function(){for(var e,t=0,r=this.bones.length;r>t;t++)e=this.bones[t],e&&e.matrixWorld.getInverse(this.boneInverses[t]);for(var t=0,r=this.bones.length;r>t;t++)e=this.bones[t],e&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},THREE.Skeleton.prototype.update=function(){var e=new THREE.Matrix4;return function(){for(var t=0,r=this.bones.length;r>t;t++){var i=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(i,this.boneInverses[t]),e.flattenToArrayOffset(this.boneMatrices,16*t)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),THREE.Skeleton.prototype.clone=function(){return new THREE.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)},THREE.SkinnedMesh=function(e,t,r){THREE.Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new THREE.Matrix4,this.bindMatrixInverse=new THREE.Matrix4;var i=[];if(this.geometry&&void 0!==this.geometry.bones){for(var n,a,o=0,s=this.geometry.bones.length;s>o;++o)a=this.geometry.bones[o],n=new THREE.Bone(this),i.push(n),n.name=a.name,n.position.fromArray(a.pos),n.quaternion.fromArray(a.rotq),void 0!==a.scl&&n.scale.fromArray(a.scl);for(var o=0,s=this.geometry.bones.length;s>o;++o)a=this.geometry.bones[o],-1!==a.parent&&null!==a.parent?i[a.parent].add(i[o]):this.add(i[o])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new THREE.Skeleton(i,void 0,r),this.matrixWorld)},THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh,THREE.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},THREE.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry)for(var e=0;e<this.geometry.skinWeights.length;e++){var t=this.geometry.skinWeights[e],r=1/t.lengthManhattan();1/0!==r?t.multiplyScalar(r):t.set(1,0,0,0)}else if(this.geometry instanceof THREE.BufferGeometry)for(var i=new THREE.Vector4,n=this.geometry.attributes.skinWeight,e=0;e<n.count;e++){i.x=n.getX(e),i.y=n.getY(e),i.z=n.getZ(e),i.w=n.getW(e);var r=1/i.lengthManhattan();1/0!==r?i.multiplyScalar(r):i.set(1,0,0,0),n.setXYZW(e,i.x,i.y,i.z,i.w)}},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(){THREE.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},THREE.SkinnedMesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material,this.useVertexTexture).copy(this)},THREE.LOD=function(){THREE.Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}})},THREE.LOD.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD.prototype.constructor=THREE.LOD,THREE.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,i=0;i<r.length&&!(t<r[i].distance);i++);r.splice(i,0,{distance:t,object:e}),this.add(e)},THREE.LOD.prototype.getObjectForDistance=function(e){for(var t=this.levels,r=1,i=t.length;i>r&&!(e<t[r].distance);r++);return t[r-1].object},THREE.LOD.prototype.raycast=function(){var e=new THREE.Vector3;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.origin.distanceTo(e);this.getObjectForDistance(i).raycast(t,r)}}(),THREE.LOD.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r){var i=this.levels;if(i.length>1){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var n=e.distanceTo(t);i[0].object.visible=!0;for(var a=1,o=i.length;o>a&&n>=i[a].distance;a++)i[a-1].object.visible=!1,i[a].object.visible=!0;for(;o>a;a++)i[a].object.visible=!1}}}(),THREE.LOD.prototype.copy=function(e){THREE.Object3D.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,i=t.length;i>r;r++){var n=t[r];this.addLevel(n.object.clone(),n.distance)}return this},THREE.LOD.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);t.object.levels=[];for(var r=this.levels,i=0,n=r.length;n>i;i++){var a=r[i];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t},THREE.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]),t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),r=new Float32Array([0,0,1,0,1,1,0,1]),i=new THREE.BufferGeometry;return i.setIndex(new THREE.BufferAttribute(e,1)),i.addAttribute("position",new THREE.BufferAttribute(t,3)),i.addAttribute("uv",new THREE.BufferAttribute(r,2)),function(e){THREE.Object3D.call(this),this.type="Sprite",this.geometry=i,this.material=void 0!==e?e:new THREE.SpriteMaterial}}(),THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype),THREE.Sprite.prototype.constructor=THREE.Sprite,THREE.Sprite.prototype.raycast=function(){var e=new THREE.Vector3;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.distanceSqToPoint(e),n=this.scale.x*this.scale.y;i>n||r.push({distance:Math.sqrt(i),point:this.position,face:null,object:this})}}(),THREE.Sprite.prototype.clone=function(){return new this.constructor(this.material).copy(this)},THREE.Particle=THREE.Sprite,THREE.LensFlare=function(e,t,r,i,n){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,r,i,n)},THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare.prototype.constructor=THREE.LensFlare,THREE.LensFlare.prototype.add=function(e,t,r,i,n,a){void 0===t&&(t=-1),void 0===r&&(r=0),void 0===a&&(a=1),void 0===n&&(n=new THREE.Color(16777215)),void 0===i&&(i=THREE.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:0,opacity:a,color:n,blending:i})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t,r=this.lensFlares.length,i=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(e=0;r>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+i*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},THREE.LensFlare.prototype.copy=function(e){THREE.Object3D.prototype.copy.call(this,e),this.positionScreen.copy(e.positionScreen),this.customUpdateCallback=e.customUpdateCallback;for(var t=0,r=e.lensFlares.length;r>t;t++)this.lensFlares.push(e.lensFlares[t]);return this},THREE.Scene=function(){THREE.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),THREE.Scene.prototype.constructor=THREE.Scene,THREE.Scene.prototype.copy=function(e){return THREE.Object3D.prototype.copy.apply(this,arguments),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},THREE.Fog=function(e,t,r){this.name="",this.color=new THREE.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3},THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)},THREE.FogExp2=function(e,t){this.name="",this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)},THREE.ShaderChunk={},THREE.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n	diffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",THREE.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n",THREE.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n	if ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",THREE.ShaderChunk.ambient_pars="uniform vec3 ambientLightColor;\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n	return PI * ambientLightColor;\n\n}\n",THREE.ShaderChunk.aomap_fragment="#ifdef USE_AOMAP\n\n	reflectedLight.indirectDiffuse *= ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n#endif\n",THREE.ShaderChunk.aomap_pars_fragment="#ifdef USE_AOMAP\n\n	uniform sampler2D aoMap;\n	uniform float aoMapIntensity;\n\n#endif",THREE.ShaderChunk.begin_vertex="\nvec3 transformed = vec3( position );\n",THREE.ShaderChunk.beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n",THREE.ShaderChunk.bsdfs='float calcLightAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n	if ( decayExponent > 0.0 ) {\n\n	  return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n	}\n\n	return 1.0;\n\n}\n\n\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\n	return RECIPROCAL_PI * diffuseColor;\n\n} // validated\n\n\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\n	// Original approximation by Christophe Schlick \'94\n	//;float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n	// Optimized variant (presented by Epic at SIGGRAPH \'13)\n	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\n	return ( 1.0 - specularColor ) * fresnel + specularColor;\n\n} // validated\n\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (34)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disney’s reparameterization\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n	// geometry term = G(l)⋅G(v) / 4(n⋅l)(n⋅v)\n\n	float a2 = alpha * alpha;\n\n	float gl = dotNL + pow( a2 + ( 1.0 - a2 ) * dotNL * dotNL, 0.5 );\n\n	float gv = dotNV + pow( a2 + ( 1.0 - a2 ) * dotNV * dotNV, 0.5 );\n\n	return 1.0 / ( gl * gv );\n\n} // validated\n\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disney’s reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n	float a2 = alpha * alpha;\n\n	float denom = dotNH * dotNH * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n	return RECIPROCAL_PI * a2 / ( denom * denom );\n\n}\n\n\n// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\n	float alpha = roughness * roughness; // UE4\'s roughness\n\n	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\n	float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n	float dotNH = saturate( dot( geometry.normal, halfDir ) );\n	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n	vec3 F = F_Schlick( specularColor, dotLH );\n\n	float G = G_GGX_Smith( alpha, dotNL, dotNV );\n\n	float D = D_GGX( alpha, dotNH );\n\n	return F * ( G * D );\n\n} // validated\n\n\n// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\n	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n	vec4 r = roughness * c0 + c1;\n\n	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n	vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n	return specularColor * AB.x + AB.y;\n\n} // validated\n\n\nfloat G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\n\n	// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n	return 0.25;\n\n}\n\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\n	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\n	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\n	//float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n	//float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n	float dotNH = saturate( dot( geometry.normal, halfDir ) );\n	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n	vec3 F = F_Schlick( specularColor, dotLH );\n\n	float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n	float D = D_BlinnPhong( shininess, dotNH );\n\n	return F * ( G * D );\n\n} // validated\n\n// source: http://simonstechblog.blogspot.ca/2011/12/microfacet-brdf.html\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n	return ( 2.0 / square( ggxRoughness + 0.0001 ) - 2.0 );\n}',THREE.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n	// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n	// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n	// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;		// normalized\n\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif\n",THREE.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n	diffuseColor.rgb *= vColor;\n\n#endif",THREE.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n",THREE.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif",THREE.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n	vColor.xyz = color.xyz;\n\n#endif",THREE.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nfloat square( const in float x ) { return x*x; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n\n\nstruct IncidentLight {\n	vec3 color;\n	vec3 direction;\n};\n\nstruct ReflectedLight {\n	vec3 directDiffuse;\n	vec3 directSpecular;\n	vec3 indirectDiffuse;\n	vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n	vec3 position;\n	vec3 normal;\n	vec3 viewDir;\n};\n\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	float distance = dot( planeNormal, point - pointOnPlane );\n\n	return - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	return sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nvec3 inputToLinear( in vec3 a ) {\n\n	#ifdef GAMMA_INPUT\n\n		return pow( a, vec3( float( GAMMA_FACTOR ) ) );\n\n	#else\n\n		return a;\n\n	#endif\n\n}\n\nvec3 linearToOutput( in vec3 a ) {\n\n	#ifdef GAMMA_OUTPUT\n\n		return pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n\n	#else\n\n		return a;\n\n	#endif\n\n}\n",THREE.ShaderChunk.defaultnormal_vertex="#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",THREE.ShaderChunk.displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\n	transformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n\n#endif\n",THREE.ShaderChunk.displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\n	uniform sampler2D displacementMap;\n	uniform float displacementScale;\n	uniform float displacementBias;\n\n#endif\n",THREE.ShaderChunk.emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\n	vec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n	emissiveColor.rgb = inputToLinear( emissiveColor.rgb );\n\n	totalEmissiveLight *= emissiveColor.rgb;\n\n#endif\n",THREE.ShaderChunk.emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\n	uniform sampler2D emissiveMap;\n\n#endif\n",THREE.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		// Transforming Normal Vectors with the Inverse Transformation\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n		#ifdef ENVMAP_MODE_REFLECTION\n\n			vec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n		#else\n\n			vec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		#endif\n\n	#else\n\n		vec3 reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n		float flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n	#else\n		float flipNormal = 1.0;\n	#endif\n\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#elif defined( ENVMAP_TYPE_EQUIREC )\n		vec2 sampleUV;\n		sampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n		sampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n		vec4 envColor = texture2D( envMap, sampleUV );\n\n	#elif defined( ENVMAP_TYPE_SPHERE )\n		vec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n	#endif\n\n	envColor.xyz = inputToLinear( envColor.xyz );\n\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_MIX )\n\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_ADD )\n\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.envmap_pars_fragment="#if defined( USE_ENVMAP ) || defined( STANDARD )\n	uniform float reflectivity;\n	uniform float envMapIntenstiy;\n#endif\n\n#ifdef USE_ENVMAP\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	uniform float flipEnvMap;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( STANDARD )\n\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG ) && ! defined( STANDARD )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n\n#endif\n",THREE.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG ) && ! defined( STANDARD )\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n	#ifdef ENVMAP_MODE_REFLECTION\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	#else\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	outgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif",THREE.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif",THREE.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n	reflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity; // factor of PI should not be present; included here to prevent breakage\n\n#endif\n",THREE.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n	uniform sampler2D lightMap;\n	uniform float lightMapIntensity;\n\n#endif",THREE.ShaderChunk.lights_lambert_vertex="vec3 diffuse = vec3( 1.0 );\n\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\n\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\n\nvLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n	vLightBack = vec3( 0.0 );\n#endif\n\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n\n#if NUM_POINT_LIGHTS > 0\n\n	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n		directLight = getPointDirectLight( pointLights[ i ], geometry );\n\n		dotNL = dot( geometry.normal, directLight.direction );\n		directLightColor_Diffuse = PI * directLight.color;\n\n		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n		#endif\n\n	}\n\n#endif\n\n#if NUM_SPOT_LIGHTS > 0\n\n	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n		directLight = getSpotDirectLight( spotLights[ i ], geometry );\n\n		dotNL = dot( geometry.normal, directLight.direction );\n		directLightColor_Diffuse = PI * directLight.color;\n\n		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n		#endif\n	}\n\n#endif\n\n#if NUM_DIR_LIGHTS > 0\n\n	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n		directLight = getDirectionalDirectLight( directionalLights[ i ], geometry );\n\n		dotNL = dot( geometry.normal, directLight.direction );\n		directLightColor_Diffuse = PI * directLight.color;\n\n		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n		#endif\n\n	}\n\n#endif\n\n#if NUM_HEMI_LIGHTS > 0\n\n	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n		vLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\n		#endif\n\n	}\n\n#endif\n",THREE.ShaderChunk.lights_pars="#if NUM_DIR_LIGHTS > 0\n\n	struct DirectionalLight {\n		vec3 direction;\n		vec3 color;\n\n		int shadow;\n		float shadowBias;\n		float shadowRadius;\n		vec2 shadowMapSize;\n	};\n\n	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\n	IncidentLight getDirectionalDirectLight( const in DirectionalLight directionalLight, const in GeometricContext geometry ) {\n\n		IncidentLight directLight;\n\n		directLight.color = directionalLight.color;\n		directLight.direction = directionalLight.direction;\n\n		return directLight;\n\n	}\n\n#endif\n\n\n#if NUM_POINT_LIGHTS > 0\n\n	struct PointLight {\n		vec3 position;\n		vec3 color;\n		float distance;\n		float decay;\n\n		int shadow;\n		float shadowBias;\n		float shadowRadius;\n		vec2 shadowMapSize;\n	};\n\n	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n	IncidentLight getPointDirectLight( const in PointLight pointLight, const in GeometricContext geometry ) {\n\n		IncidentLight directLight;\n\n		vec3 lVector = pointLight.position - geometry.position;\n		directLight.direction = normalize( lVector );\n\n		directLight.color = pointLight.color;\n		directLight.color *= calcLightAttenuation( length( lVector ), pointLight.distance, pointLight.decay );\n\n		return directLight;\n\n	}\n\n#endif\n\n\n#if NUM_SPOT_LIGHTS > 0\n\n	struct SpotLight {\n		vec3 position;\n		vec3 direction;\n		vec3 color;\n		float distance;\n		float decay;\n		float angleCos;\n		float exponent;\n\n		int shadow;\n		float shadowBias;\n		float shadowRadius;\n		vec2 shadowMapSize;\n	};\n\n	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n	IncidentLight getSpotDirectLight( const in SpotLight spotLight, const in GeometricContext geometry ) {\n\n		IncidentLight directLight;\n\n		vec3 lVector = spotLight.position - geometry.position;\n		directLight.direction = normalize( lVector );\n\n		float spotEffect = dot( directLight.direction, spotLight.direction );\n\n		if ( spotEffect > spotLight.angleCos ) {\n\n			float spotEffect = dot( spotLight.direction, directLight.direction );\n			spotEffect = saturate( pow( saturate( spotEffect ), spotLight.exponent ) );\n\n			directLight.color = spotLight.color;\n			directLight.color *= ( spotEffect * calcLightAttenuation( length( lVector ), spotLight.distance, spotLight.decay ) );\n\n		} else {\n\n			directLight.color = vec3( 0.0 );\n\n		}\n\n		return directLight;\n\n	}\n\n#endif\n\n\n#if NUM_HEMI_LIGHTS > 0\n\n	struct HemisphereLight {\n		vec3 direction;\n		vec3 skyColor;\n		vec3 groundColor;\n	};\n\n	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\n		float dotNL = dot( geometry.normal, hemiLight.direction );\n		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n		return PI * mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n	}\n\n#endif\n\n\n#if defined( USE_ENVMAP ) && defined( STANDARD )\n\n	vec3 getLightProbeIndirectIrradiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in int maxMIPLevel ) {\n\n		#ifdef DOUBLE_SIDED\n\n			float flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n		#else\n\n			float flipNormal = 1.0;\n\n		#endif\n\n		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n		#ifdef ENVMAP_TYPE_CUBE\n\n			vec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\n			// TODO: replace with properly filtered cubemaps and access the irradiance LOD level, be it the last LOD level\n			// of a specular cubemap, or just the default level of a specially created irradiance cubemap.\n\n			#ifdef TEXTURE_LOD_EXT\n\n				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\n			#else\n\n				// force the bias high to get the last LOD level as it is the most blurred.\n				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\n			#endif\n\n		#else\n\n			vec3 envMapColor = vec3( 0.0 );\n\n		#endif\n\n		envMapColor.rgb = inputToLinear( envMapColor.rgb );\n\n		return PI * envMapColor.rgb * envMapIntensity;\n\n	}\n\n	// taken from here: http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html\n	float getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\n		//float envMapWidth = pow( 2.0, maxMIPLevelScalar );\n		//float desiredMIPLevel = log2( envMapWidth * sqrt( 3.0 ) ) - 0.5 * log2( square( blinnShininessExponent ) + 1.0 );\n\n		float maxMIPLevelScalar = float( maxMIPLevel );\n		float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( square( blinnShininessExponent ) + 1.0 );\n\n		// clamp to allowable LOD ranges.\n		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n	}\n\n	vec3 getLightProbeIndirectRadiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\n		#ifdef ENVMAP_MODE_REFLECTION\n\n			vec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\n		#else\n\n			vec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\n		#endif\n\n		#ifdef DOUBLE_SIDED\n\n			float flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n		#else\n\n			float flipNormal = 1.0;\n\n		#endif\n\n		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\n		float specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\n		#ifdef ENVMAP_TYPE_CUBE\n\n			vec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\n			#ifdef TEXTURE_LOD_EXT\n\n				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\n			#else\n\n				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\n			#endif\n\n		#elif defined( ENVMAP_TYPE_EQUIREC )\n\n			vec2 sampleUV;\n			sampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n			sampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\n			#ifdef TEXTURE_LOD_EXT\n\n				vec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\n			#else\n\n				vec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\n			#endif\n\n		#elif defined( ENVMAP_TYPE_SPHERE )\n\n			vec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\n			#ifdef TEXTURE_LOD_EXT\n\n				vec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\n			#else\n\n				vec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\n			#endif\n\n		#endif\n\n		envMapColor.rgb = inputToLinear( envMapColor.rgb );\n\n		return envMapColor.rgb * envMapIntensity;\n\n	}\n\n#endif\n",THREE.ShaderChunk.lights_phong_fragment="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",THREE.ShaderChunk.lights_phong_pars_fragment="#ifdef USE_ENVMAP\n\n	varying vec3 vWorldPosition;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n	varying vec3 vNormal;\n\n#endif\n\n\nstruct BlinnPhongMaterial {\n\n	vec3	diffuseColor;\n	vec3	specularColor;\n	float	specularShininess;\n	float	specularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\n	vec3 irradiance = dotNL * PI * directLight.color; // punctual light\n\n	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct				RE_Direct_BlinnPhong\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong\n\n#define Material_LightProbeLOD( material )	(0)\n",THREE.ShaderChunk.lights_phong_pars_vertex="#ifdef USE_ENVMAP\n\n	varying vec3 vWorldPosition;\n\n#endif\n",THREE.ShaderChunk.lights_phong_vertex="#ifdef USE_ENVMAP\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif\n",THREE.ShaderChunk.lights_standard_fragment="StandardMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\nmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n",THREE.ShaderChunk.lights_standard_pars_fragment="struct StandardMaterial {\n\n	vec3	diffuseColor;\n	float	specularRoughness;\n	vec3	specularColor;\n\n};\n\nvoid RE_Direct_Standard( const in IncidentLight directLight, const in GeometricContext geometry, const in StandardMaterial material, inout ReflectedLight reflectedLight ) {\n\n	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\n	vec3 irradiance = dotNL * PI * directLight.color; // punctual light\n\n	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n	reflectedLight.directSpecular += irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\n}\n\nvoid RE_IndirectDiffuse_Standard( const in vec3 irradiance, const in GeometricContext geometry, const in StandardMaterial material, inout ReflectedLight reflectedLight ) {\n\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectSpecular_Standard( const in vec3 radiance, const in GeometricContext geometry, const in StandardMaterial material, inout ReflectedLight reflectedLight ) {\n\n	reflectedLight.indirectSpecular += radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\n}\n\n#define RE_Direct				RE_Direct_Standard\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Standard\n#define RE_IndirectSpecular		RE_IndirectSpecular_Standard\n\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n",THREE.ShaderChunk.lights_template="//\n// This is a template that can be used to light a material, it uses pluggable RenderEquations (RE)\n//   for specific lighting scenarios.\n//\n// Instructions for use:\n//  - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n//  - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???\n//  - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n//\n// TODO:\n//  - Add area light support.\n//  - Add sphere light support.\n//  - Add diffuse light probe (irradiance cubemap) support.\n//\n\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n	PointLight pointLight;\n\n	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n		pointLight = pointLights[ i ];\n\n		directLight = getPointDirectLight( pointLight, geometry );\n\n		#ifdef USE_SHADOWMAP\n		directLight.color *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n		#endif\n\n		RE_Direct( directLight, geometry, material, reflectedLight );\n\n	}\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n	SpotLight spotLight;\n\n	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n		spotLight = spotLights[ i ];\n\n		directLight = getSpotDirectLight( spotLight, geometry );\n\n		#ifdef USE_SHADOWMAP\n		directLight.color *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n		#endif\n\n		RE_Direct( directLight, geometry, material, reflectedLight );\n\n	}\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n	DirectionalLight directionalLight;\n\n	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n		directionalLight = directionalLights[ i ];\n\n		directLight = getDirectionalDirectLight( directionalLight, geometry );\n\n		#ifdef USE_SHADOWMAP\n		directLight.color *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n		#endif\n\n		RE_Direct( directLight, geometry, material, reflectedLight );\n\n	}\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n	#ifdef USE_LIGHTMAP\n\n		irradiance += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity; // factor of PI should not be present; included here to prevent breakage\n\n	#endif\n\n	#if ( NUM_HEMI_LIGHTS > 0 )\n\n		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n		}\n\n	#endif\n\n	// #if defined( USE_ENVMAP ) && defined( STANDARD )\n\n		// TODO, replace 8 with the real maxMIPLevel\n		// irradiance += getLightProbeIndirectIrradiance( /*lightProbe,*/ geometry, 8 ); // comment out until seams are fixed\n\n	// #endif\n\n	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n	// TODO, replace 8 with the real maxMIPLevel\n	vec3 radiance = getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry, Material_BlinnShininessExponent( material ), 8 );\n\n	RE_IndirectSpecular( radiance, geometry, material, reflectedLight );\n\n#endif\n",THREE.ShaderChunk.linear_to_gamma_fragment="\n	outgoingLight = linearToOutput( outgoingLight );\n",THREE.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",THREE.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif",THREE.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n	#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	texelColor.xyz = inputToLinear( texelColor.xyz );\n\n	diffuseColor *= texelColor;\n\n#endif\n",THREE.ShaderChunk.map_pars_fragment="#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif",THREE.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n	diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n",THREE.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n	uniform vec4 offsetRepeat;\n	uniform sampler2D map;\n\n#endif\n",THREE.ShaderChunk.metalnessmap_fragment="float metalnessFactor = metalness;\n\n#ifdef USE_METALNESSMAP\n\n	vec4 texelMetalness = texture2D( metalnessMap, vUv );\n	metalnessFactor *= texelMetalness.r;\n\n#endif\n",THREE.ShaderChunk.metalnessmap_pars_fragment="#ifdef USE_METALNESSMAP\n\n	uniform sampler2D metalnessMap;\n\n#endif",THREE.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n	objectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	objectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	objectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	objectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n#endif\n",THREE.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif",THREE.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n	transformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	transformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	transformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	transformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	transformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	transformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	transformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	transformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.normal_fragment="#ifdef FLAT_SHADED\n\n	vec3 fdx = dFdx( vViewPosition );\n	vec3 fdy = dFdy( vViewPosition );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n\n#else\n\n	vec3 normal = normalize( vNormal );\n\n	#ifdef DOUBLE_SIDED\n\n		normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n	#endif\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n",THREE.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n	// Per-Pixel Tangent Space Normal Mapping\n	// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n",THREE.ShaderChunk.project_vertex="#ifdef USE_SKINNING\n\n	vec4 mvPosition = modelViewMatrix * skinned;\n\n#else\n\n	vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",THREE.ShaderChunk.roughnessmap_fragment="float roughnessFactor = roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n	vec4 texelRoughness = texture2D( roughnessMap, vUv );\n	roughnessFactor *= texelRoughness.r;\n\n#endif\n",THREE.ShaderChunk.roughnessmap_pars_fragment="#ifdef USE_ROUGHNESSMAP\n\n	uniform sampler2D roughnessMap;\n\n#endif",THREE.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n	#if NUM_DIR_LIGHTS > 0\n\n		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\n	#endif\n\n	#if NUM_SPOT_LIGHTS > 0\n\n		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\n	#endif\n\n	#if NUM_POINT_LIGHTS > 0\n\n		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\n	#endif\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		return dot( rgba_depth, bit_shift );\n\n	}\n\n	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n		return step( compare, unpackDepth( texture2D( depths, uv ) ) );\n\n	}\n\n	float texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\n		const vec2 offset = vec2( 0.0, 1.0 );\n\n		vec2 texelSize = vec2( 1.0 ) / size;\n		vec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\n		float lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n		float lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n		float rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n		float rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\n		vec2 f = fract( uv * size + 0.5 );\n\n		float a = mix( lb, lt, f.y );\n		float b = mix( rb, rt, f.y );\n		float c = mix( a, b, f.x );\n\n		return c;\n\n	}\n\n	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n		shadowCoord.xyz /= shadowCoord.w;\n		shadowCoord.z += shadowBias;\n\n		// if ( something && something ) breaks ATI OpenGL shader compiler\n		// if ( all( something, something ) ) using this instead\n\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n\n		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n		bool frustumTest = all( frustumTestVec );\n\n		if ( frustumTest ) {\n\n		#if defined( SHADOWMAP_TYPE_PCF )\n\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n			float dx0 = - texelSize.x * shadowRadius;\n			float dy0 = - texelSize.y * shadowRadius;\n			float dx1 = + texelSize.x * shadowRadius;\n			float dy1 = + texelSize.y * shadowRadius;\n\n			return (\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n			) * ( 1.0 / 9.0 );\n\n		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n			float dx0 = - texelSize.x * shadowRadius;\n			float dy0 = - texelSize.y * shadowRadius;\n			float dx1 = + texelSize.x * shadowRadius;\n			float dy1 = + texelSize.y * shadowRadius;\n\n			return (\n				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n				texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n			) * ( 1.0 / 9.0 );\n\n		#else // no percentage-closer filtering:\n\n			return texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n		#endif\n\n		}\n\n		return 1.0;\n\n	}\n\n	// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n	// vector suitable for 2D texture mapping. This code uses the following layout for the\n	// 2D texture:\n	//\n	// xzXZ\n	//  y Y\n	//\n	// Y - Positive y direction\n	// y - Negative y direction\n	// X - Positive x direction\n	// x - Negative x direction\n	// Z - Positive z direction\n	// z - Negative z direction\n	//\n	// Source and test bed:\n	// https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n	vec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n		// Number of texels to avoid at the edge of each square\n\n		vec3 absV = abs( v );\n\n		// Intersect unit cube\n\n		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n		absV *= scaleToCube;\n\n		// Apply scale to avoid seams\n\n		// two texels less per square (one texel will do for NEAREST)\n		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n		// Unwrap\n\n		// space: -1 ... 1 range for each square\n		//\n		// #X##		dim    := ( 4 , 2 )\n		//  # #		center := ( 1 , 1 )\n\n		vec2 planar = v.xy;\n\n		float almostATexel = 1.5 * texelSizeY;\n		float almostOne = 1.0 - almostATexel;\n\n		if ( absV.z >= almostOne ) {\n\n			if ( v.z > 0.0 )\n				planar.x = 4.0 - v.x;\n\n		} else if ( absV.x >= almostOne ) {\n\n			float signX = sign( v.x );\n			planar.x = v.z * signX + 2.0 * signX;\n\n		} else if ( absV.y >= almostOne ) {\n\n			float signY = sign( v.y );\n			planar.x = v.x + 2.0 * signY + 2.0;\n			planar.y = v.z * signY - 2.0;\n\n		}\n\n		// Transform to UV space\n\n		// scale := 0.5 / dim\n		// translate := ( center + 0.5 ) / dim\n		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n	}\n\n	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n		vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n		// for point lights, the uniform @vShadowCoord is re-purposed to hold\n		// the distance from the light to the world-space position of the fragment.\n		vec3 lightToPosition = shadowCoord.xyz;\n\n		// bd3D = base direction 3D\n		vec3 bd3D = normalize( lightToPosition );\n		// dp = distance from light to fragment position\n		float dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\n		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n			vec3 offset = vec3( - 1, 0, 1 ) * shadowRadius * 2.0 * texelSize.y;\n\n			return (\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.zzz, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.zxz, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxz, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xzz, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.zzx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.zxx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xzx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.zzy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.zxy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xzy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.zyz, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyz, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.zyx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yzz, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxz, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yzx, texelSize.y ), dp )\n			) * ( 1.0 / 21.0 );\n\n		#else // no percentage-closer filtering\n\n			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\n		#endif\n\n	}\n\n#endif\n",THREE.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n	#if NUM_DIR_LIGHTS > 0\n\n		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\n	#endif\n\n	#if NUM_SPOT_LIGHTS > 0\n\n		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\n	#endif\n\n	#if NUM_POINT_LIGHTS > 0\n\n		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n	#if NUM_DIR_LIGHTS > 0\n\n	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\n	}\n\n	#endif\n\n	#if NUM_SPOT_LIGHTS > 0\n\n	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\n	}\n\n	#endif\n\n	#if NUM_POINT_LIGHTS > 0\n\n	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\n	}\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.shadowmask_pars_fragment="float getShadowMask() {\n\n	float shadow = 1.0;\n\n	#ifdef USE_SHADOWMAP\n\n	#if NUM_DIR_LIGHTS > 0\n\n	DirectionalLight directionalLight;\n\n	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n		directionalLight = directionalLights[ i ];\n		shadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n	}\n\n	#endif\n\n	#if NUM_SPOT_LIGHTS > 0\n\n	SpotLight spotLight;\n\n	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n		spotLight = spotLights[ i ];\n		shadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\n	}\n\n	#endif\n\n	#if NUM_POINT_LIGHTS > 0\n\n	PointLight pointLight;\n\n	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n		pointLight = pointLights[ i ];\n		shadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\n	}\n\n	#endif\n\n	#endif\n\n	return shadow;\n\n}\n",THREE.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",THREE.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n",THREE.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n#endif\n",THREE.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif",THREE.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif",THREE.ShaderChunk.uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	varying vec2 vUv2;\n\n#endif",THREE.ShaderChunk.uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	attribute vec2 uv2;\n	varying vec2 vUv2;\n\n#endif",THREE.ShaderChunk.uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	vUv2 = uv2;\n\n#endif",THREE.ShaderChunk.uv_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n	varying vec2 vUv;\n\n#endif",THREE.ShaderChunk.uv_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n",THREE.ShaderChunk.uv_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",THREE.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( STANDARD ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#else\n\n		vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n	#endif\n\n#endif\n",THREE.UniformsUtils={merge:function(e){for(var t={},r=0;r<e.length;r++){var i=this.clone(e[r]);
for(var n in i)t[n]=i[n]}return t},clone:function(e){var t={};for(var r in e){t[r]={};for(var i in e[r]){var n=e[r][i];t[r][i]=n instanceof THREE.Color||n instanceof THREE.Vector2||n instanceof THREE.Vector3||n instanceof THREE.Vector4||n instanceof THREE.Matrix3||n instanceof THREE.Matrix4||n instanceof THREE.Texture?n.clone():Array.isArray(n)?n.slice():n}}return t}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"f",value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:1},displacementBias:{type:"f",value:0}},roughnessmap:{roughnessMap:{type:"t",value:null}},metalnessmap:{metalnessMap:{type:"t",value:null}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},ambient:{ambientLightColor:{type:"fv",value:[]}},lights:{directionalLights:{type:"sa",value:[],properties:{direction:{type:"v3"},color:{type:"c"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},directionalShadowMap:{type:"tv",value:[]},directionalShadowMatrix:{type:"m4v",value:[]},spotLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},direction:{type:"v3"},distance:{type:"f"},angleCos:{type:"f"},exponent:{type:"f"},decay:{type:"f"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},spotShadowMap:{type:"tv",value:[]},spotShadowMatrix:{type:"m4v",value:[]},pointLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},decay:{type:"f"},distance:{type:"f"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},pointShadowMap:{type:"tv",value:[]},pointShadowMatrix:{type:"m4v",value:[]},hemisphereLights:{type:"sa",value:[],properties:{direction:{type:"v3"},skyColor:{type:"c"},groundColor:{type:"c"}}}},points:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)}}},THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.fog]),vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"	#ifdef USE_ENVMAP",THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"	#endif",THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.uv_pars_fragment,THREE.ShaderChunk.uv2_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.aomap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"	ReflectedLight reflectedLight;","	reflectedLight.directDiffuse = vec3( 0.0 );","	reflectedLight.directSpecular = vec3( 0.0 );","	reflectedLight.indirectDiffuse = diffuseColor.rgb;","	reflectedLight.indirectSpecular = vec3( 0.0 );",THREE.ShaderChunk.aomap_fragment,"	vec3 outgoingLight = reflectedLight.indirectDiffuse;",THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.fog,THREE.UniformsLib.ambient,THREE.UniformsLib.lights,{emissive:{type:"c",value:new THREE.Color(0)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.lights_pars,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.uv_pars_fragment,THREE.ShaderChunk.uv2_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.aomap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.emissivemap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.ambient_pars,THREE.ShaderChunk.lights_pars,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.shadowmask_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec4 diffuseColor = vec4( diffuse, opacity );","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveLight = emissive;",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.emissivemap_fragment,"	reflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );",THREE.ShaderChunk.lightmap_fragment,"	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );","	#ifdef DOUBLE_SIDED","		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;","	#else","		reflectedLight.directDiffuse = vLightFront;","	#endif","	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();",THREE.ShaderChunk.aomap_fragment,"	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveLight;",THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.bumpmap,THREE.UniformsLib.normalmap,THREE.UniformsLib.displacementmap,THREE.UniformsLib.fog,THREE.UniformsLib.ambient,THREE.UniformsLib.lights,{emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.displacementmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","	vNormal = normalize( transformedNormal );","#endif",THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.displacementmap_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = - mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.uv_pars_fragment,THREE.ShaderChunk.uv2_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.aomap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.emissivemap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.ambient_pars,THREE.ShaderChunk.lights_pars,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec4 diffuseColor = vec4( diffuse, opacity );","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveLight = emissive;",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.normal_fragment,THREE.ShaderChunk.emissivemap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lights_template,THREE.ShaderChunk.aomap_fragment,"vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;",THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},standard:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.bumpmap,THREE.UniformsLib.normalmap,THREE.UniformsLib.displacementmap,THREE.UniformsLib.roughnessmap,THREE.UniformsLib.metalnessmap,THREE.UniformsLib.fog,THREE.UniformsLib.ambient,THREE.UniformsLib.lights,{emissive:{type:"c",value:new THREE.Color(0)},roughness:{type:"f",value:.5},metalness:{type:"f",value:0},envMapIntensity:{type:"f",value:1}}]),vertexShader:["#define STANDARD","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.displacementmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","	vNormal = normalize( transformedNormal );","#endif",THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.displacementmap_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = - mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define STANDARD","uniform vec3 diffuse;","uniform vec3 emissive;","uniform float roughness;","uniform float metalness;","uniform float opacity;","uniform float envMapIntensity;","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.uv_pars_fragment,THREE.ShaderChunk.uv2_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.aomap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.emissivemap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.ambient_pars,THREE.ShaderChunk.lights_pars,THREE.ShaderChunk.lights_standard_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.roughnessmap_pars_fragment,THREE.ShaderChunk.metalnessmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec4 diffuseColor = vec4( diffuse, opacity );","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveLight = emissive;",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.roughnessmap_fragment,THREE.ShaderChunk.metalnessmap_fragment,THREE.ShaderChunk.normal_fragment,THREE.ShaderChunk.emissivemap_fragment,THREE.ShaderChunk.lights_standard_fragment,THREE.ShaderChunk.lights_template,THREE.ShaderChunk.aomap_fragment,"vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;",THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},points:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.points,THREE.UniformsLib.fog]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.project_vertex,"	#ifdef USE_SIZEATTENUATION","		gl_PointSize = size * ( scale / - mvPosition.z );","	#else","		gl_PointSize = size;","	#endif",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphatest_fragment,"	outgoingLight = diffuseColor.rgb;",THREE.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"	vLineDistance = scale * lineDistance;","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	if ( mod( vLineDistance, totalSize ) > dashSize ) {","		discard;","	}","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.color_fragment,"	outgoingLight = diffuseColor.rgb;",THREE.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		float depth = gl_FragDepthEXT / gl_FragCoord.w;","	#else","		float depth = gl_FragCoord.z / gl_FragCoord.w;","	#endif","	float color = 1.0 - smoothstep( mNear, mFar, depth );","	gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","	res -= res.xxyz * bit_mask;","	return res;","}","void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","	#else","		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","	#endif","}"].join("\n")},distanceRGBA:{uniforms:{lightPos:{type:"v3",value:new THREE.Vector3(0,0,0)}},vertexShader:["varying vec4 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.worldpos_vertex,"vWorldPosition = worldPosition;","}"].join("\n"),fragmentShader:["uniform vec3 lightPos;","varying vec4 vWorldPosition;",THREE.ShaderChunk.common,"vec4 pack1K ( float depth ) {","	depth /= 1000.0;","	const vec4 bitSh = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bitMsk = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = mod( depth * bitSh * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","	res -= res.xxyz * bitMsk;","	return res; ","}","float unpack1K ( vec4 color ) {","	const vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","	return dot( color, bitSh ) * 1000.0;","}","void main () {","	gl_FragColor = pack1K( length( vWorldPosition.xyz - lightPos.xyz ) );","}"].join("\n")}},THREE.WebGLRenderer=function(e){function t(){return null===Tt?Lt:1}function r(e,t,r,i){at===!0&&(e*=i,t*=i,r*=i),Wt.clearColor(e,t,r,i)}function i(){Wt.init(),Wt.scissor(Ht.copy(At).multiplyScalar(Lt)),Wt.viewport(bt.copy(Dt).multiplyScalar(Lt)),r(_t.r,_t.g,_t.b,wt)}function n(){mt=null,Rt=null,yt="",gt=-1,Wt.reset()}function a(e){e.preventDefault(),n(),i(),Xt.clear()}function o(e){var t=e.target;t.removeEventListener("dispose",o),c(t),Ft.textures--}function s(e){var t=e.target;t.removeEventListener("dispose",s),l(t),Ft.textures--}function h(e){var t=e.target;t.removeEventListener("dispose",h),u(t)}function c(e){var t=Xt.get(e);if(e.image&&t.__image__webglTextureCube)Nt.deleteTexture(t.__image__webglTextureCube);else{if(void 0===t.__webglInit)return;Nt.deleteTexture(t.__webglTexture)}Xt.delete(e)}function l(e){var t=Xt.get(e),r=Xt.get(e.texture);if(e&&void 0!==r.__webglTexture){if(Nt.deleteTexture(r.__webglTexture),e instanceof THREE.WebGLRenderTargetCube)for(var i=0;6>i;i++)Nt.deleteFramebuffer(t.__webglFramebuffer[i]),Nt.deleteRenderbuffer(t.__webglDepthbuffer[i]);else Nt.deleteFramebuffer(t.__webglFramebuffer),Nt.deleteRenderbuffer(t.__webglDepthbuffer);Xt.delete(e.texture),Xt.delete(e)}}function u(e){E(e),Xt.delete(e)}function E(e){var t=Xt.get(e).program;e.program=void 0,void 0!==t&&Yt.releaseProgram(t)}function p(e,t,r,i){var n;if(r instanceof THREE.InstancedBufferGeometry&&(n=zt.get("ANGLE_instanced_arrays"),null===n))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");void 0===i&&(i=0),Wt.initAttributes();var a=r.attributes,o=t.getAttributes(),s=e.defaultAttributeValues;for(var h in o){var c=o[h];if(c>=0){var l=a[h];if(void 0!==l){var u=l.itemSize,E=qt.getAttributeBuffer(l);if(l instanceof THREE.InterleavedBufferAttribute){var p=l.data,d=p.stride,f=l.offset;p instanceof THREE.InstancedInterleavedBuffer?(Wt.enableAttributeAndDivisor(c,p.meshPerAttribute,n),void 0===r.maxInstancedCount&&(r.maxInstancedCount=p.meshPerAttribute*p.count)):Wt.enableAttribute(c),Nt.bindBuffer(Nt.ARRAY_BUFFER,E),Nt.vertexAttribPointer(c,u,Nt.FLOAT,!1,d*p.array.BYTES_PER_ELEMENT,(i*d+f)*p.array.BYTES_PER_ELEMENT)}else l instanceof THREE.InstancedBufferAttribute?(Wt.enableAttributeAndDivisor(c,l.meshPerAttribute,n),void 0===r.maxInstancedCount&&(r.maxInstancedCount=l.meshPerAttribute*l.count)):Wt.enableAttribute(c),Nt.bindBuffer(Nt.ARRAY_BUFFER,E),Nt.vertexAttribPointer(c,u,Nt.FLOAT,!1,0,i*u*4)}else if(void 0!==s){var m=s[h];if(void 0!==m)switch(m.length){case 2:Nt.vertexAttrib2fv(c,m);break;case 3:Nt.vertexAttrib3fv(c,m);break;case 4:Nt.vertexAttrib4fv(c,m);break;default:Nt.vertexAttrib1fv(c,m)}}}}Wt.disableUnusedAttributes()}function d(e,t){return Math.abs(t[0])-Math.abs(e[0])}function f(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function m(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function T(e,t,r,i,n){var a,o;r.transparent?(a=lt,o=++ut):(a=ht,o=++ct);var s=a[o];void 0!==s?(s.id=e.id,s.object=e,s.geometry=t,s.material=r,s.z=kt.z,s.group=n):(s={id:e.id,object:e,geometry:t,material:r,z:kt.z,group:n},a.push(s))}function v(e,t){if(e.visible!==!1&&e.layers.test(t.layers)){if(e instanceof THREE.Light)st.push(e);else if(e instanceof THREE.Sprite)(e.frustumCulled===!1||Ut.intersectsObject(e)===!0)&&pt.push(e);else if(e instanceof THREE.LensFlare)dt.push(e);else if(e instanceof THREE.ImmediateRenderObject)ft.sortObjects===!0&&(kt.setFromMatrixPosition(e.matrixWorld),kt.applyProjection(It)),T(e,null,e.material,kt.z,null);else if((e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.Points)&&(e instanceof THREE.SkinnedMesh&&e.skeleton.update(),e.frustumCulled===!1||Ut.intersectsObject(e)===!0)){var r=e.material;if(r.visible===!0){ft.sortObjects===!0&&(kt.setFromMatrixPosition(e.matrixWorld),kt.applyProjection(It));var i=qt.update(e);if(r instanceof THREE.MultiMaterial)for(var n=i.groups,a=r.materials,o=0,s=n.length;s>o;o++){var h=n[o],c=a[h.materialIndex];c.visible===!0&&T(e,i,c,kt.z,h)}else T(e,i,r,kt.z,null)}}for(var l=e.children,o=0,s=l.length;s>o;o++)v(l[o],t)}}function g(e,t,r,i){for(var n=0,a=e.length;a>n;n++){var o=e[n],s=o.object,h=o.geometry,c=void 0===i?o.material:i,l=o.group;if(s.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,s.matrixWorld),s.normalMatrix.getNormalMatrix(s.modelViewMatrix),s instanceof THREE.ImmediateRenderObject){R(c);var u=x(t,r,c,s);yt="",s.render(function(e){ft.renderBufferImmediate(e,u,c)})}else ft.renderBufferDirect(t,r,h,c,s,l)}}function y(e,t,r){var i=Xt.get(e),n=Yt.getParameters(e,Bt,t,r),a=Yt.getProgramCode(e,n),o=i.program,s=!0;if(void 0===o)e.addEventListener("dispose",h);else if(o.code!==a)E(e);else{if(void 0!==n.shaderID)return;s=!1}if(s){if(n.shaderID){var c=THREE.ShaderLib[n.shaderID];i.__webglShader={name:e.type,uniforms:THREE.UniformsUtils.clone(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}}else i.__webglShader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.__webglShader=i.__webglShader,o=Yt.acquireProgram(e,n,a),i.program=o,e.program=o}var l=o.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var u=0;u<ft.maxMorphTargets;u++)l["morphTarget"+u]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(var u=0;u<ft.maxMorphNormals;u++)l["morphNormal"+u]>=0&&e.numSupportedMorphNormals++}i.uniformsList=[];var p=i.__webglShader.uniforms,d=i.program.getUniforms();for(var f in p){var m=d[f];m&&i.uniformsList.push([i.__webglShader.uniforms[f],m])}(e instanceof THREE.MeshPhongMaterial||e instanceof THREE.MeshLambertMaterial||e instanceof THREE.MeshStandardMaterial||e.lights)&&(i.lightsHash=Bt.hash,p.ambientLightColor.value=Bt.ambient,p.directionalLights.value=Bt.directional,p.spotLights.value=Bt.spot,p.pointLights.value=Bt.point,p.hemisphereLights.value=Bt.hemi,p.directionalShadowMap.value=Bt.directionalShadowMap,p.directionalShadowMatrix.value=Bt.directionalShadowMatrix,p.spotShadowMap.value=Bt.spotShadowMap,p.spotShadowMatrix.value=Bt.spotShadowMatrix,p.pointShadowMap.value=Bt.pointShadowMap,p.pointShadowMatrix.value=Bt.pointShadowMatrix),i.hasDynamicUniforms=!1;for(var T=0,v=i.uniformsList.length;v>T;T++){var g=i.uniformsList[T][0];if(g.dynamic===!0){i.hasDynamicUniforms=!0;break}}}function R(e){H(e),e.transparent===!0?Wt.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):Wt.setBlending(THREE.NoBlending),Wt.setDepthFunc(e.depthFunc),Wt.setDepthTest(e.depthTest),Wt.setDepthWrite(e.depthWrite),Wt.setColorWrite(e.colorWrite),Wt.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function H(e){e.side!==THREE.DoubleSide?Wt.enable(Nt.CULL_FACE):Wt.disable(Nt.CULL_FACE),Wt.setFlipSided(e.side===THREE.BackSide)}function x(e,t,r,i){Mt=0;var n=Xt.get(r);void 0===n.program&&(r.needsUpdate=!0),void 0!==n.lightsHash&&n.lightsHash!==Bt.hash&&(r.needsUpdate=!0),r.needsUpdate&&(y(r,t,i),r.needsUpdate=!1);var a=!1,o=!1,s=!1,h=n.program,c=h.getUniforms(),l=n.__webglShader.uniforms;if(h.id!==mt&&(Nt.useProgram(h.program),mt=h.id,a=!0,o=!0,s=!0),r.id!==gt&&(gt=r.id,o=!0),(a||e!==Rt)&&(Nt.uniformMatrix4fv(c.projectionMatrix,!1,e.projectionMatrix.elements),jt.logarithmicDepthBuffer&&Nt.uniform1f(c.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==Rt&&(Rt=e,o=!0,s=!0),(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshStandardMaterial||r.envMap)&&void 0!==c.cameraPosition&&(kt.setFromMatrixPosition(e.matrixWorld),Nt.uniform3f(c.cameraPosition,kt.x,kt.y,kt.z)),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshStandardMaterial||r instanceof THREE.ShaderMaterial||r.skinning)&&void 0!==c.viewMatrix&&Nt.uniformMatrix4fv(c.viewMatrix,!1,e.matrixWorldInverse.elements)),r.skinning)if(i.bindMatrix&&void 0!==c.bindMatrix&&Nt.uniformMatrix4fv(c.bindMatrix,!1,i.bindMatrix.elements),i.bindMatrixInverse&&void 0!==c.bindMatrixInverse&&Nt.uniformMatrix4fv(c.bindMatrixInverse,!1,i.bindMatrixInverse.elements),jt.floatVertexTextures&&i.skeleton&&i.skeleton.useVertexTexture){if(void 0!==c.boneTexture){var u=I();
Nt.uniform1i(c.boneTexture,u),ft.setTexture(i.skeleton.boneTexture,u)}void 0!==c.boneTextureWidth&&Nt.uniform1i(c.boneTextureWidth,i.skeleton.boneTextureWidth),void 0!==c.boneTextureHeight&&Nt.uniform1i(c.boneTextureHeight,i.skeleton.boneTextureHeight)}else i.skeleton&&i.skeleton.boneMatrices&&void 0!==c.boneGlobalMatrices&&Nt.uniformMatrix4fv(c.boneGlobalMatrices,!1,i.skeleton.boneMatrices);return o&&((r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshStandardMaterial||r.lights)&&D(l,s),t&&r.fog&&C(l,t),(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshStandardMaterial)&&M(l,r),r instanceof THREE.LineBasicMaterial?_(l,r):r instanceof THREE.LineDashedMaterial?(_(l,r),w(l,r)):r instanceof THREE.PointsMaterial?S(l,r):r instanceof THREE.MeshLambertMaterial?L(l,r):r instanceof THREE.MeshPhongMaterial?A(l,r):r instanceof THREE.MeshStandardMaterial?P(l,r):r instanceof THREE.MeshDepthMaterial?(l.mNear.value=e.near,l.mFar.value=e.far,l.opacity.value=r.opacity):r instanceof THREE.MeshNormalMaterial&&(l.opacity.value=r.opacity),k(n.uniformsList)),U(c,i),void 0!==c.modelMatrix&&Nt.uniformMatrix4fv(c.modelMatrix,!1,i.matrixWorld.elements),n.hasDynamicUniforms===!0&&b(n.uniformsList,i,e),h}function b(e,t,r){for(var i=[],n=0,a=e.length;a>n;n++){var o=e[n][0],s=o.onUpdateCallback;void 0!==s&&(s.bind(o)(t,r),i.push(e[n]))}k(i)}function M(e,t){e.opacity.value=t.opacity,e.diffuse.value=t.color,t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),e.map.value=t.map,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);var r;if(t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r){r instanceof THREE.WebGLRenderTarget&&(r=r.texture);var i=r.offset,n=r.repeat;e.offsetRepeat.value.set(i.x,i.y,n.x,n.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}function _(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function w(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function S(e,t){if(e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*Lt,e.scale.value=$.clientHeight/2,e.map.value=t.map,null!==t.map){var r=t.map.offset,i=t.map.repeat;e.offsetRepeat.value.set(r.x,r.y,i.x,i.y)}}function C(e,t){e.fogColor.value=t.color,t instanceof THREE.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof THREE.FogExp2&&(e.fogDensity.value=t.density)}function L(e,t){t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}function A(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function P(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}function D(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}function U(e,t){Nt.uniformMatrix4fv(e.modelViewMatrix,!1,t.modelViewMatrix.elements),e.normalMatrix&&Nt.uniformMatrix3fv(e.normalMatrix,!1,t.normalMatrix.elements)}function I(){var e=Mt;return e>=jt.maxTextures&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+jt.maxTextures),Mt+=1,e}function k(e){for(var t,r,i=0,n=e.length;n>i;i++){var a=e[i][0];if(a.needsUpdate!==!1){var o=a.type,s=a.value,h=e[i][1];switch(o){case"1i":Nt.uniform1i(h,s);break;case"1f":Nt.uniform1f(h,s);break;case"2f":Nt.uniform2f(h,s[0],s[1]);break;case"3f":Nt.uniform3f(h,s[0],s[1],s[2]);break;case"4f":Nt.uniform4f(h,s[0],s[1],s[2],s[3]);break;case"1iv":Nt.uniform1iv(h,s);break;case"3iv":Nt.uniform3iv(h,s);break;case"1fv":Nt.uniform1fv(h,s);break;case"2fv":Nt.uniform2fv(h,s);break;case"3fv":Nt.uniform3fv(h,s);break;case"4fv":Nt.uniform4fv(h,s);break;case"Matrix2fv":Nt.uniformMatrix2fv(h,!1,s);break;case"Matrix3fv":Nt.uniformMatrix3fv(h,!1,s);break;case"Matrix4fv":Nt.uniformMatrix4fv(h,!1,s);break;case"i":Nt.uniform1i(h,s);break;case"f":Nt.uniform1f(h,s);break;case"v2":Nt.uniform2f(h,s.x,s.y);break;case"v3":Nt.uniform3f(h,s.x,s.y,s.z);break;case"v4":Nt.uniform4f(h,s.x,s.y,s.z,s.w);break;case"c":Nt.uniform3f(h,s.r,s.g,s.b);break;case"sa":for(var c=0;c<s.length;c++)for(var l in a.properties){var u=a.properties[l],E=h[c][l],p=s[c][l];switch(u.type){case"i":Nt.uniform1i(E,p);break;case"f":Nt.uniform1f(E,p);break;case"v2":Nt.uniform2f(E,p.x,p.y);break;case"v3":Nt.uniform3f(E,p.x,p.y,p.z);break;case"v4":Nt.uniform4f(E,p.x,p.y,p.z,p.w);break;case"c":Nt.uniform3f(E,p.r,p.g,p.b);break;case"m4":Nt.uniformMatrix4fv(E,!1,p.elements)}}break;case"iv1":Nt.uniform1iv(h,s);break;case"iv":Nt.uniform3iv(h,s);break;case"fv1":Nt.uniform1fv(h,s);break;case"fv":Nt.uniform3fv(h,s);break;case"v2v":void 0===a._array&&(a._array=new Float32Array(2*s.length));for(var c=0,d=0,f=s.length;f>c;c++,d+=2)a._array[d+0]=s[c].x,a._array[d+1]=s[c].y;Nt.uniform2fv(h,a._array);break;case"v3v":void 0===a._array&&(a._array=new Float32Array(3*s.length));for(var c=0,m=0,f=s.length;f>c;c++,m+=3)a._array[m+0]=s[c].x,a._array[m+1]=s[c].y,a._array[m+2]=s[c].z;Nt.uniform3fv(h,a._array);break;case"v4v":void 0===a._array&&(a._array=new Float32Array(4*s.length));for(var c=0,T=0,f=s.length;f>c;c++,T+=4)a._array[T+0]=s[c].x,a._array[T+1]=s[c].y,a._array[T+2]=s[c].z,a._array[T+3]=s[c].w;Nt.uniform4fv(h,a._array);break;case"m2":Nt.uniformMatrix2fv(h,!1,s.elements);break;case"m3":Nt.uniformMatrix3fv(h,!1,s.elements);break;case"m3v":void 0===a._array&&(a._array=new Float32Array(9*s.length));for(var c=0,f=s.length;f>c;c++)s[c].flattenToArrayOffset(a._array,9*c);Nt.uniformMatrix3fv(h,!1,a._array);break;case"m4":Nt.uniformMatrix4fv(h,!1,s.elements);break;case"m4v":void 0===a._array&&(a._array=new Float32Array(16*s.length));for(var c=0,f=s.length;f>c;c++)s[c].flattenToArrayOffset(a._array,16*c);Nt.uniformMatrix4fv(h,!1,a._array);break;case"t":if(t=s,r=I(),Nt.uniform1i(h,r),!t)continue;t instanceof THREE.CubeTexture||Array.isArray(t.image)&&6===t.image.length?j(t,r):t instanceof THREE.WebGLRenderTargetCube?W(t.texture,r):t instanceof THREE.WebGLRenderTarget?ft.setTexture(t.texture,r):ft.setTexture(t,r);break;case"tv":void 0===a._array&&(a._array=[]);for(var c=0,f=a.value.length;f>c;c++)a._array[c]=I();Nt.uniform1iv(h,a._array);for(var c=0,f=a.value.length;f>c;c++)t=a.value[c],r=a._array[c],t&&(t instanceof THREE.CubeTexture||t.image instanceof Array&&6===t.image.length?j(t,r):t instanceof THREE.WebGLRenderTarget?ft.setTexture(t.texture,r):t instanceof THREE.WebGLRenderTargetCube?W(t.texture,r):ft.setTexture(t,r));break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+o)}}}}function B(e,t){var r,i,n,a,o,s,h=0,c=0,l=0,u=t.matrixWorldInverse,E=0,p=0,d=0,f=0,m=0;for(Bt.shadowsPointLight=0,r=0,i=e.length;i>r;r++)if(n=e[r],a=n.color,o=n.intensity,s=n.distance,n instanceof THREE.AmbientLight)h+=a.r*o,c+=a.g*o,l+=a.b*o;else if(n instanceof THREE.DirectionalLight){var T=Zt.get(n);T.color.copy(n.color).multiplyScalar(n.intensity),T.direction.setFromMatrixPosition(n.matrixWorld),kt.setFromMatrixPosition(n.target.matrixWorld),T.direction.sub(kt),T.direction.transformDirection(u),T.shadow=n.castShadow,n.castShadow&&(T.shadowBias=n.shadow.bias,T.shadowRadius=n.shadow.radius,T.shadowMapSize=n.shadow.mapSize,Bt.shadows[m++]=n),Bt.directionalShadowMap[E]=n.shadow.map,Bt.directionalShadowMatrix[E]=n.shadow.matrix,Bt.directional[E++]=T}else if(n instanceof THREE.SpotLight){var T=Zt.get(n);T.position.setFromMatrixPosition(n.matrixWorld),T.position.applyMatrix4(u),T.color.copy(a).multiplyScalar(o),T.distance=s,T.direction.setFromMatrixPosition(n.matrixWorld),kt.setFromMatrixPosition(n.target.matrixWorld),T.direction.sub(kt),T.direction.transformDirection(u),T.angleCos=Math.cos(n.angle),T.exponent=n.exponent,T.decay=0===n.distance?0:n.decay,T.shadow=n.castShadow,n.castShadow&&(T.shadowBias=n.shadow.bias,T.shadowRadius=n.shadow.radius,T.shadowMapSize=n.shadow.mapSize,Bt.shadows[m++]=n),Bt.spotShadowMap[d]=n.shadow.map,Bt.spotShadowMatrix[d]=n.shadow.matrix,Bt.spot[d++]=T}else if(n instanceof THREE.PointLight){var T=Zt.get(n);T.position.setFromMatrixPosition(n.matrixWorld),T.position.applyMatrix4(u),T.color.copy(n.color).multiplyScalar(n.intensity),T.distance=n.distance,T.decay=0===n.distance?0:n.decay,T.shadow=n.castShadow,n.castShadow&&(T.shadowBias=n.shadow.bias,T.shadowRadius=n.shadow.radius,T.shadowMapSize=n.shadow.mapSize,Bt.shadows[m++]=n),Bt.pointShadowMap[p]=n.shadow.map,void 0===Bt.pointShadowMatrix[p]&&(Bt.pointShadowMatrix[p]=new THREE.Matrix4),kt.setFromMatrixPosition(n.matrixWorld).negate(),Bt.pointShadowMatrix[p].identity().setPosition(kt),Bt.point[p++]=T}else if(n instanceof THREE.HemisphereLight){var T=Zt.get(n);T.direction.setFromMatrixPosition(n.matrixWorld),T.direction.transformDirection(u),T.direction.normalize(),T.skyColor.copy(n.color).multiplyScalar(o),T.groundColor.copy(n.groundColor).multiplyScalar(o),Bt.hemi[f++]=T}Bt.ambient[0]=h,Bt.ambient[1]=c,Bt.ambient[2]=l,Bt.directional.length=E,Bt.spot.length=d,Bt.point.length=p,Bt.hemi.length=f,Bt.shadows.length=m,Bt.hash=E+","+p+","+d+","+f+","+m}function F(e,t,r){var i;if(r?(Nt.texParameteri(e,Nt.TEXTURE_WRAP_S,J(t.wrapS)),Nt.texParameteri(e,Nt.TEXTURE_WRAP_T,J(t.wrapT)),Nt.texParameteri(e,Nt.TEXTURE_MAG_FILTER,J(t.magFilter)),Nt.texParameteri(e,Nt.TEXTURE_MIN_FILTER,J(t.minFilter))):(Nt.texParameteri(e,Nt.TEXTURE_WRAP_S,Nt.CLAMP_TO_EDGE),Nt.texParameteri(e,Nt.TEXTURE_WRAP_T,Nt.CLAMP_TO_EDGE),(t.wrapS!==THREE.ClampToEdgeWrapping||t.wrapT!==THREE.ClampToEdgeWrapping)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",t),Nt.texParameteri(e,Nt.TEXTURE_MAG_FILTER,K(t.magFilter)),Nt.texParameteri(e,Nt.TEXTURE_MIN_FILTER,K(t.minFilter)),t.minFilter!==THREE.NearestFilter&&t.minFilter!==THREE.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",t)),i=zt.get("EXT_texture_filter_anisotropic")){if(t.type===THREE.FloatType&&null===zt.get("OES_texture_float_linear"))return;if(t.type===THREE.HalfFloatType&&null===zt.get("OES_texture_half_float_linear"))return;(t.anisotropy>1||Xt.get(t).__currentAnisotropy)&&(Nt.texParameterf(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,ft.getMaxAnisotropy())),Xt.get(t).__currentAnisotropy=t.anisotropy)}}function V(e,t,r){void 0===e.__webglInit&&(e.__webglInit=!0,t.addEventListener("dispose",o),e.__webglTexture=Nt.createTexture(),Ft.textures++),Wt.activeTexture(Nt.TEXTURE0+r),Wt.bindTexture(Nt.TEXTURE_2D,e.__webglTexture),Nt.pixelStorei(Nt.UNPACK_FLIP_Y_WEBGL,t.flipY),Nt.pixelStorei(Nt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),Nt.pixelStorei(Nt.UNPACK_ALIGNMENT,t.unpackAlignment);var i=N(t.image,jt.maxTextureSize);G(t)&&O(i)===!1&&(i=z(i));var n=O(i),a=J(t.format),s=J(t.type);F(Nt.TEXTURE_2D,t,n);var h,c=t.mipmaps;if(t instanceof THREE.DataTexture)if(c.length>0&&n){for(var l=0,u=c.length;u>l;l++)h=c[l],Wt.texImage2D(Nt.TEXTURE_2D,l,a,h.width,h.height,0,a,s,h.data);t.generateMipmaps=!1}else Wt.texImage2D(Nt.TEXTURE_2D,0,a,i.width,i.height,0,a,s,i.data);else if(t instanceof THREE.CompressedTexture)for(var l=0,u=c.length;u>l;l++)h=c[l],t.format!==THREE.RGBAFormat&&t.format!==THREE.RGBFormat?Wt.getCompressedTextureFormats().indexOf(a)>-1?Wt.compressedTexImage2D(Nt.TEXTURE_2D,l,a,h.width,h.height,0,h.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Wt.texImage2D(Nt.TEXTURE_2D,l,a,h.width,h.height,0,a,s,h.data);else if(c.length>0&&n){for(var l=0,u=c.length;u>l;l++)h=c[l],Wt.texImage2D(Nt.TEXTURE_2D,l,a,a,s,h);t.generateMipmaps=!1}else Wt.texImage2D(Nt.TEXTURE_2D,0,a,a,s,i);t.generateMipmaps&&n&&Nt.generateMipmap(Nt.TEXTURE_2D),e.__version=t.version,t.onUpdate&&t.onUpdate(t)}function N(e,t){if(e.width>t||e.height>t){var r=t/Math.max(e.width,e.height),i=document.createElement("canvas");i.width=Math.floor(e.width*r),i.height=Math.floor(e.height*r);var n=i.getContext("2d");return n.drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+i.width+"x"+i.height,e),i}return e}function O(e){return THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height)}function G(e){return e.wrapS!==THREE.ClampToEdgeWrapping||e.wrapT!==THREE.ClampToEdgeWrapping?!0:e.minFilter!==THREE.NearestFilter&&e.minFilter!==THREE.LinearFilter?!0:!1}function z(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){var t=document.createElement("canvas");t.width=THREE.Math.nearestPowerOfTwo(e.width),t.height=THREE.Math.nearestPowerOfTwo(e.height);var r=t.getContext("2d");return r.drawImage(e,0,0,t.width,t.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+t.width+"x"+t.height,e),t}return e}function j(e,t){var r=Xt.get(e);if(6===e.image.length)if(e.version>0&&r.__version!==e.version){r.__image__webglTextureCube||(e.addEventListener("dispose",o),r.__image__webglTextureCube=Nt.createTexture(),Ft.textures++),Wt.activeTexture(Nt.TEXTURE0+t),Wt.bindTexture(Nt.TEXTURE_CUBE_MAP,r.__image__webglTextureCube),Nt.pixelStorei(Nt.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var i=e instanceof THREE.CompressedTexture,n=e.image[0]instanceof THREE.DataTexture,a=[],s=0;6>s;s++)a[s]=!ft.autoScaleCubemaps||i||n?n?e.image[s].image:e.image[s]:N(e.image[s],jt.maxCubemapSize);var h=a[0],c=O(h),l=J(e.format),u=J(e.type);F(Nt.TEXTURE_CUBE_MAP,e,c);for(var s=0;6>s;s++)if(i)for(var E,p=a[s].mipmaps,d=0,f=p.length;f>d;d++)E=p[d],e.format!==THREE.RGBAFormat&&e.format!==THREE.RGBFormat?Wt.getCompressedTextureFormats().indexOf(l)>-1?Wt.compressedTexImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+s,d,l,E.width,E.height,0,E.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):Wt.texImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+s,d,l,E.width,E.height,0,l,u,E.data);else n?Wt.texImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,l,a[s].width,a[s].height,0,l,u,a[s].data):Wt.texImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,l,l,u,a[s]);e.generateMipmaps&&c&&Nt.generateMipmap(Nt.TEXTURE_CUBE_MAP),r.__version=e.version,e.onUpdate&&e.onUpdate(e)}else Wt.activeTexture(Nt.TEXTURE0+t),Wt.bindTexture(Nt.TEXTURE_CUBE_MAP,r.__image__webglTextureCube)}function W(e,t){Wt.activeTexture(Nt.TEXTURE0+t),Wt.bindTexture(Nt.TEXTURE_CUBE_MAP,Xt.get(e).__webglTexture)}function X(e,t,r,i){var n=J(t.texture.format),a=J(t.texture.type);Wt.texImage2D(i,0,n,t.width,t.height,0,n,a,null),Nt.bindFramebuffer(Nt.FRAMEBUFFER,e),Nt.framebufferTexture2D(Nt.FRAMEBUFFER,r,i,Xt.get(t.texture).__webglTexture,0),Nt.bindFramebuffer(Nt.FRAMEBUFFER,null)}function q(e,t){Nt.bindRenderbuffer(Nt.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Nt.renderbufferStorage(Nt.RENDERBUFFER,Nt.DEPTH_COMPONENT16,t.width,t.height),Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_ATTACHMENT,Nt.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Nt.renderbufferStorage(Nt.RENDERBUFFER,Nt.DEPTH_STENCIL,t.width,t.height),Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_STENCIL_ATTACHMENT,Nt.RENDERBUFFER,e)):Nt.renderbufferStorage(Nt.RENDERBUFFER,Nt.RGBA4,t.width,t.height),Nt.bindRenderbuffer(Nt.RENDERBUFFER,null)}function Y(e){var t=Xt.get(e),r=e instanceof THREE.WebGLRenderTargetCube;if(r){t.__webglDepthbuffer=[];for(var i=0;6>i;i++)Nt.bindFramebuffer(Nt.FRAMEBUFFER,t.__webglFramebuffer[i]),t.__webglDepthbuffer[i]=Nt.createRenderbuffer(),q(t.__webglDepthbuffer[i],e)}else Nt.bindFramebuffer(Nt.FRAMEBUFFER,t.__webglFramebuffer),t.__webglDepthbuffer=Nt.createRenderbuffer(),q(t.__webglDepthbuffer,e);Nt.bindFramebuffer(Nt.FRAMEBUFFER,null)}function Z(e){var t=Xt.get(e),r=Xt.get(e.texture);e.addEventListener("dispose",s),r.__webglTexture=Nt.createTexture(),Ft.textures++;var i=e instanceof THREE.WebGLRenderTargetCube,n=THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height);if(i){t.__webglFramebuffer=[];for(var a=0;6>a;a++)t.__webglFramebuffer[a]=Nt.createFramebuffer()}else t.__webglFramebuffer=Nt.createFramebuffer();if(i){Wt.bindTexture(Nt.TEXTURE_CUBE_MAP,r.__webglTexture),F(Nt.TEXTURE_CUBE_MAP,e.texture,n);for(var a=0;6>a;a++)X(t.__webglFramebuffer[a],e,Nt.COLOR_ATTACHMENT0,Nt.TEXTURE_CUBE_MAP_POSITIVE_X+a);e.texture.generateMipmaps&&n&&Nt.generateMipmap(Nt.TEXTURE_CUBE_MAP),Wt.bindTexture(Nt.TEXTURE_CUBE_MAP,null)}else Wt.bindTexture(Nt.TEXTURE_2D,r.__webglTexture),F(Nt.TEXTURE_2D,e.texture,n),X(t.__webglFramebuffer,e,Nt.COLOR_ATTACHMENT0,Nt.TEXTURE_2D),e.texture.generateMipmaps&&n&&Nt.generateMipmap(Nt.TEXTURE_2D),Wt.bindTexture(Nt.TEXTURE_2D,null);e.depthBuffer&&Y(e)}function Q(e){var t=e instanceof THREE.WebGLRenderTargetCube?Nt.TEXTURE_CUBE_MAP:Nt.TEXTURE_2D,r=Xt.get(e.texture).__webglTexture;Wt.bindTexture(t,r),Nt.generateMipmap(t),Wt.bindTexture(t,null)}function K(e){return e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter?Nt.NEAREST:Nt.LINEAR}function J(e){var t;if(e===THREE.RepeatWrapping)return Nt.REPEAT;if(e===THREE.ClampToEdgeWrapping)return Nt.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return Nt.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return Nt.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return Nt.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return Nt.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return Nt.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return Nt.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return Nt.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return Nt.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return Nt.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return Nt.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return Nt.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return Nt.BYTE;if(e===THREE.ShortType)return Nt.SHORT;if(e===THREE.UnsignedShortType)return Nt.UNSIGNED_SHORT;if(e===THREE.IntType)return Nt.INT;if(e===THREE.UnsignedIntType)return Nt.UNSIGNED_INT;if(e===THREE.FloatType)return Nt.FLOAT;if(t=zt.get("OES_texture_half_float"),null!==t&&e===THREE.HalfFloatType)return t.HALF_FLOAT_OES;if(e===THREE.AlphaFormat)return Nt.ALPHA;if(e===THREE.RGBFormat)return Nt.RGB;if(e===THREE.RGBAFormat)return Nt.RGBA;if(e===THREE.LuminanceFormat)return Nt.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return Nt.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return Nt.FUNC_ADD;if(e===THREE.SubtractEquation)return Nt.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return Nt.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return Nt.ZERO;if(e===THREE.OneFactor)return Nt.ONE;if(e===THREE.SrcColorFactor)return Nt.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return Nt.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return Nt.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return Nt.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return Nt.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return Nt.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return Nt.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return Nt.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return Nt.SRC_ALPHA_SATURATE;if(t=zt.get("WEBGL_compressed_texture_s3tc"),null!==t){if(e===THREE.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t=zt.get("WEBGL_compressed_texture_pvrtc"),null!==t){if(e===THREE.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===THREE.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===THREE.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===THREE.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t=zt.get("WEBGL_compressed_texture_etc1"),null!==t&&e===THREE.RGB_ETC1_Format)return t.COMPRESSED_RGB_ETC1_WEBGL;if(t=zt.get("EXT_blend_minmax"),null!==t){if(e===THREE.MinEquation)return t.MIN_EXT;if(e===THREE.MaxEquation)return t.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION),e=e||{};var $=void 0!==e.canvas?e.canvas:document.createElement("canvas"),et=void 0!==e.context?e.context:null,tt=void 0!==e.alpha?e.alpha:!1,rt=void 0!==e.depth?e.depth:!0,it=void 0!==e.stencil?e.stencil:!0,nt=void 0!==e.antialias?e.antialias:!1,at=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,ot=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,st=[],ht=[],ct=-1,lt=[],ut=-1,Et=new Float32Array(8),pt=[],dt=[];this.domElement=$,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0;var ft=this,mt=null,Tt=null,vt=null,gt=-1,yt="",Rt=null,Ht=new THREE.Vector4,xt=null,bt=new THREE.Vector4,Mt=0,_t=new THREE.Color(0),wt=0,St=$.width,Ct=$.height,Lt=1,At=new THREE.Vector4(0,0,St,Ct),Pt=!1,Dt=new THREE.Vector4(0,0,St,Ct),Ut=new THREE.Frustum,It=new THREE.Matrix4,kt=new THREE.Vector3,Bt={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[],shadowsPointLight:0},Ft={geometries:0,textures:0},Vt={calls:0,vertices:0,faces:0,points:0};this.info={render:Vt,memory:Ft,programs:null};var Nt;try{var Ot={alpha:tt,depth:rt,stencil:it,antialias:nt,premultipliedAlpha:at,preserveDrawingBuffer:ot};if(Nt=et||$.getContext("webgl",Ot)||$.getContext("experimental-webgl",Ot),null===Nt)throw null!==$.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";$.addEventListener("webglcontextlost",a,!1)}catch(Gt){console.error("THREE.WebGLRenderer: "+Gt)}var zt=new THREE.WebGLExtensions(Nt);zt.get("OES_texture_float"),zt.get("OES_texture_float_linear"),zt.get("OES_texture_half_float"),zt.get("OES_texture_half_float_linear"),zt.get("OES_standard_derivatives"),zt.get("ANGLE_instanced_arrays"),zt.get("OES_element_index_uint")&&(THREE.BufferGeometry.MaxIndex=4294967296);var jt=new THREE.WebGLCapabilities(Nt,zt,e),Wt=new THREE.WebGLState(Nt,zt,J),Xt=new THREE.WebGLProperties,qt=new THREE.WebGLObjects(Nt,Xt,this.info),Yt=new THREE.WebGLPrograms(this,jt),Zt=new THREE.WebGLLights;this.info.programs=Yt.programs;var Qt=new THREE.WebGLBufferRenderer(Nt,zt,Vt),Kt=new THREE.WebGLIndexedBufferRenderer(Nt,zt,Vt);i(),this.context=Nt,this.capabilities=jt,this.extensions=zt,this.properties=Xt,this.state=Wt;var Jt=new THREE.WebGLShadowMap(this,Bt,qt);this.shadowMap=Jt;var $t=new THREE.SpritePlugin(this,pt),er=new THREE.LensFlarePlugin(this,dt);this.getContext=function(){return Nt},this.getContextAttributes=function(){return Nt.getContextAttributes()},this.forceContextLoss=function(){zt.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){var e;return function(){if(void 0!==e)return e;var t=zt.get("EXT_texture_filter_anisotropic");return e=null!==t?Nt.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}(),this.getPrecision=function(){return jt.precision},this.getPixelRatio=function(){return Lt},this.setPixelRatio=function(e){void 0!==e&&(Lt=e,this.setSize(Dt.z,Dt.w,!1))},this.getSize=function(){return{width:St,height:Ct}},this.setSize=function(e,t,r){St=e,Ct=t,$.width=e*Lt,$.height=t*Lt,r!==!1&&($.style.width=e+"px",$.style.height=t+"px"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,r,i){Wt.viewport(Dt.set(e,t,r,i))},this.setScissor=function(e,t,r,i){Wt.scissor(At.set(e,t,r,i))},this.setScissorTest=function(e){Wt.setScissorTest(Pt=e)},this.getClearColor=function(){return _t},this.setClearColor=function(e,t){_t.set(e),wt=void 0!==t?t:1,r(_t.r,_t.g,_t.b,wt)},this.getClearAlpha=function(){return wt},this.setClearAlpha=function(e){wt=e,r(_t.r,_t.g,_t.b,wt)},this.clear=function(e,t,r){var i=0;(void 0===e||e)&&(i|=Nt.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=Nt.DEPTH_BUFFER_BIT),(void 0===r||r)&&(i|=Nt.STENCIL_BUFFER_BIT),Nt.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(e,t,r,i){this.setRenderTarget(e),this.clear(t,r,i)},this.resetGLState=n,this.dispose=function(){$.removeEventListener("webglcontextlost",a,!1)},this.renderBufferImmediate=function(e,t,r){Wt.initAttributes();var i=Xt.get(e);e.hasPositions&&!i.position&&(i.position=Nt.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=Nt.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=Nt.createBuffer()),e.hasColors&&!i.color&&(i.color=Nt.createBuffer());var n=t.getAttributes();if(e.hasPositions&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.position),Nt.bufferData(Nt.ARRAY_BUFFER,e.positionArray,Nt.DYNAMIC_DRAW),Wt.enableAttribute(n.position),Nt.vertexAttribPointer(n.position,3,Nt.FLOAT,!1,0,0)),e.hasNormals){if(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.normal),"MeshPhongMaterial"!==r.type&&"MeshStandardMaterial"!==r.type&&r.shading===THREE.FlatShading)for(var a=0,o=3*e.count;o>a;a+=9){var s=e.normalArray,h=(s[a+0]+s[a+3]+s[a+6])/3,c=(s[a+1]+s[a+4]+s[a+7])/3,l=(s[a+2]+s[a+5]+s[a+8])/3;s[a+0]=h,s[a+1]=c,s[a+2]=l,s[a+3]=h,s[a+4]=c,s[a+5]=l,s[a+6]=h,s[a+7]=c,s[a+8]=l}Nt.bufferData(Nt.ARRAY_BUFFER,e.normalArray,Nt.DYNAMIC_DRAW),Wt.enableAttribute(n.normal),Nt.vertexAttribPointer(n.normal,3,Nt.FLOAT,!1,0,0)}e.hasUvs&&r.map&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.uv),Nt.bufferData(Nt.ARRAY_BUFFER,e.uvArray,Nt.DYNAMIC_DRAW),Wt.enableAttribute(n.uv),Nt.vertexAttribPointer(n.uv,2,Nt.FLOAT,!1,0,0)),e.hasColors&&r.vertexColors!==THREE.NoColors&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.color),Nt.bufferData(Nt.ARRAY_BUFFER,e.colorArray,Nt.DYNAMIC_DRAW),Wt.enableAttribute(n.color),Nt.vertexAttribPointer(n.color,3,Nt.FLOAT,!1,0,0)),Wt.disableUnusedAttributes(),Nt.drawArrays(Nt.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,r,i,n,a,o){R(n);var s=x(e,r,n,a),h=!1,c=i.id+"_"+s.id+"_"+n.wireframe;c!==yt&&(yt=c,h=!0);var l=a.morphTargetInfluences;if(void 0!==l){for(var u=[],E=0,f=l.length;f>E;E++){var m=l[E];u.push([m,E])}u.sort(d),u.length>8&&(u.length=8);for(var T=i.morphAttributes,E=0,f=u.length;f>E;E++){var m=u[E];if(Et[E]=m[0],0!==m[0]){var v=m[1];n.morphTargets===!0&&T.position&&i.addAttribute("morphTarget"+E,T.position[v]),n.morphNormals===!0&&T.normal&&i.addAttribute("morphNormal"+E,T.normal[v])}else n.morphTargets===!0&&i.removeAttribute("morphTarget"+E),n.morphNormals===!0&&i.removeAttribute("morphNormal"+E)}var g=s.getUniforms();null!==g.morphTargetInfluences&&Nt.uniform1fv(g.morphTargetInfluences,Et),h=!0}var v=i.index,y=i.attributes.position;n.wireframe===!0&&(v=qt.getWireframeAttribute(i));var H;null!==v?(H=Kt,H.setIndex(v)):H=Qt,h&&(p(n,s,i),null!==v&&Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,qt.getAttributeBuffer(v)));var b=0,M=1/0;null!==v?M=v.count:void 0!==y&&(M=y.count);var _=i.drawRange.start,w=i.drawRange.count,S=null!==o?o.start:0,C=null!==o?o.count:1/0,L=Math.max(b,_,S),A=Math.min(b+M,_+w,S+C)-1,P=Math.max(0,A-L+1);if(a instanceof THREE.Mesh)if(n.wireframe===!0)Wt.setLineWidth(n.wireframeLinewidth*t()),H.setMode(Nt.LINES);else switch(a.drawMode){case THREE.TrianglesDrawMode:H.setMode(Nt.TRIANGLES);break;case THREE.TriangleStripDrawMode:H.setMode(Nt.TRIANGLE_STRIP);break;case THREE.TriangleFanDrawMode:H.setMode(Nt.TRIANGLE_FAN)}else if(a instanceof THREE.Line){var D=n.linewidth;void 0===D&&(D=1),Wt.setLineWidth(D*t()),H.setMode(a instanceof THREE.LineSegments?Nt.LINES:Nt.LINE_STRIP)}else a instanceof THREE.Points&&H.setMode(Nt.POINTS);i instanceof THREE.InstancedBufferGeometry&&i.maxInstancedCount>0?H.renderInstances(i,L,P):H.render(L,P)},this.render=function(e,t,r,i){if(t instanceof THREE.Camera==!1)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");var n=e.fog;if(yt="",gt=-1,Rt=null,e.autoUpdate===!0&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),It.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),Ut.setFromMatrix(It),st.length=0,ct=-1,ut=-1,pt.length=0,dt.length=0,v(e,t),ht.length=ct+1,lt.length=ut+1,ft.sortObjects===!0&&(ht.sort(f),lt.sort(m)),B(st,t),Jt.render(e,t),Vt.calls=0,Vt.vertices=0,Vt.faces=0,Vt.points=0,void 0===r&&(r=null),this.setRenderTarget(r),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),e.overrideMaterial){var a=e.overrideMaterial;g(ht,t,n,a),g(lt,t,n,a)}else Wt.setBlending(THREE.NoBlending),g(ht,t,n),g(lt,t,n);if($t.render(e,t),er.render(e,t,bt),r){var o=r.texture;o.generateMipmaps&&O(r)&&o.minFilter!==THREE.NearestFilter&&o.minFilter!==THREE.LinearFilter&&Q(r)}Wt.setDepthTest(!0),Wt.setDepthWrite(!0),Wt.setColorWrite(!0)},this.setFaceCulling=function(e,t){e===THREE.CullFaceNone?Wt.disable(Nt.CULL_FACE):(Nt.frontFace(t===THREE.FrontFaceDirectionCW?Nt.CW:Nt.CCW),Nt.cullFace(e===THREE.CullFaceBack?Nt.BACK:e===THREE.CullFaceFront?Nt.FRONT:Nt.FRONT_AND_BACK),Wt.enable(Nt.CULL_FACE))},this.setTexture=function(e,t){var r=Xt.get(e);if(e.version>0&&r.__version!==e.version){var i=e.image;return void 0===i?void console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",e):i.complete===!1?void console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",e):void V(r,e,t)}Wt.activeTexture(Nt.TEXTURE0+t),Wt.bindTexture(Nt.TEXTURE_2D,r.__webglTexture)},this.setRenderTarget=function(e){Tt=e,e&&void 0===Xt.get(e).__webglFramebuffer&&Z(e);var t,r=e instanceof THREE.WebGLRenderTargetCube;if(e){var i=Xt.get(e);t=r?i.__webglFramebuffer[e.activeCubeFace]:i.__webglFramebuffer,Ht.copy(e.scissor),xt=e.scissorTest,bt.copy(e.viewport)}else t=null,Ht.copy(At).multiplyScalar(Lt),xt=Pt,bt.copy(Dt).multiplyScalar(Lt);if(vt!==t&&(Nt.bindFramebuffer(Nt.FRAMEBUFFER,t),vt=t),Wt.scissor(Ht),Wt.setScissorTest(xt),Wt.viewport(bt),r){var n=Xt.get(e.texture);Nt.framebufferTexture2D(Nt.FRAMEBUFFER,Nt.COLOR_ATTACHMENT0,Nt.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,n.__webglTexture,0)}},this.readRenderTargetPixels=function(e,t,r,i,n,a){if(e instanceof THREE.WebGLRenderTarget==!1)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");
var o=Xt.get(e).__webglFramebuffer;if(o){var s=!1;o!==vt&&(Nt.bindFramebuffer(Nt.FRAMEBUFFER,o),s=!0);try{var h=e.texture;if(h.format!==THREE.RGBAFormat&&J(h.format)!==Nt.getParameter(Nt.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h.type===THREE.UnsignedByteType||J(h.type)===Nt.getParameter(Nt.IMPLEMENTATION_COLOR_READ_TYPE)||h.type===THREE.FloatType&&zt.get("WEBGL_color_buffer_float")||h.type===THREE.HalfFloatType&&zt.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Nt.checkFramebufferStatus(Nt.FRAMEBUFFER)===Nt.FRAMEBUFFER_COMPLETE?Nt.readPixels(t,r,i,n,J(h.format),J(h.type),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&Nt.bindFramebuffer(Nt.FRAMEBUFFER,vt)}}}},THREE.WebGLRenderTarget=function(e,t,r){this.uuid=THREE.Math.generateUUID(),this.width=e,this.height=t,this.scissor=new THREE.Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new THREE.Vector4(0,0,e,t),r=r||{},void 0===r.minFilter&&(r.minFilter=THREE.LinearFilter),this.texture=new THREE.Texture(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy),this.depthBuffer=void 0!==r.depthBuffer?r.depthBuffer:!0,this.stencilBuffer=void 0!==r.stencilBuffer?r.stencilBuffer:!0},THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(e,t){(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.shareDepthFrom=e.shareDepthFrom,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube=function(e,t,r){THREE.WebGLRenderTarget.call(this,e,t,r),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube,THREE.WebGLBufferRenderer=function(e,t,r){function i(e){o=e}function n(t,i){e.drawArrays(o,t,i),r.calls++,r.vertices+=i,o===e.TRIANGLES&&(r.faces+=i/3)}function a(i){var n=t.get("ANGLE_instanced_arrays");if(null===n)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");var a=i.attributes.position,s=0;a instanceof THREE.InterleavedBufferAttribute?(s=a.data.count,n.drawArraysInstancedANGLE(o,0,s,i.maxInstancedCount)):(s=a.count,n.drawArraysInstancedANGLE(o,0,s,i.maxInstancedCount)),r.calls++,r.vertices+=s*i.maxInstancedCount,o===e.TRIANGLES&&(r.faces+=i.maxInstancedCount*s/3)}var o;this.setMode=i,this.render=n,this.renderInstances=a},THREE.WebGLIndexedBufferRenderer=function(e,t,r){function i(e){s=e}function n(r){r.array instanceof Uint32Array&&t.get("OES_element_index_uint")?(h=e.UNSIGNED_INT,c=4):(h=e.UNSIGNED_SHORT,c=2)}function a(t,i){e.drawElements(s,i,h,t*c),r.calls++,r.vertices+=i,s===e.TRIANGLES&&(r.faces+=i/3)}function o(i,n,a){var o=t.get("ANGLE_instanced_arrays");return null===o?void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(o.drawElementsInstancedANGLE(s,a,h,n*c,i.maxInstancedCount),r.calls++,r.vertices+=a*i.maxInstancedCount,void(s===e.TRIANGLES&&(r.faces+=i.maxInstancedCount*a/3)))}var s,h,c;this.setMode=i,this.setIndex=n,this.render=a,this.renderInstances=o},THREE.WebGLExtensions=function(e){var t={};this.get=function(r){if(void 0!==t[r])return t[r];var i;switch(r){case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":i=e.getExtension("WEBGL_compressed_texture_etc1");break;default:i=e.getExtension(r)}return null===i&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=i,i}},THREE.WebGLCapabilities=function(e,t,r){function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}this.getMaxPrecision=i,this.precision=void 0!==r.precision?r.precision:"highp",this.logarithmicDepthBuffer=void 0!==r.logarithmicDepthBuffer?r.logarithmicDepthBuffer:!1,this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxVertexUniforms=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this.maxVaryings=e.getParameter(e.MAX_VARYING_VECTORS),this.maxFragmentUniforms=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),this.vertexTextures=this.maxVertexTextures>0,this.floatFragmentTextures=!!t.get("OES_texture_float"),this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;var n=i(this.precision);n!==this.precision&&(console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",n,"instead."),this.precision=n),this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!t.get("EXT_frag_depth"))},THREE.WebGLGeometries=function(e,t,r){function i(e){var t=e.geometry;if(void 0!==c[t.id])return c[t.id];t.addEventListener("dispose",n);var i;return t instanceof THREE.BufferGeometry?i=t:t instanceof THREE.Geometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new THREE.BufferGeometry).setFromObject(e)),i=t._bufferGeometry),c[t.id]=i,r.memory.geometries++,i}function n(e){var i=e.target,a=c[i.id];null!==a.index&&o(a.index),s(a.attributes),i.removeEventListener("dispose",n),delete c[i.id];var h=t.get(i);h.wireframe&&o(h.wireframe),t.delete(i);var l=t.get(a);l.wireframe&&o(l.wireframe),t.delete(a),r.memory.geometries--}function a(e){return e instanceof THREE.InterleavedBufferAttribute?t.get(e.data).__webglBuffer:t.get(e).__webglBuffer}function o(t){var r=a(t);void 0!==r&&(e.deleteBuffer(r),h(t))}function s(e){for(var t in e)o(e[t])}function h(e){t.delete(e instanceof THREE.InterleavedBufferAttribute?e.data:e)}var c={};this.get=i},THREE.WebGLLights=function(){var e={};this.get=function(t){if(void 0!==e[t.id])return e[t.id];var r;switch(t.type){case"DirectionalLight":r={direction:new THREE.Vector3,color:new THREE.Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case"SpotLight":r={position:new THREE.Vector3,direction:new THREE.Vector3,color:new THREE.Color,distance:0,angleCos:0,exponent:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case"PointLight":r={position:new THREE.Vector3,color:new THREE.Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new THREE.Vector2};break;case"HemisphereLight":r={direction:new THREE.Vector3,skyColor:new THREE.Color,groundColor:new THREE.Color}}return e[t.id]=r,r}},THREE.WebGLObjects=function(e,t,r){function i(t){var r=l.get(t);t.geometry instanceof THREE.Geometry&&r.updateFromObject(t);var i=r.index,a=r.attributes;null!==i&&n(i,e.ELEMENT_ARRAY_BUFFER);for(var o in a)n(a[o],e.ARRAY_BUFFER);var s=r.morphAttributes;for(var o in s)for(var h=s[o],c=0,u=h.length;u>c;c++)n(h[c],e.ARRAY_BUFFER);return r}function n(e,r){var i=e instanceof THREE.InterleavedBufferAttribute?e.data:e,n=t.get(i);void 0===n.__webglBuffer?a(n,i,r):n.version!==i.version&&o(n,i,r)}function a(t,r,i){t.__webglBuffer=e.createBuffer(),e.bindBuffer(i,t.__webglBuffer);var n=r.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW;e.bufferData(i,r.array,n),t.version=r.version}function o(t,r,i){e.bindBuffer(i,t.__webglBuffer),r.dynamic===!1||-1===r.updateRange.count?e.bufferSubData(i,0,r.array):0===r.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(i,r.updateRange.offset*r.array.BYTES_PER_ELEMENT,r.array.subarray(r.updateRange.offset,r.updateRange.offset+r.updateRange.count)),r.updateRange.count=0),t.version=r.version}function s(e){return e instanceof THREE.InterleavedBufferAttribute?t.get(e.data).__webglBuffer:t.get(e).__webglBuffer}function h(r){var i=t.get(r);if(void 0!==i.wireframe)return i.wireframe;var a=[],o=r.index,s=r.attributes,h=s.position;if(null!==o)for(var l={},u=o.array,E=0,p=u.length;p>E;E+=3){var d=u[E+0],f=u[E+1],m=u[E+2];c(l,d,f)&&a.push(d,f),c(l,f,m)&&a.push(f,m),c(l,m,d)&&a.push(m,d)}else for(var u=s.position.array,E=0,p=u.length/3-1;p>E;E+=3){var d=E+0,f=E+1,m=E+2;a.push(d,f,f,m,m,d)}var T=h.count>65535?Uint32Array:Uint16Array,v=new THREE.BufferAttribute(new T(a),1);return n(v,e.ELEMENT_ARRAY_BUFFER),i.wireframe=v,v}function c(e,t,r){if(t>r){var i=t;t=r,r=i}var n=e[t];return void 0===n?(e[t]=[r],!0):-1===n.indexOf(r)?(n.push(r),!0):!1}var l=new THREE.WebGLGeometries(e,t,r);this.getAttributeBuffer=s,this.getWireframeAttribute=h,this.update=i},THREE.WebGLProgram=function(){function e(e,t,r){e=e||{};var i=[e.derivatives||t.bumpMap||t.normalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""];return i.filter(n).join("\n")}function t(e){var t=[];for(var r in e){var i=e[r];i!==!1&&t.push("#define "+r+" "+i)}return t.join("\n")}function r(e,t){for(var r={},i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=0;i>n;n++){var a=e.getActiveUniform(t,n),o=a.name,s=e.getUniformLocation(t,o),u=h.exec(o);if(u){var E=u[1],p=u[2],d=r[E];d||(d=r[E]={}),d[p]=s}else if(u=c.exec(o)){var f=u[1],m=u[2],T=u[3],v=r[f];v||(v=r[f]=[]);var g=v[m];g||(g=v[m]={}),g[T]=s}else if(u=l.exec(o)){var f=u[1];r[f]=s}else r[o]=s}return r}function i(e,t){for(var r={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),n=0;i>n;n++){var a=e.getActiveAttrib(t,n),o=a.name;r[o]=e.getAttribLocation(t,o)}return r}function n(e){return""!==e}function a(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function o(e){function t(e,t,r,i){for(var n="",a=parseInt(t);a<parseInt(r);a++)n+=i.replace(/\[ i \]/g,"[ "+a+" ]");return n}var r=/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;return e.replace(r,t)}var s=0,h=/^([\w\d_]+)\.([\w\d_]+)$/,c=/^([\w\d_]+)\[(\d+)\]\.([\w\d_]+)$/,l=/^([\w\d_]+)\[0\]$/;return function(h,c,l,u){var E=h.context,p=l.extensions,d=l.defines,f=l.__webglShader.vertexShader,m=l.__webglShader.fragmentShader,T="SHADOWMAP_TYPE_BASIC";u.shadowMapType===THREE.PCFShadowMap?T="SHADOWMAP_TYPE_PCF":u.shadowMapType===THREE.PCFSoftShadowMap&&(T="SHADOWMAP_TYPE_PCF_SOFT");var v="ENVMAP_TYPE_CUBE",g="ENVMAP_MODE_REFLECTION",y="ENVMAP_BLENDING_MULTIPLY";if(u.envMap){switch(l.envMap.mapping){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:v="ENVMAP_TYPE_CUBE";break;case THREE.EquirectangularReflectionMapping:case THREE.EquirectangularRefractionMapping:v="ENVMAP_TYPE_EQUIREC";break;case THREE.SphericalReflectionMapping:v="ENVMAP_TYPE_SPHERE"}switch(l.envMap.mapping){case THREE.CubeRefractionMapping:case THREE.EquirectangularRefractionMapping:g="ENVMAP_MODE_REFRACTION"}switch(l.combine){case THREE.MultiplyOperation:y="ENVMAP_BLENDING_MULTIPLY";break;case THREE.MixOperation:y="ENVMAP_BLENDING_MIX";break;case THREE.AddOperation:y="ENVMAP_BLENDING_ADD"}}var R,H,x=h.gammaFactor>0?h.gammaFactor:1,b=e(p,u,h.extensions),M=t(d),_=E.createProgram();l instanceof THREE.RawShaderMaterial?(R="",H=""):(R=["precision "+u.precision+" float;","precision "+u.precision+" int;","#define SHADER_NAME "+l.__webglShader.name,M,u.supportsVertexTextures?"#define VERTEX_TEXTURES":"",h.gammaInput?"#define GAMMA_INPUT":"",h.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+x,"#define MAX_BONES "+u.maxBones,u.map?"#define USE_MAP":"",u.envMap?"#define USE_ENVMAP":"",u.envMap?"#define "+g:"",u.lightMap?"#define USE_LIGHTMAP":"",u.aoMap?"#define USE_AOMAP":"",u.emissiveMap?"#define USE_EMISSIVEMAP":"",u.bumpMap?"#define USE_BUMPMAP":"",u.normalMap?"#define USE_NORMALMAP":"",u.displacementMap&&u.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",u.specularMap?"#define USE_SPECULARMAP":"",u.roughnessMap?"#define USE_ROUGHNESSMAP":"",u.metalnessMap?"#define USE_METALNESSMAP":"",u.alphaMap?"#define USE_ALPHAMAP":"",u.vertexColors?"#define USE_COLOR":"",u.flatShading?"#define FLAT_SHADED":"",u.skinning?"#define USE_SKINNING":"",u.useVertexTexture?"#define BONE_TEXTURE":"",u.morphTargets?"#define USE_MORPHTARGETS":"",u.morphNormals&&u.flatShading===!1?"#define USE_MORPHNORMALS":"",u.doubleSided?"#define DOUBLE_SIDED":"",u.flipSided?"#define FLIP_SIDED":"",u.shadowMapEnabled?"#define USE_SHADOWMAP":"",u.shadowMapEnabled?"#define "+T:"",u.pointLightShadows>0?"#define POINT_LIGHT_SHADOWS":"",u.sizeAttenuation?"#define USE_SIZEATTENUATION":"",u.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",u.logarithmicDepthBuffer&&h.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif","\n"].filter(n).join("\n"),H=[b,"precision "+u.precision+" float;","precision "+u.precision+" int;","#define SHADER_NAME "+l.__webglShader.name,M,u.alphaTest?"#define ALPHATEST "+u.alphaTest:"",h.gammaInput?"#define GAMMA_INPUT":"",h.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+x,u.useFog&&u.fog?"#define USE_FOG":"",u.useFog&&u.fogExp?"#define FOG_EXP2":"",u.map?"#define USE_MAP":"",u.envMap?"#define USE_ENVMAP":"",u.envMap?"#define "+v:"",u.envMap?"#define "+g:"",u.envMap?"#define "+y:"",u.lightMap?"#define USE_LIGHTMAP":"",u.aoMap?"#define USE_AOMAP":"",u.emissiveMap?"#define USE_EMISSIVEMAP":"",u.bumpMap?"#define USE_BUMPMAP":"",u.normalMap?"#define USE_NORMALMAP":"",u.specularMap?"#define USE_SPECULARMAP":"",u.roughnessMap?"#define USE_ROUGHNESSMAP":"",u.metalnessMap?"#define USE_METALNESSMAP":"",u.alphaMap?"#define USE_ALPHAMAP":"",u.vertexColors?"#define USE_COLOR":"",u.flatShading?"#define FLAT_SHADED":"",u.doubleSided?"#define DOUBLE_SIDED":"",u.flipSided?"#define FLIP_SIDED":"",u.shadowMapEnabled?"#define USE_SHADOWMAP":"",u.shadowMapEnabled?"#define "+T:"",u.pointLightShadows>0?"#define POINT_LIGHT_SHADOWS":"",u.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",u.logarithmicDepthBuffer&&h.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",u.envMap&&h.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","\n"].filter(n).join("\n")),f=a(f,u),m=a(m,u),l instanceof THREE.ShaderMaterial==!1&&(f=o(f),m=o(m));var w=R+f,S=H+m,C=THREE.WebGLShader(E,E.VERTEX_SHADER,w),L=THREE.WebGLShader(E,E.FRAGMENT_SHADER,S);E.attachShader(_,C),E.attachShader(_,L),void 0!==l.index0AttributeName?E.bindAttribLocation(_,0,l.index0AttributeName):u.morphTargets===!0&&E.bindAttribLocation(_,0,"position"),E.linkProgram(_);var A=E.getProgramInfoLog(_),P=E.getShaderInfoLog(C),D=E.getShaderInfoLog(L),U=!0,I=!0;E.getProgramParameter(_,E.LINK_STATUS)===!1?(U=!1,console.error("THREE.WebGLProgram: shader error: ",E.getError(),"gl.VALIDATE_STATUS",E.getProgramParameter(_,E.VALIDATE_STATUS),"gl.getProgramInfoLog",A,P,D)):""!==A?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",A):(""===P||""===D)&&(I=!1),I&&(this.diagnostics={runnable:U,material:l,programLog:A,vertexShader:{log:P,prefix:R},fragmentShader:{log:D,prefix:H}}),E.deleteShader(C),E.deleteShader(L);var k;this.getUniforms=function(){return void 0===k&&(k=r(E,_)),k};var B;return this.getAttributes=function(){return void 0===B&&(B=i(E,_)),B},this.destroy=function(){E.deleteProgram(_),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=s++,this.code=c,this.usedTimes=1,this.program=_,this.vertexShader=C,this.fragmentShader=L,this}}(),THREE.WebGLPrograms=function(e,t){function r(e){if(t.floatVertexTextures&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var r=t.maxVertexUniforms,i=Math.floor((r-20)/4),n=i;return void 0!==e&&e instanceof THREE.SkinnedMesh&&(n=Math.min(e.skeleton.bones.length,n),n<e.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+n+" (try OpenGL instead of ANGLE)")),n}var i=[],n={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshStandardMaterial:"standard",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},a=["precision","supportsVertexTextures","map","envMap","envMapMode","lightMap","aoMap","emissiveMap","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","numDirLights","numPointLights","numSpotLights","numHemiLights","shadowMapEnabled","pointLightShadows","shadowMapType","alphaTest","doubleSided","flipSided"];this.getParameters=function(i,a,o,s){var h=n[i.type],c=r(s),l=e.getPrecision();null!==i.precision&&(l=t.getMaxPrecision(i.precision),l!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",l,"instead."));var u={shaderID:h,precision:l,supportsVertexTextures:t.vertexTextures,map:!!i.map,envMap:!!i.envMap,envMapMode:i.envMap&&i.envMap.mapping,lightMap:!!i.lightMap,aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,combine:i.combine,vertexColors:i.vertexColors,fog:o,useFog:i.fog,fogExp:o instanceof THREE.FogExp2,flatShading:i.shading===THREE.FlatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:t.logarithmicDepthBuffer,skinning:i.skinning,maxBones:c,useVertexTexture:t.floatVertexTextures&&s&&s.skeleton&&s.skeleton.useVertexTexture,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numHemiLights:a.hemi.length,pointLightShadows:a.shadowsPointLight,shadowMapEnabled:e.shadowMap.enabled&&s.receiveShadow&&a.shadows.length>0,shadowMapType:e.shadowMap.type,alphaTest:i.alphaTest,doubleSided:i.side===THREE.DoubleSide,flipSided:i.side===THREE.BackSide};return u},this.getProgramCode=function(e,t){var r=[];if(t.shaderID?r.push(t.shaderID):(r.push(e.fragmentShader),r.push(e.vertexShader)),void 0!==e.defines)for(var i in e.defines)r.push(i),r.push(e.defines[i]);for(var n=0;n<a.length;n++){var o=a[n];r.push(o),r.push(t[o])}return r.join()},this.acquireProgram=function(t,r,n){for(var a,o=0,s=i.length;s>o;o++){var h=i[o];if(h.code===n){a=h,++a.usedTimes;break}}return void 0===a&&(a=new THREE.WebGLProgram(e,n,t,r),i.push(a)),a},this.releaseProgram=function(e){if(0===--e.usedTimes){var t=i.indexOf(e);i[t]=i[i.length-1],i.pop(),e.destroy()}},this.programs=i},THREE.WebGLProperties=function(){var e={};this.get=function(t){var r=t.uuid,i=e[r];return void 0===i&&(i={},e[r]=i),i},this.delete=function(t){delete e[t.uuid]},this.clear=function(){e={}}},THREE.WebGLShader=function(){function e(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}return function(t,r,i){var n=t.createShader(r);return t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)===!1&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",r===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(n),e(i)),n}}(),THREE.WebGLShadowMap=function(e,t,r){function i(e,t,r,i){var n=e.geometry,a=null,o=f,s=e.customDepthMaterial;if(r&&(o=m,s=e.customDistanceMaterial),s)a=s;else{var h=void 0!==n.morphTargets&&n.morphTargets.length>0&&t.morphTargets,c=e instanceof THREE.SkinnedMesh&&t.skinning,l=0;h&&(l|=E),c&&(l|=p),a=o[l]}return a.visible=t.visible,a.wireframe=t.wireframe,a.wireframeLinewidth=t.wireframeLinewidth,r&&void 0!==a.uniforms.lightPos&&a.uniforms.lightPos.value.copy(i),a}function n(e,t,r){if(e.visible!==!1&&e.layers.test(t.layers)){if((e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.Points)&&e.castShadow&&(e.frustumCulled===!1||s.intersectsObject(e)===!0)){var i=e.material;i.visible===!0&&(e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),u.push(e))}for(var a=e.children,o=0,h=a.length;h>o;o++)n(a[o],t,r)}}for(var a=e.context,o=e.state,s=new THREE.Frustum,h=new THREE.Matrix4,c=new THREE.Vector3,l=new THREE.Vector3,u=[],E=1,p=2,d=(E|p)+1,f=new Array(d),m=new Array(d),T=[new THREE.Vector3(1,0,0),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,-1),new THREE.Vector3(0,1,0),new THREE.Vector3(0,-1,0)],v=[new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,-1)],g=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],y=THREE.ShaderLib.depthRGBA,R=THREE.UniformsUtils.clone(y.uniforms),H=THREE.ShaderLib.distanceRGBA,x=THREE.UniformsUtils.clone(H.uniforms),b=0;b!==d;++b){var M=0!==(b&E),_=0!==(b&p),w=new THREE.ShaderMaterial({uniforms:R,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,morphTargets:M,skinning:_});w._shadowPass=!0,f[b]=w;var S=new THREE.ShaderMaterial({uniforms:x,vertexShader:H.vertexShader,fragmentShader:H.fragmentShader,morphTargets:M,skinning:_});S._shadowPass=!0,m[b]=S}var C=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=THREE.PCFShadowMap,this.cullFace=THREE.CullFaceFront,this.render=function(E,p){var d,f;if(C.enabled!==!1&&(C.autoUpdate!==!1||C.needsUpdate!==!1)){o.clearColor(1,1,1,1),o.disable(a.BLEND),o.enable(a.CULL_FACE),a.frontFace(a.CCW),a.cullFace(C.cullFace===THREE.CullFaceFront?a.FRONT:a.BACK),o.setDepthTest(!0),o.setScissorTest(!1);for(var m=t.shadows,y=0,R=m.length;R>y;y++){var H=m[y],x=H.shadow,b=x.camera,M=x.mapSize;if(H instanceof THREE.PointLight){d=6,f=!0;var _=M.x/4,w=M.y/2;g[0].set(2*_,w,_,w),g[1].set(0,w,_,w),g[2].set(3*_,w,_,w),g[3].set(_,w,_,w),g[4].set(3*_,0,_,w),g[5].set(_,0,_,w)}else d=1,f=!1;if(null===x.map){var S={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};x.map=new THREE.WebGLRenderTarget(M.x,M.y,S),H instanceof THREE.SpotLight&&(b.aspect=M.x/M.y),b.updateProjectionMatrix()}var L=x.map,A=x.matrix;l.setFromMatrixPosition(H.matrixWorld),b.position.copy(l),e.setRenderTarget(L),e.clear();for(var P=0;d>P;P++){if(f){c.copy(b.position),c.add(T[P]),b.up.copy(v[P]),b.lookAt(c);var D=g[P];o.viewport(D)}else c.setFromMatrixPosition(H.target.matrixWorld),b.lookAt(c);b.updateMatrixWorld(),b.matrixWorldInverse.getInverse(b.matrixWorld),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(b.projectionMatrix),A.multiply(b.matrixWorldInverse),h.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),s.setFromMatrix(h),u.length=0,n(E,p,b);for(var U=0,I=u.length;I>U;U++){var k=u[U],B=r.update(k),F=k.material;if(F instanceof THREE.MultiMaterial)for(var V=B.groups,N=F.materials,O=0,G=V.length;G>O;O++){var z=V[O],j=N[z.materialIndex];if(j.visible===!0){var W=i(k,j,f,l);e.renderBufferDirect(b,null,B,W,k,z)}}else{var W=i(k,F,f,l);e.renderBufferDirect(b,null,B,W,k,null)}}}e.resetGLState()}var X=e.getClearColor(),q=e.getClearAlpha();e.setClearColor(X,q),o.enable(a.BLEND),C.cullFace===THREE.CullFaceFront&&a.cullFace(a.BACK),e.resetGLState(),C.needsUpdate=!1}}},THREE.WebGLState=function(e,t,r){var i=this,n=new THREE.Vector4,a=new Uint8Array(16),o=new Uint8Array(16),s=new Uint8Array(16),h={},c=null,l=null,u=null,E=null,p=null,d=null,f=null,m=null,T=null,v=null,g=null,y=null,R=null,H=null,x=null,b=null,M=null,_=null,w=null,S=null,C=null,L=null,A=null,P=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),D=void 0,U={},I=new THREE.Vector4,k=null,B=null,F=new THREE.Vector4,V=new THREE.Vector4;this.init=function(){this.clearColor(0,0,0,1),this.clearDepth(1),this.clearStencil(0),this.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.frontFace(e.CCW),e.cullFace(e.BACK),this.enable(e.CULL_FACE),this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)},this.initAttributes=function(){for(var e=0,t=a.length;t>e;e++)a[e]=0},this.enableAttribute=function(r){if(a[r]=1,0===o[r]&&(e.enableVertexAttribArray(r),o[r]=1),0!==s[r]){var i=t.get("ANGLE_instanced_arrays");i.vertexAttribDivisorANGLE(r,0),s[r]=0}},this.enableAttributeAndDivisor=function(t,r,i){a[t]=1,0===o[t]&&(e.enableVertexAttribArray(t),o[t]=1),s[t]!==r&&(i.vertexAttribDivisorANGLE(t,r),s[t]=r)},this.disableUnusedAttributes=function(){for(var t=0,r=o.length;r>t;t++)o[t]!==a[t]&&(e.disableVertexAttribArray(t),o[t]=0)},this.enable=function(t){h[t]!==!0&&(e.enable(t),h[t]=!0)},this.disable=function(t){h[t]!==!1&&(e.disable(t),h[t]=!1)},this.getCompressedTextureFormats=function(){if(null===c&&(c=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")))for(var r=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),i=0;i<r.length;i++)c.push(r[i]);return c},this.setBlending=function(t,i,n,a,o,s,h){t===THREE.NoBlending?this.disable(e.BLEND):this.enable(e.BLEND),t!==l&&(t===THREE.AdditiveBlending?(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):t===THREE.SubtractiveBlending?(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):t===THREE.MultiplyBlending?(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),l=t),t===THREE.CustomBlending?(o=o||i,s=s||n,h=h||a,(i!==u||o!==d)&&(e.blendEquationSeparate(r(i),r(o)),u=i,d=o),(n!==E||a!==p||s!==f||h!==m)&&(e.blendFuncSeparate(r(n),r(a),r(s),r(h)),E=n,p=a,f=s,m=h)):(u=null,E=null,p=null,d=null,f=null,m=null)},this.setDepthFunc=function(t){if(T!==t){if(t)switch(t){case THREE.NeverDepth:e.depthFunc(e.NEVER);break;case THREE.AlwaysDepth:e.depthFunc(e.ALWAYS);break;case THREE.LessDepth:e.depthFunc(e.LESS);break;case THREE.LessEqualDepth:e.depthFunc(e.LEQUAL);break;case THREE.EqualDepth:e.depthFunc(e.EQUAL);break;case THREE.GreaterEqualDepth:e.depthFunc(e.GEQUAL);break;case THREE.GreaterDepth:e.depthFunc(e.GREATER);break;case THREE.NotEqualDepth:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);T=t}},this.setDepthTest=function(t){t?this.enable(e.DEPTH_TEST):this.disable(e.DEPTH_TEST)},this.setDepthWrite=function(t){v!==t&&(e.depthMask(t),v=t)},this.setColorWrite=function(t){g!==t&&(e.colorMask(t,t,t,t),g=t)},this.setStencilFunc=function(t,r,i){(R!==t||H!==r||x!==i)&&(e.stencilFunc(t,r,i),R=t,H=r,x=i)},this.setStencilOp=function(t,r,i){(b!==t||M!==r||_!==i)&&(e.stencilOp(t,r,i),b=t,M=r,_=i)},this.setStencilTest=function(t){t?this.enable(e.STENCIL_TEST):this.disable(e.STENCIL_TEST)},this.setStencilWrite=function(t){y!==t&&(e.stencilMask(t),y=t)},this.setFlipSided=function(t){w!==t&&(e.frontFace(t?e.CW:e.CCW),w=t)},this.setLineWidth=function(t){t!==S&&(e.lineWidth(t),S=t)},this.setPolygonOffset=function(t,r,i){t?this.enable(e.POLYGON_OFFSET_FILL):this.disable(e.POLYGON_OFFSET_FILL),!t||C===r&&L===i||(e.polygonOffset(r,i),C=r,L=i)},this.getScissorTest=function(){return A},this.setScissorTest=function(t){A=t,t?this.enable(e.SCISSOR_TEST):this.disable(e.SCISSOR_TEST)},this.activeTexture=function(t){void 0===t&&(t=e.TEXTURE0+P-1),D!==t&&(e.activeTexture(t),D=t)},this.bindTexture=function(t,r){void 0===D&&i.activeTexture();var n=U[D];void 0===n&&(n={type:void 0,texture:void 0},U[D]=n),(n.type!==t||n.texture!==r)&&(e.bindTexture(t,r),n.type=t,n.texture=r)},this.compressedTexImage2D=function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error(t)}},this.texImage2D=function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error(t)}},this.clearColor=function(t,r,i,a){n.set(t,r,i,a),I.equals(n)===!1&&(e.clearColor(t,r,i,a),I.copy(n))},this.clearDepth=function(t){k!==t&&(e.clearDepth(t),k=t)},this.clearStencil=function(t){B!==t&&(e.clearStencil(t),B=t)},this.scissor=function(t){F.equals(t)===!1&&(e.scissor(t.x,t.y,t.z,t.w),F.copy(t))},this.viewport=function(t){V.equals(t)===!1&&(e.viewport(t.x,t.y,t.z,t.w),V.copy(t))},this.reset=function(){for(var t=0;t<o.length;t++)1===o[t]&&(e.disableVertexAttribArray(t),o[t]=0);h={},c=null,l=null,g=null,v=null,y=null,w=null}},THREE.LensFlarePlugin=function(e,t){function r(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),t=new Uint16Array([0,1,2,0,2,3]);n=E.createBuffer(),a=E.createBuffer(),E.bindBuffer(E.ARRAY_BUFFER,n),E.bufferData(E.ARRAY_BUFFER,e,E.STATIC_DRAW),E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,a),E.bufferData(E.ELEMENT_ARRAY_BUFFER,t,E.STATIC_DRAW),l=E.createTexture(),u=E.createTexture(),p.bindTexture(E.TEXTURE_2D,l),E.texImage2D(E.TEXTURE_2D,0,E.RGB,16,16,0,E.RGB,E.UNSIGNED_BYTE,null),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,E.NEAREST),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,E.NEAREST),p.bindTexture(E.TEXTURE_2D,u),E.texImage2D(E.TEXTURE_2D,0,E.RGBA,16,16,0,E.RGBA,E.UNSIGNED_BYTE,null),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,E.NEAREST),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,E.NEAREST),c=E.getParameter(E.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;
var r;r=c?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},o=i(r),s={vertex:E.getAttribLocation(o,"position"),uv:E.getAttribLocation(o,"uv")},h={renderType:E.getUniformLocation(o,"renderType"),map:E.getUniformLocation(o,"map"),occlusionMap:E.getUniformLocation(o,"occlusionMap"),opacity:E.getUniformLocation(o,"opacity"),color:E.getUniformLocation(o,"color"),scale:E.getUniformLocation(o,"scale"),rotation:E.getUniformLocation(o,"rotation"),screenPosition:E.getUniformLocation(o,"screenPosition")}}function i(t){var r=E.createProgram(),i=E.createShader(E.FRAGMENT_SHADER),n=E.createShader(E.VERTEX_SHADER),a="precision "+e.getPrecision()+" float;\n";return E.shaderSource(i,a+t.fragmentShader),E.shaderSource(n,a+t.vertexShader),E.compileShader(i),E.compileShader(n),E.attachShader(r,i),E.attachShader(r,n),E.linkProgram(r),r}var n,a,o,s,h,c,l,u,E=e.context,p=e.state;this.render=function(i,d,f){if(0!==t.length){var m=new THREE.Vector3,T=f.w/f.z,v=.5*f.z,g=.5*f.w,y=16/f.w,R=new THREE.Vector2(y*T,y),H=new THREE.Vector3(1,1,0),x=new THREE.Vector2(1,1);void 0===o&&r(),E.useProgram(o),p.initAttributes(),p.enableAttribute(s.vertex),p.enableAttribute(s.uv),p.disableUnusedAttributes(),E.uniform1i(h.occlusionMap,0),E.uniform1i(h.map,1),E.bindBuffer(E.ARRAY_BUFFER,n),E.vertexAttribPointer(s.vertex,2,E.FLOAT,!1,16,0),E.vertexAttribPointer(s.uv,2,E.FLOAT,!1,16,8),E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,a),p.disable(E.CULL_FACE),p.setDepthWrite(!1);for(var b=0,M=t.length;M>b;b++){y=16/f.w,R.set(y*T,y);var _=t[b];if(m.set(_.matrixWorld.elements[12],_.matrixWorld.elements[13],_.matrixWorld.elements[14]),m.applyMatrix4(d.matrixWorldInverse),m.applyProjection(d.projectionMatrix),H.copy(m),x.x=H.x*v+v,x.y=H.y*g+g,c||x.x>0&&x.x<f.z&&x.y>0&&x.y<f.w){p.activeTexture(E.TEXTURE0),p.bindTexture(E.TEXTURE_2D,null),p.activeTexture(E.TEXTURE1),p.bindTexture(E.TEXTURE_2D,l),E.copyTexImage2D(E.TEXTURE_2D,0,E.RGB,f.x+x.x-8,f.y+x.y-8,16,16,0),E.uniform1i(h.renderType,0),E.uniform2f(h.scale,R.x,R.y),E.uniform3f(h.screenPosition,H.x,H.y,H.z),p.disable(E.BLEND),p.enable(E.DEPTH_TEST),E.drawElements(E.TRIANGLES,6,E.UNSIGNED_SHORT,0),p.activeTexture(E.TEXTURE0),p.bindTexture(E.TEXTURE_2D,u),E.copyTexImage2D(E.TEXTURE_2D,0,E.RGBA,f.x+x.x-8,f.y+x.y-8,16,16,0),E.uniform1i(h.renderType,1),p.disable(E.DEPTH_TEST),p.activeTexture(E.TEXTURE1),p.bindTexture(E.TEXTURE_2D,l),E.drawElements(E.TRIANGLES,6,E.UNSIGNED_SHORT,0),_.positionScreen.copy(H),_.customUpdateCallback?_.customUpdateCallback(_):_.updateLensFlares(),E.uniform1i(h.renderType,2),p.enable(E.BLEND);for(var w=0,S=_.lensFlares.length;S>w;w++){var C=_.lensFlares[w];C.opacity>.001&&C.scale>.001&&(H.x=C.x,H.y=C.y,H.z=C.z,y=C.size*C.scale/f.w,R.x=y*T,R.y=y,E.uniform3f(h.screenPosition,H.x,H.y,H.z),E.uniform2f(h.scale,R.x,R.y),E.uniform1f(h.rotation,C.rotation),E.uniform1f(h.opacity,C.opacity),E.uniform3f(h.color,C.color.r,C.color.g,C.color.b),p.setBlending(C.blending,C.blendEquation,C.blendSrc,C.blendDst),e.setTexture(C.texture,1),E.drawElements(E.TRIANGLES,6,E.UNSIGNED_SHORT,0))}}}p.enable(E.CULL_FACE),p.enable(E.DEPTH_TEST),p.setDepthWrite(!0),e.resetGLState()}}},THREE.SpritePlugin=function(e,t){function r(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),t=new Uint16Array([0,1,2,0,2,3]);a=u.createBuffer(),o=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,a),u.bufferData(u.ARRAY_BUFFER,e,u.STATIC_DRAW),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,o),u.bufferData(u.ELEMENT_ARRAY_BUFFER,t,u.STATIC_DRAW),s=i(),h={position:u.getAttribLocation(s,"position"),uv:u.getAttribLocation(s,"uv")},c={uvOffset:u.getUniformLocation(s,"uvOffset"),uvScale:u.getUniformLocation(s,"uvScale"),rotation:u.getUniformLocation(s,"rotation"),scale:u.getUniformLocation(s,"scale"),color:u.getUniformLocation(s,"color"),map:u.getUniformLocation(s,"map"),opacity:u.getUniformLocation(s,"opacity"),modelViewMatrix:u.getUniformLocation(s,"modelViewMatrix"),projectionMatrix:u.getUniformLocation(s,"projectionMatrix"),fogType:u.getUniformLocation(s,"fogType"),fogDensity:u.getUniformLocation(s,"fogDensity"),fogNear:u.getUniformLocation(s,"fogNear"),fogFar:u.getUniformLocation(s,"fogFar"),fogColor:u.getUniformLocation(s,"fogColor"),alphaTest:u.getUniformLocation(s,"alphaTest")};var r=document.createElement("canvas");r.width=8,r.height=8;var n=r.getContext("2d");n.fillStyle="white",n.fillRect(0,0,8,8),l=new THREE.Texture(r),l.needsUpdate=!0}function i(){var t=u.createProgram(),r=u.createShader(u.VERTEX_SHADER),i=u.createShader(u.FRAGMENT_SHADER);return u.shaderSource(r,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),u.shaderSource(i,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),u.compileShader(r),u.compileShader(i),u.attachShader(t,r),u.attachShader(t,i),u.linkProgram(t),t}function n(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:t.id-e.id}var a,o,s,h,c,l,u=e.context,E=e.state,p=new THREE.Vector3,d=new THREE.Quaternion,f=new THREE.Vector3;this.render=function(i,m){if(0!==t.length){void 0===s&&r(),u.useProgram(s),E.initAttributes(),E.enableAttribute(h.position),E.enableAttribute(h.uv),E.disableUnusedAttributes(),E.disable(u.CULL_FACE),E.enable(u.BLEND),u.bindBuffer(u.ARRAY_BUFFER,a),u.vertexAttribPointer(h.position,2,u.FLOAT,!1,16,0),u.vertexAttribPointer(h.uv,2,u.FLOAT,!1,16,8),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,o),u.uniformMatrix4fv(c.projectionMatrix,!1,m.projectionMatrix.elements),E.activeTexture(u.TEXTURE0),u.uniform1i(c.map,0);var T=0,v=0,g=i.fog;g?(u.uniform3f(c.fogColor,g.color.r,g.color.g,g.color.b),g instanceof THREE.Fog?(u.uniform1f(c.fogNear,g.near),u.uniform1f(c.fogFar,g.far),u.uniform1i(c.fogType,1),T=1,v=1):g instanceof THREE.FogExp2&&(u.uniform1f(c.fogDensity,g.density),u.uniform1i(c.fogType,2),T=2,v=2)):(u.uniform1i(c.fogType,0),T=0,v=0);for(var y=0,R=t.length;R>y;y++){var H=t[y];H.modelViewMatrix.multiplyMatrices(m.matrixWorldInverse,H.matrixWorld),H.z=-H.modelViewMatrix.elements[14]}t.sort(n);for(var x=[],y=0,R=t.length;R>y;y++){var H=t[y],b=H.material;u.uniform1f(c.alphaTest,b.alphaTest),u.uniformMatrix4fv(c.modelViewMatrix,!1,H.modelViewMatrix.elements),H.matrixWorld.decompose(p,d,f),x[0]=f.x,x[1]=f.y;var M=0;i.fog&&b.fog&&(M=v),T!==M&&(u.uniform1i(c.fogType,M),T=M),null!==b.map?(u.uniform2f(c.uvOffset,b.map.offset.x,b.map.offset.y),u.uniform2f(c.uvScale,b.map.repeat.x,b.map.repeat.y)):(u.uniform2f(c.uvOffset,0,0),u.uniform2f(c.uvScale,1,1)),u.uniform1f(c.opacity,b.opacity),u.uniform3f(c.color,b.color.r,b.color.g,b.color.b),u.uniform1f(c.rotation,b.rotation),u.uniform2fv(c.scale,x),E.setBlending(b.blending,b.blendEquation,b.blendSrc,b.blendDst),E.setDepthTest(b.depthTest),E.setDepthWrite(b.depthWrite),b.map&&b.map.image&&b.map.image.width?e.setTexture(b.map,0):e.setTexture(l,0),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0)}E.enable(u.CULL_FACE),e.resetGLState()}}},Object.defineProperties(THREE.Box2.prototype,{empty:{value:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()}},isIntersectionBox:{value:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)}}}),Object.defineProperties(THREE.Box3.prototype,{empty:{value:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()}},isIntersectionBox:{value:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)}},isIntersectionSphere:{value:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}}),Object.defineProperties(THREE.Matrix3.prototype,{multiplyVector3:{value:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)}},multiplyVector3Array:{value:function(e){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)}}}),Object.defineProperties(THREE.Matrix4.prototype,{extractPosition:{value:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)}},setRotationFromQuaternion:{value:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)}},multiplyVector3:{value:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)}},multiplyVector4:{value:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)}},multiplyVector3Array:{value:function(e){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)}},rotateAxis:{value:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)}},crossVector:{value:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)}},translate:{value:function(){console.error("THREE.Matrix4: .translate() has been removed.")}},rotateX:{value:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")}},rotateY:{value:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")}},rotateZ:{value:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")}},rotateByAxis:{value:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")}}}),Object.defineProperties(THREE.Plane.prototype,{isIntersectionLine:{value:function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)}}}),Object.defineProperties(THREE.Quaternion.prototype,{multiplyVector3:{value:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)}}}),Object.defineProperties(THREE.Ray.prototype,{isIntersectionBox:{value:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)}},isIntersectionPlane:{value:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)}},isIntersectionSphere:{value:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}}),Object.defineProperties(THREE.Vector3.prototype,{setEulerFromRotationMatrix:{value:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")}},setEulerFromQuaternion:{value:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")}},getPositionFromMatrix:{value:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)}},getScaleFromMatrix:{value:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)}},getColumnFromMatrix:{value:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)}}}),THREE.Face4=function(e,t,r,i,n,a,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new THREE.Face3(e,t,r,n,a,o)},Object.defineProperties(THREE.Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},getChildByName:{value:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)}},renderDepth:{set:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")}},translate:{value:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(THREE,{PointCloud:{value:function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new THREE.Points(e,t)}},ParticleSystem:{value:function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new THREE.Points(e,t)}}}),Object.defineProperties(THREE.Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(THREE.BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length}}}),Object.defineProperties(THREE.BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}},addIndex:{value:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)}},addDrawCall:{value:function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)}},clearDrawCalls:{value:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()}},computeTangents:{value:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")}},computeOffsets:{value:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}}),Object.defineProperties(THREE.Material.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE."+this.type+": .wrapRGB has been removed."),new THREE.Color}}}),Object.defineProperties(THREE,{PointCloudMaterial:{value:function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new THREE.PointsMaterial(e)}},ParticleBasicMaterial:{value:function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new THREE.PointsMaterial(e)}},ParticleSystemMaterial:{value:function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new THREE.PointsMaterial(e)}}}),Object.defineProperties(THREE.MeshPhongMaterial.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(THREE.ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.defineProperties(THREE.WebGLRenderer.prototype,{supportsFloatTextures:{value:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")}},supportsHalfFloatTextures:{value:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")}},supportsStandardDerivatives:{value:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")}},supportsCompressedTextureS3TC:{value:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")}},supportsCompressedTexturePVRTC:{value:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")}},supportsBlendMinMax:{value:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")}},supportsVertexTextures:{value:function(){return this.capabilities.vertexTextures}},supportsInstancedArrays:{value:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")}},enableScissorTest:{value:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)}},initMaterial:{value:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")}},addPrePlugin:{value:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")}},addPostPlugin:{value:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")}},updateShadowMap:{value:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}},shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),this.shadowMap.cullFace=e}}}),Object.defineProperties(THREE.WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),THREE.GeometryUtils={merge:function(e,t,r){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var i;t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,t=t.geometry),e.merge(t,i,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,r,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var n=new THREE.TextureLoader;n.setCrossOrigin(this.crossOrigin);var a=n.load(e,r,void 0,i);return t&&(a.mapping=t),a},loadTextureCube:function(e,t,r,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var n=new THREE.CubeTextureLoader;n.setCrossOrigin(this.crossOrigin);var a=n.load(e,r,void 0,i);return t&&(a.mapping=t),a},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}},THREE.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},THREE.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},THREE.MeshFaceMaterial=THREE.MultiMaterial,THREE.CurveUtils={tangentQuadraticBezier:function(e,t,r,i){return 2*(1-e)*(r-t)+2*e*(i-r)},tangentCubicBezier:function(e,t,r,i,n){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*n},tangentSpline:function(e){var t=6*e*e-6*e,r=3*e*e-4*e+1,i=-6*e*e+6*e,n=3*e*e-2*e;return t+r+i+n},interpolate:function(e,t,r,i,n){var a=.5*(r-e),o=.5*(i-t),s=n*n,h=n*s;return(2*t-2*r+a+o)*h+(-3*t+3*r-2*a-o)*s+a*n+t}},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new THREE.Group,i=0,n=t.length;n>i;i++)r.add(new THREE.Mesh(e,t[i]));return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){var i=new THREE.Matrix4;i.getInverse(r.matrixWorld),e.applyMatrix(i),t.remove(e),r.add(e)}},THREE.ShapeUtils={area:function(e){for(var t=e.length,r=0,i=t-1,n=0;t>n;i=n++)r+=e[i].x*e[n].y-e[n].x*e[i].y;return.5*r},triangulate:function(){function e(e,t,r,i,n,a){var o,s,h,c,l,u,E,p,d;if(s=e[a[t]].x,h=e[a[t]].y,c=e[a[r]].x,l=e[a[r]].y,u=e[a[i]].x,E=e[a[i]].y,Number.EPSILON>(c-s)*(E-h)-(l-h)*(u-s))return!1;var f,m,T,v,g,y,R,H,x,b,M,_,w,S,C;for(f=u-c,m=E-l,T=s-u,v=h-E,g=c-s,y=l-h,o=0;n>o;o++)if(p=e[a[o]].x,d=e[a[o]].y,!(p===s&&d===h||p===c&&d===l||p===u&&d===E)&&(R=p-s,H=d-h,x=p-c,b=d-l,M=p-u,_=d-E,C=f*b-m*x,w=g*H-y*R,S=T*_-v*M,C>=-Number.EPSILON&&S>=-Number.EPSILON&&w>=-Number.EPSILON))return!1;return!0}return function(t,r){var i=t.length;if(3>i)return null;var n,a,o,s=[],h=[],c=[];if(THREE.ShapeUtils.area(t)>0)for(a=0;i>a;a++)h[a]=a;else for(a=0;i>a;a++)h[a]=i-1-a;var l=i,u=2*l;for(a=l-1;l>2;){if(u--<=0)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),r?c:s;if(n=a,n>=l&&(n=0),a=n+1,a>=l&&(a=0),o=a+1,o>=l&&(o=0),e(t,n,a,o,l,h)){var E,p,d,f,m;for(E=h[n],p=h[a],d=h[o],s.push([t[E],t[p],t[d]]),c.push([h[n],h[a],h[o]]),f=a,m=a+1;l>m;f++,m++)h[f]=h[m];l--,u=2*l}}return r?c:s}}(),triangulateShape:function(e,t){function r(e,t,r){return e.x!==t.x?e.x<t.x?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:e.y<t.y?e.y<=r.y&&r.y<=t.y:t.y<=r.y&&r.y<=e.y}function i(e,t,i,n,a){var o=t.x-e.x,s=t.y-e.y,h=n.x-i.x,c=n.y-i.y,l=e.x-i.x,u=e.y-i.y,E=s*h-o*c,p=s*l-o*u;
if(Math.abs(E)>Number.EPSILON){var d;if(E>0){if(0>p||p>E)return[];if(d=c*l-h*u,0>d||d>E)return[]}else{if(p>0||E>p)return[];if(d=c*l-h*u,d>0||E>d)return[]}if(0===d)return!a||0!==p&&p!==E?[e]:[];if(d===E)return!a||0!==p&&p!==E?[t]:[];if(0===p)return[i];if(p===E)return[n];var f=d/E;return[{x:e.x+f*o,y:e.y+f*s}]}if(0!==p||c*l!==h*u)return[];var m=0===o&&0===s,T=0===h&&0===c;if(m&&T)return e.x!==i.x||e.y!==i.y?[]:[e];if(m)return r(i,n,e)?[e]:[];if(T)return r(e,t,i)?[i]:[];var v,g,y,R,H,x,b,M;return 0!==o?(e.x<t.x?(v=e,y=e.x,g=t,R=t.x):(v=t,y=t.x,g=e,R=e.x),i.x<n.x?(H=i,b=i.x,x=n,M=n.x):(H=n,b=n.x,x=i,M=i.x)):(e.y<t.y?(v=e,y=e.y,g=t,R=t.y):(v=t,y=t.y,g=e,R=e.y),i.y<n.y?(H=i,b=i.y,x=n,M=n.y):(H=n,b=n.y,x=i,M=i.y)),b>=y?b>R?[]:R===b?a?[]:[H]:M>=R?[H,g]:[H,x]:y>M?[]:y===M?a?[]:[v]:M>=R?[v,g]:[v,x]}function n(e,t,r,i){var n=t.x-e.x,a=t.y-e.y,o=r.x-e.x,s=r.y-e.y,h=i.x-e.x,c=i.y-e.y,l=n*s-a*o,u=n*c-a*h;if(Math.abs(l)>Number.EPSILON){var E=h*s-c*o;return l>0?u>=0&&E>=0:u>=0||E>=0}return u>0}function a(e,t){function r(e,t){var r=v.length-1,i=e-1;0>i&&(i=r);var a=e+1;a>r&&(a=0);var o=n(v[e],v[i],v[a],s[t]);if(!o)return!1;var h=s.length-1,c=t-1;0>c&&(c=h);var l=t+1;return l>h&&(l=0),o=n(s[t],s[c],s[l],v[e]),o?!0:!1}function a(e,t){var r,n,a;for(r=0;r<v.length;r++)if(n=r+1,n%=v.length,a=i(e,t,v[r],v[n],!0),a.length>0)return!0;return!1}function o(e,r){var n,a,o,s,h;for(n=0;n<g.length;n++)for(a=t[g[n]],o=0;o<a.length;o++)if(s=o+1,s%=a.length,h=i(e,r,a[o],a[s],!0),h.length>0)return!0;return!1}for(var s,h,c,l,u,E,p,d,f,m,T,v=e.concat(),g=[],y=[],R=0,H=t.length;H>R;R++)g.push(R);for(var x=0,b=2*g.length;g.length>0;){if(b--,0>b){console.log("Infinite Loop! Holes left:"+g.length+", Probably Hole outside Shape!");break}for(c=x;c<v.length;c++){l=v[c],h=-1;for(var R=0;R<g.length;R++)if(E=g[R],p=l.x+":"+l.y+":"+E,void 0===y[p]){s=t[E];for(var M=0;M<s.length;M++)if(u=s[M],r(c,M)&&!a(l,u)&&!o(l,u)){h=M,g.splice(R,1),d=v.slice(0,c+1),f=v.slice(c),m=s.slice(h),T=s.slice(0,h+1),v=d.concat(m).concat(T).concat(f),x=c;break}if(h>=0)break;y[p]=!0}if(h>=0)break}}return v}for(var o,s,h,c,l,u,E={},p=e.concat(),d=0,f=t.length;f>d;d++)Array.prototype.push.apply(p,t[d]);for(o=0,s=p.length;s>o;o++)l=p[o].x+":"+p[o].y,void 0!==E[l]&&console.warn("THREE.Shape: Duplicate point",l),E[l]=o;var m=a(e,t),T=THREE.ShapeUtils.triangulate(m,!1);for(o=0,s=T.length;s>o;o++)for(c=T[o],h=0;3>h;h++)l=c[h].x+":"+c[h].y,u=E[l],void 0!==u&&(c[h]=u);return T.concat()},isClockWise:function(e){return THREE.ShapeUtils.area(e)<0},b2:function(){function e(e,t){var r=1-e;return r*r*t}function t(e,t){return 2*(1-e)*e*t}function r(e,t){return e*e*t}return function(i,n,a,o){return e(i,n)+t(i,a)+r(i,o)}}(),b3:function(){function e(e,t){var r=1-e;return r*r*r*t}function t(e,t){var r=1-e;return 3*r*r*e*t}function r(e,t){var r=1-e;return 3*r*e*e*t}function i(e,t){return e*e*e*t}return function(n,a,o,s,h){return e(n,a)+t(n,o)+r(n,s)+i(n,h)}}()},THREE.Curve=function(){},THREE.Curve.prototype={constructor:THREE.Curve,getPoint:function(){return console.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},getPointAt:function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},getPoints:function(e){e||(e=5);var t,r=[];for(t=0;e>=t;t++)r.push(this.getPoint(t/e));return r},getSpacedPoints:function(e){e||(e=5);var t,r=[];for(t=0;e>=t;t++)r.push(this.getPointAt(t/e));return r},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,i=[],n=this.getPoint(0),a=0;for(i.push(0),r=1;e>=r;r++)t=this.getPoint(r/e),a+=t.distanceTo(n),i.push(a),n=t;return this.cacheArcLengths=i,i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r,i=this.getLengths(),n=0,a=i.length;r=t?t:e*i[a-1];for(var o,s=0,h=a-1;h>=s;)if(n=Math.floor(s+(h-s)/2),o=i[n]-r,0>o)s=n+1;else{if(!(o>0)){h=n;break}h=n-1}if(n=h,i[n]===r){var c=n/(a-1);return c}var l=i[n],u=i[n+1],E=u-l,p=(r-l)/E,c=(n+p)/(a-1);return c},getTangent:function(e){var t=1e-4,r=e-t,i=e+t;0>r&&(r=0),i>1&&(i=1);var n=this.getPoint(r),a=this.getPoint(i),o=a.clone().sub(n);return o.normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)}},THREE.Curve.create=function(e,t){return e.prototype=Object.create(THREE.Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},THREE.CurvePath=function(){this.curves=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype),THREE.CurvePath.prototype.constructor=THREE.CurvePath,THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},THREE.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=t){var n=r[i]-t,a=this.curves[i],o=1-n/a.getLength();return a.getPointAt(o)}i++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,i=this.curves.length;i>r;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e},THREE.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e);return this.createGeometry(t)},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e);return this.createGeometry(t)},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,r=0,i=e.length;i>r;r++){var n=e[r];t.vertices.push(new THREE.Vector3(n.x,n.y,n.z||0))}return t},THREE.Font=function(e){this.data=e},THREE.Font.prototype={constructor:THREE.Font,generateShapes:function(e,t,r){function i(e){for(var r=String(e).split(""),i=t/a.resolution,o=0,s=[],h=0;h<r.length;h++){var c=n(r[h],i,o);o+=c.offset,s.push(c.path)}return s}function n(e,t,i){var n=a.glyphs[e]||a.glyphs["?"];if(n){var o,s,h,c,l,u,E,p,d,f,m,T=new THREE.Path,v=[],g=THREE.ShapeUtils.b2,y=THREE.ShapeUtils.b3;if(n.o)for(var R=n._cachedOutline||(n._cachedOutline=n.o.split(" ")),H=0,x=R.length;x>H;){var b=R[H++];switch(b){case"m":o=R[H++]*t+i,s=R[H++]*t,T.moveTo(o,s);break;case"l":o=R[H++]*t+i,s=R[H++]*t,T.lineTo(o,s);break;case"q":if(h=R[H++]*t+i,c=R[H++]*t,E=R[H++]*t+i,p=R[H++]*t,T.quadraticCurveTo(E,p,h,c),m=v[v.length-1]){l=m.x,u=m.y;for(var M=1;r>=M;M++){var _=M/r;g(_,l,E,h),g(_,u,p,c)}}break;case"b":if(h=R[H++]*t+i,c=R[H++]*t,E=R[H++]*t+i,p=R[H++]*t,d=R[H++]*t+i,f=R[H++]*t,T.bezierCurveTo(E,p,d,f,h,c),m=v[v.length-1]){l=m.x,u=m.y;for(var M=1;r>=M;M++){var _=M/r;y(_,l,E,d,h),y(_,u,p,f,c)}}}}return{offset:n.ha*t,path:T}}}void 0===t&&(t=100),void 0===r&&(r=4);for(var a=this.data,o=i(e),s=[],h=0,c=o.length;c>h;h++)Array.prototype.push.apply(s,o[h].toShapes());return s}},THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=Object.create(THREE.CurvePath.prototype),THREE.Path.prototype.constructor=THREE.Path,THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;r>t;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(e,t){this.actions.push({action:"moveTo",args:[e,t]})},THREE.Path.prototype.lineTo=function(e,t){var r=this.actions[this.actions.length-1].args,i=r[r.length-2],n=r[r.length-1],a=new THREE.LineCurve(new THREE.Vector2(i,n),new THREE.Vector2(e,t));this.curves.push(a),this.actions.push({action:"lineTo",args:[e,t]})},THREE.Path.prototype.quadraticCurveTo=function(e,t,r,i){var n=this.actions[this.actions.length-1].args,a=n[n.length-2],o=n[n.length-1],s=new THREE.QuadraticBezierCurve(new THREE.Vector2(a,o),new THREE.Vector2(e,t),new THREE.Vector2(r,i));this.curves.push(s),this.actions.push({action:"quadraticCurveTo",args:[e,t,r,i]})},THREE.Path.prototype.bezierCurveTo=function(e,t,r,i,n,a){var o=this.actions[this.actions.length-1].args,s=o[o.length-2],h=o[o.length-1],c=new THREE.CubicBezierCurve(new THREE.Vector2(s,h),new THREE.Vector2(e,t),new THREE.Vector2(r,i),new THREE.Vector2(n,a));this.curves.push(c),this.actions.push({action:"bezierCurveTo",args:[e,t,r,i,n,a]})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,i=r[r.length-2],n=r[r.length-1],a=[new THREE.Vector2(i,n)];Array.prototype.push.apply(a,e);var o=new THREE.SplineCurve(a);this.curves.push(o),this.actions.push({action:"splineThru",args:t})},THREE.Path.prototype.arc=function(e,t,r,i,n,a){var o=this.actions[this.actions.length-1].args,s=o[o.length-2],h=o[o.length-1];this.absarc(e+s,t+h,r,i,n,a)},THREE.Path.prototype.absarc=function(e,t,r,i,n,a){this.absellipse(e,t,r,r,i,n,a)},THREE.Path.prototype.ellipse=function(e,t,r,i,n,a,o,s){var h=this.actions[this.actions.length-1].args,c=h[h.length-2],l=h[h.length-1];this.absellipse(e+c,t+l,r,i,n,a,o,s)},THREE.Path.prototype.absellipse=function(e,t,r,i,n,a,o,s){var h=[e,t,r,i,n,a,o,s||0],c=new THREE.EllipseCurve(e,t,r,i,n,a,o,s);this.curves.push(c);var l=c.getPoint(1);h.push(l.x),h.push(l.y),this.actions.push({action:"ellipse",args:h})},THREE.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],r=0;e>r;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},THREE.Path.prototype.getPoints=function(e){e=e||12;for(var t,r,i,n,a,o,s,h,c,l,u,E=THREE.ShapeUtils.b2,p=THREE.ShapeUtils.b3,d=[],f=0,m=this.actions.length;m>f;f++){var T=this.actions[f],v=T.action,g=T.args;switch(v){case"moveTo":d.push(new THREE.Vector2(g[0],g[1]));break;case"lineTo":d.push(new THREE.Vector2(g[0],g[1]));break;case"quadraticCurveTo":t=g[2],r=g[3],a=g[0],o=g[1],d.length>0?(c=d[d.length-1],s=c.x,h=c.y):(c=this.actions[f-1].args,s=c[c.length-2],h=c[c.length-1]);for(var y=1;e>=y;y++){var R=y/e;l=E(R,s,a,t),u=E(R,h,o,r),d.push(new THREE.Vector2(l,u))}break;case"bezierCurveTo":t=g[4],r=g[5],a=g[0],o=g[1],i=g[2],n=g[3],d.length>0?(c=d[d.length-1],s=c.x,h=c.y):(c=this.actions[f-1].args,s=c[c.length-2],h=c[c.length-1]);for(var y=1;e>=y;y++){var R=y/e;l=p(R,s,a,i,t),u=p(R,h,o,n,r),d.push(new THREE.Vector2(l,u))}break;case"splineThru":c=this.actions[f-1].args;var H=new THREE.Vector2(c[c.length-2],c[c.length-1]),x=[H],b=e*g[0].length;x=x.concat(g[0]);for(var M=new THREE.SplineCurve(x),y=1;b>=y;y++)d.push(M.getPointAt(y/b));break;case"arc":for(var _,w=g[0],S=g[1],C=g[2],L=g[3],A=g[4],P=!!g[5],D=A-L,U=2*e,y=1;U>=y;y++){var R=y/U;P||(R=1-R),_=L+R*D,l=w+C*Math.cos(_),u=S+C*Math.sin(_),d.push(new THREE.Vector2(l,u))}break;case"ellipse":var _,I,k,w=g[0],S=g[1],B=g[2],F=g[3],L=g[4],A=g[5],P=!!g[6],V=g[7],D=A-L,U=2*e;0!==V&&(I=Math.cos(V),k=Math.sin(V));for(var y=1;U>=y;y++){var R=y/U;if(P||(R=1-R),_=L+R*D,l=w+B*Math.cos(_),u=S+F*Math.sin(_),0!==V){var N=l,O=u;l=(N-w)*I-(O-S)*k+w,u=(N-w)*k+(O-S)*I+S}d.push(new THREE.Vector2(l,u))}}}var G=d[d.length-1];return Math.abs(G.x-d[0].x)<Number.EPSILON&&Math.abs(G.y-d[0].y)<Number.EPSILON&&d.splice(d.length-1,1),this.autoClose&&d.push(d[0]),d},THREE.Path.prototype.toShapes=function(e,t){function r(e){for(var t=[],r=new THREE.Path,i=0,n=e.length;n>i;i++){var a=e[i],o=a.args,s=a.action;"moveTo"===s&&0!==r.actions.length&&(t.push(r),r=new THREE.Path),r[s].apply(r,o)}return 0!==r.actions.length&&t.push(r),t}function i(e){for(var t=[],r=0,i=e.length;i>r;r++){var n=e[r],a=new THREE.Shape;a.actions=n.actions,a.curves=n.curves,t.push(a)}return t}function n(e,t){for(var r=t.length,i=!1,n=r-1,a=0;r>a;n=a++){var o=t[n],s=t[a],h=s.x-o.x,c=s.y-o.y;if(Math.abs(c)>Number.EPSILON){if(0>c&&(o=t[a],h=-h,s=t[n],c=-c),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var l=c*(e.x-o.x)-h*(e.y-o.y);if(0===l)return!0;if(0>l)continue;i=!i}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return i}var a=THREE.ShapeUtils.isClockWise,o=r(this.actions);if(0===o.length)return[];if(t===!0)return i(o);var s,h,c,l=[];if(1===o.length)return h=o[0],c=new THREE.Shape,c.actions=h.actions,c.curves=h.curves,l.push(c),l;var u=!a(o[0].getPoints());u=e?!u:u;var E,p=[],d=[],f=[],m=0;d[m]=void 0,f[m]=[];for(var T=0,v=o.length;v>T;T++)h=o[T],E=h.getPoints(),s=a(E),s=e?!s:s,s?(!u&&d[m]&&m++,d[m]={s:new THREE.Shape,p:E},d[m].s.actions=h.actions,d[m].s.curves=h.curves,u&&m++,f[m]=[]):f[m].push({h:h,p:E[0]});if(!d[0])return i(o);if(d.length>1){for(var g=!1,y=[],R=0,H=d.length;H>R;R++)p[R]=[];for(var R=0,H=d.length;H>R;R++)for(var x=f[R],b=0;b<x.length;b++){for(var M=x[b],_=!0,w=0;w<d.length;w++)n(M.p,d[w].p)&&(R!==w&&y.push({froms:R,tos:w,hole:b}),_?(_=!1,p[w].push(M)):g=!0);_&&p[R].push(M)}y.length>0&&(g||(f=p))}for(var S,T=0,C=d.length;C>T;T++){c=d[T].s,l.push(c),S=f[T];for(var L=0,A=S.length;A>L;L++)c.holes.push(S[L].h)}return l},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.create(THREE.Path.prototype),THREE.Shape.prototype.constructor=THREE.Shape,THREE.Shape.prototype.extrude=function(e){return new THREE.ExtrudeGeometry(this,e)},THREE.Shape.prototype.makeGeometry=function(e){return new THREE.ShapeGeometry(this,e)},THREE.Shape.prototype.getPointsHoles=function(e){for(var t=[],r=0,i=this.holes.length;i>r;r++)t[r]=this.holes[r].getPoints(e);return t},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractPoints=function(e){return this.extractAllPoints(e)},THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.constructor=THREE.LineCurve,THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(){var e=this.v2.clone().sub(this.v1);return e.normalize()},THREE.QuadraticBezierCurve=function(e,t,r){this.v0=e,this.v1=t,this.v2=r},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve,THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t=THREE.ShapeUtils.b2;return new THREE.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y))},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t=THREE.CurveUtils.tangentQuadraticBezier;return new THREE.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y)).normalize()},THREE.CubicBezierCurve=function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve,THREE.CubicBezierCurve.prototype.getPoint=function(e){var t=THREE.ShapeUtils.b3;return new THREE.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y))},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t=THREE.CurveUtils.tangentCubicBezier;return new THREE.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y)).normalize()},THREE.SplineCurve=function(e){this.points=void 0==e?[]:e},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.constructor=THREE.SplineCurve,THREE.SplineCurve.prototype.getPoint=function(e){var t=this.points,r=(t.length-1)*e,i=Math.floor(r),n=r-i,a=t[0===i?i:i-1],o=t[i],s=t[i>t.length-2?t.length-1:i+1],h=t[i>t.length-3?t.length-1:i+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector2(c(a.x,o.x,s.x,h.x,n),c(a.y,o.y,s.y,h.y,n))},THREE.EllipseCurve=function(e,t,r,i,n,a,o,s){this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=a,this.aClockwise=o,this.aRotation=s||0},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve,THREE.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;0>t&&(t+=2*Math.PI),t>2*Math.PI&&(t-=2*Math.PI);var r;r=this.aClockwise===!0?this.aEndAngle+(1-e)*(2*Math.PI-t):this.aStartAngle+e*t;var i=this.aX+this.xRadius*Math.cos(r),n=this.aY+this.yRadius*Math.sin(r);if(0!==this.aRotation){var a=Math.cos(this.aRotation),o=Math.sin(this.aRotation),s=i,h=n;i=(s-this.aX)*a-(h-this.aY)*o+this.aX,n=(s-this.aX)*o+(h-this.aY)*a+this.aY}return new THREE.Vector2(i,n)},THREE.ArcCurve=function(e,t,r,i,n,a){THREE.EllipseCurve.call(this,e,t,r,r,i,n,a)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.ArcCurve.prototype.constructor=THREE.ArcCurve,THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,r){this.v0=e,this.v1=t,this.v2=r},function(e){var t=THREE.ShapeUtils.b2;return new THREE.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y),t(e,this.v0.z,this.v1.z,this.v2.z))}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},function(e){var t=THREE.ShapeUtils.b3;return new THREE.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z))}),THREE.SplineCurve3=THREE.Curve.create(function(e){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3"),this.points=void 0==e?[]:e},function(e){var t=this.points,r=(t.length-1)*e,i=Math.floor(r),n=r-i,a=t[0==i?i:i-1],o=t[i],s=t[i>t.length-2?t.length-1:i+1],h=t[i>t.length-3?t.length-1:i+2],c=THREE.CurveUtils.interpolate;return new THREE.Vector3(c(a.x,o.x,s.x,h.x,n),c(a.y,o.y,s.y,h.y,n),c(a.z,o.z,s.z,h.z,n))}),THREE.CatmullRomCurve3=function(){function e(){}var t=new THREE.Vector3,r=new e,i=new e,n=new e;return e.prototype.init=function(e,t,r,i){this.c0=e,this.c1=r,this.c2=-3*e+3*t-2*r-i,this.c3=2*e-2*t+r+i},e.prototype.initNonuniformCatmullRom=function(e,t,r,i,n,a,o){var s=(t-e)/n-(r-e)/(n+a)+(r-t)/a,h=(r-t)/a-(i-t)/(a+o)+(i-r)/o;s*=a,h*=a,this.init(t,r,s,h)},e.prototype.initCatmullRom=function(e,t,r,i,n){this.init(t,r,n*(r-e),n*(i-t))},e.prototype.calc=function(e){var t=e*e,r=t*e;return this.c0+this.c1*e+this.c2*t+this.c3*r},THREE.Curve.create(function(e){this.points=e||[],this.closed=!1},function(e){var a,o,s,h,c=this.points;h=c.length,2>h&&console.log("duh, you need at least 2 points"),a=(h-(this.closed?0:1))*e,o=Math.floor(a),s=a-o,this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/c.length)+1)*c.length:0===s&&o===h-1&&(o=h-2,s=1);var l,u,E,p;if(this.closed||o>0?l=c[(o-1)%h]:(t.subVectors(c[0],c[1]).add(c[0]),l=t),u=c[o%h],E=c[(o+1)%h],this.closed||h>o+2?p=c[(o+2)%h]:(t.subVectors(c[h-1],c[h-2]).add(c[h-1]),p=t),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var d="chordal"===this.type?.5:.25,f=Math.pow(l.distanceToSquared(u),d),m=Math.pow(u.distanceToSquared(E),d),T=Math.pow(E.distanceToSquared(p),d);1e-4>m&&(m=1),1e-4>f&&(f=m),1e-4>T&&(T=m),r.initNonuniformCatmullRom(l.x,u.x,E.x,p.x,f,m,T),i.initNonuniformCatmullRom(l.y,u.y,E.y,p.y,f,m,T),n.initNonuniformCatmullRom(l.z,u.z,E.z,p.z,f,m,T)}else if("catmullrom"===this.type){var v=void 0!==this.tension?this.tension:.5;r.initCatmullRom(l.x,u.x,E.x,p.x,v),i.initCatmullRom(l.y,u.y,E.y,p.y,v),n.initCatmullRom(l.z,u.z,E.z,p.z,v)}var g=new THREE.Vector3(r.calc(s),i.calc(s),n.calc(s));return g})}(),THREE.ClosedSplineCurve3=function(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Please use THREE.CatmullRomCurve3."),THREE.CatmullRomCurve3.call(this,e),this.type="catmullrom",this.closed=!0},THREE.ClosedSplineCurve3.prototype=Object.create(THREE.CatmullRomCurve3.prototype),THREE.BoxGeometry=function(e,t,r,i,n,a){function o(e,t,r,i,n,a,o,h){var c,l,u,E=s.widthSegments,p=s.heightSegments,d=n/2,f=a/2,m=s.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?c="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(c="y",p=s.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(c="x",E=s.depthSegments);var T=E+1,v=p+1,g=n/E,y=a/p,R=new THREE.Vector3;for(R[c]=o>0?1:-1,u=0;v>u;u++)for(l=0;T>l;l++){var H=new THREE.Vector3;H[e]=(l*g-d)*r,H[t]=(u*y-f)*i,H[c]=o,s.vertices.push(H)}for(u=0;p>u;u++)for(l=0;E>l;l++){var x=l+T*u,b=l+T*(u+1),M=l+1+T*(u+1),_=l+1+T*u,w=new THREE.Vector2(l/E,1-u/p),S=new THREE.Vector2(l/E,1-(u+1)/p),C=new THREE.Vector2((l+1)/E,1-(u+1)/p),L=new THREE.Vector2((l+1)/E,1-u/p),A=new THREE.Face3(x+m,b+m,_+m);A.normal.copy(R),A.vertexNormals.push(R.clone(),R.clone(),R.clone()),A.materialIndex=h,s.faces.push(A),s.faceVertexUvs[0].push([w,S,L]),A=new THREE.Face3(b+m,M+m,_+m),A.normal.copy(R),A.vertexNormals.push(R.clone(),R.clone(),R.clone()),A.materialIndex=h,s.faces.push(A),s.faceVertexUvs[0].push([S.clone(),C,L.clone()])}}THREE.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:a},this.widthSegments=i||1,this.heightSegments=n||1,this.depthSegments=a||1;var s=this,h=e/2,c=t/2,l=r/2;o("z","y",-1,-1,r,t,h,0),o("z","y",1,-1,r,t,-h,1),o("x","z",1,1,e,r,c,2),o("x","z",1,-1,e,r,-c,3),o("x","y",1,-1,e,t,l,4),o("x","y",-1,-1,e,t,-l,5),this.mergeVertices()},THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry,THREE.CubeGeometry=THREE.BoxGeometry,THREE.CircleGeometry=function(e,t,r,i){THREE.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},this.fromBufferGeometry(new THREE.CircleBufferGeometry(e,t,r,i))},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry,THREE.CircleBufferGeometry=function(e,t,r,i){THREE.BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},e=e||50,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI;var n=t+2,a=new Float32Array(3*n),o=new Float32Array(3*n),s=new Float32Array(2*n);o[2]=1,s[0]=.5,s[1]=.5;for(var h=0,c=3,l=2;t>=h;h++,c+=3,l+=2){var u=r+h/t*i;a[c]=e*Math.cos(u),a[c+1]=e*Math.sin(u),o[c+2]=1,s[l]=(a[c]/e+1)/2,s[l+1]=(a[c+1]/e+1)/2}for(var E=[],c=1;t>=c;c++)E.push(c,c+1,0);this.setIndex(new THREE.BufferAttribute(new Uint16Array(E),1)),this.addAttribute("position",new THREE.BufferAttribute(a,3)),this.addAttribute("normal",new THREE.BufferAttribute(o,3)),this.addAttribute("uv",new THREE.BufferAttribute(s,2)),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.CircleBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.CircleBufferGeometry.prototype.constructor=THREE.CircleBufferGeometry,THREE.CylinderGeometry=function(e,t,r,i,n,a,o,s){THREE.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:n,openEnded:a,thetaStart:o,thetaLength:s},e=void 0!==e?e:20,t=void 0!==t?t:20,r=void 0!==r?r:100,i=i||8,n=n||1,a=void 0!==a?a:!1,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI;var h,c,l=r/2,u=[],E=[];for(c=0;n>=c;c++){var p=[],d=[],f=c/n,m=f*(t-e)+e;for(h=0;i>=h;h++){var T=h/i,v=new THREE.Vector3;v.x=m*Math.sin(T*s+o),v.y=-f*r+l,v.z=m*Math.cos(T*s+o),this.vertices.push(v),p.push(this.vertices.length-1),d.push(new THREE.Vector2(T,1-f))}u.push(p),E.push(d)}var g,y,R=(t-e)/r;for(h=0;i>h;h++)for(0!==e?(g=this.vertices[u[0][h]].clone(),y=this.vertices[u[0][h+1]].clone()):(g=this.vertices[u[1][h]].clone(),y=this.vertices[u[1][h+1]].clone()),g.setY(Math.sqrt(g.x*g.x+g.z*g.z)*R).normalize(),y.setY(Math.sqrt(y.x*y.x+y.z*y.z)*R).normalize(),c=0;n>c;c++){var H=u[c][h],x=u[c+1][h],b=u[c+1][h+1],M=u[c][h+1],_=g.clone(),w=g.clone(),S=y.clone(),C=y.clone(),L=E[c][h].clone(),A=E[c+1][h].clone(),P=E[c+1][h+1].clone(),D=E[c][h+1].clone();this.faces.push(new THREE.Face3(H,x,M,[_,w,C])),this.faceVertexUvs[0].push([L,A,D]),this.faces.push(new THREE.Face3(x,b,M,[w.clone(),S,C.clone()])),this.faceVertexUvs[0].push([A.clone(),P,D.clone()])}if(a===!1&&e>0)for(this.vertices.push(new THREE.Vector3(0,l,0)),h=0;i>h;h++){var H=u[0][h],x=u[0][h+1],b=this.vertices.length-1,_=new THREE.Vector3(0,1,0),w=new THREE.Vector3(0,1,0),S=new THREE.Vector3(0,1,0),L=E[0][h].clone(),A=E[0][h+1].clone(),P=new THREE.Vector2(A.x,0);this.faces.push(new THREE.Face3(H,x,b,[_,w,S],void 0,1)),this.faceVertexUvs[0].push([L,A,P])}if(a===!1&&t>0)for(this.vertices.push(new THREE.Vector3(0,-l,0)),h=0;i>h;h++){var H=u[n][h+1],x=u[n][h],b=this.vertices.length-1,_=new THREE.Vector3(0,-1,0),w=new THREE.Vector3(0,-1,0),S=new THREE.Vector3(0,-1,0),L=E[n][h+1].clone(),A=E[n][h].clone(),P=new THREE.Vector2(A.x,1);this.faces.push(new THREE.Face3(H,x,b,[_,w,S],void 0,2)),this.faceVertexUvs[0].push([L,A,P])}this.computeFaceNormals()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry,THREE.EdgesGeometry=function(e,t){function r(e,t){return e-t}THREE.BufferGeometry.call(this),t=void 0!==t?t:1;var i,n=Math.cos(THREE.Math.degToRad(t)),a=[0,0],o={},s=["a","b","c"];e instanceof THREE.BufferGeometry?(i=new THREE.Geometry,i.fromBufferGeometry(e)):i=e.clone(),i.mergeVertices(),i.computeFaceNormals();for(var h=i.vertices,c=i.faces,l=0,u=c.length;u>l;l++)for(var E=c[l],p=0;3>p;p++){a[0]=E[s[p]],a[1]=E[s[(p+1)%3]],a.sort(r);var d=a.toString();void 0===o[d]?o[d]={vert1:a[0],vert2:a[1],face1:l,face2:void 0}:o[d].face2=l}var f=[];for(var d in o){var m=o[d];if(void 0===m.face2||c[m.face1].normal.dot(c[m.face2].normal)<=n){var T=h[m.vert1];f.push(T.x),f.push(T.y),f.push(T.z),T=h[m.vert2],f.push(T.x),f.push(T.y),f.push(T.z)}}this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(f),3))},THREE.EdgesGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.EdgesGeometry.prototype.constructor=THREE.EdgesGeometry,THREE.ExtrudeGeometry=function(e,t){return"undefined"==typeof e?void(e=[]):(THREE.Geometry.call(this),this.type="ExtrudeGeometry",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),void this.computeFaceNormals())},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry,THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var r=e.length,i=0;r>i;i++){var n=e[i];this.addShape(n,t)}},THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function r(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}function i(e,t,r){var i,n,a=1,o=e.x-t.x,s=e.y-t.y,h=r.x-e.x,c=r.y-e.y,l=o*o+s*s,u=o*c-s*h;if(Math.abs(u)>Number.EPSILON){var E=Math.sqrt(l),p=Math.sqrt(h*h+c*c),d=t.x-s/E,f=t.y+o/E,m=r.x-c/p,T=r.y+h/p,v=((m-d)*c-(T-f)*h)/(o*c-s*h);i=d+o*v-e.x,n=f+s*v-e.y;var g=i*i+n*n;if(2>=g)return new THREE.Vector2(i,n);a=Math.sqrt(g/2)}else{var y=!1;o>Number.EPSILON?h>Number.EPSILON&&(y=!0):o<-Number.EPSILON?h<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(c)&&(y=!0),y?(i=-s,n=o,a=Math.sqrt(l)):(i=o,n=s,a=Math.sqrt(l/2))}return new THREE.Vector2(i/a,n/a)}function n(){if(g){var e=0,t=G*e;for(W=0;z>W;W++)O=U[W],h(O[2]+t,O[1]+t,O[0]+t);for(e=R+2*v,t=G*e,W=0;z>W;W++)O=U[W],h(O[0]+t,O[1]+t,O[2]+t)}else{for(W=0;z>W;W++)O=U[W],h(O[2],O[1],O[0]);for(W=0;z>W;W++)O=U[W],h(O[0]+G*R,O[1]+G*R,O[2]+G*R)}}function a(){var e=0;for(o(I,e),e+=I.length,_=0,w=P.length;w>_;_++)M=P[_],o(M,e),e+=M.length}function o(e,t){var r,i;for(W=e.length;--W>=0;){r=W,i=W-1,0>i&&(i=e.length-1);var n=0,a=R+2*v;for(n=0;a>n;n++){var o=G*n,s=G*(n+1),h=t+r+o,l=t+i+o,u=t+i+s,E=t+r+s;c(h,l,u,E,e,n,a,r,i)}}}function s(e,t,r){S.vertices.push(new THREE.Vector3(e,t,r))}function h(e,t,r){e+=C,t+=C,r+=C,S.faces.push(new THREE.Face3(e,t,r,null,null,0));var i=b.generateTopUV(S,e,t,r);S.faceVertexUvs[0].push(i)}function c(e,t,r,i){e+=C,t+=C,r+=C,i+=C,S.faces.push(new THREE.Face3(e,t,i,null,null,1)),S.faces.push(new THREE.Face3(t,r,i,null,null,1));var n=b.generateSideWallUV(S,e,t,r,i);S.faceVertexUvs[0].push([n[0],n[1],n[3]]),S.faceVertexUvs[0].push([n[1],n[2],n[3]])}var l,u,E,p,d,f=void 0!==t.amount?t.amount:100,m=void 0!==t.bevelThickness?t.bevelThickness:6,T=void 0!==t.bevelSize?t.bevelSize:m-2,v=void 0!==t.bevelSegments?t.bevelSegments:3,g=void 0!==t.bevelEnabled?t.bevelEnabled:!0,y=void 0!==t.curveSegments?t.curveSegments:12,R=void 0!==t.steps?t.steps:1,H=t.extrudePath,x=!1,b=void 0!==t.UVGenerator?t.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;H&&(l=H.getSpacedPoints(R),x=!0,g=!1,u=void 0!==t.frames?t.frames:new THREE.TubeGeometry.FrenetFrames(H,R,!1),E=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Vector3),g||(v=0,m=0,T=0);var M,_,w,S=this,C=this.vertices.length,L=e.extractPoints(y),A=L.shape,P=L.holes,D=!THREE.ShapeUtils.isClockWise(A);if(D){for(A=A.reverse(),_=0,w=P.length;w>_;_++)M=P[_],THREE.ShapeUtils.isClockWise(M)&&(P[_]=M.reverse());D=!1}var U=THREE.ShapeUtils.triangulateShape(A,P),I=A;for(_=0,w=P.length;w>_;_++)M=P[_],A=A.concat(M);for(var k,B,F,V,N,O,G=A.length,z=U.length,j=[],W=0,X=I.length,q=X-1,Y=W+1;X>W;W++,q++,Y++)q===X&&(q=0),Y===X&&(Y=0),j[W]=i(I[W],I[q],I[Y]);var Z,Q=[],K=j.concat();for(_=0,w=P.length;w>_;_++){for(M=P[_],Z=[],W=0,X=M.length,q=X-1,Y=W+1;X>W;W++,q++,Y++)q===X&&(q=0),Y===X&&(Y=0),Z[W]=i(M[W],M[q],M[Y]);Q.push(Z),K=K.concat(Z)}for(k=0;v>k;k++){for(F=k/v,V=m*(1-F),B=T*Math.sin(F*Math.PI/2),W=0,X=I.length;X>W;W++)N=r(I[W],j[W],B),s(N.x,N.y,-V);for(_=0,w=P.length;w>_;_++)for(M=P[_],Z=Q[_],W=0,X=M.length;X>W;W++)N=r(M[W],Z[W],B),s(N.x,N.y,-V)}for(B=T,W=0;G>W;W++)N=g?r(A[W],K[W],B):A[W],x?(p.copy(u.normals[0]).multiplyScalar(N.x),E.copy(u.binormals[0]).multiplyScalar(N.y),d.copy(l[0]).add(p).add(E),s(d.x,d.y,d.z)):s(N.x,N.y,0);var J;for(J=1;R>=J;J++)for(W=0;G>W;W++)N=g?r(A[W],K[W],B):A[W],x?(p.copy(u.normals[J]).multiplyScalar(N.x),E.copy(u.binormals[J]).multiplyScalar(N.y),d.copy(l[J]).add(p).add(E),s(d.x,d.y,d.z)):s(N.x,N.y,f/R*J);for(k=v-1;k>=0;k--){for(F=k/v,V=m*(1-F),B=T*Math.sin(F*Math.PI/2),W=0,X=I.length;X>W;W++)N=r(I[W],j[W],B),s(N.x,N.y,f+V);for(_=0,w=P.length;w>_;_++)for(M=P[_],Z=Q[_],W=0,X=M.length;X>W;W++)N=r(M[W],Z[W],B),x?s(N.x,N.y+l[R-1].y,l[R-1].x+V):s(N.x,N.y,f+V)}n(),a()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,i){var n=e.vertices,a=n[t],o=n[r],s=n[i];return[new THREE.Vector2(a.x,a.y),new THREE.Vector2(o.x,o.y),new THREE.Vector2(s.x,s.y)]},generateSideWallUV:function(e,t,r,i,n){var a=e.vertices,o=a[t],s=a[r],h=a[i],c=a[n];return Math.abs(o.y-s.y)<.01?[new THREE.Vector2(o.x,1-o.z),new THREE.Vector2(s.x,1-s.z),new THREE.Vector2(h.x,1-h.z),new THREE.Vector2(c.x,1-c.z)]:[new THREE.Vector2(o.y,1-o.z),new THREE.Vector2(s.y,1-s.z),new THREE.Vector2(h.y,1-h.z),new THREE.Vector2(c.y,1-c.z)]}},THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this),this.type="ShapeGeometry",Array.isArray(e)===!1&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry,THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,i=e.length;i>r;r++)this.addShape(e[r],t);return this},THREE.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var r,i,n,a=void 0!==t.curveSegments?t.curveSegments:12,o=t.material,s=void 0===t.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,h=this.vertices.length,c=e.extractPoints(a),l=c.shape,u=c.holes,E=!THREE.ShapeUtils.isClockWise(l);if(E){for(l=l.reverse(),r=0,i=u.length;i>r;r++)n=u[r],THREE.ShapeUtils.isClockWise(n)&&(u[r]=n.reverse());E=!1}var p=THREE.ShapeUtils.triangulateShape(l,u);for(r=0,i=u.length;i>r;r++)n=u[r],l=l.concat(n);
var d,f,m=l.length,T=p.length;for(r=0;m>r;r++)d=l[r],this.vertices.push(new THREE.Vector3(d.x,d.y,0));for(r=0;T>r;r++){f=p[r];var v=f[0]+h,g=f[1]+h,y=f[2]+h;this.faces.push(new THREE.Face3(v,g,y,null,null,o)),this.faceVertexUvs[0].push(s.generateTopUV(this,v,g,y))}},THREE.LatheGeometry=function(e,t,r,i){THREE.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},t=t||12,r=r||0,i=i||2*Math.PI;for(var n=1/(e.length-1),a=1/t,o=0,s=t;s>=o;o++)for(var h=r+o*a*i,c=Math.sin(h),l=Math.cos(h),u=0,E=e.length;E>u;u++){var p=e[u],d=new THREE.Vector3;d.x=p.x*c,d.y=p.y,d.z=p.x*l,this.vertices.push(d)}for(var f=e.length,o=0,s=t;s>o;o++)for(var u=0,E=e.length-1;E>u;u++){var m=u+f*o,T=m,v=m+f,g=m+1+f,y=m+1,R=o*a,H=u*n,x=R+a,b=H+n;this.faces.push(new THREE.Face3(T,v,y)),this.faceVertexUvs[0].push([new THREE.Vector2(R,H),new THREE.Vector2(x,H),new THREE.Vector2(R,b)]),this.faces.push(new THREE.Face3(v,g,y)),this.faceVertexUvs[0].push([new THREE.Vector2(x,H),new THREE.Vector2(x,b),new THREE.Vector2(R,b)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry,THREE.PlaneGeometry=function(e,t,r,i){THREE.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i},this.fromBufferGeometry(new THREE.PlaneBufferGeometry(e,t,r,i))},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry,THREE.PlaneBufferGeometry=function(e,t,r,i){THREE.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};for(var n=e/2,a=t/2,o=Math.floor(r)||1,s=Math.floor(i)||1,h=o+1,c=s+1,l=e/o,u=t/s,E=new Float32Array(h*c*3),p=new Float32Array(h*c*3),d=new Float32Array(h*c*2),f=0,m=0,T=0;c>T;T++)for(var v=T*u-a,g=0;h>g;g++){var y=g*l-n;E[f]=y,E[f+1]=-v,p[f+2]=1,d[m]=g/o,d[m+1]=1-T/s,f+=3,m+=2}f=0;for(var R=new(E.length/3>65535?Uint32Array:Uint16Array)(o*s*6),T=0;s>T;T++)for(var g=0;o>g;g++){var H=g+h*T,x=g+h*(T+1),b=g+1+h*(T+1),M=g+1+h*T;R[f]=H,R[f+1]=x,R[f+2]=M,R[f+3]=x,R[f+4]=b,R[f+5]=M,f+=6}this.setIndex(new THREE.BufferAttribute(R,1)),this.addAttribute("position",new THREE.BufferAttribute(E,3)),this.addAttribute("normal",new THREE.BufferAttribute(p,3)),this.addAttribute("uv",new THREE.BufferAttribute(d,2))},THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry,THREE.RingGeometry=function(e,t,r,i,n,a){THREE.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:a},e=e||0,t=t||50,n=void 0!==n?n:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8,i=void 0!==i?Math.max(1,i):8;var o,s,h=[],c=e,l=(t-e)/i;for(o=0;i+1>o;o++){for(s=0;r+1>s;s++){var u=new THREE.Vector3,E=n+s/r*a;u.x=c*Math.cos(E),u.y=c*Math.sin(E),this.vertices.push(u),h.push(new THREE.Vector2((u.x/t+1)/2,(u.y/t+1)/2))}c+=l}var p=new THREE.Vector3(0,0,1);for(o=0;i>o;o++){var d=o*(r+1);for(s=0;r>s;s++){var E=s+d,f=E,m=E+r+1,T=E+r+2;this.faces.push(new THREE.Face3(f,m,T,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([h[f].clone(),h[m].clone(),h[T].clone()]),f=E,m=E+r+2,T=E+1,this.faces.push(new THREE.Face3(f,m,T,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([h[f].clone(),h[m].clone(),h[T].clone()])}}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)},THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.RingGeometry.prototype.constructor=THREE.RingGeometry,THREE.SphereGeometry=function(e,t,r,i,n,a,o){THREE.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new THREE.SphereBufferGeometry(e,t,r,i,n,a,o))},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry,THREE.SphereBufferGeometry=function(e,t,r,i,n,a,o){THREE.BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:a,thetaLength:o},e=e||50,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI,a=void 0!==a?a:0,o=void 0!==o?o:Math.PI;for(var s=a+o,h=(t+1)*(r+1),c=new THREE.BufferAttribute(new Float32Array(3*h),3),l=new THREE.BufferAttribute(new Float32Array(3*h),3),u=new THREE.BufferAttribute(new Float32Array(2*h),2),E=0,p=[],d=new THREE.Vector3,f=0;r>=f;f++){for(var m=[],T=f/r,v=0;t>=v;v++){var g=v/t,y=-e*Math.cos(i+g*n)*Math.sin(a+T*o),R=e*Math.cos(a+T*o),H=e*Math.sin(i+g*n)*Math.sin(a+T*o);d.set(y,R,H).normalize(),c.setXYZ(E,y,R,H),l.setXYZ(E,d.x,d.y,d.z),u.setXY(E,g,1-T),m.push(E),E++}p.push(m)}for(var x=[],f=0;r>f;f++)for(var v=0;t>v;v++){var b=p[f][v+1],M=p[f][v],_=p[f+1][v],w=p[f+1][v+1];(0!==f||a>0)&&x.push(b,M,w),(f!==r-1||s<Math.PI)&&x.push(M,_,w)}this.setIndex(new(c.count>65535?THREE.Uint32Attribute:THREE.Uint16Attribute)(x,1)),this.addAttribute("position",c),this.addAttribute("normal",l),this.addAttribute("uv",u),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.SphereBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry,THREE.TextGeometry=function(e,t){t=t||{};var r=t.font;if(r instanceof THREE.Font==!1)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new THREE.Geometry;var i=r.generateShapes(e,t.size,t.curveSegments);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),THREE.ExtrudeGeometry.call(this,i,t),this.type="TextGeometry"},THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype),THREE.TextGeometry.prototype.constructor=THREE.TextGeometry,THREE.TorusGeometry=function(e,t,r,i,n){THREE.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:n},e=e||100,t=t||40,r=r||8,i=i||6,n=n||2*Math.PI;for(var a=new THREE.Vector3,o=[],s=[],h=0;r>=h;h++)for(var c=0;i>=c;c++){var l=c/i*n,u=h/r*Math.PI*2;a.x=e*Math.cos(l),a.y=e*Math.sin(l);var E=new THREE.Vector3;E.x=(e+t*Math.cos(u))*Math.cos(l),E.y=(e+t*Math.cos(u))*Math.sin(l),E.z=t*Math.sin(u),this.vertices.push(E),o.push(new THREE.Vector2(c/i,h/r)),s.push(E.clone().sub(a).normalize())}for(var h=1;r>=h;h++)for(var c=1;i>=c;c++){var p=(i+1)*h+c-1,d=(i+1)*(h-1)+c-1,f=(i+1)*(h-1)+c,m=(i+1)*h+c,T=new THREE.Face3(p,d,m,[s[p].clone(),s[d].clone(),s[m].clone()]);this.faces.push(T),this.faceVertexUvs[0].push([o[p].clone(),o[d].clone(),o[m].clone()]),T=new THREE.Face3(d,f,m,[s[d].clone(),s[f].clone(),s[m].clone()]),this.faces.push(T),this.faceVertexUvs[0].push([o[d].clone(),o[f].clone(),o[m].clone()])}this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry,THREE.TorusKnotGeometry=function(e,t,r,i,n,a,o){function s(e,t,r,i,n){var a=Math.cos(e),o=Math.sin(e),s=t/r*e,h=Math.cos(s),c=i*(2+h)*.5*a,l=i*(2+h)*o*.5,u=n*i*Math.sin(s)*.5;return new THREE.Vector3(c,l,u)}THREE.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,p:n,q:a,heightScale:o},e=e||100,t=t||40,r=r||64,i=i||8,n=n||2,a=a||3,o=o||1;for(var h=new Array(r),c=new THREE.Vector3,l=new THREE.Vector3,u=new THREE.Vector3,E=0;r>E;++E){h[E]=new Array(i);var p=E/r*2*n*Math.PI,d=s(p,a,n,e,o),f=s(p+.01,a,n,e,o);c.subVectors(f,d),l.addVectors(f,d),u.crossVectors(c,l),l.crossVectors(u,c),u.normalize(),l.normalize();for(var m=0;i>m;++m){var T=m/i*2*Math.PI,v=-t*Math.cos(T),g=t*Math.sin(T),y=new THREE.Vector3;y.x=d.x+v*l.x+g*u.x,y.y=d.y+v*l.y+g*u.y,y.z=d.z+v*l.z+g*u.z,h[E][m]=this.vertices.push(y)-1}}for(var E=0;r>E;++E)for(var m=0;i>m;++m){var R=(E+1)%r,H=(m+1)%i,x=h[E][m],b=h[R][m],M=h[R][H],_=h[E][H],w=new THREE.Vector2(E/r,m/i),S=new THREE.Vector2((E+1)/r,m/i),C=new THREE.Vector2((E+1)/r,(m+1)/i),L=new THREE.Vector2(E/r,(m+1)/i);this.faces.push(new THREE.Face3(x,b,_)),this.faceVertexUvs[0].push([w,S,L]),this.faces.push(new THREE.Face3(b,M,_)),this.faceVertexUvs[0].push([S.clone(),C,L.clone()])}this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry,THREE.TubeGeometry=function(e,t,r,i,n,a){function o(e,t,r){return C.vertices.push(new THREE.Vector3(e,t,r))-1}THREE.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:t,radius:r,radialSegments:i,closed:n,taper:a},t=t||64,r=r||1,i=i||8,n=n||!1,a=a||THREE.TubeGeometry.NoTaper;var s,h,c,l,u,E,p,d,f,m,T,v,g,y,R,H,x,b,M,_,w,S=[],C=this,L=t+1,A=new THREE.Vector3,P=new THREE.TubeGeometry.FrenetFrames(e,t,n),D=P.tangents,U=P.normals,I=P.binormals;for(this.tangents=D,this.normals=U,this.binormals=I,m=0;L>m;m++)for(S[m]=[],l=m/(L-1),f=e.getPointAt(l),s=D[m],h=U[m],c=I[m],E=r*a(l),T=0;i>T;T++)u=T/i*2*Math.PI,p=-E*Math.cos(u),d=E*Math.sin(u),A.copy(f),A.x+=p*h.x+d*c.x,A.y+=p*h.y+d*c.y,A.z+=p*h.z+d*c.z,S[m][T]=o(A.x,A.y,A.z);for(m=0;t>m;m++)for(T=0;i>T;T++)v=n?(m+1)%t:m+1,g=(T+1)%i,y=S[m][T],R=S[v][T],H=S[v][g],x=S[m][g],b=new THREE.Vector2(m/t,T/i),M=new THREE.Vector2((m+1)/t,T/i),_=new THREE.Vector2((m+1)/t,(T+1)/i),w=new THREE.Vector2(m/t,(T+1)/i),this.faces.push(new THREE.Face3(y,R,x)),this.faceVertexUvs[0].push([b,M,w]),this.faces.push(new THREE.Face3(R,H,x)),this.faceVertexUvs[0].push([M.clone(),_,w.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry,THREE.TubeGeometry.NoTaper=function(){return 1},THREE.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)},THREE.TubeGeometry.FrenetFrames=function(e,t,r){function i(){p[0]=new THREE.Vector3,d[0]=new THREE.Vector3,a=Number.MAX_VALUE,o=Math.abs(E[0].x),s=Math.abs(E[0].y),h=Math.abs(E[0].z),a>=o&&(a=o,u.set(1,0,0)),a>=s&&(a=s,u.set(0,1,0)),a>=h&&u.set(0,0,1),f.crossVectors(E[0],u).normalize(),p[0].crossVectors(E[0],f),d[0].crossVectors(E[0],p[0])}var n,a,o,s,h,c,l,u=new THREE.Vector3,E=[],p=[],d=[],f=new THREE.Vector3,m=new THREE.Matrix4,T=t+1;for(this.tangents=E,this.normals=p,this.binormals=d,c=0;T>c;c++)l=c/(T-1),E[c]=e.getTangentAt(l),E[c].normalize();for(i(),c=1;T>c;c++)p[c]=p[c-1].clone(),d[c]=d[c-1].clone(),f.crossVectors(E[c-1],E[c]),f.length()>Number.EPSILON&&(f.normalize(),n=Math.acos(THREE.Math.clamp(E[c-1].dot(E[c]),-1,1)),p[c].applyMatrix4(m.makeRotationAxis(f,n))),d[c].crossVectors(E[c],p[c]);if(r)for(n=Math.acos(THREE.Math.clamp(p[0].dot(p[T-1]),-1,1)),n/=T-1,E[0].dot(f.crossVectors(p[0],p[T-1]))>0&&(n=-n),c=1;T>c;c++)p[c].applyMatrix4(m.makeRotationAxis(E[c],n*c)),d[c].crossVectors(E[c],p[c])},THREE.PolyhedronGeometry=function(e,t,r,i){function n(e){var t=e.normalize().clone();t.index=l.vertices.push(t)-1;var r=s(e)/2/Math.PI+.5,i=h(e)/Math.PI+.5;return t.uv=new THREE.Vector2(r,1-i),t}function a(e,t,r,i){var n=new THREE.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()],void 0,i);l.faces.push(n),g.copy(e).add(t).add(r).divideScalar(3);var a=s(g);l.faceVertexUvs[0].push([c(e.uv,e,a),c(t.uv,t,a),c(r.uv,r,a)])}function o(e,t){for(var r=Math.pow(2,t),i=n(l.vertices[e.a]),o=n(l.vertices[e.b]),s=n(l.vertices[e.c]),h=[],c=e.materialIndex,u=0;r>=u;u++){h[u]=[];for(var E=n(i.clone().lerp(s,u/r)),p=n(o.clone().lerp(s,u/r)),d=r-u,f=0;d>=f;f++)h[u][f]=0===f&&u===r?E:n(E.clone().lerp(p,f/d))}for(var u=0;r>u;u++)for(var f=0;2*(r-u)-1>f;f++){var m=Math.floor(f/2);f%2===0?a(h[u][m+1],h[u+1][m],h[u][m],c):a(h[u][m+1],h[u+1][m+1],h[u+1][m],c)}}function s(e){return Math.atan2(e.z,-e.x)}function h(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function c(e,t,r){return 0>r&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(r/2/Math.PI+.5,e.y)),e.clone()}THREE.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i},r=r||1,i=i||0;for(var l=this,u=0,E=e.length;E>u;u+=3)n(new THREE.Vector3(e[u],e[u+1],e[u+2]));for(var p=this.vertices,d=[],u=0,f=0,E=t.length;E>u;u+=3,f++){var m=p[t[u]],T=p[t[u+1]],v=p[t[u+2]];d[f]=new THREE.Face3(m.index,T.index,v.index,[m.clone(),T.clone(),v.clone()],void 0,f)}for(var g=new THREE.Vector3,u=0,E=d.length;E>u;u++)o(d[u],i);for(var u=0,E=this.faceVertexUvs[0].length;E>u;u++){var y=this.faceVertexUvs[0][u],R=y[0].x,H=y[1].x,x=y[2].x,b=Math.max(R,H,x),M=Math.min(R,H,x);b>.9&&.1>M&&(.2>R&&(y[0].x+=1),.2>H&&(y[1].x+=1),.2>x&&(y[2].x+=1))}for(var u=0,E=this.vertices.length;E>u;u++)this.vertices[u].multiplyScalar(r);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,r)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry,THREE.DodecahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2,i=1/r,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];THREE.PolyhedronGeometry.call(this,n,a,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}},THREE.DodecahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype),THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry,THREE.IcosahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];THREE.PolyhedronGeometry.call(this,i,n,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}},THREE.IcosahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype),THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry,THREE.OctahedronGeometry=function(e,t){var r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];THREE.PolyhedronGeometry.call(this,r,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},THREE.OctahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype),THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry,THREE.TetrahedronGeometry=function(e,t){var r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];THREE.PolyhedronGeometry.call(this,r,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}},THREE.TetrahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype),THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry,THREE.ParametricGeometry=function(e,t,r){THREE.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r};var i,n,a,o,s,h=this.vertices,c=this.faces,l=this.faceVertexUvs[0],u=t+1;for(i=0;r>=i;i++)for(s=i/r,n=0;t>=n;n++)o=n/t,a=e(o,s),h.push(a);var E,p,d,f,m,T,v,g;for(i=0;r>i;i++)for(n=0;t>n;n++)E=i*u+n,p=i*u+n+1,d=(i+1)*u+n+1,f=(i+1)*u+n,m=new THREE.Vector2(n/t,i/r),T=new THREE.Vector2((n+1)/t,i/r),v=new THREE.Vector2((n+1)/t,(i+1)/r),g=new THREE.Vector2(n/t,(i+1)/r),c.push(new THREE.Face3(E,p,f)),l.push([m,T,g]),c.push(new THREE.Face3(p,d,f)),l.push([T.clone(),v,g.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry,THREE.WireframeGeometry=function(e){function t(e,t){return e-t}THREE.BufferGeometry.call(this);var r=[0,0],i={},n=["a","b","c"];if(e instanceof THREE.Geometry){for(var a=e.vertices,o=e.faces,s=0,h=new Uint32Array(6*o.length),c=0,l=o.length;l>c;c++)for(var u=o[c],E=0;3>E;E++){r[0]=u[n[E]],r[1]=u[n[(E+1)%3]],r.sort(t);var p=r.toString();void 0===i[p]&&(h[2*s]=r[0],h[2*s+1]=r[1],i[p]=!0,s++)}for(var d=new Float32Array(2*s*3),c=0,l=s;l>c;c++)for(var E=0;2>E;E++){var f=a[h[2*c+E]],m=6*c+3*E;d[m+0]=f.x,d[m+1]=f.y,d[m+2]=f.z}this.addAttribute("position",new THREE.BufferAttribute(d,3))}else if(e instanceof THREE.BufferGeometry)if(null!==e.index){var T=e.index.array,a=e.attributes.position,v=e.groups,s=0;0===v.length&&e.addGroup(0,T.length);for(var h=new Uint32Array(2*T.length),g=0,y=v.length;y>g;++g)for(var R=v[g],H=R.start,x=R.count,c=H,b=H+x;b>c;c+=3)for(var E=0;3>E;E++){r[0]=T[c+E],r[1]=T[c+(E+1)%3],r.sort(t);var p=r.toString();void 0===i[p]&&(h[2*s]=r[0],h[2*s+1]=r[1],i[p]=!0,s++)}for(var d=new Float32Array(2*s*3),c=0,l=s;l>c;c++)for(var E=0;2>E;E++){var m=6*c+3*E,M=h[2*c+E];d[m+0]=a.getX(M),d[m+1]=a.getY(M),d[m+2]=a.getZ(M)}this.addAttribute("position",new THREE.BufferAttribute(d,3))}else{for(var a=e.attributes.position.array,s=a.length/3,_=s/3,d=new Float32Array(2*s*3),c=0,l=_;l>c;c++)for(var E=0;3>E;E++){var m=18*c+6*E,w=9*c+3*E;d[m+0]=a[w],d[m+1]=a[w+1],d[m+2]=a[w+2];var M=9*c+3*((E+1)%3);d[m+3]=a[M],d[m+4]=a[M+1],d[m+5]=a[M+2]}this.addAttribute("position",new THREE.BufferAttribute(d,3))}},THREE.WireframeGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.WireframeGeometry.prototype.constructor=THREE.WireframeGeometry,THREE.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),r=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),i=new THREE.BufferGeometry;i.addAttribute("position",new THREE.BufferAttribute(t,3)),i.addAttribute("color",new THREE.BufferAttribute(r,3));var n=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.LineSegments.call(this,i,n)},THREE.AxisHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.AxisHelper.prototype.constructor=THREE.AxisHelper,THREE.ArrowHelper=function(){var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var t=new THREE.CylinderGeometry(0,.5,1,5,1);return t.translate(0,-.5,0),function(r,i,n,a,o,s){THREE.Object3D.call(this),void 0===a&&(a=16776960),void 0===n&&(n=1),void 0===o&&(o=.2*n),void 0===s&&(s=.2*o),this.position.copy(i),this.line=new THREE.Line(e,new THREE.LineBasicMaterial({color:a})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:a})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(r),this.setLength(n,o,s)}}(),THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper,THREE.ArrowHelper.prototype.setDirection=function(){var e,t=new THREE.Vector3;return function(r){r.y>.99999?this.quaternion.set(0,0,0,1):r.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(r.z,0,-r.x).normalize(),e=Math.acos(r.y),this.quaternion.setFromAxisAngle(t,e))}}(),THREE.ArrowHelper.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},THREE.BoxHelper=function(e){var t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new THREE.BufferGeometry;i.setIndex(new THREE.BufferAttribute(t,1)),i.addAttribute("position",new THREE.BufferAttribute(r,3)),THREE.LineSegments.call(this,i,new THREE.LineBasicMaterial({color:16776960})),void 0!==e&&this.update(e)},THREE.BoxHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.BoxHelper.prototype.constructor=THREE.BoxHelper,THREE.BoxHelper.prototype.update=function(){var e=new THREE.Box3;return function(t){if(e.setFromObject(t),!e.isEmpty()){var r=e.min,i=e.max,n=this.geometry.attributes.position,a=n.array;a[0]=i.x,a[1]=i.y,a[2]=i.z,a[3]=r.x,a[4]=i.y,a[5]=i.z,a[6]=r.x,a[7]=r.y,a[8]=i.z,a[9]=i.x,a[10]=r.y,a[11]=i.z,a[12]=i.x,a[13]=i.y,a[14]=r.z,a[15]=r.x,a[16]=i.y,a[17]=r.z,a[18]=r.x,a[19]=r.y,a[20]=r.z,a[21]=i.x,a[22]=r.y,a[23]=r.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),THREE.BoundingBoxHelper=function(e,t){var r=void 0!==t?t:8947848;this.object=e,this.box=new THREE.Box3,THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:r,wireframe:!0}))},THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper,THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},THREE.CameraHelper=function(e){function t(e,t,i){r(e,i),r(t,i)}function r(e,t){i.vertices.push(new THREE.Vector3),i.colors.push(new THREE.Color(t)),void 0===a[e]&&(a[e]=[]),a[e].push(i.vertices.length-1)}var i=new THREE.Geometry,n=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),a={},o=16755200,s=16711680,h=43775,c=16777215,l=3355443;t("n1","n2",o),t("n2","n4",o),t("n4","n3",o),t("n3","n1",o),t("f1","f2",o),t("f2","f4",o),t("f4","f3",o),t("f3","f1",o),t("n1","f1",o),t("n2","f2",o),t("n3","f3",o),t("n4","f4",o),t("p","n1",s),t("p","n2",s),t("p","n3",s),t("p","n4",s),t("u1","u2",h),t("u2","u3",h),t("u3","u1",h),t("c","t",c),t("p","c",l),t("cn1","cn2",l),t("cn3","cn4",l),t("cf1","cf2",l),t("cf3","cf4",l),THREE.LineSegments.call(this,i,n),this.camera=e,this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()},THREE.CameraHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.CameraHelper.prototype.constructor=THREE.CameraHelper,THREE.CameraHelper.prototype.update=function(){function e(e,a,o,s){i.set(a,o,s).unproject(n);var h=r[e];if(void 0!==h)for(var c=0,l=h.length;l>c;c++)t.vertices[h[c]].copy(i)}var t,r,i=new THREE.Vector3,n=new THREE.Camera;return function(){t=this.geometry,r=this.pointMap;var i=1,a=1;n.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-i,-a,-1),e("n2",i,-a,-1),e("n3",-i,a,-1),e("n4",i,a,-1),e("f1",-i,-a,1),e("f2",i,-a,1),e("f3",-i,a,1),e("f4",i,a,1),e("u1",.7*i,1.1*a,-1),e("u2",.7*-i,1.1*a,-1),e("u3",0,2*a,-1),e("cf1",-i,0,1),e("cf2",i,0,1),e("cf3",0,-a,1),e("cf4",0,a,1),e("cn1",-i,0,-1),e("cn2",i,0,-1),e("cn3",0,-a,-1),e("cn4",0,a,-1),t.verticesNeedUpdate=!0}}(),THREE.DirectionalLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var r=new THREE.Geometry;r.vertices.push(new THREE.Vector3(-t,t,0),new THREE.Vector3(t,t,0),new THREE.Vector3(t,-t,0),new THREE.Vector3(-t,-t,0),new THREE.Vector3(-t,t,0));var i=new THREE.LineBasicMaterial({fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new THREE.Line(r,i),this.add(this.lightPlane),r=new THREE.Geometry,r.vertices.push(new THREE.Vector3,new THREE.Vector3),i=new THREE.LineBasicMaterial({fog:!1}),i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new THREE.Line(r,i),this.add(this.targetLine),this.update()},THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper,THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},THREE.DirectionalLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(r),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(r),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),THREE.EdgesHelper=function(e,t,r){var i=void 0!==t?t:16777215;THREE.LineSegments.call(this,new THREE.EdgesGeometry(e.geometry,r),new THREE.LineBasicMaterial({color:i})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},THREE.EdgesHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper,THREE.FaceNormalsHelper=function(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==r?r:16776960,a=void 0!==i?i:1,o=0,s=this.object.geometry;s instanceof THREE.Geometry?o=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var h=new THREE.BufferGeometry,c=new THREE.Float32Attribute(2*o*3,3);h.addAttribute("position",c),THREE.LineSegments.call(this,h,new THREE.LineBasicMaterial({color:n,linewidth:a})),this.matrixAutoUpdate=!1,this.update()},THREE.FaceNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper,THREE.FaceNormalsHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Matrix3;return function(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var i=this.object.matrixWorld,n=this.geometry.attributes.position,a=this.object.geometry,o=a.vertices,s=a.faces,h=0,c=0,l=s.length;l>c;c++){var u=s[c],E=u.normal;e.copy(o[u.a]).add(o[u.b]).add(o[u.c]).divideScalar(3).applyMatrix4(i),t.copy(E).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),n.setXYZ(h,e.x,e.y,e.z),h+=1,n.setXYZ(h,t.x,t.y,t.z),h+=1}return n.needsUpdate=!0,this}}(),THREE.GridHelper=function(e,t){var r=new THREE.Geometry,i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924),this.color2=new THREE.Color(8947848);for(var n=-e;e>=n;n+=t){r.vertices.push(new THREE.Vector3(-e,0,n),new THREE.Vector3(e,0,n),new THREE.Vector3(n,0,-e),new THREE.Vector3(n,0,e));var a=0===n?this.color1:this.color2;r.colors.push(a,a,a,a)}THREE.LineSegments.call(this,r,i)},THREE.GridHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.GridHelper.prototype.constructor=THREE.GridHelper,THREE.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},THREE.HemisphereLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new THREE.Color,new THREE.Color];var r=new THREE.SphereGeometry(t,4,2);r.rotateX(-Math.PI/2);for(var i=0,n=8;n>i;i++)r.faces[i].color=this.colors[4>i?0:1];var a=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(r,a),this.add(this.lightSphere),this.update()},THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper,THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},THREE.HemisphereLightHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),THREE.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var r=new THREE.SphereGeometry(t,4,2),i=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),THREE.Mesh.call(this,r,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper,THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var t=new THREE.Geometry,r=0;r<this.bones.length;r++){var i=this.bones[r];i.parent instanceof THREE.Bone&&(t.vertices.push(new THREE.Vector3),t.vertices.push(new THREE.Vector3),t.colors.push(new THREE.Color(0,0,1)),t.colors.push(new THREE.Color(0,1,0)))}t.dynamic=!0;var n=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});THREE.LineSegments.call(this,t,n),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},THREE.SkeletonHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper,THREE.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof THREE.Bone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,this.getBoneList(e.children[r]));return t},THREE.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=(new THREE.Matrix4).getInverse(this.root.matrixWorld),r=new THREE.Matrix4,i=0,n=0;n<this.bones.length;n++){var a=this.bones[n];a.parent instanceof THREE.Bone&&(r.multiplyMatrices(t,a.matrixWorld),e.vertices[i].setFromMatrixPosition(r),r.multiplyMatrices(t,a.parent.matrixWorld),e.vertices[i+1].setFromMatrixPosition(r),i+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},THREE.SpotLightHelper=function(e){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new THREE.CylinderGeometry(0,1,1,8,1,!0);t.translate(0,-.5,0),t.rotateX(-Math.PI/2);var r=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(t,r),this.add(this.cone),this.update()},THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper,THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},THREE.SpotLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){var r=this.light.distance?this.light.distance:1e4,i=r*Math.tan(this.light.angle);this.cone.scale.set(i,i,r),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),THREE.VertexNormalsHelper=function(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==r?r:16711680,a=void 0!==i?i:1,o=0,s=this.object.geometry;s instanceof THREE.Geometry?o=3*s.faces.length:s instanceof THREE.BufferGeometry&&(o=s.attributes.normal.count);var h=new THREE.BufferGeometry,c=new THREE.Float32Attribute(2*o*3,3);h.addAttribute("position",c),THREE.LineSegments.call(this,h,new THREE.LineBasicMaterial({color:n,linewidth:a})),this.matrixAutoUpdate=!1,this.update()},THREE.VertexNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper,THREE.VertexNormalsHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Matrix3;
return function(){var i=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var n=this.object.matrixWorld,a=this.geometry.attributes.position,o=this.object.geometry;if(o instanceof THREE.Geometry)for(var s=o.vertices,h=o.faces,c=0,l=0,u=h.length;u>l;l++)for(var E=h[l],p=0,d=E.vertexNormals.length;d>p;p++){var f=s[E[i[p]]],m=E.vertexNormals[p];e.copy(f).applyMatrix4(n),t.copy(m).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),a.setXYZ(c,e.x,e.y,e.z),c+=1,a.setXYZ(c,t.x,t.y,t.z),c+=1}else if(o instanceof THREE.BufferGeometry)for(var T=o.attributes.position,v=o.attributes.normal,c=0,p=0,d=T.count;d>p;p++)e.set(T.getX(p),T.getY(p),T.getZ(p)).applyMatrix4(n),t.set(v.getX(p),v.getY(p),v.getZ(p)),t.applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),a.setXYZ(c,e.x,e.y,e.z),c+=1,a.setXYZ(c,t.x,t.y,t.z),c+=1;return a.needsUpdate=!0,this}}(),THREE.WireframeHelper=function(e,t){var r=void 0!==t?t:16777215;THREE.LineSegments.call(this,new THREE.WireframeGeometry(e.geometry),new THREE.LineBasicMaterial({color:r})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},THREE.WireframeHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper,THREE.ImmediateRenderObject=function(e){THREE.Object3D.call(this),this.material=e,this.render=function(){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject,THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length,i="__default",n=0,a=r-1,o=r/1;this.createAnimation(i,n,a,o),this.setAnimationWeight(i,1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh,THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,r,i){var n={start:t,end:r,length:r-t+1,fps:i,duration:(r-t)/i,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=n,this.animationsList.push(n)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,r=/([a-z]+)_?(\d+)/i,i={},n=this.geometry,a=0,o=n.morphTargets.length;o>a;a++){var s=n.morphTargets[a],h=s.name.match(r);if(h&&h.length>1){var c=h[1];i[c]||(i[c]={start:1/0,end:-1/0});var l=i[c];a<l.start&&(l.start=a),a>l.end&&(l.end=a),t||(t=c)}}for(var c in i){var l=i[c];this.createAnimation(c,l.start,l.end,e)}this.firstAnimation=t},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];r&&(r.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,r=this.animationsMap[e];return r&&(t=r.time),t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;r>t;t++){var i=this.animationsList[t];if(i.active){var n=i.duration/i.length;i.time+=i.direction*e,i.mirroredLoop?(i.time>i.duration||i.time<0)&&(i.direction*=-1,i.time>i.duration&&(i.time=i.duration,i.directionBackwards=!0),i.time<0&&(i.time=0,i.directionBackwards=!1)):(i.time=i.time%i.duration,i.time<0&&(i.time+=i.duration));var a=i.start+THREE.Math.clamp(Math.floor(i.time/n),0,i.length-1),o=i.weight;a!==i.currentFrame&&(this.morphTargetInfluences[i.lastFrame]=0,this.morphTargetInfluences[i.currentFrame]=1*o,this.morphTargetInfluences[a]=0,i.lastFrame=i.currentFrame,i.currentFrame=a);var s=i.time%n/n;i.directionBackwards&&(s=1-s),i.currentFrame!==i.lastFrame?(this.morphTargetInfluences[i.currentFrame]=s*o,this.morphTargetInfluences[i.lastFrame]=(1-s)*o):this.morphTargetInfluences[i.currentFrame]=o}}};
;
THREE.OBJLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null},THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(e,t,a,r){var s=this,n=new THREE.XHRLoader(s.manager);n.setPath(this.path),n.load(e,function(e){var a=s.parse(e);t(a.geometries,a.materials)},a,r)},setPath:function(e){this.path=e},setMaterials:function(e){this.materials=e},parse:function(e){function t(e){var t={vertices:[],normals:[],uvs:[]},a={name:"",smooth:!0};d={name:e,geometry:t,material:a},u.push(d)}function a(e){var t=parseInt(e);return 3*(t>=0?t-1:t+f.length/3)}function r(e){var t=parseInt(e);return 3*(t>=0?t-1:t+h.length/3)}function s(e){var t=parseInt(e);return 2*(t>=0?t-1:t+v.length/2)}function n(e,t,a){d.geometry.vertices.push(f[e],f[e+1],f[e+2],f[t],f[t+1],f[t+2],f[a],f[a+1],f[a+2])}function o(e,t,a){d.geometry.normals.push(h[e],h[e+1],h[e+2],h[t],h[t+1],h[t+2],h[a],h[a+1],h[a+2])}function i(e,t,a){d.geometry.uvs.push(v[e],v[e+1],v[t],v[t+1],v[a],v[a+1])}function l(e,t,l,d,u,m,f,h,v,c,E,p){var g,H=a(e),R=a(t),F=a(l);void 0===d?n(H,R,F):(g=a(d),n(H,R,g),n(R,F,g)),void 0!==u&&(H=s(u),R=s(m),F=s(f),void 0===d?i(H,R,F):(g=s(h),i(H,R,g),i(R,F,g))),void 0!==v&&(H=r(v),R=r(c),F=r(E),void 0===d?o(H,R,F):(g=r(p),o(H,R,g),o(R,F,g)))}console.time("OBJLoader");var d,u=[],m=!1,f=[],h=[],v=[];t("");for(var c=/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,E=/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,p=/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,g=/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,H=/^f\s+((-?\d+)\/(-?\d+))\s+((-?\d+)\/(-?\d+))\s+((-?\d+)\/(-?\d+))(?:\s+((-?\d+)\/(-?\d+)))?/,R=/^f\s+((-?\d+)\/(-?\d+)\/(-?\d+))\s+((-?\d+)\/(-?\d+)\/(-?\d+))\s+((-?\d+)\/(-?\d+)\/(-?\d+))(?:\s+((-?\d+)\/(-?\d+)\/(-?\d+)))?/,F=/^f\s+((-?\d+)\/\/(-?\d+))\s+((-?\d+)\/\/(-?\d+))\s+((-?\d+)\/\/(-?\d+))(?:\s+((-?\d+)\/\/(-?\d+)))?/,T=/^[og]\s+(.+)/,w=/^s\s+([01]|on|off)/,x=e.split("\n"),y=0;y<x.length;y++){var A=x[y];A=A.trim();var B;if(0!==A.length&&"#"!==A.charAt(0))if(null!==(B=c.exec(A)))f.push(parseFloat(B[1]),parseFloat(B[2]),parseFloat(B[3]));else if(null!==(B=E.exec(A)))h.push(parseFloat(B[1]),parseFloat(B[2]),parseFloat(B[3]));else if(null!==(B=p.exec(A)))v.push(parseFloat(B[1]),parseFloat(B[2]));else if(null!==(B=g.exec(A)))l(B[1],B[2],B[3],B[4]);else if(null!==(B=H.exec(A)))l(B[2],B[5],B[8],B[11],B[3],B[6],B[9],B[12]);else if(null!==(B=R.exec(A)))l(B[2],B[6],B[10],B[14],B[3],B[7],B[11],B[15],B[4],B[8],B[12],B[16]);else if(null!==(B=F.exec(A)))l(B[2],B[5],B[8],B[11],void 0,void 0,void 0,void 0,B[3],B[6],B[9],B[12]);else if(null!==(B=T.exec(A))){var b=B[1].trim();m===!1?(m=!0,d.name=b):t(b)}else if(/^usemtl /.test(A))d.material.name=A.substring(7).trim();else if(/^mtllib /.test(A));else{if(null===(B=w.exec(A)))throw new Error("Unexpected line: "+A);d.material.smooth="1"===B[1]||"on"===B[1]}}for(var L={geometries:[],materials:[]},y=0,J=u.length;J>y;y++){d=u[y];var O=d.geometry,M=new THREE.BufferGeometry;M.addAttribute("position",new THREE.BufferAttribute(new Float32Array(O.vertices),3)),O.normals.length>0?M.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(O.normals),3)):M.computeVertexNormals(),O.uvs.length>0&&M.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(O.uvs),2));var I;null!==this.materials&&(I=this.materials.create(d.material.name)),I||(I=new THREE.MeshPhongMaterial,I.name=d.material.name),I.shading=d.material.smooth?THREE.SmoothShading:THREE.FlatShading,L.geometries.push(M),L.materials.push(I)}return console.timeEnd("OBJLoader"),L}};
;
THREE.MTLLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager},THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(a,t,r,s){var i=this,e=new THREE.XHRLoader(this.manager);e.setPath(this.path),e.load(a,function(a){t(i.parse(a))},r,s)},setPath:function(a){this.path=a},setBaseUrl:function(a){this.baseUrl=a},setCrossOrigin:function(a){this.crossOrigin=a},setMaterialOptions:function(a){this.materialOptions=a},parse:function(a){for(var t=a.split("\n"),r={},s=/\s+/,i={},e=0;e<t.length;e++){var o=t[e];if(o=o.trim(),0!==o.length&&"#"!==o.charAt(0)){var n=o.indexOf(" "),h=n>=0?o.substring(0,n):o;h=h.toLowerCase();var p=n>=0?o.substring(n+1):"";if(p=p.trim(),"newmtl"===h)r={name:p},i[p]=r;else if(r)if("ka"===h||"kd"===h||"ks"===h){var l=p.split(s,3);r[h]=[parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2])]}else r[h]=p}}var c=new THREE.MTLLoader.MaterialCreator(this.baseUrl,this.materialOptions);return c.setCrossOrigin(this.crossOrigin),c.setManager(this.manager),c.setMaterials(i),c}},THREE.MTLLoader.MaterialCreator=function(a,t){this.baseUrl=a,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,setCrossOrigin:function(a){this.crossOrigin=a},setManager:function(a){this.manager=a},setMaterials:function(a){this.materialsInfo=this.convert(a),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(a){if(!this.options)return a;var t={};for(var r in a){var s=a[r],i={};t[r]=i;for(var e in s){var o=!0,n=s[e],h=e.toLowerCase();switch(h){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(n=[n[0]/255,n[1]/255,n[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===n[0]&&0===n[1]&&0===n[1]&&(o=!1)}o&&(i[h]=n)}}return t},preload:function(){for(var a in this.materialsInfo)this.create(a)},getIndex:function(a){return this.nameLookup[a]},getAsArray:function(){var a=0;for(var t in this.materialsInfo)this.materialsArray[a]=this.create(t),this.nameLookup[t]=a,a++;return this.materialsArray},create:function(a){return void 0===this.materials[a]&&this.createMaterial_(a),this.materials[a]},createMaterial_:function(a){var t=this.materialsInfo[a],r={name:a,side:this.side};for(var s in t){var i=t[s];if(""!==i)switch(s.toLowerCase()){case"kd":r.color=(new THREE.Color).fromArray(i);break;case"ks":r.specular=(new THREE.Color).fromArray(i);break;case"map_kd":r.map=this.loadTexture(this.baseUrl+i),r.map.wrapS=this.wrap,r.map.wrapT=this.wrap;break;case"ns":r.shininess=parseFloat(i);break;case"d":1>i&&(r.opacity=i,r.transparent=!0);break;case"Tr":i>0&&(r.opacity=1-i,r.transparent=!0);break;case"map_bump":case"bump":if(r.bumpMap)break;r.bumpMap=this.loadTexture(this.baseUrl+i),r.bumpMap.wrapS=this.wrap,r.bumpMap.wrapT=this.wrap}}return this.materials[a]=new THREE.MeshPhongMaterial(r),this.materials[a]},loadTexture:function(a,t,r,s,i){var e,o=THREE.Loader.Handlers.get(a),n=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;return null===o&&(o=new THREE.TextureLoader(n)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin),e=o.load(a,r,s,i),void 0!==t&&(e.mapping=t),e}},THREE.EventDispatcher.prototype.apply(THREE.MTLLoader.prototype);
;
THREE.DDSLoader=function(){this._parser=THREE.DDSLoader.parse},THREE.DDSLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.DDSLoader.prototype.constructor=THREE.DDSLoader,THREE.DDSLoader.parse=function(r,a){function e(r){return r.charCodeAt(0)+(r.charCodeAt(1)<<8)+(r.charCodeAt(2)<<16)+(r.charCodeAt(3)<<24)}function t(r){return String.fromCharCode(255&r,r>>8&255,r>>16&255,r>>24&255)}function o(r,a,e,t){for(var o=e*t*4,n=new Uint8Array(r,a,o),m=new Uint8Array(o),i=0,p=0,E=0;t>E;E++)for(var u=0;e>u;u++){var s=n[p];p++;var c=n[p];p++;var d=n[p];p++;var D=n[p];p++,m[i]=d,i++,m[i]=c,i++,m[i]=s,i++,m[i]=D,i++}return m}var n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},m=542327876,i=131072,p=512,E=1024,u=2048,s=4096,c=8192,d=16384,D=32768,T=4,h=e("DXT1"),f=e("DXT3"),C=e("DXT5"),R=e("ETC1"),H=31,v=0,S=1,_=2,l=3,A=4,L=7,b=20,w=21,g=22,y=23,F=24,x=25,X=26,B=28,G=new Int32Array(r,0,H);if(G[v]!==m)return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),n;if(!G[b]&T)return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),n;var M,U=G[w],k=!1;switch(U){case h:M=8,n.format=THREE.RGB_S3TC_DXT1_Format;break;case f:M=16,n.format=THREE.RGBA_S3TC_DXT3_Format;break;case C:M=16,n.format=THREE.RGBA_S3TC_DXT5_Format;break;case R:M=8,n.format=THREE.RGB_ETC1_Format;break;default:if(!(32===G[g]&&16711680&G[y]&&65280&G[F]&&255&G[x]&&4278190080&G[X]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",t(U)),n;k=!0,M=64,n.format=THREE.RGBAFormat}n.mipmapCount=1,G[_]&i&&a!==!1&&(n.mipmapCount=Math.max(1,G[L]));var I=G[B];if(n.isCubemap=I&p?!0:!1,!(!n.isCubemap||I&E&&I&u&&I&s&&I&c&&I&d&&I&D))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),n;n.width=G[A],n.height=G[l];for(var j=G[S]+4,O=n.isCubemap?6:1,q=0;O>q;q++)for(var z=n.width,J=n.height,K=0;K<n.mipmapCount;K++){if(k)var N=o(r,j,z,J),P=N.length;else var P=Math.max(4,z)/4*Math.max(4,J)/4*M,N=new Uint8Array(r,j,P);var Q={data:N,width:z,height:J};n.mipmaps.push(Q),j+=P,z=Math.max(z>>1,1),J=Math.max(J>>1,1)}return n};
;
THREE.VREffect=function(e,t){function r(e){for(var r=0;r<e.length;r++)if(e[r]instanceof HMDVRDevice){if(s=e[r],void 0!==s.getEyeParameters){var n=s.getEyeParameters("left"),a=s.getEyeParameters("right");o=n.eyeTranslation,c=a.eyeTranslation,l=n.recommendedFieldOfView,d=a.recommendedFieldOfView}else o=s.getEyeTranslation("left"),c=s.getEyeTranslation("right"),l=s.getRecommendedEyeFieldOfView("left"),d=s.getRecommendedEyeFieldOfView("right");break}void 0===s&&t&&t("HMD not available")}function n(e){var t=2/(e.leftTan+e.rightTan),r=(e.leftTan-e.rightTan)*t*.5,n=2/(e.upTan+e.downTan),a=(e.upTan-e.downTan)*n*.5;return{scale:[t,n],offset:[r,a]}}function a(e,t,r,a){t=void 0===t?!0:t,r=void 0===r?.01:r,a=void 0===a?1e4:a;var i=t?-1:1,s=new THREE.Matrix4,o=s.elements,l=n(e);return o[0]=l.scale[0],o[1]=0,o[2]=l.offset[0]*i,o[3]=0,o[4]=0,o[5]=l.scale[1],o[6]=-l.offset[1]*i,o[7]=0,o[8]=0,o[9]=0,o[10]=a/(r-a)*-i,o[11]=a*r/(r-a),o[12]=0,o[13]=0,o[14]=i,o[15]=0,s.transpose(),s}function i(e,t,r,n){var i=Math.PI/180,s={upTan:Math.tan(e.upDegrees*i),downTan:Math.tan(e.downDegrees*i),leftTan:Math.tan(e.leftDegrees*i),rightTan:Math.tan(e.rightDegrees*i)};return a(s,t,r,n)}var s,o,l,c,d;navigator.getVRDevices&&navigator.getVRDevices().then(r),this.scale=1,this.setSize=function(t,r){e.setSize(t,r)};var f=!1,u=e.domElement,h=u.mozRequestFullScreen?"mozfullscreenchange":"webkitfullscreenchange";document.addEventListener(h,function(){f=document.mozFullScreenElement||document.webkitFullscreenElement},!1),this.setFullScreen=function(e){void 0!==s&&f!==e&&(u.mozRequestFullScreen?u.mozRequestFullScreen({vrDisplay:s}):u.webkitRequestFullscreen&&u.webkitRequestFullscreen({vrDisplay:s}))};var m=new THREE.PerspectiveCamera;m.layers.enable(1);var g=new THREE.PerspectiveCamera;g.layers.enable(2),this.render=function(t,r){if(s){var n=s.getEyeParameters("left"),a=s.getEyeParameters("right");o=n.eyeTranslation,c=a.eyeTranslation,l=n.recommendedFieldOfView,d=a.recommendedFieldOfView,Array.isArray(t)&&(console.warn("THREE.VREffect.render() no longer supports arrays. Use object.layers instead."),t=t[0]);var f=e.getSize();return e.setScissorTest(!0),e.clear(),null===r.parent&&r.updateMatrixWorld(),m.projectionMatrix=i(l,!0,r.near,r.far),g.projectionMatrix=i(d,!0,r.near,r.far),r.matrixWorld.decompose(m.position,m.quaternion,m.scale),r.matrixWorld.decompose(g.position,g.quaternion,g.scale),m.translateX(o.x*this.scale),g.translateX(c.x*this.scale),e.setViewport(0,0,f.width/2,f.height),e.setScissor(0,0,f.width/2,f.height),e.render(t,m),e.setViewport(f.width/2,0,f.width/2,f.height),e.setScissor(f.width/2,0,f.width/2,f.height),e.render(t,g),void e.setScissorTest(!1)}e.render(t,r)}};
;
THREE.VRControls=function(e,n){function o(e){var n=e.filter(function(e){return-1!==e.deviceName.toLowerCase().indexOf("oculus")||-1!==e.deviceName.toLowerCase().indexOf("vive")});return n.length>=1?e.filter(function(e){return-1===e.deviceName.toLowerCase().indexOf("cardboard")}):e}function t(e){e=o(e);for(var t=0;t<e.length;t++)e[t]instanceof PositionSensorVRDevice&&r.push(e[t]);n&&n("HMD not available")}var i=this,r=[];navigator.getVRDevices&&navigator.getVRDevices().then(t),this.scale=1;var s=new THREE.Quaternion;this.update=function(n,o){for(var t=0;t<r.length;t++){var a=r[t],c=a.getState();null!==c.orientation&&(e.quaternion.copy(o),s.set(c.orientation.x,c.orientation.y,c.orientation.z,c.orientation.w),e.quaternion.multiply(s)),null!==c.position&&e.position.copy(n).add(c.position).multiplyScalar(i.scale)}},this.resetSensor=function(){for(var e=0;e<r.length;e++){var n=r[e];void 0!==n.resetSensor?n.resetSensor():void 0!==n.zeroSensor&&n.zeroSensor()}},this.zeroSensor=function(){console.warn("THREE.VRControls: .zeroSensor() is now .resetSensor()."),this.resetSensor()},this.dispose=function(){r=[]}};
;
THREE.SceneLoader=function(e){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlers={},this.hierarchyHandlers={},this.addGeometryHandler("ascii",THREE.JSONLoader),this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.SceneLoader.prototype={constructor:THREE.SceneLoader,load:function(e,r,a,t){var o=this,i=new THREE.XHRLoader(o.manager);i.load(e,function(a){o.parse(JSON.parse(a),r,e)},a,t)},addGeometryHandler:function(e,r){this.geometryHandlers[e]={loaderClass:r}},addHierarchyHandler:function(e,r){this.hierarchyHandlers[e]={loaderClass:r}},parse:function(e,r,a){function t(e,r){return"relativeToHTML"==r?e:A+e}function o(){i(L.scene,j.objects)}function i(e,r){var a,o,n,s,l;for(var p in r){var d=L.objects[p],c=r[p];if(void 0===d){if(c.type&&c.type in S.hierarchyHandlers){if(void 0===c.loading){E=L.materials[c.material],c.loading=!0;var g=S.hierarchyHandlers[c.type].loaderObject;g.options?g.load(t(c.url,j.urlBaseType),m(p,e,E,c)):g.load(t(c.url,j.urlBaseType),m(p,e,E,c))}}else if(void 0!==c.geometry)f=L.geometries[c.geometry],f&&(E=L.materials[c.material],o=c.position,n=c.rotation,s=c.scale,a=c.matrix,l=c.quaternion,c.material||(E=new THREE.MultiMaterial(L.face_materials[c.geometry])),E instanceof THREE.MultiMaterial&&0===E.materials.length&&(E=new THREE.MultiMaterial(L.face_materials[c.geometry])),c.skin?d=new THREE.SkinnedMesh(f,E):c.morph?(d=new THREE.MorphAnimMesh(f,E),void 0!==c.duration&&(d.duration=c.duration),void 0!==c.time&&(d.time=c.time),void 0!==c.mirroredLoop&&(d.mirroredLoop=c.mirroredLoop),E.morphNormals&&f.computeMorphNormals()):d=new THREE.Mesh(f,E),d.name=p,a?(d.matrixAutoUpdate=!1,d.matrix.set(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])):(d.position.fromArray(o),l?d.quaternion.fromArray(l):d.rotation.fromArray(n),d.scale.fromArray(s)),d.visible=c.visible,d.castShadow=c.castShadow,d.receiveShadow=c.receiveShadow,e.add(d),L.objects[p]=d);else if("AmbientLight"===c.type||"PointLight"===c.type||"DirectionalLight"===c.type||"SpotLight"===c.type||"HemisphereLight"===c.type){var u=c.color||new THREE.Color(16777215),y=c.intensity||1,H=c.distance||0,T=c.position||[0,0,0],R=c.rotation||[0,0,0];switch(c.type){case"AmbientLight":v=new THREE.AmbientLight(u);break;case"PointLight":v=new THREE.PointLight(u,y,H),v.position.fromArray(T);break;case"DirectionalLight":v=new THREE.DirectionalLight(u,y),v.position.fromArray(c.direction);break;case"SpotLight":v=new THREE.SpotLight(u,y,H,1),v.angle=c.angle,v.position.fromArray(T),v.target.position.set(T[0],T[1]-H,T[2]),v.target.position.applyEuler(new THREE.Euler(R[0],R[1],R[2],"XYZ"));break;case"HemisphereLight":v=new THREE.DirectionalLight(u,y,H),v.target.position.set(T[0],T[1]-H,T[2]),v.target.position.applyEuler(new THREE.Euler(R[0],R[1],R[2],"XYZ"))}e.add(v),v.name=p,L.lights[p]=v,L.objects[p]=v}else"PerspectiveCamera"===c.type||"OrthographicCamera"===c.type?(o=c.position,n=c.rotation,l=c.quaternion,"PerspectiveCamera"===c.type?h=new THREE.PerspectiveCamera(c.fov,c.aspect,c.near,c.far):"OrthographicCamera"===c.type&&(h=new THREE.OrthographicCamera(c.left,c.right,c.top,c.bottom,c.near,c.far)),h.name=p,h.position.fromArray(o),void 0!==l?h.quaternion.fromArray(l):void 0!==n?h.rotation.fromArray(n):c.target&&h.lookAt((new THREE.Vector3).fromArray(c.target)),e.add(h),L.cameras[p]=h,L.objects[p]=h):(o=c.position,n=c.rotation,s=c.scale,l=c.quaternion,d=new THREE.Object3D,d.name=p,d.position.fromArray(o),l?d.quaternion.fromArray(l):d.rotation.fromArray(n),d.scale.fromArray(s),d.visible=void 0!==c.visible?c.visible:!1,e.add(d),L.objects[p]=d,L.empties[p]=d);if(d){if(void 0!==c.userData)for(var b in c.userData){var w=c.userData[b];d.userData[b]=w}if(void 0!==c.groups)for(var A=0;A<c.groups.length;A++){var M=c.groups[A];void 0===L.groups[M]&&(L.groups[M]=[]),L.groups[M].push(p)}}}void 0!==d&&void 0!==c.children&&i(d,c.children)}}function n(e,r,a){L.geometries[a]=e,L.face_materials[a]=r,o()}function s(e,r,a,t,i){var n=i.position,s=i.rotation,l=i.quaternion,m=i.scale;e.position.fromArray(n),l?e.quaternion.fromArray(l):e.rotation.fromArray(s),e.scale.fromArray(m),t&&e.traverse(function(e){e.material=t});var p=void 0!==i.visible?i.visible:!0;e.traverse(function(e){e.visible=p}),a.add(e),e.name=r,L.objects[r]=e,o()}function l(e){return function(r,a){r.name=e,n(r,a,e),T-=1,S.onLoadComplete(),d()}}function m(e,r,a,t){return function(o){var i;i=o.content?o.content:o.dae?o.scene:o,s(i,e,r,a,t),T-=1,S.onLoadComplete(),d()}}function p(e){return function(r,a){r.name=e,L.geometries[e]=r,L.face_materials[e]=a}}function d(){var e={totalModels:b,totalTextures:w,loadedModels:b-T,loadedTextures:w-R};S.callbackProgress(e,L),S.onLoadProgress(),0===T&&0===R&&(c(),r(L))}function c(){for(var e=0;e<M.length;e++){var r=M[e],a=L.objects[r.targetName];a?r.object.target=a:(r.object.target=new THREE.Object3D,L.scene.add(r.object.target)),r.object.target.userData.targetInverse=r.object}}function g(e,r){if(r(e),void 0!==e.children)for(var a in e.children)g(e.children[a],r)}var f,E,h,u,y,H,v,T,R,b,w,L,S=this,A=THREE.Loader.prototype.extractUrlBase(a),M=[],j=e;for(var x in this.geometryHandlers){var C=this.geometryHandlers[x].loaderClass;this.geometryHandlers[x].loaderObject=new C}for(var x in this.hierarchyHandlers){var C=this.hierarchyHandlers[x].loaderClass;this.hierarchyHandlers[x].loaderObject=new C}if(T=0,R=0,L={scene:new THREE.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},j.transform){var k=j.transform.position,D=j.transform.rotation,O=j.transform.scale;k&&L.scene.position.fromArray(k),D&&L.scene.rotation.fromArray(D),O&&L.scene.scale.fromArray(O),(k||D||O)&&(L.scene.updateMatrix(),L.scene.updateMatrixWorld())}var B,F,P=function(e){R-=e,d(),S.onLoadComplete()},G=function(e){return function(){P(e)}};for(B in j.fogs)F=j.fogs[B],"linear"===F.type?u=new THREE.Fog(0,F.near,F.far):"exp2"===F.type&&(u=new THREE.FogExp2(0,F.density)),H=F.color,u.color.setRGB(H[0],H[1],H[2]),L.fogs[B]=u;var q,N;for(q in j.geometries)N=j.geometries[q],N.type in this.geometryHandlers&&(T+=1,S.onLoadStart());for(var W in j.objects)g(j.objects[W],function(e){e.type&&e.type in S.hierarchyHandlers&&(T+=1,S.onLoadStart())});b=T;for(q in j.geometries)if(N=j.geometries[q],"cube"===N.type)f=new THREE.BoxGeometry(N.width,N.height,N.depth,N.widthSegments,N.heightSegments,N.depthSegments),f.name=q,L.geometries[q]=f;else if("plane"===N.type)f=new THREE.PlaneGeometry(N.width,N.height,N.widthSegments,N.heightSegments),f.name=q,L.geometries[q]=f;else if("sphere"===N.type)f=new THREE.SphereGeometry(N.radius,N.widthSegments,N.heightSegments),f.name=q,L.geometries[q]=f;else if("cylinder"===N.type)f=new THREE.CylinderGeometry(N.topRad,N.botRad,N.height,N.radSegs,N.heightSegs),f.name=q,L.geometries[q]=f;else if("torus"===N.type)f=new THREE.TorusGeometry(N.radius,N.tube,N.segmentsR,N.segmentsT),f.name=q,L.geometries[q]=f;else if("icosahedron"===N.type)f=new THREE.IcosahedronGeometry(N.radius,N.subdivisions),f.name=q,L.geometries[q]=f;else if(N.type in this.geometryHandlers){var _=this.geometryHandlers[N.type].loaderObject;_.load(t(N.url,j.urlBaseType),l(q))}else if("embedded"===N.type){var V=j.embeds[N.id],I="";if(V.metadata=j.metadata,V){var U=this.geometryHandlers.ascii.loaderObject,X=U.parse(V,I);p(q)(X.geometry,X.materials)}}var J,Y;for(J in j.textures)if(Y=j.textures[J],Array.isArray(Y.url)){R+=Y.url.length;for(var Z=0;Z<Y.url.length;Z++)S.onLoadStart()}else R+=1,S.onLoadStart();w=R;for(J in j.textures){Y=j.textures[J],void 0!==Y.mapping&&void 0!==THREE[Y.mapping]&&(Y.mapping=THREE[Y.mapping]);var y;if(Array.isArray(Y.url)){for(var z=Y.url.length,K=[],Q=0;z>Q;Q++)K[Q]=t(Y.url[Q],j.urlBaseType);var _=THREE.Loader.Handlers.get(K[0]);null!==_?(y=_.load(K,G(z)),void 0!==Y.mapping&&(y.mapping=Y.mapping)):(y=(new THREE.CubeTextureLoader).load(urls,G(z)),y.mapping=Y.mapping)}else{var $=t(Y.url,j.urlBaseType),er=G(1),_=THREE.Loader.Handlers.get($);if(null!==_?y=_.load($,er):(y=new THREE.Texture,_=new THREE.ImageLoader,function(e){_.load($,function(r){e.image=r,e.needsUpdate=!0,er()})}(y)),void 0!==Y.mapping&&(y.mapping=Y.mapping),void 0!==THREE[Y.minFilter]&&(y.minFilter=THREE[Y.minFilter]),void 0!==THREE[Y.magFilter]&&(y.magFilter=THREE[Y.magFilter]),Y.anisotropy&&(y.anisotropy=Y.anisotropy),Y.repeat&&(y.repeat.set(Y.repeat[0],Y.repeat[1]),1!==Y.repeat[0]&&(y.wrapS=THREE.RepeatWrapping),1!==Y.repeat[1]&&(y.wrapT=THREE.RepeatWrapping)),Y.offset&&y.offset.set(Y.offset[0],Y.offset[1]),Y.wrap){var rr={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};void 0!==rr[Y.wrap[0]]&&(y.wrapS=rr[Y.wrap[0]]),void 0!==rr[Y.wrap[1]]&&(y.wrapT=rr[Y.wrap[1]])}}L.textures[J]=y}var ar,tr,or;for(ar in j.materials){tr=j.materials[ar];for(or in tr.parameters)if("envMap"===or||"map"===or||"lightMap"===or||"bumpMap"===or||"normalMap"===or||"alphaMap"===or)tr.parameters[or]=L.textures[tr.parameters[or]];else if("shading"===or)tr.parameters[or]="flat"===tr.parameters[or]?THREE.FlatShading:THREE.SmoothShading;else if("side"===or)tr.parameters[or]="double"==tr.parameters[or]?THREE.DoubleSide:"back"==tr.parameters[or]?THREE.BackSide:THREE.FrontSide;else if("blending"===or)tr.parameters[or]=tr.parameters[or]in THREE?THREE[tr.parameters[or]]:THREE.NormalBlending;else if("combine"===or)tr.parameters[or]=tr.parameters[or]in THREE?THREE[tr.parameters[or]]:THREE.MultiplyOperation;else if("vertexColors"===or)"face"==tr.parameters[or]?tr.parameters[or]=THREE.FaceColors:tr.parameters[or]&&(tr.parameters[or]=THREE.VertexColors);else if("wrapRGB"===or){var ir=tr.parameters[or];tr.parameters[or]=new THREE.Vector3(ir[0],ir[1],ir[2])}else if("normalScale"===or){var nr=tr.parameters[or];tr.parameters[or]=new THREE.Vector2(nr[0],nr[1])}void 0!==tr.parameters.opacity&&tr.parameters.opacity<1&&(tr.parameters.transparent=!0),E=new THREE[tr.type](tr.parameters),E.name=ar,L.materials[ar]=E}for(ar in j.materials)if(tr=j.materials[ar],tr.parameters.materials){for(var sr=[],Q=0;Q<tr.parameters.materials.length;Q++){var lr=tr.parameters.materials[Q];sr.push(L.materials[lr])}L.materials[ar].materials=sr}o(),L.cameras&&j.defaults.camera&&(L.currentCamera=L.cameras[j.defaults.camera]),L.fogs&&j.defaults.fog&&(L.scene.fog=L.fogs[j.defaults.fog]),S.callbackSync(L),d()}};
;
THREE.MorphAnimMesh=function(i,t){THREE.Mesh.call(this,i,t),this.type="MorphAnimMesh",this.mixer=new THREE.AnimationMixer(this),this.activeAction=null},THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphAnimMesh.prototype.constructor=THREE.MorphAnimMesh,THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.mixer.timeScale=1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.mixer.timeScale=-1},THREE.MorphAnimMesh.prototype.playAnimation=function(i,t){this.activeAction&&(this.activeAction.stop(),this.activeAction=null);var e=THREE.AnimationClip.findByName(this.geometry.animations,i);if(!e)throw new Error("THREE.MorphAnimMesh: animations["+i+"] undefined in .playAnimation()");var o=this.mixer.clipAction(e);o.timeScale=e.tracks.length*t/e.duration,this.activeAction=o.play()},THREE.MorphAnimMesh.prototype.updateAnimation=function(i){this.mixer.update(i)},THREE.MorphAnimMesh.prototype.copy=function(i){return THREE.Mesh.prototype.copy.call(this,i),this.mixer=new THREE.AnimationMixer(this),this};
;
!function t(i,e,n){function s(o,h){if(!e[o]){if(!i[o]){var a="function"==typeof require&&require;if(!h&&a)return a(o,!0);if(r)return r(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=e[o]={exports:{}};i[o][0].call(c.exports,function(t){var e=i[o][1][t];return s(e?e:t)},c,c.exports,t,i,e,n)}return e[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(t,i){function e(){this.hardwareUnitId="webvr-polyfill hardwareUnitId",this.deviceId="webvr-polyfill deviceId",this.deviceName="webvr-polyfill deviceName"}function n(){}function s(){}n.prototype=new e,s.prototype=new e,i.exports.VRDevice=e,i.exports.HMDVRDevice=n,i.exports.PositionSensorVRDevice=s},{}],2:[function(t,i){function e(){this.fov={upDegrees:h,downDegrees:o,leftDegrees:r,rightDegrees:r},this.eyeTranslationLeft={x:s*-.5,y:0,z:0},this.eyeTranslationRight={x:.5*s,y:0,z:0}}var n=t("./base.js").HMDVRDevice,s=.06,r=40,o=40,h=40;e.prototype=new n,e.prototype.getEyeParameters=function(t){var i;if("left"==t)i=this.eyeTranslationLeft;else{if("right"!=t)return console.error("Invalid eye provided: %s",t),null;i=this.eyeTranslationRight}return{recommendedFieldOfView:this.fov,eyeTranslation:i}},i.exports=e},{"./base.js":1}],3:[function(t,i){function e(t){this.kFilter=t,this.currentAccelMeasurement=new n,this.currentGyroMeasurement=new n,this.previousGyroMeasurement=new n,this.filterQ=new s.Quaternion,this.previousFilterQ=new s.Quaternion,this.accelQ=new s.Quaternion,this.isOrientationInitialized=!1,this.estimatedGravity=new s.Vector3,this.measuredGravity=new s.Vector3,this.gyroIntegralQ=new s.Quaternion}var n=t("./sensor-sample.js"),s=t("./three-math.js"),r=t("./util.js"),o=!1;e.prototype.addAccelMeasurement=function(t,i){this.currentAccelMeasurement.set(t,i)},e.prototype.addGyroMeasurement=function(t,i){this.currentGyroMeasurement.set(t,i);var e=i-this.previousGyroMeasurement.timestampS;r.isTimestampDeltaValid(e)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},e.prototype.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var t=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,i=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,t);this.gyroIntegralQ.multiply(i),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(i);var e=new s.Quaternion;e.copy(this.filterQ),e.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(e),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var n=new s.Quaternion;n.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),n.inverse(),o&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",s.Math.radToDeg(r.getQuaternionAngle(n)),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var h=new s.Quaternion;h.copy(this.filterQ),h.multiply(n),this.filterQ.slerp(h,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},e.prototype.getOrientation=function(){return this.filterQ},e.prototype.accelToQuaternion_=function(t){var i=new s.Vector3;i.copy(t),i.normalize();var e=new s.Quaternion;return e.setFromUnitVectors(new s.Vector3(0,0,-1),i),e.inverse(),e},e.prototype.gyroToQuaternionDelta_=function(t,i){var e=new s.Quaternion,n=new s.Vector3;return n.copy(t),n.normalize(),e.setFromAxisAngle(n,t.length()*i),e},i.exports=e},{"./sensor-sample.js":8,"./three-math.js":9,"./util.js":11}],4:[function(t,i){function e(){this.deviceId="webvr-polyfill:fused",this.deviceName="VR Position Device (webvr-polyfill:fused)",this.accelerometer=new h.Vector3,this.gyroscope=new h.Vector3,window.addEventListener("devicemotion",this.onDeviceMotionChange_.bind(this)),window.addEventListener("orientationchange",this.onScreenOrientationChange_.bind(this)),this.filter=new s(WebVRConfig.K_FILTER||.98),this.posePredictor=new r(WebVRConfig.PREDICTION_TIME_S||.05),this.touchPanner=new o,this.filterToWorldQ=new h.Quaternion,a.isIOS()?this.filterToWorldQ.setFromAxisAngle(new h.Vector3(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new h.Vector3(1,0,0),-Math.PI/2),this.worldToScreenQ=new h.Quaternion,this.setScreenTransform_(),this.resetQ=new h.Quaternion,this.isFirefoxAndroid=a.isFirefoxAndroid(),this.isIOS=a.isIOS()}var n=t("./base.js").PositionSensorVRDevice,s=t("./complementary-filter.js"),r=t("./pose-predictor.js"),o=t("./touch-panner.js"),h=t("./three-math.js"),a=t("./util.js");e.prototype=new n,e.prototype.getState=function(){return{hasOrientation:!0,orientation:this.getOrientation(),hasPosition:!1,position:null}},e.prototype.getOrientation=function(){var t=this.filter.getOrientation();this.predictedQ=this.posePredictor.getPrediction(t,this.gyroscope,this.previousTimestampS);var i=new h.Quaternion;return i.copy(this.filterToWorldQ),i.multiply(this.resetQ),i.multiply(this.touchPanner.getOrientation()),i.multiply(this.predictedQ),i.multiply(this.worldToScreenQ),i},e.prototype.resetSensor=function(){var t=new h.Euler;t.setFromQuaternion(this.filter.getOrientation());var i=t.y;console.log("resetSensor with yaw: %f",i),this.resetQ.setFromAxisAngle(new h.Vector3(0,0,1),-i),this.touchPanner.resetSensor()},e.prototype.onDeviceMotionChange_=function(t){var i=t.accelerationIncludingGravity,e=t.rotationRate,n=t.timeStamp/1e3;this.isFirefoxAndroid&&(n/=1e3);var s=n-this.previousTimestampS;return s<=a.MIN_TIMESTEP||s>a.MAX_TIMESTEP?(console.warn("Invalid timestamps detected. Time step between successive gyroscope sensor samples is very small or not monotonic"),void(this.previousTimestampS=n)):(this.accelerometer.set(-i.x,-i.y,-i.z),this.gyroscope.set(e.alpha,e.beta,e.gamma),(this.isIOS||this.isFirefoxAndroid)&&this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addAccelMeasurement(this.accelerometer,n),this.filter.addGyroMeasurement(this.gyroscope,n),void(this.previousTimestampS=n))},e.prototype.onScreenOrientationChange_=function(){this.setScreenTransform_()},e.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new h.Vector3(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new h.Vector3(0,0,1),Math.PI/2);break;case 180:}},i.exports=e},{"./base.js":1,"./complementary-filter.js":3,"./pose-predictor.js":7,"./three-math.js":9,"./touch-panner.js":10,"./util.js":11}],5:[function(t){var i=t("./webvr-polyfill.js");window.WebVRConfig=window.WebVRConfig||{},new i},{"./webvr-polyfill.js":12}],6:[function(t,i){function e(){this.deviceId="webvr-polyfill:mouse-keyboard",this.deviceName="VR Position Device (webvr-polyfill:mouse-keyboard)",window.addEventListener("keydown",this.onKeyDown_.bind(this)),window.addEventListener("mousemove",this.onMouseMove_.bind(this)),window.addEventListener("mousedown",this.onMouseDown_.bind(this)),window.addEventListener("mouseup",this.onMouseUp_.bind(this)),this.phi=0,this.theta=0,this.targetAngle=null,this.euler=new s.Euler,this.orientation=new s.Quaternion,this.rotateStart=new s.Vector2,this.rotateEnd=new s.Vector2,this.rotateDelta=new s.Vector2}var n=t("./base.js").PositionSensorVRDevice,s=t("./three-math.js"),r=t("./util.js"),o=.15,h=80,a=.5,u=.3;e.prototype=new n,e.prototype.getState=function(){return this.euler.set(this.phi,this.theta,0,"YXZ"),this.orientation.setFromEuler(this.euler),{hasOrientation:!0,orientation:this.orientation,hasPosition:!1,position:null}},e.prototype.onKeyDown_=function(t){return"undefined"==typeof E2||"undefined"==typeof E2.app?!0:!E2.app.isVRCameraActive()||E2.util.isTextInputInFocus(t)?!0:(38==t.keyCode?this.animatePhi_(this.phi+o):39==t.keyCode?this.animateTheta_(this.theta-o):40==t.keyCode?this.animatePhi_(this.phi-o):37==t.keyCode&&this.animateTheta_(this.theta+o),!0)},e.prototype.animateTheta_=function(t){this.animateKeyTransitions_("theta",t)},e.prototype.animatePhi_=function(t){t=r.clamp(t,-Math.PI/2,Math.PI/2),this.animateKeyTransitions_("phi",t)},e.prototype.animateKeyTransitions_=function(t,i){this.angleAnimation&&clearInterval(this.angleAnimation);var e=this[t],n=new Date;this.angleAnimation=setInterval(function(){var s=new Date-n;if(s>=h)return this[t]=i,void clearInterval(this.angleAnimation);var r=s/h;this[t]=e+(i-e)*r}.bind(this),1e3/60)},e.prototype.onMouseDown_=function(t){E2.app.isVRCameraActive()&&(this.rotateStart.set(t.clientX,t.clientY),this.isDragging=!0)},e.prototype.onMouseMove_=function(t){if(this.isDragging||this.isPointerLocked_()){if(this.isPointerLocked_()){var i=t.movementX||t.mozMovementX||0,e=t.movementY||t.mozMovementY||0;this.rotateEnd.set(this.rotateStart.x-i,this.rotateStart.y-e)}else this.rotateEnd.set(t.clientX,t.clientY);this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd);var n=document.body;this.phi+=2*Math.PI*this.rotateDelta.y/n.clientHeight*u,this.theta+=2*Math.PI*this.rotateDelta.x/n.clientWidth*a,this.phi=r.clamp(this.phi,-Math.PI/2,Math.PI/2)}},e.prototype.onMouseUp_=function(){this.isDragging=!1},e.prototype.isPointerLocked_=function(){var t=document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement;return void 0!==t},e.prototype.resetSensor=function(){console.error("Not implemented yet.")},i.exports=e},{"./base.js":1,"./three-math.js":9,"./util.js":11}],7:[function(t,i){function e(t){this.predictionTimeS=t,this.previousQ=new n.Quaternion,this.previousTimestampS=null,this.deltaQ=new n.Quaternion,this.outQ=new n.Quaternion}var n=t("./three-math.js"),s=!1;e.prototype.getPrediction=function(t,i,e){if(!this.previousTimestampS)return this.previousQ.copy(t),this.previousTimestampS=e,t;var r=new n.Vector3;r.copy(i),r.normalize();var o=i.length();if(o<n.Math.degToRad(20))return s&&console.log("Moving slowly, at %s deg/s: no prediction",n.Math.radToDeg(o).toFixed(1)),this.outQ.copy(t),this.previousQ.copy(t),this.outQ;var h=(e-this.previousTimestampS,o*this.predictionTimeS);return this.deltaQ.setFromAxisAngle(r,h),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(t),this.outQ},i.exports=e},{"./three-math.js":9}],8:[function(t,i){function e(t,i){this.set(t,i)}e.prototype.set=function(t,i){this.sample=t,this.timestampS=i},e.prototype.copy=function(t){this.set(t.sample,t.timestampS)},i.exports=e},{}],9:[function(t,i){var e=window.THREE||{};e.Quaternion&&e.Vector3&&e.Vector2&&e.Euler&&e.Math||(console.log("No THREE.js found."),e.Quaternion=function(t,i,e,n){this._x=t||0,this._y=i||0,this._z=e||0,this._w=void 0!==n?n:1},e.Quaternion.prototype={constructor:e.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get w(){return this._w},set w(t){this._w=t,this.onChangeCallback()},set:function(t,i,e,n){return this._x=t,this._y=i,this._z=e,this._w=n,this.onChangeCallback(),this},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,i){if(t instanceof e.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var n=Math.cos(t._x/2),s=Math.cos(t._y/2),r=Math.cos(t._z/2),o=Math.sin(t._x/2),h=Math.sin(t._y/2),a=Math.sin(t._z/2);return"XYZ"===t.order?(this._x=o*s*r+n*h*a,this._y=n*h*r-o*s*a,this._z=n*s*a+o*h*r,this._w=n*s*r-o*h*a):"YXZ"===t.order?(this._x=o*s*r+n*h*a,this._y=n*h*r-o*s*a,this._z=n*s*a-o*h*r,this._w=n*s*r+o*h*a):"ZXY"===t.order?(this._x=o*s*r-n*h*a,this._y=n*h*r+o*s*a,this._z=n*s*a+o*h*r,this._w=n*s*r-o*h*a):"ZYX"===t.order?(this._x=o*s*r-n*h*a,this._y=n*h*r+o*s*a,this._z=n*s*a-o*h*r,this._w=n*s*r+o*h*a):"YZX"===t.order?(this._x=o*s*r+n*h*a,this._y=n*h*r+o*s*a,this._z=n*s*a-o*h*r,this._w=n*s*r-o*h*a):"XZY"===t.order&&(this._x=o*s*r-n*h*a,this._y=n*h*r-o*s*a,this._z=n*s*a+o*h*r,this._w=n*s*r+o*h*a),i!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(t,i){var e=i/2,n=Math.sin(e);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(e),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var i,e=t.elements,n=e[0],s=e[4],r=e[8],o=e[1],h=e[5],a=e[9],u=e[2],c=e[6],l=e[10],y=n+h+l;return y>0?(i=.5/Math.sqrt(y+1),this._w=.25/i,this._x=(c-a)*i,this._y=(r-u)*i,this._z=(o-s)*i):n>h&&n>l?(i=2*Math.sqrt(1+n-h-l),this._w=(c-a)/i,this._x=.25*i,this._y=(s+o)/i,this._z=(r+u)/i):h>l?(i=2*Math.sqrt(1+h-n-l),this._w=(r-u)/i,this._x=(s+o)/i,this._y=.25*i,this._z=(a+c)/i):(i=2*Math.sqrt(1+l-n-h),this._w=(o-s)/i,this._x=(r+u)/i,this._y=(a+c)/i,this._z=.25*i),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,i,n=1e-6;return function(s,r){return void 0===t&&(t=new e.Vector3),i=s.dot(r)+1,n>i?(i=0,Math.abs(s.x)>Math.abs(s.z)?t.set(-s.y,s.x,0):t.set(0,-s.z,s.y)):t.crossVectors(s,r),this._x=t.x,this._y=t.y,this._z=t.z,this._w=i,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,i){var e=t._x,n=t._y,s=t._z,r=t._w,o=i._x,h=i._y,a=i._z,u=i._w;return this._x=e*u+r*o+n*a-s*h,this._y=n*u+r*h+s*o-e*a,this._z=s*u+r*a+e*h-n*o,this._w=r*u-e*o-n*h-s*a,this.onChangeCallback(),this},multiplyVector3:function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},slerp:function(t,i){if(0===i)return this;if(1===i)return this.copy(t);var e=this._x,n=this._y,s=this._z,r=this._w,o=r*t._w+e*t._x+n*t._y+s*t._z;if(0>o?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=r,this._x=e,this._y=n,this._z=s,this;var h=Math.acos(o),a=Math.sqrt(1-o*o);if(Math.abs(a)<.001)return this._w=.5*(r+this._w),this._x=.5*(e+this._x),this._y=.5*(n+this._y),this._z=.5*(s+this._z),this;var u=Math.sin((1-i)*h)/a,c=Math.sin(i*h)/a;return this._w=r*u+this._w*c,this._x=e*u+this._x*c,this._y=n*u+this._y*c,this._z=s*u+this._z*c,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,i){return void 0===i&&(i=0),this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this.onChangeCallback(),this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){},clone:function(){return new e.Quaternion(this._x,this._y,this._z,this._w)}},e.Quaternion.slerp=function(t,i,e,n){return e.copy(t).slerp(i,n)},e.Vector2=function(t,i){this.x=t||0,this.y=i||0},e.Vector2.prototype={constructor:e.Vector2,set:function(t,i){return this.x=t,this.y=i,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this)},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},addScalar:function(t){return this.x+=t,this.y+=t,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this)},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){if(0!==t){var i=1/t;this.x*=i,this.y*=i}else this.x=0,this.y=0;return this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this},clamp:function(t,i){return this.x<t.x?this.x=t.x:this.x>i.x&&(this.x=i.x),this.y<t.y?this.y=t.y:this.y>i.y&&(this.y=i.y),this},clampScalar:function(){var t,i;return function(n,s){return void 0===t&&(t=new e.Vector2,i=new e.Vector2),t.set(n,n),i.set(s,s),this.clamp(t,i)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,e=this.y-t.y;return i*i+e*e},setLength:function(t){var i=this.length();return 0!==i&&t!==i&&this.multiplyScalar(t/i),this},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t},fromAttribute:function(t,i,e){return void 0===e&&(e=0),i=i*t.itemSize+e,this.x=t.array[i],this.y=t.array[i+1],this},clone:function(){return new e.Vector2(this.x,this.y)}},e.Vector3=function(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0},e.Vector3.prototype={constructor:e.Vector3,set:function(t,i,e){return this.x=t,this.y=i,this.z=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,i)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},applyEuler:function(){var t;return function(i){return i instanceof e.Euler==!1&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===t&&(t=new e.Quaternion),this.applyQuaternion(t.setFromEuler(i)),this}}(),applyAxisAngle:function(){var t;return function(i,n){return void 0===t&&(t=new e.Quaternion),this.applyQuaternion(t.setFromAxisAngle(i,n)),this}}(),applyMatrix3:function(t){var i=this.x,e=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[3]*e+s[6]*n,this.y=s[1]*i+s[4]*e+s[7]*n,this.z=s[2]*i+s[5]*e+s[8]*n,this},applyMatrix4:function(t){var i=this.x,e=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*e+s[8]*n+s[12],this.y=s[1]*i+s[5]*e+s[9]*n+s[13],this.z=s[2]*i+s[6]*e+s[10]*n+s[14],this},applyProjection:function(t){var i=this.x,e=this.y,n=this.z,s=t.elements,r=1/(s[3]*i+s[7]*e+s[11]*n+s[15]);return this.x=(s[0]*i+s[4]*e+s[8]*n+s[12])*r,this.y=(s[1]*i+s[5]*e+s[9]*n+s[13])*r,this.z=(s[2]*i+s[6]*e+s[10]*n+s[14])*r,this},applyQuaternion:function(t){var i=this.x,e=this.y,n=this.z,s=t.x,r=t.y,o=t.z,h=t.w,a=h*i+r*n-o*e,u=h*e+o*i-s*n,c=h*n+s*e-r*i,l=-s*i-r*e-o*n;return this.x=a*h+l*-s+u*-o-c*-r,this.y=u*h+l*-r+c*-s-a*-o,this.z=c*h+l*-o+a*-r-u*-s,this},project:function(){var t;return function(i){return void 0===t&&(t=new e.Matrix4),t.multiplyMatrices(i.projectionMatrix,t.getInverse(i.matrixWorld)),this.applyProjection(t)}}(),unproject:function(){var t;return function(i){return void 0===t&&(t=new e.Matrix4),t.multiplyMatrices(i.matrixWorld,t.getInverse(i.projectionMatrix)),this.applyProjection(t)}}(),transformDirection:function(t){var i=this.x,e=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*e+s[8]*n,this.y=s[1]*i+s[5]*e+s[9]*n,this.z=s[2]*i+s[6]*e+s[10]*n,this.normalize(),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){if(0!==t){var i=1/t;this.x*=i,this.y*=i,this.z*=i}else this.x=0,this.y=0,this.z=0;return this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this},clamp:function(t,i){return this.x<t.x?this.x=t.x:this.x>i.x&&(this.x=i.x),this.y<t.y?this.y=t.y:this.y>i.y&&(this.y=i.y),this.z<t.z?this.z=t.z:this.z>i.z&&(this.z=i.z),this},clampScalar:function(){var t,i;return function(n,s){return void 0===t&&(t=new e.Vector3,i=new e.Vector3),t.set(n,n,n),i.set(s,s,s),this.clamp(t,i)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var i=this.length();return 0!==i&&t!==i&&this.multiplyScalar(t/i),this},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this},cross:function(t,i){if(void 0!==i)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,i);var e=this.x,n=this.y,s=this.z;return this.x=n*t.z-s*t.y,this.y=s*t.x-e*t.z,this.z=e*t.y-n*t.x,this},crossVectors:function(t,i){var e=t.x,n=t.y,s=t.z,r=i.x,o=i.y,h=i.z;return this.x=n*h-s*o,this.y=s*r-e*h,this.z=e*o-n*r,this},projectOnVector:function(){var t,i;return function(n){return void 0===t&&(t=new e.Vector3),t.copy(n).normalize(),i=this.dot(t),this.copy(t).multiplyScalar(i)}}(),projectOnPlane:function(){var t;return function(i){return void 0===t&&(t=new e.Vector3),t.copy(this).projectOnVector(i),this.sub(t)}}(),reflect:function(){var t;return function(i){return void 0===t&&(t=new e.Vector3),this.sub(t.copy(i).multiplyScalar(2*this.dot(i)))}}(),angleTo:function(t){var i=this.dot(t)/(this.length()*t.length());return Math.acos(e.Math.clamp(i,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,e=this.y-t.y,n=this.z-t.z;return i*i+e*e+n*n},setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,i){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,i)},setFromMatrixPosition:function(t){return this.x=t.elements[12],this.y=t.elements[13],this.z=t.elements[14],this},setFromMatrixScale:function(t){var i=this.set(t.elements[0],t.elements[1],t.elements[2]).length(),e=this.set(t.elements[4],t.elements[5],t.elements[6]).length(),n=this.set(t.elements[8],t.elements[9],t.elements[10]).length();return this.x=i,this.y=e,this.z=n,this},setFromMatrixColumn:function(t,i){var e=4*t,n=i.elements;return this.x=n[e],this.y=n[e+1],this.z=n[e+2],this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t},fromAttribute:function(t,i,e){return void 0===e&&(e=0),i=i*t.itemSize+e,this.x=t.array[i],this.y=t.array[i+1],this.z=t.array[i+2],this},clone:function(){return new e.Vector3(this.x,this.y,this.z)}},e.Euler=function(t,i,n,s){this._x=t||0,this._y=i||0,this._z=n||0,this._order=s||e.Euler.DefaultOrder},e.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],e.Euler.DefaultOrder="XYZ",e.Euler.prototype={constructor:e.Euler,_x:0,_y:0,_z:0,_order:e.Euler.DefaultOrder,get x(){return this._x},set x(t){this._x=t,this.onChangeCallback()},get y(){return this._y},set y(t){this._y=t,this.onChangeCallback()},get z(){return this._z},set z(t){this._z=t,this.onChangeCallback()},get order(){return this._order},set order(t){this._order=t,this.onChangeCallback()},set:function(t,i,e,n){return this._x=t,this._y=i,this._z=e,this._order=n||this._order,this.onChangeCallback(),this},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,i,n){var s=e.Math.clamp,r=t.elements,o=r[0],h=r[4],a=r[8],u=r[1],c=r[5],l=r[9],y=r[2],d=r[6],f=r[10];return i=i||this._order,"XYZ"===i?(this._y=Math.asin(s(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-l,f),this._z=Math.atan2(-h,o)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===i?(this._x=Math.asin(-s(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(a,f),this._z=Math.atan2(u,c)):(this._y=Math.atan2(-y,o),this._z=0)):"ZXY"===i?(this._x=Math.asin(s(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-y,f),this._z=Math.atan2(-h,c)):(this._y=0,this._z=Math.atan2(u,o))):"ZYX"===i?(this._y=Math.asin(-s(y,-1,1)),Math.abs(y)<.99999?(this._x=Math.atan2(d,f),this._z=Math.atan2(u,o)):(this._x=0,this._z=Math.atan2(-h,c))):"YZX"===i?(this._z=Math.asin(s(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-y,o)):(this._x=0,this._y=Math.atan2(a,f))):"XZY"===i?(this._z=Math.asin(-s(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-l,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+i),this._order=i,n!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var t;return function(i,n,s){return void 0===t&&(t=new e.Matrix4),t.makeRotationFromQuaternion(i),this.setFromRotationMatrix(t,n,s),this}}(),setFromVector3:function(t,i){return this.set(t.x,t.y,t.z,i||this._order)},reorder:function(){var t=new e.Quaternion;return function(i){t.setFromEuler(this),this.setFromQuaternion(t,i)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new e.Vector3(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){},clone:function(){return new e.Euler(this._x,this._y,this._z,this._order)}},e.Math={generateUUID:function(){var t,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=new Array(36),n=0;return function(){for(var s=0;36>s;s++)8==s||13==s||18==s||23==s?e[s]="-":14==s?e[s]="4":(2>=n&&(n=33554432+16777216*Math.random()|0),t=15&n,n>>=4,e[s]=i[19==s?3&t|8:t]);return e.join("")}}(),clamp:function(t,i,e){return i>t?i:t>e?e:t},clampBottom:function(t,i){return i>t?i:t},mapLinear:function(t,i,e,n,s){return n+(t-i)*(s-n)/(e-i)},smoothstep:function(t,i,e){return i>=t?0:t>=e?1:(t=(t-i)/(e-i),t*t*(3-2*t))},smootherstep:function(t,i,e){return i>=t?0:t>=e?1:(t=(t-i)/(e-i),t*t*t*(t*(6*t-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(t,i){return Math.floor(this.randFloat(t,i))},randFloat:function(t,i){return t+Math.random()*(i-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(){var t=Math.PI/180;return function(i){return i*t}}(),radToDeg:function(){var t=180/Math.PI;return function(i){return i*t}}(),isPowerOfTwo:function(t){return 0===(t&t-1)&&0!==t},nextPowerOfTwo:function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t++,t}}),i.exports=e},{}],10:[function(t,i){function e(){window.addEventListener("touchstart",this.onTouchStart_.bind(this)),window.addEventListener("touchmove",this.onTouchMove_.bind(this)),window.addEventListener("touchend",this.onTouchEnd_.bind(this)),this.isTouching=!1,this.rotateStart=new n.Vector2,this.rotateEnd=new n.Vector2,this.rotateDelta=new n.Vector2,this.theta=0,this.orientation=new n.Quaternion}var n=t("./three-math.js"),s=.5;e.prototype.getOrientation=function(){return this.orientation.setFromEuler(new n.Euler(0,0,this.theta)),this.orientation},e.prototype.resetSensor=function(){this.theta=0},e.prototype.onTouchStart_=function(t){1==t.touches.length&&(this.rotateStart.set(t.touches[0].pageX,t.touches[0].pageY),this.isTouching=!0)},e.prototype.onTouchMove_=function(t){if(this.isTouching){this.rotateEnd.set(t.touches[0].pageX,t.touches[0].pageY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd);
var i=document.body;this.theta+=2*Math.PI*this.rotateDelta.x/i.clientWidth*s}},e.prototype.onTouchEnd_=function(){this.isTouching=!1},i.exports=e},{"./three-math.js":9}],11:[function(t,i){var e=window.Util||{};e.MIN_TIMESTEP=1e-4,e.MAX_TIMESTEP=1,e.clamp=function(t,i,e){return Math.min(Math.max(i,t),e)},e.isIOS=function(){return/iPad|iPhone|iPod/.test(navigator.platform)},e.isFirefoxAndroid=function(){return-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android")},e.isTimestampDeltaValid=function(t){return isNaN(t)?!1:t<=e.MIN_TIMESTEP?!1:t>e.MAX_TIMESTEP?!1:!0},i.exports=e},{}],12:[function(t,i){function e(){this.devices=[],this.isWebVRAvailable()||this.enablePolyfill()}var n=t("./cardboard-hmd-vr-device.js"),s=t("./fusion-position-sensor-vr-device.js"),r=t("./mouse-keyboard-position-sensor-vr-device.js"),o=t("./base.js").HMDVRDevice,h=t("./base.js").PositionSensorVRDevice;e.prototype.isWebVRAvailable=function(){return"getVRDevices"in navigator||"mozGetVRDevices"in navigator},e.prototype.enablePolyfill=function(){this.isCardboardCompatible()&&this.devices.push(new n),this.devices.push(this.isMobile()?new s:new r),navigator.getVRDevices=this.getVRDevices.bind(this),window.HMDVRDevice=o,window.PositionSensorVRDevice=h},e.prototype.getVRDevices=function(){var t=this.devices;return new Promise(function(i,e){try{i(t)}catch(n){e(n)}})},e.prototype.isMobile=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},e.prototype.isCardboardCompatible=function(){return this.isMobile()||WebVRConfig.FORCE_ENABLE_VR},i.exports=e},{"./base.js":1,"./cardboard-hmd-vr-device.js":2,"./fusion-position-sensor-vr-device.js":4,"./mouse-keyboard-position-sensor-vr-device.js":6}]},{},[5]);
;
!function M(N,D,j){function L(I,A){if(!D[I]){if(!N[I]){var T="function"==typeof require&&require;if(!A&&T)return T(I,!0);if(g)return g(I,!0);var i=new Error("Cannot find module '"+I+"'");throw i.code="MODULE_NOT_FOUND",i}var u=D[I]={exports:{}};N[I][0].call(u.exports,function(M){var D=N[I][1][M];return L(D?D:M)},u,u.exports,M,N,D,j)}return D[I].exports}for(var g="function"==typeof require&&require,I=0;I<j.length;I++)L(j[I]);return L}({1:[function(M,N){function D(){this.loadIcons_();var M=this.createButton();M.src=this.ICONS.fullscreen,M.title="Fullscreen mode";var N=M.style;N.bottom=0,N.right=0,M.addEventListener("click",this.createClickHandler_("fs")),document.body.appendChild(M),this.fsButton=M;var D=this.createButton();D.src=this.ICONS.cardboard,D.title="Virtual reality mode";var N=D.style;N.bottom=0,N.right="48px",D.addEventListener("click",this.createClickHandler_("vr")),document.body.appendChild(D),this.vrButton=D;var j=this.createButton();j.title="Back to previous mode";var N=j.style;N.left=0,N.top=0,j.src=this.ICONS.back,j.addEventListener("click",this.createClickHandler_("back")),document.body.appendChild(j),this.backButton=j,this.isVisible=!0}var j=M("./modes.js"),L=M("./emitter.js"),g=M("./util.js");D.prototype=new L,D.prototype.createButton=function(){var M=document.createElement("img"),N=M.style;return N.position="fixed",N.width="24px",N.height="24px",N.backgroundSize="cover",N.backgroundColor="transparent",N.border=0,N.userSelect="none",N.webkitUserSelect="none",N.MozUserSelect="none",N.cursor="pointer",N.padding="12px",N.zIndex=1,N.display="none",M.draggable=!1,M.addEventListener("dragstart",function(M){M.preventDefault()}),M.addEventListener("mouseenter",function(){N.webkitFilter="drop-shadow(0 0 5px rgba(255,255,255,1))"}),M.addEventListener("mouseleave",function(){N.webkitFilter=""}),M},D.prototype.setMode=function(M,N){if(this.isVisible){switch(M){case j.NORMAL:this.fsButton.style.display="block",this.fsButton.src=this.ICONS.fullscreen,this.vrButton.style.display=N?"block":"none",this.backButton.style.display="none";break;case j.MAGIC_WINDOW:this.fsButton.style.display="block",this.fsButton.src=this.ICONS.exitFullscreen,this.vrButton.style.display=N?"block":"none",this.backButton.style.display="block";break;case j.VR:this.fsButton.style.display="none",this.vrButton.style.display="none",this.backButton.style.display="block"}var D=this.fsButton.style.display;this.fsButton.style.display="inline-block",this.fsButton.offsetHeight,this.fsButton.style.display=D}},D.prototype.setVisibility=function(M){this.isVisible=M,this.fsButton.style.display=M?"block":"none",this.vrButton.style.display=M?"block":"none",this.backButton.style.display=M?"block":"none"},D.prototype.createClickHandler_=function(M){return function(N){N.stopPropagation(),N.preventDefault(),this.emit(M)}.bind(this)},D.prototype.loadIcons_=function(){this.ICONS={},this.ICONS.cardboard=g.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMjAuNzQgNkgzLjIxQzIuNTUgNiAyIDYuNTcgMiA3LjI4djEwLjQ0YzAgLjcuNTUgMS4yOCAxLjIzIDEuMjhoNC43OWMuNTIgMCAuOTYtLjMzIDEuMTQtLjc5bDEuNC0zLjQ4Yy4yMy0uNTkuNzktMS4wMSAxLjQ0LTEuMDFzMS4yMS40MiAxLjQ1IDEuMDFsMS4zOSAzLjQ4Yy4xOS40Ni42My43OSAxLjExLjc5aDQuNzljLjcxIDAgMS4yNi0uNTcgMS4yNi0xLjI4VjcuMjhjMC0uNy0uNTUtMS4yOC0xLjI2LTEuMjh6TTcuNSAxNC42MmMtMS4xNyAwLTIuMTMtLjk1LTIuMTMtMi4xMiAwLTEuMTcuOTYtMi4xMyAyLjEzLTIuMTMgMS4xOCAwIDIuMTIuOTYgMi4xMiAyLjEzcy0uOTUgMi4xMi0yLjEyIDIuMTJ6bTkgMGMtMS4xNyAwLTIuMTMtLjk1LTIuMTMtMi4xMiAwLTEuMTcuOTYtMi4xMyAyLjEzLTIuMTNzMi4xMi45NiAyLjEyIDIuMTMtLjk1IDIuMTItMi4xMiAyLjEyeiIvPgogICAgPHBhdGggZmlsbD0ibm9uZSIgZD0iTTAgMGgyNHYyNEgwVjB6Ii8+Cjwvc3ZnPgo="),this.ICONS.fullscreen=g.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+CiAgICA8cGF0aCBkPSJNNyAxNEg1djVoNXYtMkg3di0zem0tMi00aDJWN2gzVjVINXY1em0xMiA3aC0zdjJoNXYtNWgtMnYzek0xNCA1djJoM3YzaDJWNWgtNXoiLz4KPC9zdmc+Cg=="),this.ICONS.exitFullscreen=g.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+CiAgICA8cGF0aCBkPSJNNSAxNmgzdjNoMnYtNUg1djJ6bTMtOEg1djJoNVY1SDh2M3ptNiAxMWgydi0zaDN2LTJoLTV2NXptMi0xMVY1aC0ydjVoNVY4aC0zeiIvPgo8L3N2Zz4K"),this.ICONS.back=g.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+CiAgICA8cGF0aCBkPSJNMjAgMTFINy44M2w1LjU5LTUuNTlMMTIgNGwtOCA4IDggOCAxLjQxLTEuNDFMNy44MyAxM0gyMHYtMnoiLz4KPC9zdmc+Cg==")},N.exports=D},{"./emitter.js":4,"./modes.js":6,"./util.js":8}],2:[function(M,N){function D(M){var N=M.context.canvas.width,D=M.context.canvas.height,j={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1,depthBuffer:!0};return new THREE.WebGLRenderTarget(N,D,j)}function j(M){var N=g.getLeftEyeCenter(),j=g.getRightEyeCenter();I.leftCenter={type:"v2",value:new THREE.Vector2(N.x,N.y)},I.rightCenter={type:"v2",value:new THREE.Vector2(j.x,j.y)},WebVRConfig.DISTORTION_BGCOLOR&&(I.uniforms.background={type:"v4",value:WebVRConfig.DISTORTION_BGCOLOR});var L=new A(I),T=null,i=M.render,u=M.setSize,E=!1;this.patch=function(){E&&(T=D(M),M.render=function(N,D,j,L){i.call(M,N,D,T,L)},M.setSize=function(N,j){u.call(M,N,j),T=D(M)})},this.unpatch=function(){E&&(M.render=i,M.setSize=u)},this.preRender=function(){E&&M.setRenderTarget(T)},this.postRender=function(){if(E){var N=M.getSize();M.setViewport(0,0,N.width,N.height),L.render(i.bind(M),T)}},this.setActive=function(M){E=M}}var L=M("./device-info.js"),g=new L,I={uniforms:{tDiffuse:{type:"t",value:null},distortion:{type:"v2",value:new THREE.Vector2(.441,.156)},leftCenter:{type:"v2",value:new THREE.Vector2(.5,.5)},rightCenter:{type:"v2",value:new THREE.Vector2(.5,.5)},background:{type:"v4",value:new THREE.Vector4(0,0,0,1)}},vertexShader:["varying vec2 vUV;","void main() {","vUV = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 distortion;","uniform vec2 leftCenter;","uniform vec2 rightCenter;","uniform vec4 background;","varying vec2 vUV;","float poly(float val) {","return 1.0 + (distortion.x + distortion.y * val) * val;","}","vec2 barrel(vec2 v, vec2 center) {","vec2 w = v - center;","return poly(dot(w, w)) * w + center;","}","void main() {","bool isLeft = (vUV.x < 0.5);","float offset = isLeft ? 0.0 : 0.5;","vec2 a = barrel(vec2((vUV.x - offset) / 0.5, vUV.y), isLeft ? leftCenter : rightCenter);","if (a.x < 0.0 || a.x > 1.0 || a.y < 0.0 || a.y > 1.0) {","gl_FragColor = background;","} else {","gl_FragColor = texture2D(tDiffuse, vec2(a.x * 0.5 + offset, a.y));","}","}"].join("\n")},A=function(M){this.uniforms=THREE.UniformsUtils.clone(M.uniforms),this.material=new THREE.ShaderMaterial({defines:M.defines||{},uniforms:this.uniforms,vertexShader:M.vertexShader,fragmentShader:M.fragmentShader}),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.scene.add(this.quad),this.render=function(M,N){this.uniforms.tDiffuse.value=N,this.quad.material=this.material,M(this.scene,this.camera)}};N.exports=j},{"./device-info.js":3}],3:[function(M,N){function D(){this.device=this.determineDevice_(),this.enclosure=T.CardboardV1}function j(M){this.userAgentRegExp=M.userAgentRegExp,this.width=M.width,this.height=M.height,this.widthMm=M.widthMm,this.heightMm=M.heightMm,this.bevelMm=M.bevelMm}function L(M){this.k1=M.k1,this.k2=M.k2,this.ipdMm=M.ipdMm,this.baselineLensCenterMm=M.baselineLensCenterMm}var g=M("./util.js"),I={iPhone5:new j({width:640,height:1136,widthMm:51.27,heightMm:90.11,bevelMm:3.96}),iPhone6:new j({width:750,height:1334,widthMm:58.4,heightMm:103.8,bevelMm:3.71}),iPhone6Plus:new j({width:1242,height:2208,widthMm:69.54,heightMm:122.35,bevelMm:4.62})},A={Nexus5:new j({userAgentRegExp:/Nexus 5/,widthMm:62,heightMm:110,bevelMm:4}),GalaxyS3:new j({userAgentRegExp:/GT-I9300/,widthMm:60,heightMm:106,bevelMm:5}),GalaxyS4:new j({userAgentRegExp:/GT-I9505/,widthMm:62.5,heightMm:111,bevelMm:4}),GalaxyS5:new j({userAgentRegExp:/SM-G900F/,widthMm:66,heightMm:113,bevelMm:5}),GalaxyS6:new j({userAgentRegExp:/SM-G920/,widthMm:63.5,heightMm:114,bevelMm:3.5})},T={CardboardV1:new L({ipdMm:61,baselineLensCenterMm:37.26}),FunkyMonkey:new L({})},i={x:.5,y:.5},u={x:.5,y:.5};D.prototype.getDevice=function(){return this.device},D.prototype.getLeftEyeCenter=function(){if(!this.device)return i;var M=this.enclosure.ipdMm/2,N=this.enclosure.baselineLensCenterMm,D=this.device.heightMm/2,j=this.device.widthMm,L=N-this.device.bevelMm,g=1-M/D,I=1-L/j;return{x:g,y:I}},D.prototype.getRightEyeCenter=function(){if(!this.device)return u;var M=this.getLeftEyeCenter();return{x:1-M.x,y:M.y}},D.prototype.determineDevice_=function(){return g.isIOS()?this.determineIPhone_():this.determineAndroid_()},D.prototype.determineIPhone_=function(){var M=(navigator.userAgent||navigator.vendor||window.opera,screen.availWidth),N=screen.availHeight,D=M*window.devicePixelRatio,j=N*window.devicePixelRatio;for(var L in I){var g=I[L];if(g.width==D||g.width==j)return console.log("Detected iPhone: %s",L),g}return console.error("Unable to detect iPhone type."),null},D.prototype.determineAndroid_=function(){for(var M in A){var N=A[M];if(navigator.userAgent.match(N.userAgentRegExp))return console.log("Detected Android: %s",M),N}return null},N.exports=D},{"./util.js":8}],4:[function(M,N){function D(){this.callbacks={}}D.prototype.emit=function(M){var N=this.callbacks[M];if(!N)return void console.log("No valid callback specified.");var D=[].slice.call(arguments);D.shift();for(var j=0;j<N.length;j++)N[j].apply(this,D)},D.prototype.on=function(M,N){M in this.callbacks?this.callbacks[M].push(N):this.callbacks[M]=[N]},N.exports=D},{}],5:[function(M){var N=M("./webvr-manager.js");window.WebVRConfig=window.WebVRConfig||{},window.WebVRManager=N},{"./webvr-manager.js":10}],6:[function(M,N){var D={UNKNOWN:0,NORMAL:1,MAGIC_WINDOW:2,VR:3};N.exports=D},{}],7:[function(M,N){function D(){this.loadIcon_();var M=document.createElement("div"),N=M.style;N.position="fixed",N.top=0,N.right=0,N.bottom=0,N.left=0,N.backgroundColor="gray",N.fontFamily="sans-serif";var D=document.createElement("img");D.src=this.icon;var N=D.style;N.marginLeft="25%",N.marginTop="25%",N.width="50%",M.appendChild(D);var j=document.createElement("div"),N=j.style;N.textAlign="center",N.fontSize="16px",N.lineHeight="24px",N.margin="24px 25%",N.width="50%",j.innerHTML="Place your phone into your Cardboard viewer.",M.appendChild(j);var L=document.createElement("div"),N=L.style;N.backgroundColor="#CFD8DC",N.position="fixed",N.bottom=0,N.width="100%",N.height="48px",N.padding="14px 24px",N.boxSizing="border-box",N.color="#656A6B",M.appendChild(L);var g=document.createElement("div");g.style.float="left",g.innerHTML="No Cardboard viewer?";var I=document.createElement("a");I.href="https://www.google.com/get/cardboard/get-cardboard/",I.innerHTML="get one";var N=I.style;N.float="right",N.fontWeight=600,N.textTransform="uppercase",N.borderLeft="1px solid gray",N.paddingLeft="24px",N.textDecoration="none",N.color="#656A6B",L.appendChild(g),L.appendChild(I),this.overlay=M,this.text=j,document.body.appendChild(M),this.hide()}var j=M("./util.js");D.prototype.show=function(){this.overlay.style.display="block";var M=this.overlay.querySelector("img"),N=M.style;j.isLandscapeMode()?(N.width="20%",N.marginLeft="40%",N.marginTop="3%"):(N.width="50%",N.marginLeft="25%",N.marginTop="25%"),document.body.dispatchEvent(new CustomEvent("VRManInstructionsShown"))},D.prototype.hide=function(){this.overlay.style.display="none",document.body.dispatchEvent(new CustomEvent("VRManInstructionsHidden"))},D.prototype.showTemporarily=function(M){this.show(),this.timer=setTimeout(this.hide.bind(this),M)},D.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},D.prototype.loadIcon_=function(){this.icon=j.base64("image/svg+xml","PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjE5OHB4IiBoZWlnaHQ9IjI0MHB4IiB2aWV3Qm94PSIwIDAgMTk4IDI0MCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWxuczpza2V0Y2g9Imh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaC9ucyI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDMuMy4zICgxMjA4MSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+dHJhbnNpdGlvbjwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxkZWZzPjwvZGVmcz4KICAgIDxnIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHNrZXRjaDp0eXBlPSJNU1BhZ2UiPgogICAgICAgIDxnIGlkPSJ0cmFuc2l0aW9uIiBza2V0Y2g6dHlwZT0iTVNBcnRib2FyZEdyb3VwIj4KICAgICAgICAgICAgPGcgaWQ9IkltcG9ydGVkLUxheWVycy1Db3B5LTQtKy1JbXBvcnRlZC1MYXllcnMtQ29weS0rLUltcG9ydGVkLUxheWVycy1Db3B5LTItQ29weSIgc2tldGNoOnR5cGU9Ik1TTGF5ZXJHcm91cCI+CiAgICAgICAgICAgICAgICA8ZyBpZD0iSW1wb3J0ZWQtTGF5ZXJzLUNvcHktNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsIDEwNy4wMDAwMDApIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIj4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTQ5LjYyNSwyLjUyNyBDMTQ5LjYyNSwyLjUyNyAxNTUuODA1LDYuMDk2IDE1Ni4zNjIsNi40MTggTDE1Ni4zNjIsNy4zMDQgQzE1Ni4zNjIsNy40ODEgMTU2LjM3NSw3LjY2NCAxNTYuNCw3Ljg1MyBDMTU2LjQxLDcuOTM0IDE1Ni40Miw4LjAxNSAxNTYuNDI3LDguMDk1IEMxNTYuNTY3LDkuNTEgMTU3LjQwMSwxMS4wOTMgMTU4LjUzMiwxMi4wOTQgTDE2NC4yNTIsMTcuMTU2IEwxNjQuMzMzLDE3LjA2NiBDMTY0LjMzMywxNy4wNjYgMTY4LjcxNSwxNC41MzYgMTY5LjU2OCwxNC4wNDIgQzE3MS4wMjUsMTQuODgzIDE5NS41MzgsMjkuMDM1IDE5NS41MzgsMjkuMDM1IEwxOTUuNTM4LDgzLjAzNiBDMTk1LjUzOCw4My44MDcgMTk1LjE1Miw4NC4yNTMgMTk0LjU5LDg0LjI1MyBDMTk0LjM1Nyw4NC4yNTMgMTk0LjA5NSw4NC4xNzcgMTkzLjgxOCw4NC4wMTcgTDE2OS44NTEsNzAuMTc5IEwxNjkuODM3LDcwLjIwMyBMMTQyLjUxNSw4NS45NzggTDE0MS42NjUsODQuNjU1IEMxMzYuOTM0LDgzLjEyNiAxMzEuOTE3LDgxLjkxNSAxMjYuNzE0LDgxLjA0NSBDMTI2LjcwOSw4MS4wNiAxMjYuNzA3LDgxLjA2OSAxMjYuNzA3LDgxLjA2OSBMMTIxLjY0LDk4LjAzIEwxMTMuNzQ5LDEwMi41ODYgTDExMy43MTIsMTAyLjUyMyBMMTEzLjcxMiwxMzAuMTEzIEMxMTMuNzEyLDEzMC44ODUgMTEzLjMyNiwxMzEuMzMgMTEyLjc2NCwxMzEuMzMgQzExMi41MzIsMTMxLjMzIDExMi4yNjksMTMxLjI1NCAxMTEuOTkyLDEzMS4wOTQgTDY5LjUxOSwxMDYuNTcyIEM2OC41NjksMTA2LjAyMyA2Ny43OTksMTA0LjY5NSA2Ny43OTksMTAzLjYwNSBMNjcuNzk5LDEwMi41NyBMNjcuNzc4LDEwMi42MTcgQzY3LjI3LDEwMi4zOTMgNjYuNjQ4LDEwMi4yNDkgNjUuOTYyLDEwMi4yMTggQzY1Ljg3NSwxMDIuMjE0IDY1Ljc4OCwxMDIuMjEyIDY1LjcwMSwxMDIuMjEyIEM2NS42MDYsMTAyLjIxMiA2NS41MTEsMTAyLjIxNSA2NS40MTYsMTAyLjIxOSBDNjUuMTk1LDEwMi4yMjkgNjQuOTc0LDEwMi4yMzUgNjQuNzU0LDEwMi4yMzUgQzY0LjMzMSwxMDIuMjM1IDYzLjkxMSwxMDIuMjE2IDYzLjQ5OCwxMDIuMTc4IEM2MS44NDMsMTAyLjAyNSA2MC4yOTgsMTAxLjU3OCA1OS4wOTQsMTAwLjg4MiBMMTIuNTE4LDczLjk5MiBMMTIuNTIzLDc0LjAwNCBMMi4yNDUsNTUuMjU0IEMxLjI0NCw1My40MjcgMi4wMDQsNTEuMDM4IDMuOTQzLDQ5LjkxOCBMNTkuOTU0LDE3LjU3MyBDNjAuNjI2LDE3LjE4NSA2MS4zNSwxNy4wMDEgNjIuMDUzLDE3LjAwMSBDNjMuMzc5LDE3LjAwMSA2NC42MjUsMTcuNjYgNjUuMjgsMTguODU0IEw2NS4yODUsMTguODUxIEw2NS41MTIsMTkuMjY0IEw2NS41MDYsMTkuMjY4IEM2NS45MDksMjAuMDAzIDY2LjQwNSwyMC42OCA2Ni45ODMsMjEuMjg2IEw2Ny4yNiwyMS41NTYgQzY5LjE3NCwyMy40MDYgNzEuNzI4LDI0LjM1NyA3NC4zNzMsMjQuMzU3IEM3Ni4zMjIsMjQuMzU3IDc4LjMyMSwyMy44NCA4MC4xNDgsMjIuNzg1IEM4MC4xNjEsMjIuNzg1IDg3LjQ2NywxOC41NjYgODcuNDY3LDE4LjU2NiBDODguMTM5LDE4LjE3OCA4OC44NjMsMTcuOTk0IDg5LjU2NiwxNy45OTQgQzkwLjg5MiwxNy45OTQgOTIuMTM4LDE4LjY1MiA5Mi43OTIsMTkuODQ3IEw5Ni4wNDIsMjUuNzc1IEw5Ni4wNjQsMjUuNzU3IEwxMDIuODQ5LDI5LjY3NCBMMTAyLjc0NCwyOS40OTIgTDE0OS42MjUsMi41MjcgTTE0OS42MjUsMC44OTIgQzE0OS4zNDMsMC44OTIgMTQ5LjA2MiwwLjk2NSAxNDguODEsMS4xMSBMMTAyLjY0MSwyNy42NjYgTDk3LjIzMSwyNC41NDIgTDk0LjIyNiwxOS4wNjEgQzkzLjMxMywxNy4zOTQgOTEuNTI3LDE2LjM1OSA4OS41NjYsMTYuMzU4IEM4OC41NTUsMTYuMzU4IDg3LjU0NiwxNi42MzIgODYuNjQ5LDE3LjE1IEM4My44NzgsMTguNzUgNzkuNjg3LDIxLjE2OSA3OS4zNzQsMjEuMzQ1IEM3OS4zNTksMjEuMzUzIDc5LjM0NSwyMS4zNjEgNzkuMzMsMjEuMzY5IEM3Ny43OTgsMjIuMjU0IDc2LjA4NCwyMi43MjIgNzQuMzczLDIyLjcyMiBDNzIuMDgxLDIyLjcyMiA2OS45NTksMjEuODkgNjguMzk3LDIwLjM4IEw2OC4xNDUsMjAuMTM1IEM2Ny43MDYsMTkuNjcyIDY3LjMyMywxOS4xNTYgNjcuMDA2LDE4LjYwMSBDNjYuOTg4LDE4LjU1OSA2Ni45NjgsMTguNTE5IDY2Ljk0NiwxOC40NzkgTDY2LjcxOSwxOC4wNjUgQzY2LjY5LDE4LjAxMiA2Ni42NTgsMTcuOTYgNjYuNjI0LDE3LjkxMSBDNjUuNjg2LDE2LjMzNyA2My45NTEsMTUuMzY2IDYyLjA1MywxNS4zNjYgQzYxLjA0MiwxNS4zNjYgNjAuMDMzLDE1LjY0IDU5LjEzNiwxNi4xNTggTDMuMTI1LDQ4LjUwMiBDMC40MjYsNTAuMDYxIC0wLjYxMyw1My40NDIgMC44MTEsNTYuMDQgTDExLjA4OSw3NC43OSBDMTEuMjY2LDc1LjExMyAxMS41MzcsNzUuMzUzIDExLjg1LDc1LjQ5NCBMNTguMjc2LDEwMi4yOTggQzU5LjY3OSwxMDMuMTA4IDYxLjQzMywxMDMuNjMgNjMuMzQ4LDEwMy44MDYgQzYzLjgxMiwxMDMuODQ4IDY0LjI4NSwxMDMuODcgNjQuNzU0LDEwMy44NyBDNjUsMTAzLjg3IDY1LjI0OSwxMDMuODY0IDY1LjQ5NCwxMDMuODUyIEM2NS41NjMsMTAzLjg0OSA2NS42MzIsMTAzLjg0NyA2NS43MDEsMTAzLjg0NyBDNjUuNzY0LDEwMy44NDcgNjUuODI4LDEwMy44NDkgNjUuODksMTAzLjg1MiBDNjUuOTg2LDEwMy44NTYgNjYuMDgsMTAzLjg2MyA2Ni4xNzMsMTAzLjg3NCBDNjYuMjgyLDEwNS40NjcgNjcuMzMyLDEwNy4xOTcgNjguNzAyLDEwNy45ODggTDExMS4xNzQsMTMyLjUxIEMxMTEuNjk4LDEzMi44MTIgMTEyLjIzMiwxMzIuOTY1IDExMi43NjQsMTMyLjk2NSBDMTE0LjI2MSwxMzIuOTY1IDExNS4zNDcsMTMxLjc2NSAxMTUuMzQ3LDEzMC4xMTMgTDExNS4zNDcsMTAzLjU1MSBMMTIyLjQ1OCw5OS40NDYgQzEyMi44MTksOTkuMjM3IDEyMy4wODcsOTguODk4IDEyMy4yMDcsOTguNDk4IEwxMjcuODY1LDgyLjkwNSBDMTMyLjI3OSw4My43MDIgMTM2LjU1Nyw4NC43NTMgMTQwLjYwNyw4Ni4wMzMgTDE0MS4xNCw4Ni44NjIgQzE0MS40NTEsODcuMzQ2IDE0MS45NzcsODcuNjEzIDE0Mi41MTYsODcuNjEzIEMxNDIuNzk0LDg3LjYxMyAxNDMuMDc2LDg3LjU0MiAxNDMuMzMzLDg3LjM5MyBMMTY5Ljg2NSw3Mi4wNzYgTDE5Myw4NS40MzMgQzE5My41MjMsODUuNzM1IDE5NC4wNTgsODUuODg4IDE5NC41OSw4NS44ODggQzE5Ni4wODcsODUuODg4IDE5Ny4xNzMsODQuNjg5IDE5Ny4xNzMsODMuMDM2IEwxOTcuMTczLDI5LjAzNSBDMTk3LjE3MywyOC40NTEgMTk2Ljg2MSwyNy45MTEgMTk2LjM1NSwyNy42MTkgQzE5Ni4zNTUsMjcuNjE5IDE3MS44NDMsMTMuNDY3IDE3MC4zODUsMTIuNjI2IEMxNzAuMTMyLDEyLjQ4IDE2OS44NSwxMi40MDcgMTY5LjU2OCwxMi40MDcgQzE2OS4yODUsMTIuNDA3IDE2OS4wMDIsMTIuNDgxIDE2OC43NDksMTIuNjI3IEMxNjguMTQzLDEyLjk3OCAxNjUuNzU2LDE0LjM1NyAxNjQuNDI0LDE1LjEyNSBMMTU5LjYxNSwxMC44NyBDMTU4Ljc5NiwxMC4xNDUgMTU4LjE1NCw4LjkzNyAxNTguMDU0LDcuOTM0IEMxNTguMDQ1LDcuODM3IDE1OC4wMzQsNy43MzkgMTU4LjAyMSw3LjY0IEMxNTguMDA1LDcuNTIzIDE1Ny45OTgsNy40MSAxNTcuOTk4LDcuMzA0IEwxNTcuOTk4LDYuNDE4IEMxNTcuOTk4LDUuODM0IDE1Ny42ODYsNS4yOTUgMTU3LjE4MSw1LjAwMiBDMTU2LjYyNCw0LjY4IDE1MC40NDIsMS4xMTEgMTUwLjQ0MiwxLjExMSBDMTUwLjE4OSwwLjk2NSAxNDkuOTA3LDAuODkyIDE0OS42MjUsMC44OTIiIGlkPSJGaWxsLTEiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNOTYuMDI3LDI1LjYzNiBMMTQyLjYwMyw1Mi41MjcgQzE0My44MDcsNTMuMjIyIDE0NC41ODIsNTQuMTE0IDE0NC44NDUsNTUuMDY4IEwxNDQuODM1LDU1LjA3NSBMNjMuNDYxLDEwMi4wNTcgTDYzLjQ2LDEwMi4wNTcgQzYxLjgwNiwxMDEuOTA1IDYwLjI2MSwxMDEuNDU3IDU5LjA1NywxMDAuNzYyIEwxMi40ODEsNzMuODcxIEw5Ni4wMjcsMjUuNjM2IiBpZD0iRmlsbC0yIiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTYzLjQ2MSwxMDIuMTc0IEM2My40NTMsMTAyLjE3NCA2My40NDYsMTAyLjE3NCA2My40MzksMTAyLjE3MiBDNjEuNzQ2LDEwMi4wMTYgNjAuMjExLDEwMS41NjMgNTguOTk4LDEwMC44NjMgTDEyLjQyMiw3My45NzMgQzEyLjM4Niw3My45NTIgMTIuMzY0LDczLjkxNCAxMi4zNjQsNzMuODcxIEMxMi4zNjQsNzMuODMgMTIuMzg2LDczLjc5MSAxMi40MjIsNzMuNzcgTDk1Ljk2OCwyNS41MzUgQzk2LjAwNCwyNS41MTQgOTYuMDQ5LDI1LjUxNCA5Ni4wODUsMjUuNTM1IEwxNDIuNjYxLDUyLjQyNiBDMTQzLjg4OCw1My4xMzQgMTQ0LjY4Miw1NC4wMzggMTQ0Ljk1Nyw1NS4wMzcgQzE0NC45Nyw1NS4wODMgMTQ0Ljk1Myw1NS4xMzMgMTQ0LjkxNSw1NS4xNjEgQzE0NC45MTEsNTUuMTY1IDE0NC44OTgsNTUuMTc0IDE0NC44OTQsNTUuMTc3IEw2My41MTksMTAyLjE1OCBDNjMuNTAxLDEwMi4xNjkgNjMuNDgxLDEwMi4xNzQgNjMuNDYxLDEwMi4xNzQgTDYzLjQ2MSwxMDIuMTc0IFogTTEyLjcxNCw3My44NzEgTDU5LjExNSwxMDAuNjYxIEM2MC4yOTMsMTAxLjM0MSA2MS43ODYsMTAxLjc4MiA2My40MzUsMTAxLjkzNyBMMTQ0LjcwNyw1NS4wMTUgQzE0NC40MjgsNTQuMTA4IDE0My42ODIsNTMuMjg1IDE0Mi41NDQsNTIuNjI4IEw5Ni4wMjcsMjUuNzcxIEwxMi43MTQsNzMuODcxIEwxMi43MTQsNzMuODcxIFoiIGlkPSJGaWxsLTMiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTQ4LjMyNyw1OC40NzEgQzE0OC4xNDUsNTguNDggMTQ3Ljk2Miw1OC40OCAxNDcuNzgxLDU4LjQ3MiBDMTQ1Ljg4Nyw1OC4zODkgMTQ0LjQ3OSw1Ny40MzQgMTQ0LjYzNiw1Ni4zNCBDMTQ0LjY4OSw1NS45NjcgMTQ0LjY2NCw1NS41OTcgMTQ0LjU2NCw1NS4yMzUgTDYzLjQ2MSwxMDIuMDU3IEM2NC4wODksMTAyLjExNSA2NC43MzMsMTAyLjEzIDY1LjM3OSwxMDIuMDk5IEM2NS41NjEsMTAyLjA5IDY1Ljc0MywxMDIuMDkgNjUuOTI1LDEwMi4wOTggQzY3LjgxOSwxMDIuMTgxIDY5LjIyNywxMDMuMTM2IDY5LjA3LDEwNC4yMyBMMTQ4LjMyNyw1OC40NzEiIGlkPSJGaWxsLTQiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNjkuMDcsMTA0LjM0NyBDNjkuMDQ4LDEwNC4zNDcgNjkuMDI1LDEwNC4zNCA2OS4wMDUsMTA0LjMyNyBDNjguOTY4LDEwNC4zMDEgNjguOTQ4LDEwNC4yNTcgNjguOTU1LDEwNC4yMTMgQzY5LDEwMy44OTYgNjguODk4LDEwMy41NzYgNjguNjU4LDEwMy4yODggQzY4LjE1MywxMDIuNjc4IDY3LjEwMywxMDIuMjY2IDY1LjkyLDEwMi4yMTQgQzY1Ljc0MiwxMDIuMjA2IDY1LjU2MywxMDIuMjA3IDY1LjM4NSwxMDIuMjE1IEM2NC43NDIsMTAyLjI0NiA2NC4wODcsMTAyLjIzMiA2My40NSwxMDIuMTc0IEM2My4zOTksMTAyLjE2OSA2My4zNTgsMTAyLjEzMiA2My4zNDcsMTAyLjA4MiBDNjMuMzM2LDEwMi4wMzMgNjMuMzU4LDEwMS45ODEgNjMuNDAyLDEwMS45NTYgTDE0NC41MDYsNTUuMTM0IEMxNDQuNTM3LDU1LjExNiAxNDQuNTc1LDU1LjExMyAxNDQuNjA5LDU1LjEyNyBDMTQ0LjY0Miw1NS4xNDEgMTQ0LjY2OCw1NS4xNyAxNDQuNjc3LDU1LjIwNCBDMTQ0Ljc4MSw1NS41ODUgMTQ0LjgwNiw1NS45NzIgMTQ0Ljc1MSw1Ni4zNTcgQzE0NC43MDYsNTYuNjczIDE0NC44MDgsNTYuOTk0IDE0NS4wNDcsNTcuMjgyIEMxNDUuNTUzLDU3Ljg5MiAxNDYuNjAyLDU4LjMwMyAxNDcuNzg2LDU4LjM1NSBDMTQ3Ljk2NCw1OC4zNjMgMTQ4LjE0Myw1OC4zNjMgMTQ4LjMyMSw1OC4zNTQgQzE0OC4zNzcsNTguMzUyIDE0OC40MjQsNTguMzg3IDE0OC40MzksNTguNDM4IEMxNDguNDU0LDU4LjQ5IDE0OC40MzIsNTguNTQ1IDE0OC4zODUsNTguNTcyIEw2OS4xMjksMTA0LjMzMSBDNjkuMTExLDEwNC4zNDIgNjkuMDksMTA0LjM0NyA2OS4wNywxMDQuMzQ3IEw2OS4wNywxMDQuMzQ3IFogTTY1LjY2NSwxMDEuOTc1IEM2NS43NTQsMTAxLjk3NSA2NS44NDIsMTAxLjk3NyA2NS45MywxMDEuOTgxIEM2Ny4xOTYsMTAyLjAzNyA2OC4yODMsMTAyLjQ2OSA2OC44MzgsMTAzLjEzOSBDNjkuMDY1LDEwMy40MTMgNjkuMTg4LDEwMy43MTQgNjkuMTk4LDEwNC4wMjEgTDE0Ny44ODMsNTguNTkyIEMxNDcuODQ3LDU4LjU5MiAxNDcuODExLDU4LjU5MSAxNDcuNzc2LDU4LjU4OSBDMTQ2LjUwOSw1OC41MzMgMTQ1LjQyMiw1OC4xIDE0NC44NjcsNTcuNDMxIEMxNDQuNTg1LDU3LjA5MSAxNDQuNDY1LDU2LjcwNyAxNDQuNTIsNTYuMzI0IEMxNDQuNTYzLDU2LjAyMSAxNDQuNTUyLDU1LjcxNiAxNDQuNDg4LDU1LjQxNCBMNjMuODQ2LDEwMS45NyBDNjQuMzUzLDEwMi4wMDIgNjQuODY3LDEwMi4wMDYgNjUuMzc0LDEwMS45ODIgQzY1LjQ3MSwxMDEuOTc3IDY1LjU2OCwxMDEuOTc1IDY1LjY2NSwxMDEuOTc1IEw2NS42NjUsMTAxLjk3NSBaIiBpZD0iRmlsbC01IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTIuMjA4LDU1LjEzNCBDMS4yMDcsNTMuMzA3IDEuOTY3LDUwLjkxNyAzLjkwNiw0OS43OTcgTDU5LjkxNywxNy40NTMgQzYxLjg1NiwxNi4zMzMgNjQuMjQxLDE2LjkwNyA2NS4yNDMsMTguNzM0IEw2NS40NzUsMTkuMTQ0IEM2NS44NzIsMTkuODgyIDY2LjM2OCwyMC41NiA2Ni45NDUsMjEuMTY1IEw2Ny4yMjMsMjEuNDM1IEM3MC41NDgsMjQuNjQ5IDc1LjgwNiwyNS4xNTEgODAuMTExLDIyLjY2NSBMODcuNDMsMTguNDQ1IEM4OS4zNywxNy4zMjYgOTEuNzU0LDE3Ljg5OSA5Mi43NTUsMTkuNzI3IEw5Ni4wMDUsMjUuNjU1IEwxMi40ODYsNzMuODg0IEwyLjIwOCw1NS4xMzQgWiIgaWQ9IkZpbGwtNiIgZmlsbD0iI0ZBRkFGQSI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMi40ODYsNzQuMDAxIEMxMi40NzYsNzQuMDAxIDEyLjQ2NSw3My45OTkgMTIuNDU1LDczLjk5NiBDMTIuNDI0LDczLjk4OCAxMi4zOTksNzMuOTY3IDEyLjM4NCw3My45NCBMMi4xMDYsNTUuMTkgQzEuMDc1LDUzLjMxIDEuODU3LDUwLjg0NSAzLjg0OCw0OS42OTYgTDU5Ljg1OCwxNy4zNTIgQzYwLjUyNSwxNi45NjcgNjEuMjcxLDE2Ljc2NCA2Mi4wMTYsMTYuNzY0IEM2My40MzEsMTYuNzY0IDY0LjY2NiwxNy40NjYgNjUuMzI3LDE4LjY0NiBDNjUuMzM3LDE4LjY1NCA2NS4zNDUsMTguNjYzIDY1LjM1MSwxOC42NzQgTDY1LjU3OCwxOS4wODggQzY1LjU4NCwxOS4xIDY1LjU4OSwxOS4xMTIgNjUuNTkxLDE5LjEyNiBDNjUuOTg1LDE5LjgzOCA2Ni40NjksMjAuNDk3IDY3LjAzLDIxLjA4NSBMNjcuMzA1LDIxLjM1MSBDNjkuMTUxLDIzLjEzNyA3MS42NDksMjQuMTIgNzQuMzM2LDI0LjEyIEM3Ni4zMTMsMjQuMTIgNzguMjksMjMuNTgyIDgwLjA1MywyMi41NjMgQzgwLjA2NCwyMi41NTcgODAuMDc2LDIyLjU1MyA4MC4wODgsMjIuNTUgTDg3LjM3MiwxOC4zNDQgQzg4LjAzOCwxNy45NTkgODguNzg0LDE3Ljc1NiA4OS41MjksMTcuNzU2IEM5MC45NTYsMTcuNzU2IDkyLjIwMSwxOC40NzIgOTIuODU4LDE5LjY3IEw5Ni4xMDcsMjUuNTk5IEM5Ni4xMzgsMjUuNjU0IDk2LjExOCwyNS43MjQgOTYuMDYzLDI1Ljc1NiBMMTIuNTQ1LDczLjk4NSBDMTIuNTI2LDczLjk5NiAxMi41MDYsNzQuMDAxIDEyLjQ4Niw3NC4wMDEgTDEyLjQ4Niw3NC4wMDEgWiBNNjIuMDE2LDE2Ljk5NyBDNjEuMzEyLDE2Ljk5NyA2MC42MDYsMTcuMTkgNTkuOTc1LDE3LjU1NCBMMy45NjUsNDkuODk5IEMyLjA4Myw1MC45ODUgMS4zNDEsNTMuMzA4IDIuMzEsNTUuMDc4IEwxMi41MzEsNzMuNzIzIEw5NS44NDgsMjUuNjExIEw5Mi42NTMsMTkuNzgyIEM5Mi4wMzgsMTguNjYgOTAuODcsMTcuOTkgODkuNTI5LDE3Ljk5IEM4OC44MjUsMTcuOTkgODguMTE5LDE4LjE4MiA4Ny40ODksMTguNTQ3IEw4MC4xNzIsMjIuNzcyIEM4MC4xNjEsMjIuNzc4IDgwLjE0OSwyMi43ODIgODAuMTM3LDIyLjc4NSBDNzguMzQ2LDIzLjgxMSA3Ni4zNDEsMjQuMzU0IDc0LjMzNiwyNC4zNTQgQzcxLjU4OCwyNC4zNTQgNjkuMDMzLDIzLjM0NyA2Ny4xNDIsMjEuNTE5IEw2Ni44NjQsMjEuMjQ5IEM2Ni4yNzcsMjAuNjM0IDY1Ljc3NCwxOS45NDcgNjUuMzY3LDE5LjIwMyBDNjUuMzYsMTkuMTkyIDY1LjM1NiwxOS4xNzkgNjUuMzU0LDE5LjE2NiBMNjUuMTYzLDE4LjgxOSBDNjUuMTU0LDE4LjgxMSA2NS4xNDYsMTguODAxIDY1LjE0LDE4Ljc5IEM2NC41MjUsMTcuNjY3IDYzLjM1NywxNi45OTcgNjIuMDE2LDE2Ljk5NyBMNjIuMDE2LDE2Ljk5NyBaIiBpZD0iRmlsbC03IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTQyLjQzNCw0OC44MDggTDQyLjQzNCw0OC44MDggQzM5LjkyNCw0OC44MDcgMzcuNzM3LDQ3LjU1IDM2LjU4Miw0NS40NDMgQzM0Ljc3MSw0Mi4xMzkgMzYuMTQ0LDM3LjgwOSAzOS42NDEsMzUuNzg5IEw1MS45MzIsMjguNjkxIEM1My4xMDMsMjguMDE1IDU0LjQxMywyNy42NTggNTUuNzIxLDI3LjY1OCBDNTguMjMxLDI3LjY1OCA2MC40MTgsMjguOTE2IDYxLjU3MywzMS4wMjMgQzYzLjM4NCwzNC4zMjcgNjIuMDEyLDM4LjY1NyA1OC41MTQsNDAuNjc3IEw0Ni4yMjMsNDcuNzc1IEM0NS4wNTMsNDguNDUgNDMuNzQyLDQ4LjgwOCA0Mi40MzQsNDguODA4IEw0Mi40MzQsNDguODA4IFogTTU1LjcyMSwyOC4xMjUgQzU0LjQ5NSwyOC4xMjUgNTMuMjY1LDI4LjQ2MSA1Mi4xNjYsMjkuMDk2IEwzOS44NzUsMzYuMTk0IEMzNi41OTYsMzguMDg3IDM1LjMwMiw0Mi4xMzYgMzYuOTkyLDQ1LjIxOCBDMzguMDYzLDQ3LjE3MyA0MC4wOTgsNDguMzQgNDIuNDM0LDQ4LjM0IEM0My42NjEsNDguMzQgNDQuODksNDguMDA1IDQ1Ljk5LDQ3LjM3IEw1OC4yODEsNDAuMjcyIEM2MS41NiwzOC4zNzkgNjIuODUzLDM0LjMzIDYxLjE2NCwzMS4yNDggQzYwLjA5MiwyOS4yOTMgNTguMDU4LDI4LjEyNSA1NS43MjEsMjguMTI1IEw1NS43MjEsMjguMTI1IFoiIGlkPSJGaWxsLTgiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTQ5LjU4OCwyLjQwNyBDMTQ5LjU4OCwyLjQwNyAxNTUuNzY4LDUuOTc1IDE1Ni4zMjUsNi4yOTcgTDE1Ni4zMjUsNy4xODQgQzE1Ni4zMjUsNy4zNiAxNTYuMzM4LDcuNTQ0IDE1Ni4zNjIsNy43MzMgQzE1Ni4zNzMsNy44MTQgMTU2LjM4Miw3Ljg5NCAxNTYuMzksNy45NzUgQzE1Ni41Myw5LjM5IDE1Ny4zNjMsMTAuOTczIDE1OC40OTUsMTEuOTc0IEwxNjUuODkxLDE4LjUxOSBDMTY2LjA2OCwxOC42NzUgMTY2LjI0OSwxOC44MTQgMTY2LjQzMiwxOC45MzQgQzE2OC4wMTEsMTkuOTc0IDE2OS4zODIsMTkuNCAxNjkuNDk0LDE3LjY1MiBDMTY5LjU0MywxNi44NjggMTY5LjU1MSwxNi4wNTcgMTY5LjUxNywxNS4yMjMgTDE2OS41MTQsMTUuMDYzIEwxNjkuNTE0LDEzLjkxMiBDMTcwLjc4LDE0LjY0MiAxOTUuNTAxLDI4LjkxNSAxOTUuNTAxLDI4LjkxNSBMMTk1LjUwMSw4Mi45MTUgQzE5NS41MDEsODQuMDA1IDE5NC43MzEsODQuNDQ1IDE5My43ODEsODMuODk3IEwxNTEuMzA4LDU5LjM3NCBDMTUwLjM1OCw1OC44MjYgMTQ5LjU4OCw1Ny40OTcgMTQ5LjU4OCw1Ni40MDggTDE0OS41ODgsMjIuMzc1IiBpZD0iRmlsbC05IiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE5NC41NTMsODQuMjUgQzE5NC4yOTYsODQuMjUgMTk0LjAxMyw4NC4xNjUgMTkzLjcyMiw4My45OTcgTDE1MS4yNSw1OS40NzYgQzE1MC4yNjksNTguOTA5IDE0OS40NzEsNTcuNTMzIDE0OS40NzEsNTYuNDA4IEwxNDkuNDcxLDIyLjM3NSBMMTQ5LjcwNSwyMi4zNzUgTDE0OS43MDUsNTYuNDA4IEMxNDkuNzA1LDU3LjQ1OSAxNTAuNDUsNTguNzQ0IDE1MS4zNjYsNTkuMjc0IEwxOTMuODM5LDgzLjc5NSBDMTk0LjI2Myw4NC4wNCAxOTQuNjU1LDg0LjA4MyAxOTQuOTQyLDgzLjkxNyBDMTk1LjIyNyw4My43NTMgMTk1LjM4NCw4My4zOTcgMTk1LjM4NCw4Mi45MTUgTDE5NS4zODQsMjguOTgyIEMxOTQuMTAyLDI4LjI0MiAxNzIuMTA0LDE1LjU0MiAxNjkuNjMxLDE0LjExNCBMMTY5LjYzNCwxNS4yMiBDMTY5LjY2OCwxNi4wNTIgMTY5LjY2LDE2Ljg3NCAxNjkuNjEsMTcuNjU5IEMxNjkuNTU2LDE4LjUwMyAxNjkuMjE0LDE5LjEyMyAxNjguNjQ3LDE5LjQwNSBDMTY4LjAyOCwxOS43MTQgMTY3LjE5NywxOS41NzggMTY2LjM2NywxOS4wMzIgQzE2Ni4xODEsMTguOTA5IDE2NS45OTUsMTguNzY2IDE2NS44MTQsMTguNjA2IEwxNTguNDE3LDEyLjA2MiBDMTU3LjI1OSwxMS4wMzYgMTU2LjQxOCw5LjQzNyAxNTYuMjc0LDcuOTg2IEMxNTYuMjY2LDcuOTA3IDE1Ni4yNTcsNy44MjcgMTU2LjI0Nyw3Ljc0OCBDMTU2LjIyMSw3LjU1NSAxNTYuMjA5LDcuMzY1IDE1Ni4yMDksNy4xODQgTDE1Ni4yMDksNi4zNjQgQzE1NS4zNzUsNS44ODMgMTQ5LjUyOSwyLjUwOCAxNDkuNTI5LDIuNTA4IEwxNDkuNjQ2LDIuMzA2IEMxNDkuNjQ2LDIuMzA2IDE1NS44MjcsNS44NzQgMTU2LjM4NCw2LjE5NiBMMTU2LjQ0Miw2LjIzIEwxNTYuNDQyLDcuMTg0IEMxNTYuNDQyLDcuMzU1IDE1Ni40NTQsNy41MzUgMTU2LjQ3OCw3LjcxNyBDMTU2LjQ4OSw3LjggMTU2LjQ5OSw3Ljg4MiAxNTYuNTA3LDcuOTYzIEMxNTYuNjQ1LDkuMzU4IDE1Ny40NTUsMTAuODk4IDE1OC41NzIsMTEuODg2IEwxNjUuOTY5LDE4LjQzMSBDMTY2LjE0MiwxOC41ODQgMTY2LjMxOSwxOC43MiAxNjYuNDk2LDE4LjgzNyBDMTY3LjI1NCwxOS4zMzYgMTY4LDE5LjQ2NyAxNjguNTQzLDE5LjE5NiBDMTY5LjAzMywxOC45NTMgMTY5LjMyOSwxOC40MDEgMTY5LjM3NywxNy42NDUgQzE2OS40MjcsMTYuODY3IDE2OS40MzQsMTYuMDU0IDE2OS40MDEsMTUuMjI4IEwxNjkuMzk3LDE1LjA2NSBMMTY5LjM5NywxMy43MSBMMTY5LjU3MiwxMy44MSBDMTcwLjgzOSwxNC41NDEgMTk1LjU1OSwyOC44MTQgMTk1LjU1OSwyOC44MTQgTDE5NS42MTgsMjguODQ3IEwxOTUuNjE4LDgyLjkxNSBDMTk1LjYxOCw4My40ODQgMTk1LjQyLDgzLjkxMSAxOTUuMDU5LDg0LjExOSBDMTk0LjkwOCw4NC4yMDYgMTk0LjczNyw4NC4yNSAxOTQuNTUzLDg0LjI1IiBpZD0iRmlsbC0xMCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNDUuNjg1LDU2LjE2MSBMMTY5LjgsNzAuMDgzIEwxNDMuODIyLDg1LjA4MSBMMTQyLjM2LDg0Ljc3NCBDMTM1LjgyNiw4Mi42MDQgMTI4LjczMiw4MS4wNDYgMTIxLjM0MSw4MC4xNTggQzExNi45NzYsNzkuNjM0IDExMi42NzgsODEuMjU0IDExMS43NDMsODMuNzc4IEMxMTEuNTA2LDg0LjQxNCAxMTEuNTAzLDg1LjA3MSAxMTEuNzMyLDg1LjcwNiBDMTEzLjI3LDg5Ljk3MyAxMTUuOTY4LDk0LjA2OSAxMTkuNzI3LDk3Ljg0MSBMMTIwLjI1OSw5OC42ODYgQzEyMC4yNiw5OC42ODUgOTQuMjgyLDExMy42ODMgOTQuMjgyLDExMy42ODMgTDcwLjE2Nyw5OS43NjEgTDE0NS42ODUsNTYuMTYxIiBpZD0iRmlsbC0xMSIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik05NC4yODIsMTEzLjgxOCBMOTQuMjIzLDExMy43ODUgTDY5LjkzMyw5OS43NjEgTDcwLjEwOCw5OS42NiBMMTQ1LjY4NSw1Ni4wMjYgTDE0NS43NDMsNTYuMDU5IEwxNzAuMDMzLDcwLjA4MyBMMTQzLjg0Miw4NS4yMDUgTDE0My43OTcsODUuMTk1IEMxNDMuNzcyLDg1LjE5IDE0Mi4zMzYsODQuODg4IDE0Mi4zMzYsODQuODg4IEMxMzUuNzg3LDgyLjcxNCAxMjguNzIzLDgxLjE2MyAxMjEuMzI3LDgwLjI3NCBDMTIwLjc4OCw4MC4yMDkgMTIwLjIzNiw4MC4xNzcgMTE5LjY4OSw4MC4xNzcgQzExNS45MzEsODAuMTc3IDExMi42MzUsODEuNzA4IDExMS44NTIsODMuODE5IEMxMTEuNjI0LDg0LjQzMiAxMTEuNjIxLDg1LjA1MyAxMTEuODQyLDg1LjY2NyBDMTEzLjM3Nyw4OS45MjUgMTE2LjA1OCw5My45OTMgMTE5LjgxLDk3Ljc1OCBMMTE5LjgyNiw5Ny43NzkgTDEyMC4zNTIsOTguNjE0IEMxMjAuMzU0LDk4LjYxNyAxMjAuMzU2LDk4LjYyIDEyMC4zNTgsOTguNjI0IEwxMjAuNDIyLDk4LjcyNiBMMTIwLjMxNyw5OC43ODcgQzEyMC4yNjQsOTguODE4IDk0LjU5OSwxMTMuNjM1IDk0LjM0LDExMy43ODUgTDk0LjI4MiwxMTMuODE4IEw5NC4yODIsMTEzLjgxOCBaIE03MC40MDEsOTkuNzYxIEw5NC4yODIsMTEzLjU0OSBMMTE5LjA4NCw5OS4yMjkgQzExOS42Myw5OC45MTQgMTE5LjkzLDk4Ljc0IDEyMC4xMDEsOTguNjU0IEwxMTkuNjM1LDk3LjkxNCBDMTE1Ljg2NCw5NC4xMjcgMTEzLjE2OCw5MC4wMzMgMTExLjYyMiw4NS43NDYgQzExMS4zODIsODUuMDc5IDExMS4zODYsODQuNDA0IDExMS42MzMsODMuNzM4IEMxMTIuNDQ4LDgxLjUzOSAxMTUuODM2LDc5Ljk0MyAxMTkuNjg5LDc5Ljk0MyBDMTIwLjI0Niw3OS45NDMgMTIwLjgwNiw3OS45NzYgMTIxLjM1NSw4MC4wNDIgQzEyOC43NjcsODAuOTMzIDEzNS44NDYsODIuNDg3IDE0Mi4zOTYsODQuNjYzIEMxNDMuMjMyLDg0LjgzOCAxNDMuNjExLDg0LjkxNyAxNDMuNzg2LDg0Ljk2NyBMMTY5LjU2Niw3MC4wODMgTDE0NS42ODUsNTYuMjk1IEw3MC40MDEsOTkuNzYxIEw3MC40MDEsOTkuNzYxIFoiIGlkPSJGaWxsLTEyIiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE2Ny4yMywxOC45NzkgTDE2Ny4yMyw2OS44NSBMMTM5LjkwOSw4NS42MjMgTDEzMy40NDgsNzEuNDU2IEMxMzIuNTM4LDY5LjQ2IDEzMC4wMiw2OS43MTggMTI3LjgyNCw3Mi4wMyBDMTI2Ljc2OSw3My4xNCAxMjUuOTMxLDc0LjU4NSAxMjUuNDk0LDc2LjA0OCBMMTE5LjAzNCw5Ny42NzYgTDkxLjcxMiwxMTMuNDUgTDkxLjcxMiw2Mi41NzkgTDE2Ny4yMywxOC45NzkiIGlkPSJGaWxsLTEzIiBmaWxsPSIjRkZGRkZGIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTkxLjcxMiwxMTMuNTY3IEM5MS42OTIsMTEzLjU2NyA5MS42NzIsMTEzLjU2MSA5MS42NTMsMTEzLjU1MSBDOTEuNjE4LDExMy41MyA5MS41OTUsMTEzLjQ5MiA5MS41OTUsMTEzLjQ1IEw5MS41OTUsNjIuNTc5IEM5MS41OTUsNjIuNTM3IDkxLjYxOCw2Mi40OTkgOTEuNjUzLDYyLjQ3OCBMMTY3LjE3MiwxOC44NzggQzE2Ny4yMDgsMTguODU3IDE2Ny4yNTIsMTguODU3IDE2Ny4yODgsMTguODc4IEMxNjcuMzI0LDE4Ljg5OSAxNjcuMzQ3LDE4LjkzNyAxNjcuMzQ3LDE4Ljk3OSBMMTY3LjM0Nyw2OS44NSBDMTY3LjM0Nyw2OS44OTEgMTY3LjMyNCw2OS45MyAxNjcuMjg4LDY5Ljk1IEwxMzkuOTY3LDg1LjcyNSBDMTM5LjkzOSw4NS43NDEgMTM5LjkwNSw4NS43NDUgMTM5Ljg3Myw4NS43MzUgQzEzOS44NDIsODUuNzI1IDEzOS44MTYsODUuNzAyIDEzOS44MDIsODUuNjcyIEwxMzMuMzQyLDcxLjUwNCBDMTMyLjk2Nyw3MC42ODIgMTMyLjI4LDcwLjIyOSAxMzEuNDA4LDcwLjIyOSBDMTMwLjMxOSw3MC4yMjkgMTI5LjA0NCw3MC45MTUgMTI3LjkwOCw3Mi4xMSBDMTI2Ljg3NCw3My4yIDEyNi4wMzQsNzQuNjQ3IDEyNS42MDYsNzYuMDgyIEwxMTkuMTQ2LDk3LjcwOSBDMTE5LjEzNyw5Ny43MzggMTE5LjExOCw5Ny43NjIgMTE5LjA5Miw5Ny43NzcgTDkxLjc3LDExMy41NTEgQzkxLjc1MiwxMTMuNTYxIDkxLjczMiwxMTMuNTY3IDkxLjcxMiwxMTMuNTY3IEw5MS43MTIsMTEzLjU2NyBaIE05MS44MjksNjIuNjQ3IEw5MS44MjksMTEzLjI0OCBMMTE4LjkzNSw5Ny41OTggTDEyNS4zODIsNzYuMDE1IEMxMjUuODI3LDc0LjUyNSAxMjYuNjY0LDczLjA4MSAxMjcuNzM5LDcxLjk1IEMxMjguOTE5LDcwLjcwOCAxMzAuMjU2LDY5Ljk5NiAxMzEuNDA4LDY5Ljk5NiBDMTMyLjM3Nyw2OS45OTYgMTMzLjEzOSw3MC40OTcgMTMzLjU1NCw3MS40MDcgTDEzOS45NjEsODUuNDU4IEwxNjcuMTEzLDY5Ljc4MiBMMTY3LjExMywxOS4xODEgTDkxLjgyOSw2Mi42NDcgTDkxLjgyOSw2Mi42NDcgWiIgaWQ9IkZpbGwtMTQiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTY4LjU0MywxOS4yMTMgTDE2OC41NDMsNzAuMDgzIEwxNDEuMjIxLDg1Ljg1NyBMMTM0Ljc2MSw3MS42ODkgQzEzMy44NTEsNjkuNjk0IDEzMS4zMzMsNjkuOTUxIDEyOS4xMzcsNzIuMjYzIEMxMjguMDgyLDczLjM3NCAxMjcuMjQ0LDc0LjgxOSAxMjYuODA3LDc2LjI4MiBMMTIwLjM0Niw5Ny45MDkgTDkzLjAyNSwxMTMuNjgzIEw5My4wMjUsNjIuODEzIEwxNjguNTQzLDE5LjIxMyIgaWQ9IkZpbGwtMTUiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNOTMuMDI1LDExMy44IEM5My4wMDUsMTEzLjggOTIuOTg0LDExMy43OTUgOTIuOTY2LDExMy43ODUgQzkyLjkzMSwxMTMuNzY0IDkyLjkwOCwxMTMuNzI1IDkyLjkwOCwxMTMuNjg0IEw5Mi45MDgsNjIuODEzIEM5Mi45MDgsNjIuNzcxIDkyLjkzMSw2Mi43MzMgOTIuOTY2LDYyLjcxMiBMMTY4LjQ4NCwxOS4xMTIgQzE2OC41MiwxOS4wOSAxNjguNTY1LDE5LjA5IDE2OC42MDEsMTkuMTEyIEMxNjguNjM3LDE5LjEzMiAxNjguNjYsMTkuMTcxIDE2OC42NiwxOS4yMTIgTDE2OC42Niw3MC4wODMgQzE2OC42Niw3MC4xMjUgMTY4LjYzNyw3MC4xNjQgMTY4LjYwMSw3MC4xODQgTDE0MS4yOCw4NS45NTggQzE0MS4yNTEsODUuOTc1IDE0MS4yMTcsODUuOTc5IDE0MS4xODYsODUuOTY4IEMxNDEuMTU0LDg1Ljk1OCAxNDEuMTI5LDg1LjkzNiAxNDEuMTE1LDg1LjkwNiBMMTM0LjY1NSw3MS43MzggQzEzNC4yOCw3MC45MTUgMTMzLjU5Myw3MC40NjMgMTMyLjcyLDcwLjQ2MyBDMTMxLjYzMiw3MC40NjMgMTMwLjM1Nyw3MS4xNDggMTI5LjIyMSw3Mi4zNDQgQzEyOC4xODYsNzMuNDMzIDEyNy4zNDcsNzQuODgxIDEyNi45MTksNzYuMzE1IEwxMjAuNDU4LDk3Ljk0MyBDMTIwLjQ1LDk3Ljk3MiAxMjAuNDMxLDk3Ljk5NiAxMjAuNDA1LDk4LjAxIEw5My4wODMsMTEzLjc4NSBDOTMuMDY1LDExMy43OTUgOTMuMDQ1LDExMy44IDkzLjAyNSwxMTMuOCBMOTMuMDI1LDExMy44IFogTTkzLjE0Miw2Mi44ODEgTDkzLjE0MiwxMTMuNDgxIEwxMjAuMjQ4LDk3LjgzMiBMMTI2LjY5NSw3Ni4yNDggQzEyNy4xNCw3NC43NTggMTI3Ljk3Nyw3My4zMTUgMTI5LjA1Miw3Mi4xODMgQzEzMC4yMzEsNzAuOTQyIDEzMS41NjgsNzAuMjI5IDEzMi43Miw3MC4yMjkgQzEzMy42ODksNzAuMjI5IDEzNC40NTIsNzAuNzMxIDEzNC44NjcsNzEuNjQxIEwxNDEuMjc0LDg1LjY5MiBMMTY4LjQyNiw3MC4wMTYgTDE2OC40MjYsMTkuNDE1IEw5My4xNDIsNjIuODgxIEw5My4xNDIsNjIuODgxIFoiIGlkPSJGaWxsLTE2IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE2OS44LDcwLjA4MyBMMTQyLjQ3OCw4NS44NTcgTDEzNi4wMTgsNzEuNjg5IEMxMzUuMTA4LDY5LjY5NCAxMzIuNTksNjkuOTUxIDEzMC4zOTMsNzIuMjYzIEMxMjkuMzM5LDczLjM3NCAxMjguNSw3NC44MTkgMTI4LjA2NCw3Ni4yODIgTDEyMS42MDMsOTcuOTA5IEw5NC4yODIsMTEzLjY4MyBMOTQuMjgyLDYyLjgxMyBMMTY5LjgsMTkuMjEzIEwxNjkuOCw3MC4wODMgWiIgaWQ9IkZpbGwtMTciIGZpbGw9IiNGQUZBRkEiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNOTQuMjgyLDExMy45MTcgQzk0LjI0MSwxMTMuOTE3IDk0LjIwMSwxMTMuOTA3IDk0LjE2NSwxMTMuODg2IEM5NC4wOTMsMTEzLjg0NSA5NC4wNDgsMTEzLjc2NyA5NC4wNDgsMTEzLjY4NCBMOTQuMDQ4LDYyLjgxMyBDOTQuMDQ4LDYyLjczIDk0LjA5Myw2Mi42NTIgOTQuMTY1LDYyLjYxMSBMMTY5LjY4MywxOS4wMSBDMTY5Ljc1NSwxOC45NjkgMTY5Ljg0NCwxOC45NjkgMTY5LjkxNywxOS4wMSBDMTY5Ljk4OSwxOS4wNTIgMTcwLjAzMywxOS4xMjkgMTcwLjAzMywxOS4yMTIgTDE3MC4wMzMsNzAuMDgzIEMxNzAuMDMzLDcwLjE2NiAxNjkuOTg5LDcwLjI0NCAxNjkuOTE3LDcwLjI4NSBMMTQyLjU5NSw4Ni4wNiBDMTQyLjUzOCw4Ni4wOTIgMTQyLjQ2OSw4Ni4xIDE0Mi40MDcsODYuMDggQzE0Mi4zNDQsODYuMDYgMTQyLjI5Myw4Ni4wMTQgMTQyLjI2Niw4NS45NTQgTDEzNS44MDUsNzEuNzg2IEMxMzUuNDQ1LDcwLjk5NyAxMzQuODEzLDcwLjU4IDEzMy45NzcsNzAuNTggQzEzMi45MjEsNzAuNTggMTMxLjY3Niw3MS4yNTIgMTMwLjU2Miw3Mi40MjQgQzEyOS41NCw3My41MDEgMTI4LjcxMSw3NC45MzEgMTI4LjI4Nyw3Ni4zNDggTDEyMS44MjcsOTcuOTc2IEMxMjEuODEsOTguMDM0IDEyMS43NzEsOTguMDgyIDEyMS43Miw5OC4xMTIgTDk0LjM5OCwxMTMuODg2IEM5NC4zNjIsMTEzLjkwNyA5NC4zMjIsMTEzLjkxNyA5NC4yODIsMTEzLjkxNyBMOTQuMjgyLDExMy45MTcgWiBNOTQuNTE1LDYyLjk0OCBMOTQuNTE1LDExMy4yNzkgTDEyMS40MDYsOTcuNzU0IEwxMjcuODQsNzYuMjE1IEMxMjguMjksNzQuNzA4IDEyOS4xMzcsNzMuMjQ3IDEzMC4yMjQsNzIuMTAzIEMxMzEuNDI1LDcwLjgzOCAxMzIuNzkzLDcwLjExMiAxMzMuOTc3LDcwLjExMiBDMTM0Ljk5NSw3MC4xMTIgMTM1Ljc5NSw3MC42MzggMTM2LjIzLDcxLjU5MiBMMTQyLjU4NCw4NS41MjYgTDE2OS41NjYsNjkuOTQ4IEwxNjkuNTY2LDE5LjYxNyBMOTQuNTE1LDYyLjk0OCBMOTQuNTE1LDYyLjk0OCBaIiBpZD0iRmlsbC0xOCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMDkuODk0LDkyLjk0MyBMMTA5Ljg5NCw5Mi45NDMgQzEwOC4xMiw5Mi45NDMgMTA2LjY1Myw5Mi4yMTggMTA1LjY1LDkwLjgyMyBDMTA1LjU4Myw5MC43MzEgMTA1LjU5Myw5MC42MSAxMDUuNjczLDkwLjUyOSBDMTA1Ljc1Myw5MC40NDggMTA1Ljg4LDkwLjQ0IDEwNS45NzQsOTAuNTA2IEMxMDYuNzU0LDkxLjA1MyAxMDcuNjc5LDkxLjMzMyAxMDguNzI0LDkxLjMzMyBDMTEwLjA0Nyw5MS4zMzMgMTExLjQ3OCw5MC44OTQgMTEyLjk4LDkwLjAyNyBDMTE4LjI5MSw4Ni45NiAxMjIuNjExLDc5LjUwOSAxMjIuNjExLDczLjQxNiBDMTIyLjYxMSw3MS40ODkgMTIyLjE2OSw2OS44NTYgMTIxLjMzMyw2OC42OTIgQzEyMS4yNjYsNjguNiAxMjEuMjc2LDY4LjQ3MyAxMjEuMzU2LDY4LjM5MiBDMTIxLjQzNiw2OC4zMTEgMTIxLjU2Myw2OC4yOTkgMTIxLjY1Niw2OC4zNjUgQzEyMy4zMjcsNjkuNTM3IDEyNC4yNDcsNzEuNzQ2IDEyNC4yNDcsNzQuNTg0IEMxMjQuMjQ3LDgwLjgyNiAxMTkuODIxLDg4LjQ0NyAxMTQuMzgyLDkxLjU4NyBDMTEyLjgwOCw5Mi40OTUgMTExLjI5OCw5Mi45NDMgMTA5Ljg5NCw5Mi45NDMgTDEwOS44OTQsOTIuOTQzIFogTTEwNi45MjUsOTEuNDAxIEMxMDcuNzM4LDkyLjA1MiAxMDguNzQ1LDkyLjI3OCAxMDkuODkzLDkyLjI3OCBMMTA5Ljg5NCw5Mi4yNzggQzExMS4yMTUsOTIuMjc4IDExMi42NDcsOTEuOTUxIDExNC4xNDgsOTEuMDg0IEMxMTkuNDU5LDg4LjAxNyAxMjMuNzgsODAuNjIxIDEyMy43OCw3NC41MjggQzEyMy43OCw3Mi41NDkgMTIzLjMxNyw3MC45MjkgMTIyLjQ1NCw2OS43NjcgQzEyMi44NjUsNzAuODAyIDEyMy4wNzksNzIuMDQyIDEyMy4wNzksNzMuNDAyIEMxMjMuMDc5LDc5LjY0NSAxMTguNjUzLDg3LjI4NSAxMTMuMjE0LDkwLjQyNSBDMTExLjY0LDkxLjMzNCAxMTAuMTMsOTEuNzQyIDEwOC43MjQsOTEuNzQyIEMxMDguMDgzLDkxLjc0MiAxMDcuNDgxLDkxLjU5MyAxMDYuOTI1LDkxLjQwMSBMMTA2LjkyNSw5MS40MDEgWiIgaWQ9IkZpbGwtMTkiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEzLjA5Nyw5MC4yMyBDMTE4LjQ4MSw4Ny4xMjIgMTIyLjg0NSw3OS41OTQgMTIyLjg0NSw3My40MTYgQzEyMi44NDUsNzEuMzY1IDEyMi4zNjIsNjkuNzI0IDEyMS41MjIsNjguNTU2IEMxMTkuNzM4LDY3LjMwNCAxMTcuMTQ4LDY3LjM2MiAxMTQuMjY1LDY5LjAyNiBDMTA4Ljg4MSw3Mi4xMzQgMTA0LjUxNyw3OS42NjIgMTA0LjUxNyw4NS44NCBDMTA0LjUxNyw4Ny44OTEgMTA1LDg5LjUzMiAxMDUuODQsOTAuNyBDMTA3LjYyNCw5MS45NTIgMTEwLjIxNCw5MS44OTQgMTEzLjA5Nyw5MC4yMyIgaWQ9IkZpbGwtMjAiIGZpbGw9IiNGQUZBRkEiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTA4LjcyNCw5MS42MTQgTDEwOC43MjQsOTEuNjE0IEMxMDcuNTgyLDkxLjYxNCAxMDYuNTY2LDkxLjQwMSAxMDUuNzA1LDkwLjc5NyBDMTA1LjY4NCw5MC43ODMgMTA1LjY2NSw5MC44MTEgMTA1LjY1LDkwLjc5IEMxMDQuNzU2LDg5LjU0NiAxMDQuMjgzLDg3Ljg0MiAxMDQuMjgzLDg1LjgxNyBDMTA0LjI4Myw3OS41NzUgMTA4LjcwOSw3MS45NTMgMTE0LjE0OCw2OC44MTIgQzExNS43MjIsNjcuOTA0IDExNy4yMzIsNjcuNDQ5IDExOC42MzgsNjcuNDQ5IEMxMTkuNzgsNjcuNDQ5IDEyMC43OTYsNjcuNzU4IDEyMS42NTYsNjguMzYyIEMxMjEuNjc4LDY4LjM3NyAxMjEuNjk3LDY4LjM5NyAxMjEuNzEyLDY4LjQxOCBDMTIyLjYwNiw2OS42NjIgMTIzLjA3OSw3MS4zOSAxMjMuMDc5LDczLjQxNSBDMTIzLjA3OSw3OS42NTggMTE4LjY1Myw4Ny4xOTggMTEzLjIxNCw5MC4zMzggQzExMS42NCw5MS4yNDcgMTEwLjEzLDkxLjYxNCAxMDguNzI0LDkxLjYxNCBMMTA4LjcyNCw5MS42MTQgWiBNMTA2LjAwNiw5MC41MDUgQzEwNi43OCw5MS4wMzcgMTA3LjY5NCw5MS4yODEgMTA4LjcyNCw5MS4yODEgQzExMC4wNDcsOTEuMjgxIDExMS40NzgsOTAuODY4IDExMi45OCw5MC4wMDEgQzExOC4yOTEsODYuOTM1IDEyMi42MTEsNzkuNDk2IDEyMi42MTEsNzMuNDAzIEMxMjIuNjExLDcxLjQ5NCAxMjIuMTc3LDY5Ljg4IDEyMS4zNTYsNjguNzE4IEMxMjAuNTgyLDY4LjE4NSAxMTkuNjY4LDY3LjkxOSAxMTguNjM4LDY3LjkxOSBDMTE3LjMxNSw2Ny45MTkgMTE1Ljg4Myw2OC4zNiAxMTQuMzgyLDY5LjIyNyBDMTA5LjA3MSw3Mi4yOTMgMTA0Ljc1MSw3OS43MzMgMTA0Ljc1MSw4NS44MjYgQzEwNC43NTEsODcuNzM1IDEwNS4xODUsODkuMzQzIDEwNi4wMDYsOTAuNTA1IEwxMDYuMDA2LDkwLjUwNSBaIiBpZD0iRmlsbC0yMSIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNDkuMzE4LDcuMjYyIEwxMzkuMzM0LDE2LjE0IEwxNTUuMjI3LDI3LjE3MSBMMTYwLjgxNiwyMS4wNTkgTDE0OS4zMTgsNy4yNjIiIGlkPSJGaWxsLTIyIiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE2OS42NzYsMTMuODQgTDE1OS45MjgsMTkuNDY3IEMxNTYuMjg2LDIxLjU3IDE1MC40LDIxLjU4IDE0Ni43ODEsMTkuNDkxIEMxNDMuMTYxLDE3LjQwMiAxNDMuMTgsMTQuMDAzIDE0Ni44MjIsMTEuOSBMMTU2LjMxNyw2LjI5MiBMMTQ5LjU4OCwyLjQwNyBMNjcuNzUyLDQ5LjQ3OCBMMTEzLjY3NSw3NS45OTIgTDExNi43NTYsNzQuMjEzIEMxMTcuMzg3LDczLjg0OCAxMTcuNjI1LDczLjMxNSAxMTcuMzc0LDcyLjgyMyBDMTE1LjAxNyw2OC4xOTEgMTE0Ljc4MSw2My4yNzcgMTE2LjY5MSw1OC41NjEgQzEyMi4zMjksNDQuNjQxIDE0MS4yLDMzLjc0NiAxNjUuMzA5LDMwLjQ5MSBDMTczLjQ3OCwyOS4zODggMTgxLjk4OSwyOS41MjQgMTkwLjAxMywzMC44ODUgQzE5MC44NjUsMzEuMDMgMTkxLjc4OSwzMC44OTMgMTkyLjQyLDMwLjUyOCBMMTk1LjUwMSwyOC43NSBMMTY5LjY3NiwxMy44NCIgaWQ9IkZpbGwtMjMiIGZpbGw9IiNGQUZBRkEiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEzLjY3NSw3Ni40NTkgQzExMy41OTQsNzYuNDU5IDExMy41MTQsNzYuNDM4IDExMy40NDIsNzYuMzk3IEw2Ny41MTgsNDkuODgyIEM2Ny4zNzQsNDkuNzk5IDY3LjI4NCw0OS42NDUgNjcuMjg1LDQ5LjQ3OCBDNjcuMjg1LDQ5LjMxMSA2Ny4zNzQsNDkuMTU3IDY3LjUxOSw0OS4wNzMgTDE0OS4zNTUsMi4wMDIgQzE0OS40OTksMS45MTkgMTQ5LjY3NywxLjkxOSAxNDkuODIxLDIuMDAyIEwxNTYuNTUsNS44ODcgQzE1Ni43NzQsNi4wMTcgMTU2Ljg1LDYuMzAyIDE1Ni43MjIsNi41MjYgQzE1Ni41OTIsNi43NDkgMTU2LjMwNyw2LjgyNiAxNTYuMDgzLDYuNjk2IEwxNDkuNTg3LDIuOTQ2IEw2OC42ODcsNDkuNDc5IEwxMTMuNjc1LDc1LjQ1MiBMMTE2LjUyMyw3My44MDggQzExNi43MTUsNzMuNjk3IDExNy4xNDMsNzMuMzk5IDExNi45NTgsNzMuMDM1IEMxMTQuNTQyLDY4LjI4NyAxMTQuMyw2My4yMjEgMTE2LjI1OCw1OC4zODUgQzExOS4wNjQsNTEuNDU4IDEyNS4xNDMsNDUuMTQzIDEzMy44NCw0MC4xMjIgQzE0Mi40OTcsMzUuMTI0IDE1My4zNTgsMzEuNjMzIDE2NS4yNDcsMzAuMDI4IEMxNzMuNDQ1LDI4LjkyMSAxODIuMDM3LDI5LjA1OCAxOTAuMDkxLDMwLjQyNSBDMTkwLjgzLDMwLjU1IDE5MS42NTIsMzAuNDMyIDE5Mi4xODYsMzAuMTI0IEwxOTQuNTY3LDI4Ljc1IEwxNjkuNDQyLDE0LjI0NCBDMTY5LjIxOSwxNC4xMTUgMTY5LjE0MiwxMy44MjkgMTY5LjI3MSwxMy42MDYgQzE2OS40LDEzLjM4MiAxNjkuNjg1LDEzLjMwNiAxNjkuOTA5LDEzLjQzNSBMMTk1LjczNCwyOC4zNDUgQzE5NS44NzksMjguNDI4IDE5NS45NjgsMjguNTgzIDE5NS45NjgsMjguNzUgQzE5NS45NjgsMjguOTE2IDE5NS44NzksMjkuMDcxIDE5NS43MzQsMjkuMTU0IEwxOTIuNjUzLDMwLjkzMyBDMTkxLjkzMiwzMS4zNSAxOTAuODksMzEuNTA4IDE4OS45MzUsMzEuMzQ2IEMxODEuOTcyLDI5Ljk5NSAxNzMuNDc4LDI5Ljg2IDE2NS4zNzIsMzAuOTU0IEMxNTMuNjAyLDMyLjU0MyAxNDIuODYsMzUuOTkzIDEzNC4zMDcsNDAuOTMxIEMxMjUuNzkzLDQ1Ljg0NyAxMTkuODUxLDUyLjAwNCAxMTcuMTI0LDU4LjczNiBDMTE1LjI3LDYzLjMxNCAxMTUuNTAxLDY4LjExMiAxMTcuNzksNzIuNjExIEMxMTguMTYsNzMuMzM2IDExNy44NDUsNzQuMTI0IDExNi45OSw3NC42MTcgTDExMy45MDksNzYuMzk3IEMxMTMuODM2LDc2LjQzOCAxMTMuNzU2LDc2LjQ1OSAxMTMuNjc1LDc2LjQ1OSIgaWQ9IkZpbGwtMjQiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTUzLjMxNiwyMS4yNzkgQzE1MC45MDMsMjEuMjc5IDE0OC40OTUsMjAuNzUxIDE0Ni42NjQsMTkuNjkzIEMxNDQuODQ2LDE4LjY0NCAxNDMuODQ0LDE3LjIzMiAxNDMuODQ0LDE1LjcxOCBDMTQzLjg0NCwxNC4xOTEgMTQ0Ljg2LDEyLjc2MyAxNDYuNzA1LDExLjY5OCBMMTU2LjE5OCw2LjA5MSBDMTU2LjMwOSw2LjAyNSAxNTYuNDUyLDYuMDYyIDE1Ni41MTgsNi4xNzMgQzE1Ni41ODMsNi4yODQgMTU2LjU0Nyw2LjQyNyAxNTYuNDM2LDYuNDkzIEwxNDYuOTQsMTIuMTAyIEMxNDUuMjQ0LDEzLjA4MSAxNDQuMzEyLDE0LjM2NSAxNDQuMzEyLDE1LjcxOCBDMTQ0LjMxMiwxNy4wNTggMTQ1LjIzLDE4LjMyNiAxNDYuODk3LDE5LjI4OSBDMTUwLjQ0NiwyMS4zMzggMTU2LjI0LDIxLjMyNyAxNTkuODExLDE5LjI2NSBMMTY5LjU1OSwxMy42MzcgQzE2OS42NywxMy41NzMgMTY5LjgxMywxMy42MTEgMTY5Ljg3OCwxMy43MjMgQzE2OS45NDMsMTMuODM0IDE2OS45MDQsMTMuOTc3IDE2OS43OTMsMTQuMDQyIEwxNjAuMDQ1LDE5LjY3IEMxNTguMTg3LDIwLjc0MiAxNTUuNzQ5LDIxLjI3OSAxNTMuMzE2LDIxLjI3OSIgaWQ9IkZpbGwtMjUiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEzLjY3NSw3NS45OTIgTDY3Ljc2Miw0OS40ODQiIGlkPSJGaWxsLTI2IiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTExMy42NzUsNzYuMzQyIEMxMTMuNjE1LDc2LjM0MiAxMTMuNTU1LDc2LjMyNyAxMTMuNSw3Ni4yOTUgTDY3LjU4Nyw0OS43ODcgQzY3LjQxOSw0OS42OSA2Ny4zNjIsNDkuNDc2IDY3LjQ1OSw0OS4zMDkgQzY3LjU1Niw0OS4xNDEgNjcuNzcsNDkuMDgzIDY3LjkzNyw0OS4xOCBMMTEzLjg1LDc1LjY4OCBDMTE0LjAxOCw3NS43ODUgMTE0LjA3NSw3NiAxMTMuOTc4LDc2LjE2NyBDMTEzLjkxNCw3Ni4yNzkgMTEzLjc5Niw3Ni4zNDIgMTEzLjY3NSw3Ni4zNDIiIGlkPSJGaWxsLTI3IiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTY3Ljc2Miw0OS40ODQgTDY3Ljc2MiwxMDMuNDg1IEM2Ny43NjIsMTA0LjU3NSA2OC41MzIsMTA1LjkwMyA2OS40ODIsMTA2LjQ1MiBMMTExLjk1NSwxMzAuOTczIEMxMTIuOTA1LDEzMS41MjIgMTEzLjY3NSwxMzEuMDgzIDExMy42NzUsMTI5Ljk5MyBMMTEzLjY3NSw3NS45OTIiIGlkPSJGaWxsLTI4IiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTExMi43MjcsMTMxLjU2MSBDMTEyLjQzLDEzMS41NjEgMTEyLjEwNywxMzEuNDY2IDExMS43OCwxMzEuMjc2IEw2OS4zMDcsMTA2Ljc1NSBDNjguMjQ0LDEwNi4xNDIgNjcuNDEyLDEwNC43MDUgNjcuNDEyLDEwMy40ODUgTDY3LjQxMiw0OS40ODQgQzY3LjQxMiw0OS4yOSA2Ny41NjksNDkuMTM0IDY3Ljc2Miw0OS4xMzQgQzY3Ljk1Niw0OS4xMzQgNjguMTEzLDQ5LjI5IDY4LjExMyw0OS40ODQgTDY4LjExMywxMDMuNDg1IEM2OC4xMTMsMTA0LjQ0NSA2OC44MiwxMDUuNjY1IDY5LjY1NywxMDYuMTQ4IEwxMTIuMTMsMTMwLjY3IEMxMTIuNDc0LDEzMC44NjggMTEyLjc5MSwxMzAuOTEzIDExMywxMzAuNzkyIEMxMTMuMjA2LDEzMC42NzMgMTEzLjMyNSwxMzAuMzgxIDExMy4zMjUsMTI5Ljk5MyBMMTEzLjMyNSw3NS45OTIgQzExMy4zMjUsNzUuNzk4IDExMy40ODIsNzUuNjQxIDExMy42NzUsNzUuNjQxIEMxMTMuODY5LDc1LjY0MSAxMTQuMDI1LDc1Ljc5OCAxMTQuMDI1LDc1Ljk5MiBMMTE0LjAyNSwxMjkuOTkzIEMxMTQuMDI1LDEzMC42NDggMTEzLjc4NiwxMzEuMTQ3IDExMy4zNSwxMzEuMzk5IEMxMTMuMTYyLDEzMS41MDcgMTEyLjk1MiwxMzEuNTYxIDExMi43MjcsMTMxLjU2MSIgaWQ9IkZpbGwtMjkiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEyLjg2LDQwLjUxMiBDMTEyLjg2LDQwLjUxMiAxMTIuODYsNDAuNTEyIDExMi44NTksNDAuNTEyIEMxMTAuNTQxLDQwLjUxMiAxMDguMzYsMzkuOTkgMTA2LjcxNywzOS4wNDEgQzEwNS4wMTIsMzguMDU3IDEwNC4wNzQsMzYuNzI2IDEwNC4wNzQsMzUuMjkyIEMxMDQuMDc0LDMzLjg0NyAxMDUuMDI2LDMyLjUwMSAxMDYuNzU0LDMxLjUwNCBMMTE4Ljc5NSwyNC41NTEgQzEyMC40NjMsMjMuNTg5IDEyMi42NjksMjMuMDU4IDEyNS4wMDcsMjMuMDU4IEMxMjcuMzI1LDIzLjA1OCAxMjkuNTA2LDIzLjU4MSAxMzEuMTUsMjQuNTMgQzEzMi44NTQsMjUuNTE0IDEzMy43OTMsMjYuODQ1IDEzMy43OTMsMjguMjc4IEMxMzMuNzkzLDI5LjcyNCAxMzIuODQxLDMxLjA2OSAxMzEuMTEzLDMyLjA2NyBMMTE5LjA3MSwzOS4wMTkgQzExNy40MDMsMzkuOTgyIDExNS4xOTcsNDAuNTEyIDExMi44Niw0MC41MTIgTDExMi44Niw0MC41MTIgWiBNMTI1LjAwNywyMy43NTkgQzEyMi43OSwyMy43NTkgMTIwLjcwOSwyNC4yNTYgMTE5LjE0NiwyNS4xNTggTDEwNy4xMDQsMzIuMTEgQzEwNS42MDIsMzIuOTc4IDEwNC43NzQsMzQuMTA4IDEwNC43NzQsMzUuMjkyIEMxMDQuNzc0LDM2LjQ2NSAxMDUuNTg5LDM3LjU4MSAxMDcuMDY3LDM4LjQzNCBDMTA4LjYwNSwzOS4zMjMgMTEwLjY2MywzOS44MTIgMTEyLjg1OSwzOS44MTIgTDExMi44NiwzOS44MTIgQzExNS4wNzYsMzkuODEyIDExNy4xNTgsMzkuMzE1IDExOC43MjEsMzguNDEzIEwxMzAuNzYyLDMxLjQ2IEMxMzIuMjY0LDMwLjU5MyAxMzMuMDkyLDI5LjQ2MyAxMzMuMDkyLDI4LjI3OCBDMTMzLjA5MiwyNy4xMDYgMTMyLjI3OCwyNS45OSAxMzAuOCwyNS4xMzYgQzEyOS4yNjEsMjQuMjQ4IDEyNy4yMDQsMjMuNzU5IDEyNS4wMDcsMjMuNzU5IEwxMjUuMDA3LDIzLjc1OSBaIiBpZD0iRmlsbC0zMCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNjUuNjMsMTYuMjE5IEwxNTkuODk2LDE5LjUzIEMxNTYuNzI5LDIxLjM1OCAxNTEuNjEsMjEuMzY3IDE0OC40NjMsMTkuNTUgQzE0NS4zMTYsMTcuNzMzIDE0NS4zMzIsMTQuNzc4IDE0OC40OTksMTIuOTQ5IEwxNTQuMjMzLDkuNjM5IEwxNjUuNjMsMTYuMjE5IiBpZD0iRmlsbC0zMSIgZmlsbD0iI0ZBRkFGQSI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNTQuMjMzLDEwLjQ0OCBMMTY0LjIyOCwxNi4yMTkgTDE1OS41NDYsMTguOTIzIEMxNTguMTEyLDE5Ljc1IDE1Ni4xOTQsMjAuMjA2IDE1NC4xNDcsMjAuMjA2IEMxNTIuMTE4LDIwLjIwNiAxNTAuMjI0LDE5Ljc1NyAxNDguODE0LDE4Ljk0MyBDMTQ3LjUyNCwxOC4xOTkgMTQ2LjgxNCwxNy4yNDkgMTQ2LjgxNCwxNi4yNjkgQzE0Ni44MTQsMTUuMjc4IDE0Ny41MzcsMTQuMzE0IDE0OC44NSwxMy41NTYgTDE1NC4yMzMsMTAuNDQ4IE0xNTQuMjMzLDkuNjM5IEwxNDguNDk5LDEyLjk0OSBDMTQ1LjMzMiwxNC43NzggMTQ1LjMxNiwxNy43MzMgMTQ4LjQ2MywxOS41NSBDMTUwLjAzMSwyMC40NTUgMTUyLjA4NiwyMC45MDcgMTU0LjE0NywyMC45MDcgQzE1Ni4yMjQsMjAuOTA3IDE1OC4zMDYsMjAuNDQ3IDE1OS44OTYsMTkuNTMgTDE2NS42MywxNi4yMTkgTDE1NC4yMzMsOS42MzkiIGlkPSJGaWxsLTMyIiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE0NS40NDUsNzIuNjY3IEwxNDUuNDQ1LDcyLjY2NyBDMTQzLjY3Miw3Mi42NjcgMTQyLjIwNCw3MS44MTcgMTQxLjIwMiw3MC40MjIgQzE0MS4xMzUsNzAuMzMgMTQxLjE0NSw3MC4xNDcgMTQxLjIyNSw3MC4wNjYgQzE0MS4zMDUsNjkuOTg1IDE0MS40MzIsNjkuOTQ2IDE0MS41MjUsNzAuMDExIEMxNDIuMzA2LDcwLjU1OSAxNDMuMjMxLDcwLjgyMyAxNDQuMjc2LDcwLjgyMiBDMTQ1LjU5OCw3MC44MjIgMTQ3LjAzLDcwLjM3NiAxNDguNTMyLDY5LjUwOSBDMTUzLjg0Miw2Ni40NDMgMTU4LjE2Myw1OC45ODcgMTU4LjE2Myw1Mi44OTQgQzE1OC4xNjMsNTAuOTY3IDE1Ny43MjEsNDkuMzMyIDE1Ni44ODQsNDguMTY4IEMxNTYuODE4LDQ4LjA3NiAxNTYuODI4LDQ3Ljk0OCAxNTYuOTA4LDQ3Ljg2NyBDMTU2Ljk4OCw0Ny43ODYgMTU3LjExNCw0Ny43NzQgMTU3LjIwOCw0Ny44NCBDMTU4Ljg3OCw0OS4wMTIgMTU5Ljc5OCw1MS4yMiAxNTkuNzk4LDU0LjA1OSBDMTU5Ljc5OCw2MC4zMDEgMTU1LjM3Myw2OC4wNDYgMTQ5LjkzMyw3MS4xODYgQzE0OC4zNiw3Mi4wOTQgMTQ2Ljg1LDcyLjY2NyAxNDUuNDQ1LDcyLjY2NyBMMTQ1LjQ0NSw3Mi42NjcgWiBNMTQyLjQ3Niw3MSBDMTQzLjI5LDcxLjY1MSAxNDQuMjk2LDcyLjAwMiAxNDUuNDQ1LDcyLjAwMiBDMTQ2Ljc2Nyw3Mi4wMDIgMTQ4LjE5OCw3MS41NSAxNDkuNyw3MC42ODIgQzE1NS4wMSw2Ny42MTcgMTU5LjMzMSw2MC4xNTkgMTU5LjMzMSw1NC4wNjUgQzE1OS4zMzEsNTIuMDg1IDE1OC44NjgsNTAuNDM1IDE1OC4wMDYsNDkuMjcyIEMxNTguNDE3LDUwLjMwNyAxNTguNjMsNTEuNTMyIDE1OC42Myw1Mi44OTIgQzE1OC42Myw1OS4xMzQgMTU0LjIwNSw2Ni43NjcgMTQ4Ljc2NSw2OS45MDcgQzE0Ny4xOTIsNzAuODE2IDE0NS42ODEsNzEuMjgzIDE0NC4yNzYsNzEuMjgzIEMxNDMuNjM0LDcxLjI4MyAxNDMuMDMzLDcxLjE5MiAxNDIuNDc2LDcxIEwxNDIuNDc2LDcxIFoiIGlkPSJGaWxsLTMzIiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE0OC42NDgsNjkuNzA0IEMxNTQuMDMyLDY2LjU5NiAxNTguMzk2LDU5LjA2OCAxNTguMzk2LDUyLjg5MSBDMTU4LjM5Niw1MC44MzkgMTU3LjkxMyw0OS4xOTggMTU3LjA3NCw0OC4wMyBDMTU1LjI4OSw0Ni43NzggMTUyLjY5OSw0Ni44MzYgMTQ5LjgxNiw0OC41MDEgQzE0NC40MzMsNTEuNjA5IDE0MC4wNjgsNTkuMTM3IDE0MC4wNjgsNjUuMzE0IEMxNDAuMDY4LDY3LjM2NSAxNDAuNTUyLDY5LjAwNiAxNDEuMzkxLDcwLjE3NCBDMTQzLjE3Niw3MS40MjcgMTQ1Ljc2NSw3MS4zNjkgMTQ4LjY0OCw2OS43MDQiIGlkPSJGaWxsLTM0IiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE0NC4yNzYsNzEuMjc2IEwxNDQuMjc2LDcxLjI3NiBDMTQzLjEzMyw3MS4yNzYgMTQyLjExOCw3MC45NjkgMTQxLjI1Nyw3MC4zNjUgQzE0MS4yMzYsNzAuMzUxIDE0MS4yMTcsNzAuMzMyIDE0MS4yMDIsNzAuMzExIEMxNDAuMzA3LDY5LjA2NyAxMzkuODM1LDY3LjMzOSAxMzkuODM1LDY1LjMxNCBDMTM5LjgzNSw1OS4wNzMgMTQ0LjI2LDUxLjQzOSAxNDkuNyw0OC4yOTggQzE1MS4yNzMsNDcuMzkgMTUyLjc4NCw0Ni45MjkgMTU0LjE4OSw0Ni45MjkgQzE1NS4zMzIsNDYuOTI5IDE1Ni4zNDcsNDcuMjM2IDE1Ny4yMDgsNDcuODM5IEMxNTcuMjI5LDQ3Ljg1NCAxNTcuMjQ4LDQ3Ljg3MyAxNTcuMjYzLDQ3Ljg5NCBDMTU4LjE1Nyw0OS4xMzggMTU4LjYzLDUwLjg2NSAxNTguNjMsNTIuODkxIEMxNTguNjMsNTkuMTMyIDE1NC4yMDUsNjYuNzY2IDE0OC43NjUsNjkuOTA3IEMxNDcuMTkyLDcwLjgxNSAxNDUuNjgxLDcxLjI3NiAxNDQuMjc2LDcxLjI3NiBMMTQ0LjI3Niw3MS4yNzYgWiBNMTQxLjU1OCw3MC4xMDQgQzE0Mi4zMzEsNzAuNjM3IDE0My4yNDUsNzEuMDA1IDE0NC4yNzYsNzEuMDA1IEMxNDUuNTk4LDcxLjAwNSAxNDcuMDMsNzAuNDY3IDE0OC41MzIsNjkuNiBDMTUzLjg0Miw2Ni41MzQgMTU4LjE2Myw1OS4wMzMgMTU4LjE2Myw1Mi45MzkgQzE1OC4xNjMsNTEuMDMxIDE1Ny43MjksNDkuMzg1IDE1Ni45MDcsNDguMjIzIEMxNTYuMTMzLDQ3LjY5MSAxNTUuMjE5LDQ3LjQwOSAxNTQuMTg5LDQ3LjQwOSBDMTUyLjg2Nyw0Ny40MDkgMTUxLjQzNSw0Ny44NDIgMTQ5LjkzMyw0OC43MDkgQzE0NC42MjMsNTEuNzc1IDE0MC4zMDIsNTkuMjczIDE0MC4zMDIsNjUuMzY2IEMxNDAuMzAyLDY3LjI3NiAxNDAuNzM2LDY4Ljk0MiAxNDEuNTU4LDcwLjEwNCBMMTQxLjU1OCw3MC4xMDQgWiIgaWQ9IkZpbGwtMzUiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTUwLjcyLDY1LjM2MSBMMTUwLjM1Nyw2NS4wNjYgQzE1MS4xNDcsNjQuMDkyIDE1MS44NjksNjMuMDQgMTUyLjUwNSw2MS45MzggQzE1My4zMTMsNjAuNTM5IDE1My45NzgsNTkuMDY3IDE1NC40ODIsNTcuNTYzIEwxNTQuOTI1LDU3LjcxMiBDMTU0LjQxMiw1OS4yNDUgMTUzLjczMyw2MC43NDUgMTUyLjkxLDYyLjE3MiBDMTUyLjI2Miw2My4yOTUgMTUxLjUyNSw2NC4zNjggMTUwLjcyLDY1LjM2MSIgaWQ9IkZpbGwtMzYiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTE1LjkxNyw4NC41MTQgTDExNS41NTQsODQuMjIgQzExNi4zNDQsODMuMjQ1IDExNy4wNjYsODIuMTk0IDExNy43MDIsODEuMDkyIEMxMTguNTEsNzkuNjkyIDExOS4xNzUsNzguMjIgMTE5LjY3OCw3Ni43MTcgTDEyMC4xMjEsNzYuODY1IEMxMTkuNjA4LDc4LjM5OCAxMTguOTMsNzkuODk5IDExOC4xMDYsODEuMzI2IEMxMTcuNDU4LDgyLjQ0OCAxMTYuNzIyLDgzLjUyMSAxMTUuOTE3LDg0LjUxNCIgaWQ9IkZpbGwtMzciIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTE0LDEzMC40NzYgTDExNCwxMzAuMDA4IEwxMTQsNzYuMDUyIEwxMTQsNzUuNTg0IEwxMTQsNzYuMDUyIEwxMTQsMTMwLjAwOCBMMTE0LDEzMC40NzYiIGlkPSJGaWxsLTM4IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgICAgICA8ZyBpZD0iSW1wb3J0ZWQtTGF5ZXJzLUNvcHkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDYyLjAwMDAwMCwgMC4wMDAwMDApIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIj4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTkuODIyLDM3LjQ3NCBDMTkuODM5LDM3LjMzOSAxOS43NDcsMzcuMTk0IDE5LjU1NSwzNy4wODIgQzE5LjIyOCwzNi44OTQgMTguNzI5LDM2Ljg3MiAxOC40NDYsMzcuMDM3IEwxMi40MzQsNDAuNTA4IEMxMi4zMDMsNDAuNTg0IDEyLjI0LDQwLjY4NiAxMi4yNDMsNDAuNzkzIEMxMi4yNDUsNDAuOTI1IDEyLjI0NSw0MS4yNTQgMTIuMjQ1LDQxLjM3MSBMMTIuMjQ1LDQxLjQxNCBMMTIuMjM4LDQxLjU0MiBDOC4xNDgsNDMuODg3IDUuNjQ3LDQ1LjMyMSA1LjY0Nyw0NS4zMjEgQzUuNjQ2LDQ1LjMyMSAzLjU3LDQ2LjM2NyAyLjg2LDUwLjUxMyBDMi44Niw1MC41MTMgMS45NDgsNTcuNDc0IDEuOTYyLDcwLjI1OCBDMS45NzcsODIuODI4IDIuNTY4LDg3LjMyOCAzLjEyOSw5MS42MDkgQzMuMzQ5LDkzLjI5MyA2LjEzLDkzLjczNCA2LjEzLDkzLjczNCBDNi40NjEsOTMuNzc0IDYuODI4LDkzLjcwNyA3LjIxLDkzLjQ4NiBMODIuNDgzLDQ5LjkzNSBDODQuMjkxLDQ4Ljg2NiA4NS4xNSw0Ni4yMTYgODUuNTM5LDQzLjY1MSBDODYuNzUyLDM1LjY2MSA4Ny4yMTQsMTAuNjczIDg1LjI2NCwzLjc3MyBDODUuMDY4LDMuMDggODQuNzU0LDIuNjkgODQuMzk2LDIuNDkxIEw4Mi4zMSwxLjcwMSBDODEuNTgzLDEuNzI5IDgwLjg5NCwyLjE2OCA4MC43NzYsMi4yMzYgQzgwLjYzNiwyLjMxNyA0MS44MDcsMjQuNTg1IDIwLjAzMiwzNy4wNzIgTDE5LjgyMiwzNy40NzQiIGlkPSJGaWxsLTEiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNODIuMzExLDEuNzAxIEw4NC4zOTYsMi40OTEgQzg0Ljc1NCwyLjY5IDg1LjA2OCwzLjA4IDg1LjI2NCwzLjc3MyBDODcuMjEzLDEwLjY3MyA4Ni43NTEsMzUuNjYgODUuNTM5LDQzLjY1MSBDODUuMTQ5LDQ2LjIxNiA4NC4yOSw0OC44NjYgODIuNDgzLDQ5LjkzNSBMNy4yMSw5My40ODYgQzYuODk3LDkzLjY2NyA2LjU5NSw5My43NDQgNi4zMTQsOTMuNzQ0IEw2LjEzMSw5My43MzMgQzYuMTMxLDkzLjczNCAzLjM0OSw5My4yOTMgMy4xMjgsOTEuNjA5IEMyLjU2OCw4Ny4zMjcgMS45NzcsODIuODI4IDEuOTYzLDcwLjI1OCBDMS45NDgsNTcuNDc0IDIuODYsNTAuNTEzIDIuODYsNTAuNTEzIEMzLjU3LDQ2LjM2NyA1LjY0Nyw0NS4zMjEgNS42NDcsNDUuMzIxIEM1LjY0Nyw0NS4zMjEgOC4xNDgsNDMuODg3IDEyLjIzOCw0MS41NDIgTDEyLjI0NSw0MS40MTQgTDEyLjI0NSw0MS4zNzEgQzEyLjI0NSw0MS4yNTQgMTIuMjQ1LDQwLjkyNSAxMi4yNDMsNDAuNzkzIEMxMi4yNCw0MC42ODYgMTIuMzAyLDQwLjU4MyAxMi40MzQsNDAuNTA4IEwxOC40NDYsMzcuMDM2IEMxOC41NzQsMzYuOTYyIDE4Ljc0NiwzNi45MjYgMTguOTI3LDM2LjkyNiBDMTkuMTQ1LDM2LjkyNiAxOS4zNzYsMzYuOTc5IDE5LjU1NCwzNy4wODIgQzE5Ljc0NywzNy4xOTQgMTkuODM5LDM3LjM0IDE5LjgyMiwzNy40NzQgTDIwLjAzMywzNy4wNzIgQzQxLjgwNiwyNC41ODUgODAuNjM2LDIuMzE4IDgwLjc3NywyLjIzNiBDODAuODk0LDIuMTY4IDgxLjU4MywxLjcyOSA4Mi4zMTEsMS43MDEgTTgyLjMxMSwwLjcwNCBMODIuMjcyLDAuNzA1IEM4MS42NTQsMC43MjggODAuOTg5LDAuOTQ5IDgwLjI5OCwxLjM2MSBMODAuMjc3LDEuMzczIEM4MC4xMjksMS40NTggNTkuNzY4LDEzLjEzNSAxOS43NTgsMzYuMDc5IEMxOS41LDM1Ljk4MSAxOS4yMTQsMzUuOTI5IDE4LjkyNywzNS45MjkgQzE4LjU2MiwzNS45MjkgMTguMjIzLDM2LjAxMyAxNy45NDcsMzYuMTczIEwxMS45MzUsMzkuNjQ0IEMxMS40OTMsMzkuODk5IDExLjIzNiw0MC4zMzQgMTEuMjQ2LDQwLjgxIEwxMS4yNDcsNDAuOTYgTDUuMTY3LDQ0LjQ0NyBDNC43OTQsNDQuNjQ2IDIuNjI1LDQ1Ljk3OCAxLjg3Nyw1MC4zNDUgTDEuODcxLDUwLjM4NCBDMS44NjIsNTAuNDU0IDAuOTUxLDU3LjU1NyAwLjk2NSw3MC4yNTkgQzAuOTc5LDgyLjg3OSAxLjU2OCw4Ny4zNzUgMi4xMzcsOTEuNzI0IEwyLjEzOSw5MS43MzkgQzIuNDQ3LDk0LjA5NCA1LjYxNCw5NC42NjIgNS45NzUsOTQuNzE5IEw2LjAwOSw5NC43MjMgQzYuMTEsOTQuNzM2IDYuMjEzLDk0Ljc0MiA2LjMxNCw5NC43NDIgQzYuNzksOTQuNzQyIDcuMjYsOTQuNjEgNy43MSw5NC4zNSBMODIuOTgzLDUwLjc5OCBDODQuNzk0LDQ5LjcyNyA4NS45ODIsNDcuMzc1IDg2LjUyNSw0My44MDEgQzg3LjcxMSwzNS45ODcgODguMjU5LDEwLjcwNSA4Ni4yMjQsMy41MDIgQzg1Ljk3MSwyLjYwOSA4NS41MiwxLjk3NSA4NC44ODEsMS42MiBMODQuNzQ5LDEuNTU4IEw4Mi42NjQsMC43NjkgQzgyLjU1MSwwLjcyNSA4Mi40MzEsMC43MDQgODIuMzExLDAuNzA0IiBpZD0iRmlsbC0yIiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTY2LjI2NywxMS41NjUgTDY3Ljc2MiwxMS45OTkgTDExLjQyMyw0NC4zMjUiIGlkPSJGaWxsLTMiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTIuMjAyLDkwLjU0NSBDMTIuMDI5LDkwLjU0NSAxMS44NjIsOTAuNDU1IDExLjc2OSw5MC4yOTUgQzExLjYzMiw5MC4wNTcgMTEuNzEzLDg5Ljc1MiAxMS45NTIsODkuNjE0IEwzMC4zODksNzguOTY5IEMzMC42MjgsNzguODMxIDMwLjkzMyw3OC45MTMgMzEuMDcxLDc5LjE1MiBDMzEuMjA4LDc5LjM5IDMxLjEyNyw3OS42OTYgMzAuODg4LDc5LjgzMyBMMTIuNDUxLDkwLjQ3OCBMMTIuMjAyLDkwLjU0NSIgaWQ9IkZpbGwtNCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMy43NjQsNDIuNjU0IEwxMy42NTYsNDIuNTkyIEwxMy43MDIsNDIuNDIxIEwxOC44MzcsMzkuNDU3IEwxOS4wMDcsMzkuNTAyIEwxOC45NjIsMzkuNjczIEwxMy44MjcsNDIuNjM3IEwxMy43NjQsNDIuNjU0IiBpZD0iRmlsbC01IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTguNTIsOTAuMzc1IEw4LjUyLDQ2LjQyMSBMOC41ODMsNDYuMzg1IEw3NS44NCw3LjU1NCBMNzUuODQsNTEuNTA4IEw3NS43NzgsNTEuNTQ0IEw4LjUyLDkwLjM3NSBMOC41Miw5MC4zNzUgWiBNOC43Nyw0Ni41NjQgTDguNzcsODkuOTQ0IEw3NS41OTEsNTEuMzY1IEw3NS41OTEsNy45ODUgTDguNzcsNDYuNTY0IEw4Ljc3LDQ2LjU2NCBaIiBpZD0iRmlsbC02IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTI0Ljk4Niw4My4xODIgQzI0Ljc1Niw4My4zMzEgMjQuMzc0LDgzLjU2NiAyNC4xMzcsODMuNzA1IEwxMi42MzIsOTAuNDA2IEMxMi4zOTUsOTAuNTQ1IDEyLjQyNiw5MC42NTggMTIuNyw5MC42NTggTDEzLjI2NSw5MC42NTggQzEzLjU0LDkwLjY1OCAxMy45NTgsOTAuNTQ1IDE0LjE5NSw5MC40MDYgTDI1LjcsODMuNzA1IEMyNS45MzcsODMuNTY2IDI2LjEyOCw4My40NTIgMjYuMTI1LDgzLjQ0OSBDMjYuMTIyLDgzLjQ0NyAyNi4xMTksODMuMjIgMjYuMTE5LDgyLjk0NiBDMjYuMTE5LDgyLjY3MiAyNS45MzEsODIuNTY5IDI1LjcwMSw4Mi43MTkgTDI0Ljk4Niw4My4xODIiIGlkPSJGaWxsLTciIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTMuMjY2LDkwLjc4MiBMMTIuNyw5MC43ODIgQzEyLjUsOTAuNzgyIDEyLjM4NCw5MC43MjYgMTIuMzU0LDkwLjYxNiBDMTIuMzI0LDkwLjUwNiAxMi4zOTcsOTAuMzk5IDEyLjU2OSw5MC4yOTkgTDI0LjA3NCw4My41OTcgQzI0LjMxLDgzLjQ1OSAyNC42ODksODMuMjI2IDI0LjkxOCw4My4wNzggTDI1LjYzMyw4Mi42MTQgQzI1LjcyMyw4Mi41NTUgMjUuODEzLDgyLjUyNSAyNS44OTksODIuNTI1IEMyNi4wNzEsODIuNTI1IDI2LjI0NCw4Mi42NTUgMjYuMjQ0LDgyLjk0NiBDMjYuMjQ0LDgzLjE2IDI2LjI0NSw4My4zMDkgMjYuMjQ3LDgzLjM4MyBMMjYuMjUzLDgzLjM4NyBMMjYuMjQ5LDgzLjQ1NiBDMjYuMjQ2LDgzLjUzMSAyNi4yNDYsODMuNTMxIDI1Ljc2Myw4My44MTIgTDE0LjI1OCw5MC41MTQgQzE0LDkwLjY2NSAxMy41NjQsOTAuNzgyIDEzLjI2Niw5MC43ODIgTDEzLjI2Niw5MC43ODIgWiBNMTIuNjY2LDkwLjUzMiBMMTIuNyw5MC41MzMgTDEzLjI2Niw5MC41MzMgQzEzLjUxOCw5MC41MzMgMTMuOTE1LDkwLjQyNSAxNC4xMzIsOTAuMjk5IEwyNS42MzcsODMuNTk3IEMyNS44MDUsODMuNDk5IDI1LjkzMSw4My40MjQgMjUuOTk4LDgzLjM4MyBDMjUuOTk0LDgzLjI5OSAyNS45OTQsODMuMTY1IDI1Ljk5NCw4Mi45NDYgTDI1Ljg5OSw4Mi43NzUgTDI1Ljc2OCw4Mi44MjQgTDI1LjA1NCw4My4yODcgQzI0LjgyMiw4My40MzcgMjQuNDM4LDgzLjY3MyAyNC4yLDgzLjgxMiBMMTIuNjk1LDkwLjUxNCBMMTIuNjY2LDkwLjUzMiBMMTIuNjY2LDkwLjUzMiBaIiBpZD0iRmlsbC04IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTEzLjI2Niw4OS44NzEgTDEyLjcsODkuODcxIEMxMi41LDg5Ljg3MSAxMi4zODQsODkuODE1IDEyLjM1NCw4OS43MDUgQzEyLjMyNCw4OS41OTUgMTIuMzk3LDg5LjQ4OCAxMi41NjksODkuMzg4IEwyNC4wNzQsODIuNjg2IEMyNC4zMzIsODIuNTM1IDI0Ljc2OCw4Mi40MTggMjUuMDY3LDgyLjQxOCBMMjUuNjMyLDgyLjQxOCBDMjUuODMyLDgyLjQxOCAyNS45NDgsODIuNDc0IDI1Ljk3OCw4Mi41ODQgQzI2LjAwOCw4Mi42OTQgMjUuOTM1LDgyLjgwMSAyNS43NjMsODIuOTAxIEwxNC4yNTgsODkuNjAzIEMxNCw4OS43NTQgMTMuNTY0LDg5Ljg3MSAxMy4yNjYsODkuODcxIEwxMy4yNjYsODkuODcxIFogTTEyLjY2Niw4OS42MjEgTDEyLjcsODkuNjIyIEwxMy4yNjYsODkuNjIyIEMxMy41MTgsODkuNjIyIDEzLjkxNSw4OS41MTUgMTQuMTMyLDg5LjM4OCBMMjUuNjM3LDgyLjY4NiBMMjUuNjY3LDgyLjY2OCBMMjUuNjMyLDgyLjY2NyBMMjUuMDY3LDgyLjY2NyBDMjQuODE1LDgyLjY2NyAyNC40MTgsODIuNzc1IDI0LjIsODIuOTAxIEwxMi42OTUsODkuNjAzIEwxMi42NjYsODkuNjIxIEwxMi42NjYsODkuNjIxIFoiIGlkPSJGaWxsLTkiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTIuMzcsOTAuODAxIEwxMi4zNyw4OS41NTQgTDEyLjM3LDkwLjgwMSIgaWQ9IkZpbGwtMTAiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNi4xMyw5My45MDEgQzUuMzc5LDkzLjgwOCA0LjgxNiw5My4xNjQgNC42OTEsOTIuNTI1IEMzLjg2LDg4LjI4NyAzLjU0LDgzLjc0MyAzLjUyNiw3MS4xNzMgQzMuNTExLDU4LjM4OSA0LjQyMyw1MS40MjggNC40MjMsNTEuNDI4IEM1LjEzNCw0Ny4yODIgNy4yMSw0Ni4yMzYgNy4yMSw0Ni4yMzYgQzcuMjEsNDYuMjM2IDgxLjY2NywzLjI1IDgyLjA2OSwzLjAxNyBDODIuMjkyLDIuODg4IDg0LjU1NiwxLjQzMyA4NS4yNjQsMy45NCBDODcuMjE0LDEwLjg0IDg2Ljc1MiwzNS44MjcgODUuNTM5LDQzLjgxOCBDODUuMTUsNDYuMzgzIDg0LjI5MSw0OS4wMzMgODIuNDgzLDUwLjEwMSBMNy4yMSw5My42NTMgQzYuODI4LDkzLjg3NCA2LjQ2MSw5My45NDEgNi4xMyw5My45MDEgQzYuMTMsOTMuOTAxIDMuMzQ5LDkzLjQ2IDMuMTI5LDkxLjc3NiBDMi41NjgsODcuNDk1IDEuOTc3LDgyLjk5NSAxLjk2Miw3MC40MjUgQzEuOTQ4LDU3LjY0MSAyLjg2LDUwLjY4IDIuODYsNTAuNjggQzMuNTcsNDYuNTM0IDUuNjQ3LDQ1LjQ4OSA1LjY0Nyw0NS40ODkgQzUuNjQ2LDQ1LjQ4OSA4LjA2NSw0NC4wOTIgMTIuMjQ1LDQxLjY3OSBMMTMuMTE2LDQxLjU2IEwxOS43MTUsMzcuNzMgTDE5Ljc2MSwzNy4yNjkgTDYuMTMsOTMuOTAxIiBpZD0iRmlsbC0xMSIgZmlsbD0iI0ZBRkFGQSI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik02LjMxNyw5NC4xNjEgTDYuMTAyLDk0LjE0OCBMNi4xMDEsOTQuMTQ4IEw1Ljg1Nyw5NC4xMDEgQzUuMTM4LDkzLjk0NSAzLjA4NSw5My4zNjUgMi44ODEsOTEuODA5IEMyLjMxMyw4Ny40NjkgMS43MjcsODIuOTk2IDEuNzEzLDcwLjQyNSBDMS42OTksNTcuNzcxIDIuNjA0LDUwLjcxOCAyLjYxMyw1MC42NDggQzMuMzM4LDQ2LjQxNyA1LjQ0NSw0NS4zMSA1LjUzNSw0NS4yNjYgTDEyLjE2Myw0MS40MzkgTDEzLjAzMyw0MS4zMiBMMTkuNDc5LDM3LjU3OCBMMTkuNTEzLDM3LjI0NCBDMTkuNTI2LDM3LjEwNyAxOS42NDcsMzcuMDA4IDE5Ljc4NiwzNy4wMjEgQzE5LjkyMiwzNy4wMzQgMjAuMDIzLDM3LjE1NiAyMC4wMDksMzcuMjkzIEwxOS45NSwzNy44ODIgTDEzLjE5OCw0MS44MDEgTDEyLjMyOCw0MS45MTkgTDUuNzcyLDQ1LjcwNCBDNS43NDEsNDUuNzIgMy43ODIsNDYuNzcyIDMuMTA2LDUwLjcyMiBDMy4wOTksNTAuNzgyIDIuMTk4LDU3LjgwOCAyLjIxMiw3MC40MjQgQzIuMjI2LDgyLjk2MyAyLjgwOSw4Ny40MiAzLjM3Myw5MS43MjkgQzMuNDY0LDkyLjQyIDQuMDYyLDkyLjg4MyA0LjY4Miw5My4xODEgQzQuNTY2LDkyLjk4NCA0LjQ4Niw5Mi43NzYgNC40NDYsOTIuNTcyIEMzLjY2NSw4OC41ODggMy4yOTEsODQuMzcgMy4yNzYsNzEuMTczIEMzLjI2Miw1OC41MiA0LjE2Nyw1MS40NjYgNC4xNzYsNTEuMzk2IEM0LjkwMSw0Ny4xNjUgNy4wMDgsNDYuMDU5IDcuMDk4LDQ2LjAxNCBDNy4wOTQsNDYuMDE1IDgxLjU0MiwzLjAzNCA4MS45NDQsMi44MDIgTDgxLjk3MiwyLjc4NSBDODIuODc2LDIuMjQ3IDgzLjY5MiwyLjA5NyA4NC4zMzIsMi4zNTIgQzg0Ljg4NywyLjU3MyA4NS4yODEsMy4wODUgODUuNTA0LDMuODcyIEM4Ny41MTgsMTEgODYuOTY0LDM2LjA5MSA4NS43ODUsNDMuODU1IEM4NS4yNzgsNDcuMTk2IDg0LjIxLDQ5LjM3IDgyLjYxLDUwLjMxNyBMNy4zMzUsOTMuODY5IEM2Ljk5OSw5NC4wNjMgNi42NTgsOTQuMTYxIDYuMzE3LDk0LjE2MSBMNi4zMTcsOTQuMTYxIFogTTYuMTcsOTMuNjU0IEM2LjQ2Myw5My42OSA2Ljc3NCw5My42MTcgNy4wODUsOTMuNDM3IEw4Mi4zNTgsNDkuODg2IEM4NC4xODEsNDguODA4IDg0Ljk2LDQ1Ljk3MSA4NS4yOTIsNDMuNzggQzg2LjQ2NiwzNi4wNDkgODcuMDIzLDExLjA4NSA4NS4wMjQsNC4wMDggQzg0Ljg0NiwzLjM3NyA4NC41NTEsMi45NzYgODQuMTQ4LDIuODE2IEM4My42NjQsMi42MjMgODIuOTgyLDIuNzY0IDgyLjIyNywzLjIxMyBMODIuMTkzLDMuMjM0IEM4MS43OTEsMy40NjYgNy4zMzUsNDYuNDUyIDcuMzM1LDQ2LjQ1MiBDNy4zMDQsNDYuNDY5IDUuMzQ2LDQ3LjUyMSA0LjY2OSw1MS40NzEgQzQuNjYyLDUxLjUzIDMuNzYxLDU4LjU1NiAzLjc3NSw3MS4xNzMgQzMuNzksODQuMzI4IDQuMTYxLDg4LjUyNCA0LjkzNiw5Mi40NzYgQzUuMDI2LDkyLjkzNyA1LjQxMiw5My40NTkgNS45NzMsOTMuNjE1IEM2LjA4Nyw5My42NCA2LjE1OCw5My42NTIgNi4xNjksOTMuNjU0IEw2LjE3LDkzLjY1NCBMNi4xNyw5My42NTQgWiIgaWQ9IkZpbGwtMTIiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNy4zMTcsNjguOTgyIEM3LjgwNiw2OC43MDEgOC4yMDIsNjguOTI2IDguMjAyLDY5LjQ4NyBDOC4yMDIsNzAuMDQ3IDcuODA2LDcwLjczIDcuMzE3LDcxLjAxMiBDNi44MjksNzEuMjk0IDYuNDMzLDcxLjA2OSA2LjQzMyw3MC41MDggQzYuNDMzLDY5Ljk0OCA2LjgyOSw2OS4yNjUgNy4zMTcsNjguOTgyIiBpZD0iRmlsbC0xMyIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik02LjkyLDcxLjEzMyBDNi42MzEsNzEuMTMzIDYuNDMzLDcwLjkwNSA2LjQzMyw3MC41MDggQzYuNDMzLDY5Ljk0OCA2LjgyOSw2OS4yNjUgNy4zMTcsNjguOTgyIEM3LjQ2LDY4LjkgNy41OTUsNjguODYxIDcuNzE0LDY4Ljg2MSBDOC4wMDMsNjguODYxIDguMjAyLDY5LjA5IDguMjAyLDY5LjQ4NyBDOC4yMDIsNzAuMDQ3IDcuODA2LDcwLjczIDcuMzE3LDcxLjAxMiBDNy4xNzQsNzEuMDk0IDcuMDM5LDcxLjEzMyA2LjkyLDcxLjEzMyBNNy43MTQsNjguNjc0IEM3LjU1Nyw2OC42NzQgNy4zOTIsNjguNzIzIDcuMjI0LDY4LjgyMSBDNi42NzYsNjkuMTM4IDYuMjQ2LDY5Ljg3OSA2LjI0Niw3MC41MDggQzYuMjQ2LDcwLjk5NCA2LjUxNyw3MS4zMiA2LjkyLDcxLjMyIEM3LjA3OCw3MS4zMiA3LjI0Myw3MS4yNzEgNy40MTEsNzEuMTc0IEM3Ljk1OSw3MC44NTcgOC4zODksNzAuMTE3IDguMzg5LDY5LjQ4NyBDOC4zODksNjkuMDAxIDguMTE3LDY4LjY3NCA3LjcxNCw2OC42NzQiIGlkPSJGaWxsLTE0IiBmaWxsPSIjODA5N0EyIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTYuOTIsNzAuOTQ3IEM2LjY0OSw3MC45NDcgNi42MjEsNzAuNjQgNi42MjEsNzAuNTA4IEM2LjYyMSw3MC4wMTcgNi45ODIsNjkuMzkyIDcuNDExLDY5LjE0NSBDNy41MjEsNjkuMDgyIDcuNjI1LDY5LjA0OSA3LjcxNCw2OS4wNDkgQzcuOTg2LDY5LjA0OSA4LjAxNSw2OS4zNTUgOC4wMTUsNjkuNDg3IEM4LjAxNSw2OS45NzggNy42NTIsNzAuNjAzIDcuMjI0LDcwLjg1MSBDNy4xMTUsNzAuOTE0IDcuMDEsNzAuOTQ3IDYuOTIsNzAuOTQ3IE03LjcxNCw2OC44NjEgQzcuNTk1LDY4Ljg2MSA3LjQ2LDY4LjkgNy4zMTcsNjguOTgyIEM2LjgyOSw2OS4yNjUgNi40MzMsNjkuOTQ4IDYuNDMzLDcwLjUwOCBDNi40MzMsNzAuOTA1IDYuNjMxLDcxLjEzMyA2LjkyLDcxLjEzMyBDNy4wMzksNzEuMTMzIDcuMTc0LDcxLjA5NCA3LjMxNyw3MS4wMTIgQzcuODA2LDcwLjczIDguMjAyLDcwLjA0NyA4LjIwMiw2OS40ODcgQzguMjAyLDY5LjA5IDguMDAzLDY4Ljg2MSA3LjcxNCw2OC44NjEiIGlkPSJGaWxsLTE1IiBmaWxsPSIjODA5N0EyIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTcuNDQ0LDg1LjM1IEM3LjcwOCw4NS4xOTggNy45MjEsODUuMzE5IDcuOTIxLDg1LjYyMiBDNy45MjEsODUuOTI1IDcuNzA4LDg2LjI5MiA3LjQ0NCw4Ni40NDQgQzcuMTgxLDg2LjU5NyA2Ljk2Nyw4Ni40NzUgNi45NjcsODYuMTczIEM2Ljk2Nyw4NS44NzEgNy4xODEsODUuNTAyIDcuNDQ0LDg1LjM1IiBpZD0iRmlsbC0xNiIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik03LjIzLDg2LjUxIEM3LjA3NCw4Ni41MSA2Ljk2Nyw4Ni4zODcgNi45NjcsODYuMTczIEM2Ljk2Nyw4NS44NzEgNy4xODEsODUuNTAyIDcuNDQ0LDg1LjM1IEM3LjUyMSw4NS4zMDUgNy41OTQsODUuMjg0IDcuNjU4LDg1LjI4NCBDNy44MTQsODUuMjg0IDcuOTIxLDg1LjQwOCA3LjkyMSw4NS42MjIgQzcuOTIxLDg1LjkyNSA3LjcwOCw4Ni4yOTIgNy40NDQsODYuNDQ0IEM3LjM2Nyw4Ni40ODkgNy4yOTQsODYuNTEgNy4yMyw4Ni41MSBNNy42NTgsODUuMDk4IEM3LjU1OCw4NS4wOTggNy40NTUsODUuMTI3IDcuMzUxLDg1LjE4OCBDNy4wMzEsODUuMzczIDYuNzgxLDg1LjgwNiA2Ljc4MSw4Ni4xNzMgQzYuNzgxLDg2LjQ4MiA2Ljk2Niw4Ni42OTcgNy4yMyw4Ni42OTcgQzcuMzMsODYuNjk3IDcuNDMzLDg2LjY2NiA3LjUzOCw4Ni42MDcgQzcuODU4LDg2LjQyMiA4LjEwOCw4NS45ODkgOC4xMDgsODUuNjIyIEM4LjEwOCw4NS4zMTMgNy45MjMsODUuMDk4IDcuNjU4LDg1LjA5OCIgaWQ9IkZpbGwtMTciIGZpbGw9IiM4MDk3QTIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNy4yMyw4Ni4zMjIgTDcuMTU0LDg2LjE3MyBDNy4xNTQsODUuOTM4IDcuMzMzLDg1LjYyOSA3LjUzOCw4NS41MTIgTDcuNjU4LDg1LjQ3MSBMNy43MzQsODUuNjIyIEM3LjczNCw4NS44NTYgNy41NTUsODYuMTY0IDcuMzUxLDg2LjI4MiBMNy4yMyw4Ni4zMjIgTTcuNjU4LDg1LjI4NCBDNy41OTQsODUuMjg0IDcuNTIxLDg1LjMwNSA3LjQ0NCw4NS4zNSBDNy4xODEsODUuNTAyIDYuOTY3LDg1Ljg3MSA2Ljk2Nyw4Ni4xNzMgQzYuOTY3LDg2LjM4NyA3LjA3NCw4Ni41MSA3LjIzLDg2LjUxIEM3LjI5NCw4Ni41MSA3LjM2Nyw4Ni40ODkgNy40NDQsODYuNDQ0IEM3LjcwOCw4Ni4yOTIgNy45MjEsODUuOTI1IDcuOTIxLDg1LjYyMiBDNy45MjEsODUuNDA4IDcuODE0LDg1LjI4NCA3LjY1OCw4NS4yODQiIGlkPSJGaWxsLTE4IiBmaWxsPSIjODA5N0EyIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTc3LjI3OCw3Ljc2OSBMNzcuMjc4LDUxLjQzNiBMMTAuMjA4LDkwLjE2IEwxMC4yMDgsNDYuNDkzIEw3Ny4yNzgsNy43NjkiIGlkPSJGaWxsLTE5IiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTEwLjA4Myw5MC4zNzUgTDEwLjA4Myw0Ni40MjEgTDEwLjE0Niw0Ni4zODUgTDc3LjQwMyw3LjU1NCBMNzcuNDAzLDUxLjUwOCBMNzcuMzQxLDUxLjU0NCBMMTAuMDgzLDkwLjM3NSBMMTAuMDgzLDkwLjM3NSBaIE0xMC4zMzMsNDYuNTY0IEwxMC4zMzMsODkuOTQ0IEw3Ny4xNTQsNTEuMzY1IEw3Ny4xNTQsNy45ODUgTDEwLjMzMyw0Ni41NjQgTDEwLjMzMyw0Ni41NjQgWiIgaWQ9IkZpbGwtMjAiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMjUuNzM3LDg4LjY0NyBMMTE4LjA5OCw5MS45ODEgTDExOC4wOTgsODQgTDEwNi42MzksODguNzEzIEwxMDYuNjM5LDk2Ljk4MiBMOTksMTAwLjMxNSBMMTEyLjM2OSwxMDMuOTYxIEwxMjUuNzM3LDg4LjY0NyIgaWQ9IkltcG9ydGVkLUxheWVycy1Db3B5LTIiIGZpbGw9IiM0NTVBNjQiIHNrZXRjaDp0eXBlPSJNU1NoYXBlR3JvdXAiPjwvcGF0aD4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+")
},N.exports=D},{"./util.js":8}],8:[function(M,N){var D={};D.base64=function(M,N){return"data:"+M+";base64,"+N},D.isMobile=function(){var M=!1;return function(N){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(N)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(N.substr(0,4)))&&(M=!0)}(navigator.userAgent||navigator.vendor||window.opera),M},D.isIOS=function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},D.isIFrame=function(){try{return window.self!==window.top}catch(M){return!0}},D.appendQueryParameter=function(M,N,D){var j=M.indexOf("?")<0?"?":"&";return M+=j+N+"="+D},D.getQueryParameter=function(M){M=M.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var N=new RegExp("[\\?&]"+M+"=([^&#]*)"),D=N.exec(location.search);return null===D?"":decodeURIComponent(D[1].replace(/\+/g," "))},D.isLandscapeMode=function(){return 90==window.orientation||-90==window.orientation},N.exports=D},{}],9:[function(M,N){function D(){var M=document.createElement("video");M.addEventListener("ended",function(){M.play()}),this.request=function(){M.paused&&(M.src=g.base64("video/webm","GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAAH4xFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggfG7AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU2LjQwLjEwMVdBjUxhdmY1Ni40MC4xMDFzpJAGSJTMbsLpDt/ySkipgX1fRImIQO1MAAAAAAAWVK5rAQAAAAAAADuuAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDmDgQEj44OEO5rKAOABAAAAAAAABrCBsLqBkB9DtnUBAAAAAAAAo+eBAKOmgQAAgKJJg0IAAV4BHsAHBIODCoAACmH2MAAAZxgz4dPSTFi5JACjloED6ACmAECSnABMQAADYAAAWi0quoCjloEH0ACmAECSnABNwAADYAAAWi0quoCjloELuACmAECSnABNgAADYAAAWi0quoCjloEPoACmAECSnABNYAADYAAAWi0quoCjloETiACmAECSnABNIAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTnghdwo5aBAAAApgBAkpwATOAAA2AAAFotKrqAo5aBA+gApgBAkpwATMAAA2AAAFotKrqAo5aBB9AApgBAkpwATIAAA2AAAFotKrqAo5aBC7gApgBAkpwATEAAA2AAAFotKrqAo5aBD6AApgDAkpwAQ2AAA2AAAFotKrqAo5aBE4gApgBAkpwATCAAA2AAAFotKrqAH0O2dQEAAAAAAACU54Iu4KOWgQAAAKYAQJKcAEvAAANgAABaLSq6gKOWgQPoAKYAQJKcAEtgAANgAABaLSq6gKOWgQfQAKYAQJKcAEsAAANgAABaLSq6gKOWgQu4AKYAQJKcAEqAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEogAANgAABaLSq6gKOWgROIAKYAQJKcAEnAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCRlCjloEAAACmAECSnABJgAADYAAAWi0quoCjloED6ACmAECSnABJIAADYAAAWi0quoCjloEH0ACmAMCSnABDYAADYAAAWi0quoCjloELuACmAECSnABI4AADYAAAWi0quoCjloEPoACmAECSnABIoAADYAAAWi0quoCjloETiACmAECSnABIYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngl3Ao5aBAAAApgBAkpwASCAAA2AAAFotKrqAo5aBA+gApgBAkpwASAAAA2AAAFotKrqAo5aBB9AApgBAkpwAR8AAA2AAAFotKrqAo5aBC7gApgBAkpwAR4AAA2AAAFotKrqAo5aBD6AApgBAkpwAR2AAA2AAAFotKrqAo5aBE4gApgBAkpwARyAAA2AAAFotKrqAH0O2dQEAAAAAAACU54J1MKOWgQAAAKYAwJKcAENgAANgAABaLSq6gKOWgQPoAKYAQJKcAEbgAANgAABaLSq6gKOWgQfQAKYAQJKcAEagAANgAABaLSq6gKOWgQu4AKYAQJKcAEaAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEZAAANgAABaLSq6gKOWgROIAKYAQJKcAEYAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCjKCjloEAAACmAECSnABF4AADYAAAWi0quoCjloED6ACmAECSnABFwAADYAAAWi0quoCjloEH0ACmAECSnABFoAADYAAAWi0quoCjloELuACmAECSnABFgAADYAAAWi0quoCjloEPoACmAMCSnABDYAADYAAAWi0quoCjloETiACmAECSnABFYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngqQQo5aBAAAApgBAkpwARUAAA2AAAFotKrqAo5aBA+gApgBAkpwARSAAA2AAAFotKrqAo5aBB9AApgBAkpwARQAAA2AAAFotKrqAo5aBC7gApgBAkpwARQAAA2AAAFotKrqAo5aBD6AApgBAkpwAROAAA2AAAFotKrqAo5aBE4gApgBAkpwARMAAA2AAAFotKrqAH0O2dQEAAAAAAACU54K7gKOWgQAAAKYAQJKcAESgAANgAABaLSq6gKOWgQPoAKYAQJKcAESAAANgAABaLSq6gKOWgQfQAKYAwJKcAENgAANgAABaLSq6gKOWgQu4AKYAQJKcAERgAANgAABaLSq6gKOWgQ+gAKYAQJKcAERAAANgAABaLSq6gKOWgROIAKYAQJKcAEQgAANgAABaLSq6gB9DtnUBAAAAAAAAlOeC0vCjloEAAACmAECSnABEIAADYAAAWi0quoCjloED6ACmAECSnABEAAADYAAAWi0quoCjloEH0ACmAECSnABD4AADYAAAWi0quoCjloELuACmAECSnABDwAADYAAAWi0quoCjloEPoACmAECSnABDoAADYAAAWi0quoCjloETiACmAECSnABDgAADYAAAWi0quoAcU7trAQAAAAAAABG7j7OBALeK94EB8YIBd/CBAw=="),M.play())},this.release=function(){M.pause(),M.src=""}}function j(){var M=null;this.request=function(){M||(M=setInterval(function(){window.location=window.location,setTimeout(window.stop,0)},3e4))},this.release=function(){M&&(clearInterval(M),M=null)}}function L(){var M=navigator.userAgent||navigator.vendor||window.opera;return M.match(/iPhone/i)||M.match(/iPod/i)?j:D}var g=M("./util.js");N.exports=L()},{"./util.js":8}],10:[function(M,N){function D(M,N,D){this.params=D||{},this.mode=I.UNKNOWN;var u=Vizor.hideWebVRButton||this.params.hideButton||!1;this.renderer=M,this.effect=N,this.distorter=new L(M),this.button=new j,this.rotateInstructions=new A,this.isVRCompatible=!1,this.isFullscreenDisabled=!!T.getQueryParameter("no_fullscreen"),this.startMode=I.NORMAL;var E=parseInt(T.getQueryParameter("start_mode"));isNaN(E)||(this.startMode=E),u&&this.button.setVisibility(!1);var z=new g;this.getDeviceByType_(HMDVRDevice).then(function(M){switch(WebVRConfig.FORCE_DISTORTION?(this.distorter.setActive(!0),this.isVRCompatible=!0):M&&(this.isVRCompatible=!0,0==M.deviceName.indexOf("webvr-polyfill")&&z.getDevice()&&!WebVRConfig.PREVENT_DISTORTION&&this.distorter.setActive(!0),this.hmd=M),this.startMode){case I.MAGIC_WINDOW:this.normalToMagicWindow(),this.setMode_(I.MAGIC_WINDOW);break;case I.VR:this.anyModeToVR(),this.setMode_(I.VR);break;default:this.setMode_(I.NORMAL)}this.button.on("fs",this.onFSClick_.bind(this)),this.button.on("vr",this.onVRClick_.bind(this)),this.button.on("back",this.onBackClick_.bind(this))}.bind(this)),this.getDeviceByType_(PositionSensorVRDevice).then(function(M){this.input=M}.bind(this)),document.addEventListener("webkitfullscreenchange",this.onFullscreenChange_.bind(this)),document.addEventListener("mozfullscreenchange",this.onFullscreenChange_.bind(this)),window.addEventListener("orientationchange",this.onOrientationChange_.bind(this)),this.wakelock=new i}var j=M("./button-manager.js"),L=M("./cardboard-distorter.js"),g=M("./device-info.js"),I=M("./modes.js"),A=M("./rotate-instructions.js"),T=M("./util.js"),i=M("./wakelock.js");D.prototype.getDeviceByType_=function(M){return new Promise(function(N){navigator.getVRDevices().then(function(D){for(var j=0;j<D.length;j++)if(D[j]instanceof M){N(D[j]);break}N(null)},function(){N(null)})})},D.prototype.isVRMode=function(){return this.mode==I.VR},D.prototype.render=function(M,N){this.resizeIfNeeded_(N),this.isVRMode()?(this.distorter.preRender(),this.effect.render(M,N),this.distorter.postRender()):M instanceof Array?this.renderer.render(M[0],N):this.renderer.render(M,N)},D.prototype.setMode_=function(M){console.log("Mode change: %s => %s",this.mode,M),this.mode=M,this.button.setMode(M,this.isVRCompatible),this.mode==I.VR&&T.isLandscapeMode()&&T.isMobile()?this.rotateInstructions.showTemporarily(3e3):this.updateRotateInstructions_()},D.prototype.toggleFullScreen=function(){this.isVRCompatible?this.onVRClick_():this.onFSClick_()},D.prototype.toggleImmersive=function(){this.onFSClick_()},D.prototype.onFSClick_=function(){switch(this.mode){case I.NORMAL:if(T.isIOS()&&T.isIFrame()){var M=window.location.href;return M=T.appendQueryParameter(M,"no_fullscreen","true"),M=T.appendQueryParameter(M,"start_mode",I.MAGIC_WINDOW),void(top.location.href=M)}this.normalToMagicWindow(),this.setMode_(I.MAGIC_WINDOW);break;case I.MAGIC_WINDOW:this.isFullscreenDisabled?window.history.back():(this.anyModeToNormal(),this.setMode_(I.NORMAL))}},D.prototype.onVRClick_=function(){if(this.mode==I.NORMAL&&T.isIOS()&&T.isIFrame()){var M=window.location.href;return M=T.appendQueryParameter(M,"no_fullscreen","true"),M=T.appendQueryParameter(M,"start_mode",I.VR),void(top.location.href=M)}this.anyModeToVR(),this.setMode_(I.VR)},D.prototype.onBackClick_=function(){this.isFullscreenDisabled?window.history.back():(this.anyModeToNormal(),this.setMode_(I.NORMAL))},D.prototype.normalToMagicWindow=function(){this.requestFullscreen_(),this.wakelock.request()},D.prototype.anyModeToVR=function(){this.requestFullscreen_(),this.wakelock.request(),this.distorter.patch()},D.prototype.vrToMagicWindow=function(){this.distorter.unpatch(),this.resize_()},D.prototype.anyModeToNormal=function(){this.exitFullscreen_(),this.releasePointerLock_(),this.wakelock.release(),this.distorter.unpatch(),this.resize_()},D.prototype.getContainerDimensions=function(){var M,N,D;return this.renderer.domElement?(M=this.renderer.domElement.parentNode,N=M.clientWidth,D=M.clientHeight,N&&D||(N=window.innerWidth,D=window.innerHeight)):(M=window,N=M.innerWidth,D=M.innerHeight),{width:N,height:D}},D.prototype.resizeIfNeeded_=function(M){var N=this.renderer.getSize(),D=this.getContainerDimensions();(N.width!=D.width||N.height!=D.height)&&(M.aspect=D.width/D.height,M.updateProjectionMatrix(),this.resize_(D))},D.prototype.resize_=function(M){M=M||this.getContainerDimensions(),this.effect.setSize(M.width,M.height)},D.prototype.onOrientationChange_=function(){this.updateRotateInstructions_()},D.prototype.updateRotateInstructions_=function(){this.rotateInstructions.disableShowTemporarily(),this.mode==I.VR&&!T.isLandscapeMode()&&T.isMobile()?this.rotateInstructions.show():this.rotateInstructions.hide()},D.prototype.onFullscreenChange_=function(){(null===document.webkitFullscreenElement||null===document.mozFullScreenElement)&&(this.anyModeToNormal(),this.setMode_(I.NORMAL))},D.prototype.requestPointerLock_=function(){var M=this.renderer.domElement;M.requestPointerLock=M.requestPointerLock||M.mozRequestPointerLock||M.webkitRequestPointerLock,M.requestPointerLock&&M.requestPointerLock()},D.prototype.releasePointerLock_=function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},D.prototype.requestOrientationLock_=function(){screen.orientation&&T.isMobile()&&screen.orientation.lock("landscape")},D.prototype.releaseOrientationLock_=function(){screen.orientation&&screen.orientation.unlock()},D.prototype.requestFullscreen_=function(){var M=this.renderer.domElement;M.requestFullscreen?M.requestFullscreen():M.mozRequestFullScreen?M.mozRequestFullScreen({vrDisplay:this.hmd}):M.webkitRequestFullscreen&&M.webkitRequestFullscreen({vrDisplay:this.hmd})},D.prototype.exitFullscreen_=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},N.exports=D},{"./button-manager.js":1,"./cardboard-distorter.js":2,"./device-info.js":3,"./modes.js":6,"./rotate-instructions.js":7,"./util.js":8,"./wakelock.js":9}]},{},[5]);
;
!function(){var s=E2.Noise=function(s,i){this.seed(s||256,i||0)};s.prototype.seed=function(s,i){this.size=Math.floor(s),this.rngSeed=i,this.rng=new Random(Random.engines.mt19937().seed(this.rngSeed)),this.rns=[];for(var t=0;s>t;t++)this.rns[t]=this.rng.real(0,1)},s.prototype.noise1D=function(s,i){var t=this.rns[Math.floor(s%this.size)],e=this.rns[Math.floor((s+1)%this.size)],n=s-Math.floor(s),h=n*n*(3-2*n),o=t+(e-t)*h;return i>0&&(o=.5*o+this.noise1D((s+this.size/(i+1))/2,i-1)),o},s.prototype.noise2D=function(s,i,t,e){var n=e||40,h=Math.floor(i),o=Math.floor(s),r=this.rns[(h*n+o)%this.size],a=this.rns[(h*n+o+1)%this.size],f=this.rns[(h*n+o+n)%this.size],z=this.rns[(h*n+o+n+1)%this.size],d=s-o,l=d*d*(3-2*d),u=i-h,p=u*u*(3-2*u),M=r+(a-r)*l,c=f+(z-f)*l,g=M+(c-M)*p;return t>0&&(g=.5*g+this.noise2D((s+this.size/(t+1))/2,(i+this.size/(t+1))/2,t-1,n)),g}}();
;
!function(n){"use strict";function t(n){if(!(this instanceof t))return new t(n);if(null==n)n=t.engines.nativeMath;else if("function"!=typeof n)throw new TypeError("Expected engine to be a function, got "+typeof n);this.engine=n}function r(n){return function(){return n}}function e(n,t){return 0===t?n:function(r){return n(r)+t}}function i(n){var t=+n;return 0>t?Math.ceil(t):Math.floor(t)}function u(n,t){return 0>n?Math.max(n+t,0):Math.min(n,t)}function o(){return void 0}var f="Random",c="function"!=typeof Math.imul||-5!==Math.imul(4294967295,5)?function(n,t){var r=n>>>16&65535,e=65535&n,i=t>>>16&65535,u=65535&t;return e*u+(r*u+e*i<<16>>>0)|0}:Math.imul,a="function"==typeof String.prototype.repeat&&"xxx"==="x".repeat(3)?function(n,t){return n.repeat(t)}:function(n,t){for(var r="";t>0;)1&t&&(r+=n),t>>=1,n+=n;return r},l=t.prototype;t.engines={nativeMath:function(){return 4294967296*Math.random()|0},mt19937:function(n){function r(n){for(var t=0,r=0;227>(0|t);t=t+1|0)r=2147483648&n[t]|2147483647&n[t+1|0],n[t]=n[t+397|0]^r>>>1^(1&r?2567483615:0);for(;623>(0|t);t=t+1|0)r=2147483648&n[t]|2147483647&n[t+1|0],n[t]=n[t-227|0]^r>>>1^(1&r?2567483615:0);r=2147483648&n[623]|2147483647&n[0],n[623]=n[396]^r>>>1^(1&r?2567483615:0)}function e(n){return n^=n>>>11,n^=n<<7&2636928640,n^=n<<15&4022730752,n^n>>>18}function i(n,t){for(var r=1,e=0,i=t.length,u=0|Math.max(i,624),o=0|n[0];(0|u)>0;--u)n[r]=o=(n[r]^c(o^o>>>30,1664525))+(0|t[e])+(0|e)|0,r=r+1|0,++e,(0|r)>623&&(n[0]=n[623],r=1),e>=i&&(e=0);for(u=623;(0|u)>0;--u)n[r]=o=(n[r]^c(o^o>>>30,1566083941))-r|0,r=r+1|0,(0|r)>623&&(n[0]=n[623],r=1);n[0]=2147483648}function u(){function u(){(0|f)>=624&&(r(o),f=0);var n=o[f];return f=f+1|0,0|e(n)}var o=new n(624),f=0;return u.discard=function(n){for((0|f)>=624&&(r(o),f=0);n-f>624;)n-=624-f,r(o),f=0;return f=f+n|0,u},u.seed=function(n){var t=0;o[0]=t=0|n;for(var r=1;624>r;r=r+1|0)o[r]=t=c(t^t>>>30,1812433253)+r|0;return f=624,u},u.seedWithArray=function(n){return u.seed(19650218),i(o,n),u},u.autoSeed=function(){return u.seedWithArray(t.generateEntropyArray())},u}return u}("function"==typeof Int32Array?Int32Array:Array),browserCrypto:"undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues&&"function"==typeof Int32Array?function(){var n=null,t=128;return function(){return t>=128&&(null===n&&(n=new Int32Array(128)),crypto.getRandomValues(n),t=0),0|n[t++]}}():null},t.generateEntropyArray=function(){var n=[];n.push(0|(new Date).getTime());for(var r=t.engines.nativeMath,e=0;16>e;++e)n[e]=0|r();return n},t.int32=function(n){return 0|n()},l.int32=function(){return t.int32(this.engine)},t.uint32=function(n){return n()>>>0},l.uint32=function(){return t.uint32(this.engine)},t.uint53=function(n){var t=2097151&n(),r=n()>>>0;return 4294967296*t+r},l.uint53=function(){return t.uint53(this.engine)},t.uint53Full=function(n){for(;;){var t=0|n();if(!(2097152&t)){var r=n()>>>0;return 4294967296*(2097151&t)+r}if(2097152===(4194303&t)&&0===(0|n()))return 9007199254740992}},l.uint53Full=function(){return t.uint53Full(this.engine)},t.int53=function(n){var t=0|n(),r=n()>>>0;return 4294967296*(2097151&t)+r+(2097152&t?-9007199254740992:0)},l.int53=function(){return t.int53(this.engine)},t.int53Full=function(n){for(;;){var t=0|n();if(!(4194304&t)){var r=n()>>>0;return 4294967296*(2097151&t)+r+(2097152&t?-9007199254740992:0)}if(4194304===(8388607&t)&&0===(0|n()))return 9007199254740992}},l.int53Full=function(){return t.int53Full(this.engine)},t.integer=function(){function n(n){return 0===(n+1&n)}function i(n){return function(t){return t()&n}}function u(n){var t=n+1,r=t*Math.floor(4294967296/t);return function(n){var e=0;do e=n()>>>0;while(e>=r);return e%t}}function o(t){return n(t)?i(t):u(t)}function f(n){return 0===(0|n)}function c(n){return function(t){var r=t()&n,e=t()>>>0;return 4294967296*r+e}}function a(n){var t=n*Math.floor(9007199254740992/n);return function(r){var e=0;do{var i=2097151&r(),u=r()>>>0;e=4294967296*i+u}while(e>=t);return e%n}}function l(t){var r=t+1;if(f(r)){var e=(r/4294967296|0)-1;if(n(e))return c(e)}return a(r)}function h(n,t){return function(r){var e=0;do{var i=0|r(),u=r()>>>0;e=4294967296*(2097151&i)+u+(2097152&i?-9007199254740992:0)}while(n>e||e>t);return e}}return function(n,i){if(n=Math.floor(n),i=Math.floor(i),-9007199254740992>n||!isFinite(n))throw new RangeError("Expected min to be at least -9007199254740992");if(i>9007199254740992||!isFinite(i))throw new RangeError("Expected max to be at most 9007199254740992");var u=i-n;return 0>=u||!isFinite(u)?r(n):4294967295===u?0===n?t.uint32:e(t.int32,n+2147483648):4294967295>u?e(o(u),n):9007199254740991===u?e(t.uint53,n):9007199254740991>u?e(l(u),n):i-1-n===9007199254740991?e(t.uint53Full,n):-9007199254740992===n&&9007199254740992===i?t.int53Full:-9007199254740992===n&&9007199254740991===i?t.int53:-9007199254740991===n&&9007199254740992===i?e(t.int53,1):9007199254740992===i?e(h(n-1,i-1),1):h(n,i)}}(),l.integer=function(n,r){return t.integer(n,r)(this.engine)},t.realZeroToOneInclusive=function(n){return t.uint53Full(n)/9007199254740992},l.realZeroToOneInclusive=function(){return t.realZeroToOneInclusive(this.engine)},t.realZeroToOneExclusive=function(n){return t.uint53(n)/9007199254740992},l.realZeroToOneExclusive=function(){return t.realZeroToOneExclusive(this.engine)},t.real=function(){function n(n,t){return 1===t?n:0===t?function(){return 0}:function(r){return n(r)*t}}return function(r,i,u){if(!isFinite(r))throw new RangeError("Expected left to be a finite number");if(!isFinite(i))throw new RangeError("Expected right to be a finite number");return e(n(u?t.realZeroToOneInclusive:t.realZeroToOneExclusive,i-r),r)}}(),l.real=function(n,r,e){return t.real(n,r,e)(this.engine)},t.bool=function(){function n(n){return 1===(1&n())}function e(n,t){return function(r){return n(r)<t}}function i(n){if(0>=n)return r(!1);if(n>=1)return r(!0);var i=4294967296*n;return i%1===0?e(t.int32,i-2147483648|0):e(t.uint53,Math.round(9007199254740992*n))}return function(u,o){return null==o?null==u?n:i(u):0>=u?r(!1):u>=o?r(!0):e(t.integer(0,o-1),u)}}(),l.bool=function(n,r){return t.bool(n,r)(this.engine)},t.pick=function(n,r,e,o){var f=r.length,c=null==e?0:u(i(e),f),a=void 0===o?f:u(i(o),f);if(c>=a)return void 0;var l=t.integer(c,a-1);return r[l(n)]},l.pick=function(n,r,e){return t.pick(this.engine,n,r,e)};var h=Array.prototype.slice;t.picker=function(n,r,e){var i=h.call(n,r,e);if(!i.length)return o;var u=t.integer(0,i.length-1);return function(n){return i[u(n)]}},t.shuffle=function(n,r,e){var i=r.length;if(i){null==e&&(e=0);for(var u=i-1>>>0;u>e;--u){var o=t.integer(0,u),f=o(n);if(u!==f){var c=r[u];r[u]=r[f],r[f]=c}}}return r},l.shuffle=function(n){return t.shuffle(this.engine,n)},t.sample=function(n,r,e){if(0>e||e>r.length||!isFinite(e))throw new RangeError("Expected sampleSize to be within 0 and the length of the population");if(0===e)return[];var i=h.call(r),u=i.length;if(u===e)return t.shuffle(n,i,0);var o=u-e;return t.shuffle(n,i,o-1).slice(o)},l.sample=function(n,r){return t.sample(this.engine,n,r)},t.die=function(n){return t.integer(1,n)},l.die=function(n){return t.die(n)(this.engine)},t.dice=function(n,r){var e=t.die(n);return function(n){var t=[];t.length=r;for(var i=0;r>i;++i)t[i]=e(n);return t}},l.dice=function(n,r){return t.dice(n,r)(this.engine)},t.uuid4=function(){function n(n,t){return a("0",t-n.length)+n}return function(t){var r=t()>>>0,e=0|t(),i=0|t(),u=t()>>>0;return n(r.toString(16),8)+"-"+n((65535&e).toString(16),4)+"-"+n((e>>4&4095|16384).toString(16),4)+"-"+n((16383&i|32768).toString(16),4)+"-"+n((i>>4&65535).toString(16),4)+n(u.toString(16),8)}}(),l.uuid4=function(){return t.uuid4(this.engine)},t.string=function(){var n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_-";return function(r){null==r&&(r=n);var e=r.length;if(!e)throw new Error("Expected pool not to be an empty string");var i=t.integer(0,e-1);return function(n,t){for(var e="",u=0;t>u;++u){var o=i(n);e+=r.charAt(o)}return e}}}(),l.string=function(n,r){return t.string(r)(this.engine,n)},t.hex=function(){var n="0123456789abcdef",r=t.string(n),e=t.string(n.toUpperCase());return function(n){return n?e:r}}(),l.hex=function(n,r){return t.hex(r)(this.engine,n)},t.date=function(n,r){if(!(n instanceof Date))throw new TypeError("Expected start to be a Date, got "+typeof n);if(!(r instanceof Date))throw new TypeError("Expected end to be a Date, got "+typeof r);var e=t.integer(n.getTime(),r.getTime());return function(n){return new Date(e(n))}},l.date=function(n,r){return t.date(n,r)(this.engine)},"function"==typeof define&&define.amd?define(function(){return t}):"undefined"!=typeof module&&"function"==typeof require?module.exports=t:(!function(){var r=n[f];t.noConflict=function(){return n[f]=r,this}}(),n[f]=t)}(this);
;
E2.EnvironmentSettings=function(){this.fog=new THREE.Fog,this.fog.near=1e4,this.fog.far=1e4,this.fog.color=new THREE.Color(0)};
;
function TextureCache(){this.textures={},this.defaultTexture=THREE.ImageUtils.loadTexture("/data/textures/defaulttex.png"),this.loadingTexture=THREE.ImageUtils.loadTexture("/data/textures/loadingtex.png")}TextureCache.prototype.get=function(t){function e(){this.textures[t].texture.image=this.defaultTexture.image,this.textures[t].texture.needsUpdate=!0}var r=this.textures[t];if(r)return msg("INFO: Returning cached version of texture '"+t+"'."),r.count++,r.texture;var u=THREE.ImageUtils.loadTexture(t,void 0,void 0,e.bind(this));return u.wrapS=THREE.RepeatWrapping,u.wrapT=THREE.RepeatWrapping,msg("INFO: Fetching texture '"+t+"'."),this.textures[t]={count:0,texture:u},u},TextureCache.prototype.clear=function(){this.textures={}},TextureCache.prototype.count=function(){var t=0,e=this.textures;for(var r in e)e.hasOwnProperty(r)&&++t;return t};
;
function PluginManager(){EventEmitter.call(this),this.keybyid=E2.plugins;var e=this;setTimeout(function(){e.emit("ready")},0)}PluginManager.prototype=Object.create(EventEmitter.prototype),PluginManager.prototype.create=function(e,t){if(E2.plugins.hasOwnProperty(e)){var r=new E2.plugins[e](E2.app.player.core,t);return r.id=e,r}throw new Error("Failed to resolve plugin with id "+e)};
;
E2.p=E2.plugins.absolute_modulator=function(t){this.desc="Emit the absolute value of the input.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Positive or negative input value",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"Positive output value",def:0}]},E2.p.prototype.reset=function(){this.input_val=0,this.output_val=0},E2.p.prototype.update_input=function(t,u){this.input_val=u},E2.p.prototype.update_state=function(){this.output_val=Math.abs(this.input_val)},E2.p.prototype.update_output=function(){return this.output_val};
;
E2.p=E2.plugins.accumulate_modulator=function(t){this.desc="Every input <b>value</b> is accumulated in an internal buffer (which resets to zero on playback stop).",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"A small value to be accumulated in an internal buffer.",def:0},{name:"reset",dt:t.datatypes.FLOAT,desc:"Send a value to this slot to reset the accumulator to that value.",def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The current value of the accumulation buffer.",def:0}],this.state={value:0}},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_input=function(t,e){0===t.index?this.state.value+=e:this.state.value=e},E2.p.prototype.update_output=function(){return this.state.value};
;
E2.p=E2.plugins.action_button=function(t,u){this.desc="Push button that emits true when it is clicked.",this.input_slots=[],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"True once each time the button is clicked.",def:!1}],this.node=u,this.value=!1,this.output_value=!1},E2.p.prototype.reset=function(){this.value=!1,this.output_value=!1},E2.p.prototype.create_ui=function(){var t=makeButton("Click","","fxtrigger");return t.click(function(t){return function(){t.output_value=!1,t.value=!0,t.updated=!0}}(this)),t},E2.p.prototype.update_state=function(){this.updated=this.output_value||this.value,this.output_value=this.value,this.value=!1},E2.p.prototype.update_output=function(){return this.output_value};
;
E2.p=E2.plugins.add_modulator=function(t){this.desc="Add two floating point values.",this.input_slots=[{name:"a",dt:t.datatypes.FLOAT,desc:"The first operand.",def:0},{name:"b",dt:t.datatypes.FLOAT,desc:"The second operand.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"The result of <b>first</b> + <b>second</b>.",def:0}]},E2.p.prototype.reset=function(){this.input_val=0,this.add_val=0,this.output_val=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.input_val=e:this.add_val=e},E2.p.prototype.update_state=function(){this.output_val=this.input_val+this.add_val},E2.p.prototype.update_output=function(){return this.output_val};
;
!function(){var t=E2.plugins.add_on_trigger_float=function(){Plugin.apply(this,arguments),this.input_slots=[{name:"trigger",dt:E2.dt.BOOL,desc:"On true, this plugin will output A + B, otherwise A"},{name:"A",dt:E2.dt.FLOAT},{name:"B",dt:E2.dt.FLOAT}],this.output_slots=[{name:"value",dt:E2.dt.FLOAT,desc:"if trigger is true, will output A + B, otherwise A"}]};t.prototype=Object.create(Plugin.prototype),t.prototype.update_output=function(){return this.inputValues.trigger?this.inputValues.A+this.inputValues.B:this.inputValues.A}}();
;
!function(){var t=E2.plugins.add_on_trigger_vector3=function(){Plugin.apply(this,arguments),this.input_slots=[{name:"trigger",dt:E2.dt.BOOL,desc:"On true, this plugin will output A + B, otherwise A"},{name:"A",dt:E2.dt.VECTOR},{name:"B",dt:E2.dt.VECTOR}],this.output_slots=[{name:"value",dt:E2.dt.VECTOR,desc:"if trigger is true, will output A + B, otherwise A"}],this.value=new THREE.Vector3};t.prototype=Object.create(Plugin.prototype),t.prototype.update_state=function(){this.value.copy(this.inputValues.A),this.inputValues.trigger&&this.value.add(this.inputValues.B)},t.prototype.update_output=function(){return this.value}}();
;
E2.p=E2.plugins.and_modulator=function(t){this.desc="Emit true if and only if both inputs are true and false otherwise.",this.input_slots=[{name:"a",dt:t.datatypes.BOOL,desc:"The first operand.",def:!1},{name:"b",dt:t.datatypes.BOOL,desc:"The second operand.",def:!1}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true if <b>first</b> <i>and</i> <b>second</b> are true, and false otherwise.",def:!1}]},E2.p.prototype.reset=function(){this.conds=[!1,!1],this.state=!1},E2.p.prototype.update_input=function(t,e){this.conds[t.index]=e},E2.p.prototype.update_state=function(){this.state=this.conds[0]&&this.conds[1]},E2.p.prototype.update_output=function(){return this.state};
;
!function(){var t=E2.plugins.animate_float_on_trigger=function(t,n){AbstractAnimateValueOnTriggerPlugin.apply(this,[t,n,E2.dt.FLOAT,function(t,n,e){return t+(n-t)*e}])};t.prototype=Object.create(AbstractAnimateValueOnTriggerPlugin.prototype)}();
;
!function(){var t=E2.plugins.animate_vector3_on_trigger=function(t,e){AbstractAnimateValueOnTriggerPlugin.apply(this,[t,e,E2.dt.VECTOR,function(t,e,n){return new THREE.Vector3(t.x,t.y,t.z).lerp(e,n)}])};t.prototype=Object.create(AbstractAnimateValueOnTriggerPlugin.prototype)}();
;
!function(){var t=120,e=80,i=550,n=440,o=THREE.Math.clamp,u=E2.plugins.annotation=function(){Plugin.apply(this,arguments),this.desc="Add textual hints to the graph.",this.input_slots=[],this.output_slots=[],this.state={text:"",width:t,height:e}};u.prototype=Object.create(Plugin.prototype),u.prototype.create_ui=function(){var u=this,a={get text(){return u.state.text},set text(t){return u.state.text=t},get width(){return u.state.width},set width(e){return u.state.width=o(e,t,i)},get height(){return u.state.height},set height(t){return u.state.height=o(t,e,n)}},s=this.updateUi.bind(this),h=this.beginBatchModifyState.bind(this),c=function(){u.endBatchModifyState("Annotation")};this.ui=new UITextArea(a,h,s,c);var r=this.ui.dom.find("textarea"),p=null;return r.on("keyup",function(){p&&clearTimeout(p),p=setTimeout(function(){u.transientSetState("text",r.val())},300)}),this.node.on("pluginStateChanged",this.updateUi.bind(this)),this.ui.dom},u.prototype.state_changed=function(){this.updateUi()},u.prototype.updateUi=function(){this.ui&&this.ui.update()}}();
;
!function(){var t=E2.plugins.array_blend_modulator_float=function(t,r){AbstractArrayBlendModulatorPlugin.apply(this,[t,r,E2.dt.FLOAT,function(t,r,o){return t+(r-t)*o}])};t.prototype=Object.create(AbstractArrayBlendModulatorPlugin.prototype)}();
;
!function(){var t=E2.plugins.array_blend_modulator_vector3=function(t,r){AbstractArrayBlendModulatorPlugin.apply(this,[t,r,E2.dt.VECTOR,function(t,r,o){return new THREE.Vector3(t.x,t.y,t.z).lerp(r,o)}])};t.prototype=Object.create(AbstractArrayBlendModulatorPlugin.prototype)}();
;
var ArrayClearPlugin=E2.plugins.array_clear=function(t,r){Plugin.apply(this,arguments),this.desc="Empties given array",this.input_slots=[{name:"array",dt:E2.dt.ANY,array:!0,desc:"Optional array to change",def:[]},{name:"clear",dt:t.datatypes.BOOL,desc:"A true signal here clears the array"}],this.output_slots=[{name:"array",dt:E2.dt.ANY,array:!0}],this.lsg=new LinkedSlotGroup(t,r,[this.input_slots[0]],[this.output_slots[0]]),this.array=[],this.index=0};ArrayClearPlugin.prototype=Object.create(Plugin.prototype),ArrayClearPlugin.prototype.reset=function(){},ArrayClearPlugin.prototype.update_input=function(t,r){0===t.index?this.array=r?r:this.array:1===t.index&&r===!0&&(this.array=[])},ArrayClearPlugin.prototype.update_output=function(){return this.array},ArrayClearPlugin.prototype.state_changed=function(t){t||(this.array=[],this.lsg.infer_dt())};
;
!function(){var t=E2.plugins.array_function=function(t){SubGraphPlugin.apply(this,arguments),this.desc="Creates an array with the nested patch. A local variable called <b>index</b> is available to the patch in each iteration. Each iteration should output its result to the <b>item</b> local variable. ",this.input_slots=[{name:"length",dt:t.datatypes.FLOAT,desc:"The length of the array to create.",def:0}],this.output_slots=[{name:"array",array:!0,dt:t.datatypes.ANY,desc:"The array created by the function.",def:0}],this.state={input_sids:{},output_sids:{},always_update:!1}};t.prototype=Object.create(SubGraphPlugin.prototype),t.prototype.drilldown=function(){return NodeUI.drilldown(this)},t.prototype.update_input=function(t,a){t.dynamic?this.input_nodes[t.uid].plugin.input_updated(a):"length"===t.name&&(this.length=Math.floor(a))},t.prototype.update_state=function(){if(this.updated=!1,this.updated_sids.length=0,this.graph){var t=!1;this.array=[];for(var a=0;a<this.length;a++){this.graph.variables.write("index",a),this.graph.reset(),this.graph.update()&&(t=!0);var e=this.graph.variables.read("item");this.array[a]=e}this.updated=!0,t&&this===E2.app.player.core.active_graph&&E2.app.updateCanvas(!1)}},t.prototype.variable_dt_changed=function(t){this.output_slots[0].dt=t,this.updated=!0},t.prototype.update_output=function(t){return"array"===t.name?this.array:SubGraphPlugin.prototype.update_output.apply(this,arguments)},t.prototype.state_changed=function(t){{var a=this.core;this.parent_node}if(!t){this.setupProxies(),this.length=0,this.array=[],this.graph.variables.lock(this,"index"),this.graph.variables.set_datatype("index",a.datatypes.FLOAT),this.graph.variables.lock(this,"item");var e=this.graph.variables.variables.item.dt;e.id!==E2.dt.ANY.id&&this.graph.variables.set_datatype("item",e)}}}();
;
var ArrayGetPlugin=E2.plugins.array_get=function(t,e){Plugin.apply(this,arguments),this.input_slots=[{name:"array",dt:E2.dt.ANY,array:!0,desc:"Optional array to change",def:[]},{name:"index",dt:t.datatypes.FLOAT,def:0,desc:"Index for object in array"}],this.output_slots=[{name:"item",dt:t.datatypes.ANY}],this.lsg=new LinkedSlotGroup(t,e,[this.input_slots[0]],[this.output_slots[0]]),this.array=[]};ArrayGetPlugin.prototype=Object.create(Plugin.prototype),ArrayGetPlugin.prototype.reset=function(){this.item=this.lsg.infer_dt(),this.output_slots[0].array=!1},ArrayGetPlugin.prototype.connection_changed=function(t,e,r){this.lsg.connection_changed(t,e,r)&&(this.array=this.lsg.core.get_default_value(this.lsg.dt)),this.output_slots[0].array=!1},ArrayGetPlugin.prototype.update_input=function(t,e){0===t.index?e&&e.length&&(this.array=e):1===t.index&&(this.item=this.array[e])},ArrayGetPlugin.prototype.update_output=function(){return this.item},ArrayGetPlugin.prototype.state_changed=function(t){t||(this.array=[],this.lsg.infer_dt(),this.output_slots[0].array=!1)};
;
var ArrayLengthPlugin=E2.plugins.array_length=function(t){this.input_slots=[{name:"array",dt:E2.dt.ANY,array:!0,def:[]}],this.output_slots=[{name:"length",dt:t.datatypes.FLOAT}],this.length=0};ArrayLengthPlugin.prototype.connection_changed=function(t,n){this.input_slots[0].dt=t?n.src_slot.dt:E2.dt.ANY},ArrayLengthPlugin.prototype.reset=function(){this.length=0},ArrayLengthPlugin.prototype.update_input=function(t,n){this.length=n?n.length:0},ArrayLengthPlugin.prototype.update_output=function(){return this.length};
;
var ArrayRemovePlugin=E2.plugins.array_remove=function(t,e){Plugin.apply(this,arguments),this.input_slots=[{name:"array",dt:E2.dt.ANY,array:!0,desc:"Optional array to change",def:[]},{name:"index",dt:t.datatypes.FLOAT,def:0,desc:"Index for object in array"}],this.output_slots=[{name:"array",dt:E2.dt.ANY,array:!0}],this.lsg=new LinkedSlotGroup(t,e,[this.input_slots[0]],[this.output_slots[0]]),this.array=[]};ArrayRemovePlugin.prototype=Object.create(Plugin.prototype),ArrayRemovePlugin.prototype.reset=function(){this.array=this.lsg.infer_dt()},ArrayRemovePlugin.prototype.connection_changed=function(t,e,r){console.log("ArrayRemovePlugin.connection_changed"),this.lsg.connection_changed(t,e,r)&&(this.array=this.lsg.core.get_default_value(this.lsg.dt))},ArrayRemovePlugin.prototype.update_input=function(t,e){console.log("ArrayRemovePlugin.update_input",t.index,e),0===t.index?e&&e.length&&(this.array=e):1===t.index&&this.array.splice(e,1)},ArrayRemovePlugin.prototype.update_output=function(){return this.array},ArrayRemovePlugin.prototype.state_changed=function(t){t||(this.array=[],this.lsg.infer_dt())};
;
var ArraySetPlugin=E2.plugins.array_set=function(t,e){Plugin.apply(this,arguments),this.input_slots=[{name:"array",dt:E2.dt.ANY,array:!0,desc:"Optional array to change",def:[]},{name:"index",dt:t.datatypes.FLOAT,def:0,desc:"Index for object in array"},{name:"item",dt:t.datatypes.ANY,desc:"Item to set in array at index"}],this.output_slots=[{name:"array",dt:E2.dt.ANY,array:!0}],this.lsg=new LinkedSlotGroup(t,e,[this.input_slots[0]],[this.output_slots[0]]),this.array=[],this.index=0};ArraySetPlugin.prototype=Object.create(Plugin.prototype),ArraySetPlugin.prototype.reset=function(){this.index=0},ArraySetPlugin.prototype.connection_changed=function(t,e,r){return"item"===r.name?(r.dt=e.src_slot.dt,this.lsg.set_dt(e.src_slot.dt)):void(this.lsg.connection_changed(t,e,r)&&(this.array=[]))},ArraySetPlugin.prototype.update_input=function(t,e){e&&(console.log("Set update_input",t.name,e,this.array.length),"array"===t.name?this.array=e?e:this.array:"index"===t.name?(console.log("set index to",e),this.index=e):(console.log("ArraySetPlugin.update_input",this.index,e.length?e[0]:e,this.array),this.array[this.index]=e.constructor===Array?e[0]:e))},ArraySetPlugin.prototype.update_output=function(){return this.array},ArraySetPlugin.prototype.state_changed=function(t){t||(this.array=[],this.lsg.infer_dt())};
;
!function(){var t=E2.plugins.array_switch_modulator=function(t,e){var n=this;this.desc="Revolver style array switch. Set up n inputs, then choose which one to output.",this.input_slots=[{name:"number",dt:E2.dt.FLOAT,desc:"Input number to select for output.",def:0}],this.output_slots=[{name:"value",dt:E2.dt.ANY,desc:"Emits the selected input."},{name:"length",dt:E2.dt.FLOAT,desc:"Emits the number of inputs = the length of the array."}],this.core=t,this.node=e,this.lsg=new LinkedSlotGroup(t,e,[],[this.output_slots[0]]),this.number=0,this.values=[],this.node.on("slotAdded",function(){n.dynInputs=e.getDynamicInputSlots(),n.updated=!0}),this.node.on("slotRemoved",function(){n.dynInputs=e.getDynamicInputSlots(),n.updated=!0})};t.prototype.create_ui=function(){var t=this,e=make("div"),n=makeButton("Remove","Click to remove the last input."),i=makeButton("Add","Click to add another input.");return n.css("width","65px"),i.css({width:"65px","margin-top":"5px"}),i.click(function(){E2.app.graphApi.addSlot(t.node.parent_graph,t.node,{type:E2.slot_type.input,name:t.dynInputs.length+"",dt:t.lsg.dt})}),n.click(function(){var e=t.dynInputs;if(e){var n=e[e.length-1].uid;E2.app.graphApi.removeSlot(t.node.parent_graph,t.node,n)}}),e.append(n,"<br />",i),e},t.prototype.update_input=function(t,e){if(void 0===t.uid){if(0===t.index){var n=Math.floor(e);this.number!==n&&(this.number=n);for(var i=0;i<this.dynInputs.length;i++)this.dynInputs[i].inactive=i!==this.number;return}}else this.values[t.index]=e},t.prototype.update_state=function(){return this.number>=this.values.length?(this.updated=void 0!==this.value,void(this.value=void 0)):void(this.value!==this.values[this.number]?(this.value=this.values[this.number],this.updated=!0):this.updated=!1)},t.prototype.update_output=function(t){if(1===t.index)return this.dynInputs.length;if(void 0!==this.value)return this.value;var e=this.core.get_default_value(this.lsg.dt);return e},t.prototype.connection_changed=function(t,e,n){this.lsg.connection_changed(t,e,n)&&(this.value=this.lsg.core.get_default_value(this.lsg.dt))},t.prototype.state_changed=function(t){if(!t){for(var e=this.dynInputs=this.node.getDynamicInputSlots(),n=0,i=e.length;i>n;n++)this.lsg.add_dyn_slot(e[n]),e[n].inactive=!1;this.number=0,this.value=this.lsg.infer_dt()}}}();
;
E2.p=E2.plugins.aspect_ratio_generator=function(t){this.desc="Emits current renderer aspect ratio (width / height).",this.input_slots=[],this.output_slots=[{name:"aspect",dt:t.datatypes.FLOAT,desc:"The current renderer aspect ratio."}],this.core=t,this.canvas=E2.dom.webgl_canvas[0],this.delegate=this._onResize.bind(this),this.core.on("resize",this.delegate)},E2.p.prototype.reset=function(){},E2.p.prototype.destroy=function(){this.core.off("resize",this.delegate)},E2.p.prototype.update_output=function(){return this.canvas.width/this.canvas.height},E2.p.prototype._onResize=function(){this.updated=!0};
;
E2.p=E2.plugins.atan2_modulator=function(t){this.desc="Atan2(x, y).",this.input_slots=[{name:"x value",dt:t.datatypes.FLOAT,desc:"X value.",def:0},{name:"y value",dt:t.datatypes.FLOAT,desc:"Y value.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"atan(<b>x</b>,<b>y</b>).",def:0}]},E2.p.prototype.reset=function(){this.x_value=0,this.y_value=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.x_value=e:this.y_value=e},E2.p.prototype.update_output=function(){return this.value=Math.atan2(this.x_value,this.y_value),this.value};
;
E2.p=E2.plugins.atan_modulator=function(t){this.desc="Atan(x).",this.input_slots=[{name:"x value",dt:t.datatypes.FLOAT,desc:"X value.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"atan(<b>x</b>).",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){this.value=Math.atan(e)},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.audio_analyse_modulator=function(t){this.desc="Frequency and time domain audio analysis.",this.input_slots=[{name:"source",dt:t.datatypes.OBJECT,desc:"An audio source to analyse.",def:null},{name:"bin-count",dt:t.datatypes.FLOAT,desc:"Number of FFT bins. Will be made power-of-two and clamped to 8-2048.",def:32},{name:"multiplier",dt:t.datatypes.FLOAT,desc:"Multiplier for each bin value",def:1},{name:"smoothing",dt:t.datatypes.FLOAT,desc:"Amount of FFT smoothing between frames",min:0,max:1,def:.9}],this.output_slots=[{name:"source",dt:t.datatypes.OBJECT,desc:"The unmodified supplied source.",def:null},{name:"fft-bins",dt:t.datatypes.ARRAY,desc:"The FFT bins.",def:null}],this.analyser_node=t.audioContext?t.audioContext.createAnalyser():null,this.always_update=!0,this.src=null,this.fft_bins=null,this.array=new ArrayBuffer(128),this.array.datatype=6,this.array.stride=4,this.first=!0,this.smoothing=.9},E2.p.prototype.reset=function(){this.first=!0},E2.p.prototype.update_input=function(t,s){"source"===t.name?(this.src&&this.src.disconnect(0),this.src=s,s&&(s.connect(this.analyser_node),this.analyser_node.player=s.player)):"multiplier"===t.name?this.multiplier=s:"smoothing"===t.name?this.smoothing=s:"bin-count"===t.name&&(this.fft_bins=s,this.array=new ArrayBuffer(2*this.fft_bins),this.array.datatype=6,this.array.stride=4,this.data=new Float32Array(this.array),msg("FFT bins = "+this.fft_bins))},E2.p.prototype.update_state=function(){if(this.analyser_node){(this.analyser_node.frequencyBinCount!==this.fft_bins||this.first)&&(this.analyser_node.fftSize=this.fft_bins||128,this.first=!1),this.analyser_node.smoothingTimeConstant=this.smoothing,this.analyser_node.getFloatFrequencyData(this.data);for(var t=this.data,s=0;s<4*this.fft_bins;s++)t[s]=Math.pow(10,t[s]/20)*this.multiplier}},E2.p.prototype.update_output=function(t){return 0===t.index?this.analyser_node:(this.updated=!0,this.array)};
;
E2.p=E2.plugins.audio_buffer_source_modulator=function(t,s){this.desc="Create a playable audio source from a buffer of audio data.",this.input_slots=[{name:"buffer",dt:t.datatypes.OBJECT,desc:"An audio buffer to create a playable source from.",def:null},{name:"play",dt:t.datatypes.BOOL,desc:"Start or stop playback.",def:!1},{name:"loop",dt:t.datatypes.BOOL,desc:"Looping playback.",def:!1},{name:"loop-start",dt:t.datatypes.FLOAT,desc:"Start of loop (in seconds).",def:0},{name:"loop-end",dt:t.datatypes.FLOAT,desc:"End of loop (in seconds).",def:0}],this.output_slots=[{name:"source",dt:t.datatypes.OBJECT,desc:"A playable audio source",def:null}],this.core=t,this.node=s,this.audio_src=null,this.playing=!1,this.should_play=!1,this.loop=!1,this.loop_start=0,this.loop_end=0,this.time=null,this.state=0,this.update_source()},E2.p.prototype.reset=function(){},E2.p.prototype.play=function(){this.audio_src&&!this.playing&&(this.should_play=!0,this.updated=!0)},E2.p.prototype.pause=function(){this.audio_src&&this.playing&&(this.playing=!1,this.should_play=!0,this.stop_playback(),this.time=this.audio_src.currentTime,this.audio_src=null)},E2.p.prototype.stop=function(){this.playing&&(this.playing=this.should_play=!1,this.stop_playback(),this.audio_src=null),this.time=0},E2.p.prototype.connection_changed=function(t,s,i){0===i.index&&!t&&this.playing&&this.node.outputs.length<1&&(this.stop_playback(),this.audio_src=null,this.playing=!1)},E2.p.prototype.update_input=function(t,s){if(0===t.index){if(this.buffer===s)return;if(s&&"[object AudioBuffer]"!==s.toString())return void msg("ERROR: Can't create audio source from buffer: The supplied object isn't a valid AudioBuffer object.");this.playing&&(this.audio_src&&this.stop_playback(),this.playing=!1),this.buffer=s,this.changed=!0}else if(1===t.index){if(this.should_play===s)return;this.should_play=s,this.changed=!0}else 2===t.index?this.loop=s:3===t.index?this.loop_start=s:4===t.index&&(this.loop_end=s)},E2.p.prototype.start_playback=function(){this.audio_src&&null!==this.audio_src.buffer&&0===this.state&&(this.audio_src.start(0),this.state++)},E2.p.prototype.stop_playback=function(){this.audio_src&&1===this.state&&(this.audio_src.stop(0),this.state--)},E2.p.prototype.update_source=function(){return this.core.audioContext?(this.audio_src=this.core.audioContext.createBufferSource(),this.audio_src.player=this,this.state=0,void(this.buffer&&this.playing&&(this.audio_src.buffer=this.buffer))):void(this.audio_src=null)},E2.p.prototype.update_state=function(){this.changed&&(this.playing!==this.should_play&&(this.audio_src&&this.playing&&!this.should_play&&this.stop_playback(),this.playing=this.should_play,this.update_source()),this.changed=!1),this.audio_src&&(this.audio_src.loop!==this.loop&&(this.audio_src.loop=this.loop),this.audio_src.loopStart!==this.loop_start&&(this.audio_src.loopStart=this.loop_start),this.audio_src.loopEnd!==this.loop_end&&(this.audio_src.loopEnd=this.loop_end),null!==this.time&&(this.audio_src.currentTime=this.time,this.time=null))},E2.p.prototype.update_output=function(){return this.audio_src};
;
E2.p=E2.plugins.audio_delay_modulator=function(t){this.desc="Delay audio data.",this.input_slots=[{name:"source",dt:t.datatypes.OBJECT,desc:"An audio source to delay.",def:null},{name:"delay",dt:t.datatypes.FLOAT,desc:"Delay time (in seconds).",def:0}],this.output_slots=[{name:"source",dt:t.datatypes.OBJECT,desc:"A delayed audio source",def:null}],this.delay_node=t.audioContext?t.audioContext.createDelay(20):null,this.src=null,this.delay=null,this.first=!0},E2.p.prototype.reset=function(){this.first=!0},E2.p.prototype.update_input=function(t,e){0===t.index?(this.src&&this.src.disconnect(0),this.src=e,e&&(e.connect(this.delay_node),this.delay_node.player=e.player)):this.delay=e>20?20:e},E2.p.prototype.update_state=function(){(this.delay_node.delayTime.value!==this.delay||this.first)&&(this.delay_node.delayTime.value=null!==this.delay?this.delay:0,this.first=!1)},E2.p.prototype.update_output=function(){return this.delay_node};
;
!function(){var t=E2.plugins.audio_gain_modulator=function(t,n){var i=this;this.desc="(De)amplify or mix audio data.",this.input_slots=[{name:"gain",dt:t.datatypes.FLOAT,desc:"Amplification scalar.",def:null}],this.output_slots=[{name:"source",dt:t.datatypes.OBJECT,desc:"A (de)amplified audio source",def:null}],this.state={},this.core=t,this.node=n,this.gain_node=t.audioContext?t.audioContext.createGain():null,this.lsg=new LinkedSlotGroup(t,n,[],[]),this.srcs=[],this.gain=null,this.first=!0,this.node.on("slotAdded",function(){i.dynInputs=n.getDynamicInputSlots(),i.updated=!0}),this.node.on("slotRemoved",function(){i.dynInputs=n.getDynamicInputSlots(),i.updated=!0})};t.prototype.reset=function(){this.first=!0},t.prototype.create_ui=function(){var t=this,n=make("div"),i=makeButton("+","Click to add another input."),e=makeButton("-","Click to remove the last input.");return i.css({width:"20px","float":"left"}),e.css({width:"20px","float":"right","margin-left":"5px"}),i.click(function(){E2.app.graphApi.addSlot(t.node.parent_graph,t.node,{type:E2.slot_type.input,name:t.dynInputs.length+"",dt:t.core.datatypes.OBJECT})}),e.click(function(){var n=t.dynInputs;if(n){var i=n[n.length-1].uid;E2.app.graphApi.removeSlot(t.node.parent_graph,t.node,i)}}),n.append(i,"<br />",e),n},t.prototype.update_input=function(t,n){if(void 0!==t.uid){if(this.srcs[t.index]===n)return;this.srcs[t.index]&&this.srcs[t.index].disconnect(0),n&&n.connect&&(this.srcs[t.index]=n,n.connect(this.gain_node),this.gain_node.player=n.player)}else 0===t.index&&(this.gain=n)},t.prototype.update_state=function(){(this.gain_node.gain.value!==this.gain||this.first)&&(this.gain_node.gain.value=null!==this.gain?this.gain:1,this.first=!1)},t.prototype.update_output=function(){return this.gain_node},t.prototype.state_changed=function(t){if(!t){this.dynInputs=this.node.getDynamicInputSlots();for(var n=0,i=this.dynInputs.length;i>n;n++)this.lsg.add_dyn_slot(this.dynInputs[n])}}}();
;
E2.p=E2.plugins.audio_get_current_time_modulator=function(t){this.desc="Get the current playback time of the supplied audio sample in seconds.",this.input_slots=[{name:"audio",dt:t.datatypes.AUDIO,desc:"Input audio sample.",def:null}],this.output_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"Current playback time.",def:0}],this.always_update=!0},E2.p.prototype.reset=function(){this.time=0,this.audio=null},E2.p.prototype.update_state=function(){this.time=this.audio?this.audio.currentTime:0,this.updated=!0},E2.p.prototype.update_input=function(t,e){this.audio=e},E2.p.prototype.update_output=function(){return this.time};
;
E2.p=E2.plugins.audio_get_duration_modulator=function(t){this.desc="Get the duration of the supplied audio sample in seconds.",this.input_slots=[{name:"audio",dt:t.datatypes.AUDIO,desc:"Input audio sample.",def:null}],this.output_slots=[{name:"duration",dt:t.datatypes.FLOAT,desc:"Duration in seconds.",def:0}]},E2.p.prototype.reset=function(){this.duration=0},E2.p.prototype.update_input=function(t,o){this.duration=o?o.duration:0},E2.p.prototype.update_output=function(){return this.duration};
;
E2.p=E2.plugins.audio_player=function(t){this.desc="Play an audio stream. Playback loops.",this.input_slots=[{name:"audio",dt:t.datatypes.AUDIO,desc:"The audio stream to play.",def:null},{name:"play",dt:t.datatypes.BOOL,desc:"Send true to start playback and false to stop.",def:!0},{name:"mute",dt:t.datatypes.BOOL,desc:"Send true to mute playback and false to reenable audio.",def:!1},{name:"volume",dt:t.datatypes.FLOAT,desc:"Set playback volume.",lo:0,hi:0,def:.5},{name:"time",dt:t.datatypes.FLOAT,desc:"Set playback time.",def:null}],this.output_slots=[],this.audio=null,this.playing=!1,this.should_play=!1,this.muted=!1,this.volume=.5,this.time=null},E2.p.prototype.play=function(){this.audio&&!this.playing&&this.should_play&&(this.playing=this.should_play=!0,this.audio.play())},E2.p.prototype.pause=function(){this.audio&&this.playing&&(this.playing=!1,this.should_play=!0,this.audio.pause())},E2.p.prototype.stop=function(){this.audio&&(this.playing&&(this.playing=this.should_play=!1,this.audio.pause()),this.audio.readyState>2&&(this.audio.currentTime=0))},E2.p.prototype.update_input=function(t,i){0===t.index?(i||this.audio&&(this.audio.pause(),delete this.audio),this.audio=i,this.playing=!1):1===t.index?this.should_play=i:2===t.index?this.muted=i:3===t.index?this.volume=0>i?0:i>1?1:i:4===t.index&&(this.time=i)},E2.p.prototype.update_state=function(){var t=this.audio;this.playing!==this.should_play&&t&&(this.should_play?t.play():(t.pause(),t.currentTime=0),this.playing=this.should_play),this.playing&&(t&&(t.muted=this.muted,t.volume=this.volume,null!==this.time&&this.audio.readyState>2&&(t.currentTime=this.time?this.time:0,this.time=null)),this.updated=!0)};
;
E2.p=E2.plugins.audio_source_player=function(t,o){this.desc="Plays a supplied audio source.",this.input_slots=[{name:"source",dt:t.datatypes.OBJECT,desc:"The audio source to play.",def:null}],this.output_slots=[],this.core=t,this.node=o,this.audio_src=null},E2.p.prototype.connection_changed=function(t){!t&&this.audio_src&&(this.audio_src.player.stop_playback(),this.audio_src=null)},E2.p.prototype.update_input=function(t,o){if(0===t.index){if(o&&(!o.context||"[object AudioContext]"!==o.context.toString()))return void msg("ERROR: Can't play audio source: The supplied object isn't a valid AudioSource object.");if(!o&&this.audio_src&&this.audio_src.buffer)return void this.audio_src.player.stop_playback();this.audio_src&&this.audio_src!==o&&this.audio_src.player.stop_playback(),this.core.audioContext&&o&&(o.connect(this.core.audioContext.destination),o.player&&o.player.start_playback()),this.audio_src=o}},E2.p.prototype.update_state=function(){this.updated=!0};
;
E2.p=E2.plugins.bool_display=function(t){this.desc="Displays the text 'True' or 'False' depending on the state of the supplied bool or '-', if no data is being received.",this.input_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"The input boolean to display.",def:null}],this.output_slots=[],this.label=null},E2.p.prototype.reset=function(){this.update_value(null)},E2.p.prototype.create_ui=function(){return this.label=make("div"),this.label.css("text-align","right"),this.update_value(null),this.label},E2.p.prototype.update_input=function(t,e){this.update_value(e)},E2.p.prototype.update_value=function(t){this.label&&this.label.text(null===t?"-":t?"True":"False")};
;
E2.p=E2.plugins.ceiling_modulator=function(t){this.desc="Round <b>value</b> to the closest higher interger.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Value to be rounded.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"The rounded result.",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.value=Math.ceil(e))},E2.p.prototype.update_output=function(){return this.value};
;
var ValueChangePlugin=E2.plugins.change_trigger=function(e){Plugin.apply(this,arguments),this.desc="Triggers the output once when input changes",this.input_slots=[{name:"value",dt:e.datatypes.ANY,desc:"Item to watch"}],this.output_slots=[{name:"bool",dt:e.datatypes.BOOL,desc:"Triggered for one frame when input value changes"}],this.value=null,this.changed=!1};ValueChangePlugin.prototype=Object.create(Plugin.prototype),ValueChangePlugin.prototype.reset=function(){this.changed=!1},ValueChangePlugin.prototype.update_input=function(e,t){t!==this.value&&(this.value=t,this.node.queued_update=1)},ValueChangePlugin.prototype.update_state=function(){this.changed=this.value!==this.previousValue,this.previousValue=this.value},ValueChangePlugin.prototype.update_output=function(){return this.changed};
;
E2.p=E2.plugins.clamp_modulator=function(t){this.desc="Emit a float <b>value</b> no less than <b>min</b> and no greater than <b>max</b>.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Value to be clipped.",def:0},{name:"min",dt:t.datatypes.FLOAT,desc:"Minimum output value.",def:0},{name:"max",dt:t.datatypes.FLOAT,desc:"Maximum output value.",def:1}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"Emits <b>min</b> <= <b>value</b> >= <b>max</b>.",def:0}]},E2.p.prototype.reset=function(){this.input_val=0,this.min_value=0,this.max_value=1,this.output_val=0},E2.p.prototype.update_input=function(t,a){0===t.index?this.input_val=a:1===t.index?this.min_value=a:this.max_value=a},E2.p.prototype.update_state=function(){var t=this.min_value,a=this.max_value,e=this.input_val;if(t>a){var u=t;t=a,a=u}this.output_val=t>e?t:e>a?a:e},E2.p.prototype.update_output=function(){return this.output_val};
;
E2.p=E2.plugins.clamped_accumulate_modulator=function(t){this.desc="Every input <b>value</b> is accumulated in an internal buffer. The buffer value is not permitted to be smaller then <b>min</b> or larger than <b>max</b>.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"A small value to be accumulated in an internal buffer.",def:0},{name:"min",dt:t.datatypes.FLOAT,desc:"Minimum internal buffer value.",def:0},{name:"max",dt:t.datatypes.FLOAT,desc:"Maximum internal buffer value.",def:1},{name:"reset",dt:t.datatypes.FLOAT,desc:"Send a value to this slot to reset the accumulator to that value.",def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The current value of the accumulation buffer.",def:0}],this.state={value:0}},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.value=e,this.state.value+=this.value,this.state.value=this.state.value<this.lo?this.lo:this.state.value>this.hi?this.hi:this.state.value),1===t.index&&(this.lo=e),2===t.index&&(this.hi=e),3===t.index&&(this.state.value=e<this.lo?this.lo:e>this.hi?this.hi:e)},E2.p.prototype.update_output=function(){return this.state.value},E2.p.prototype.state_changed=function(t){t||(this.value=0,this.lo=0,this.hi=1)};
;
E2.p=E2.plugins.clock_generator=function(t){this.desc="Emits current absolute time in seconds.",this.input_slots=[],this.output_slots=[{name:"seconds",dt:t.datatypes.FLOAT,desc:"Current absolute time."}],this.core=t},E2.p.prototype.update_state=function(){this.updated=!0},E2.p.prototype.update_output=function(){return this.core.abs_t};
;
E2.p=E2.plugins.color_add_modulator=function(t){this.desc="Adds a constant value to all components of a color. Each channel is clipped to the range 0;1.",this.input_slots=[{name:"color",dt:t.datatypes.COLOR,desc:"Input color.",def:t.renderer.color_white},{name:"value",dt:t.datatypes.FLOAT,desc:"Value to be added to the R, G and B channels.",def:0}],this.output_slots=[{name:"color",dt:t.datatypes.COLOR,desc:"Output color: R+V, G+V, B+V"}]},E2.p.prototype.reset=function(){this.color=new THREE.Color(1,1,1),this.output_color=new THREE.Color(1,1,1),this.value=0},E2.p.prototype.update_input=function(t,o){0===t.index?this.color=o:this.value=o},E2.p.prototype.update_state=function(){this.output_color.r=this.color.r+this.value,this.output_color.g=this.color.g+this.value,this.output_color.b=this.color.b+this.value},E2.p.prototype.update_output=function(){return this.output_color};
;
E2.p=E2.plugins.color_blend_modulator=function(o){this.desc="Color x-fader. Perform linear blend between two colors.",this.input_slots=[{name:"color A",dt:o.datatypes.COLOR,desc:"First color operand.",def:o.renderer.color_black},{name:"color B",dt:o.datatypes.COLOR,desc:"Second color operand.",def:o.renderer.color_black},{name:"mix",dt:o.datatypes.FLOAT,desc:"0: Emit pure color A\n1: Emit pure color B",lo:0,hi:1,def:.5}],this.output_slots=[{name:"color",dt:o.datatypes.COLOR,desc:"Linear mix of color A and B:\n\nA * (1 - mix) + B * mix"}]},E2.p.prototype.reset=function(){this.output_color=new THREE.Color(1,1,1)},E2.p.prototype.update_input=function(o,t){0===o.index?this.color_a=t:1===o.index?this.color_b=t:this.mix=t},E2.p.prototype.update_state=function(){var o=this.mix,t=1-o,e=this.color_a,r=this.color_b,n=this.output_color;n.r=e.r*o+r.r*t,n.g=e.g*o+r.g*t,n.b=e.b*o+r.b*t},E2.p.prototype.update_output=function(){return this.output_color},E2.p.prototype.state_changed=function(o){o||(this.color_a=new THREE.Color(0,0,0),this.color_b=new THREE.Color(0,0,0),this.output_color=new THREE.Color(0,0,0),this.mix=.5)};
;
E2.p=E2.plugins.color_display=function(s){this.desc="Displays the supplied color in a rectangle on the plugin.",this.input_slots=[{name:"color",dt:s.datatypes.COLOR,desc:"Input color to be displayed.",def:s.renderer.color_white}],this.output_slots=[],this.color=new THREE.Color(1,1,1)},E2.p.prototype.reset=function(){this.color=new THREE.Color(1,1,1)},E2.p.prototype.css=function(){var s={},t=this.color;return s["background-color"]="rgb("+Math.round(255*t.r)+", "+Math.round(255*t.g)+", "+Math.round(255*t.b)+")",s},E2.p.prototype.create_ui=function(){var s=make("span");return this.label=make("span"),s.css({background:"url('images/checkerboard.png')",border:"1px #aaa solid"}),this.label.html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"),this.label.css(this.css()),s.append(this.label),s},E2.p.prototype.update_input=function(s,t){this.color=t,this.label&&this.label.css(this.css())};
;
E2.p=E2.plugins.color_multiply_modulator=function(t){this.desc="Scale the RGB components of a color by a supplied factor.",this.input_slots=[{name:"color",dt:t.datatypes.COLOR,desc:"Color to be modulated.",def:t.renderer.color_white},{name:"factor",dt:t.datatypes.FLOAT,desc:"Factor to scale the RGB components of the supplied color with.",def:1}],this.output_slots=[{name:"color",dt:t.datatypes.COLOR,desc:"Output color: R * V, G * V, B * V, A"}]},E2.p.prototype.reset=function(){this.color=new THREE.Color(1,1,1),this.output_color=new THREE.Color(1,1,1),this.factor=1},E2.p.prototype.update_input=function(t,o){0===t.index?this.color=o:this.factor=o},E2.p.prototype.update_state=function(){var t=this.color,o=this.output_color,e=this.factor,r=t.r*e,p=t.g*e,c=t.b*e;o.r=0>r?0:r>1?1:r,o.g=0>p?0:p>1?1:p,o.b=0>c?0:c>1?1:c},E2.p.prototype.update_output=function(){return this.output_color};
;
!function(){var t=THREE.Math.clamp,e=function(t){Plugin.apply(this,arguments),this.desc="Provides an intuitive way of picking arbitrary colors via a hue slider and saturation/value selection area.",this.input_slots=[],this.output_slots=[{name:"color",dt:t.datatypes.COLOR,desc:"The selected color.",def:new THREE.Color(1,1,1)}],this.state={hue:0,sat:0,lum:1},this.ui=null,this.color=new THREE.Color(1,1,1),this.updated=!1};e.prototype=Object.create(Plugin.prototype),e.prototype.setFromState=function(e){var i,a,s,o;o=t(this.state.lum,0,1),i=t(1-this.state.hue,0,1),s=.5*o*(2-this.state.sat),s=t(s,0,1);var r=t(s,1e-5,.999999);return a=o*this.state.sat/(1-Math.abs(2*r-1)),a=t(a,0,1),e.setHSL(i,a,s),e},e.prototype.makeStateFromThisColor=function(){var e,i,a,s,o=this.color.getHSL();a=t(o.h,0,1),s=t(o.l,0,1),i=.5*(2*s+o.s*(1-Math.abs(2*s-1))),i=t(i,0,1);var r=0===i?1e-6:i;e=2*(i-s)/r,e=t(e,0,1),this.state.sat=e,this.state.lum=i,e>0&&(this.state.hue=1-a)},e.prototype.create_ui=function(){var t=this.c=make("div"),e=this.i=make("img"),i=this.s=make("img"),a=this.h=make("img"),s=this.hs=make("img");this.indicator={Hex:null,R:null,G:null,B:null};var o=178,r=120,n=r+24;this.picker_height=0+r,this.picker_width=0+o,t.css({height:""+n+"px",width:""+o+"px",position:"relative"}),a.attr("src","/images/color_picker/hue_h.svg"),s.attr("src","/images/color_picker/hue-select_h.svg"),e.attr("src","/images/color_picker/picker.png"),i.attr("src","/images/color_picker/select.gif"),a.attr("preserveAspectRatio","xMidYMid none"),a.css({width:""+o+"px",border:"0","border-radius":"2px","z-index":"100",position:"absolute",top:""+(r+4)+"px",left:"0"}),s.css({position:"absolute",left:"0px",top:""+(r+3)+"px",height:"20px",width:"5px","z-index":"101"}),i.css({width:"11px",height:"11px","z-index":"101",position:"absolute"}),e.css({width:""+o+"px",height:""+r+"px",border:"0","border-radius":"2px","z-index":"100"}),e.attr({width:o,height:r}),t.append(e),t.append(i),t.append(a),t.append(s);var u=this.ui_createValuesIndicator(t);return this.ui=jQuery("<div></div>").append(t,u),this.ui_enableInteraction(t[0],e[0],i[0],a[0],s[0]),this.ui},e.prototype.updateRGBValue=function(){this.setFromState(this.color),this.updated=!0},e.prototype.updatePicker=function(t,e){var i=Math.round(this.state.sat*this.picker_width)-6,a=Math.round((1-this.state.lum)*this.picker_height)-6;e.css("left",i),e.css("top",a)},e.prototype.updateHue=function(t,e,i){var a=new THREE.Color,s=1-this.state.hue;a.setHSL(s,1,.5),t&&t.css("background-color","#"+a.getHexString()),e&&i&&i.css("left",Math.round(s*this.picker_width-2))},e.prototype.ui_createValuesIndicator=function(){var t=jQuery("<table></table>"),e=jQuery("<tr></tr>"),i=[],a=this.indicator;Object.keys(a).forEach(function(t){a[t]=jQuery("<td>-</td>"),e.append(a[t]),i.push("<th>"+t+"</th>")});var s=jQuery("<tr>"+i.join("")+"</tr>");return t.append(e,s),a._oldcolor=new THREE.Color(0,0,0),a.update=function(t){this._oldcolor.equals(t)||(this._oldcolor=t.clone(),this.Hex.html(t.getHexString()),this.R.html(Math.round(255*t.r)),this.G.html(Math.round(255*t.g)),this.B.html(Math.round(255*t.b)))}.bind(a),t},e.prototype.ui_enableInteraction=function(t,e,i,a,s){function o(){c.beginBatchModifyState()}function r(){return c.endBatchModifyState("Pick color")}function n(t){c.state.lum=t,c.state_changed(c.ui)}function u(t){c.state.sat=t,c.state_changed(c.ui)}function h(t){c.state.hue=1-t,c.state_changed(c.ui)}var c=this,l={min:0,max:1,step:.001,getValue:function(){return c.state.sat},isSurface:!0,cssCursor:"crosshair",orientation:"horizontal"};NodeUI.makeUIAdjustableValue(e,o,u,r,l),l.surfaceDomNode=e,NodeUI.makeUIAdjustableValue(i,o,u,r,l),delete l.surfaceDomNode,l.getValue=function(){return c.state.lum},l.orientation="vertical",l.min=1,l.max=0,NodeUI.makeUIAdjustableValue(e,o,n,r,l),l.surfaceDomNode=e,NodeUI.makeUIAdjustableValue(i,o,n,r,l),l={min:1e-5,max:.99999,step:.001,getValue:function(){return c.state.hue},isSurface:!0,cssCursor:"crosshair",orientation:"horizontal"},NodeUI.makeUIAdjustableValue(a,o,h,r,l),l.surfaceDomNode=a,NodeUI.makeUIAdjustableValue(s,o,h,r,l);var d=function(t){return function(){return c.color[t]}},p=function(t){return function(e){c.color[t]=e,c.makeStateFromThisColor(),c.state_changed(c.ui)}},g={min:1e-5,max:1,step:.002,cssCursor:"ns-resize",allowTextInput:!0,textInputParentNode:t,parseTextInput:function(t){var e=parseFloat(t);return isNaN(e)?!1:isFinite(e)?e/255:!1}};NodeUI.makeUIAdjustableValue(this.indicator.R[0],o,p("r"),r,_.extend(g,{getValue:d("r")})),NodeUI.makeUIAdjustableValue(this.indicator.G[0],o,p("g"),r,_.extend(g,{getValue:d("g")})),NodeUI.makeUIAdjustableValue(this.indicator.B[0],o,p("b"),r,_.extend(g,{getValue:d("b")})),this.indicator.Hex.on("dblclick",function(){NodeUI.enterValueControl(c.indicator.Hex[0],t,function(t){var e="000000";if(t=t.toString().replace("#","").toUpperCase(),3===t.length){var i=t;t=i.substring(0,1)+i.substring(0,1)+i.substring(1,2)+i.substring(1,2)+i.substring(2,3)+i.substring(2,3)}else t=""+t+e.substring(0,e.length-t.length),t=t.substring(0,6);if(6!==t.length)return!1;var a=/^[0-9A-F]{6}$/i.test(t);return a?(o(),c.color.setHex("0x"+t),c.makeStateFromThisColor(),c.state_changed(c.ui),void r()):!1})})},e.prototype.reset=function(){},e.prototype.update_state=function(){},e.prototype.update_output=function(){return this.color},e.prototype.state_changed=function(t){this.updateRGBValue(),t&&(this.updateHue(this.i,this.h,this.hs),this.updatePicker(t,this.s),this.indicator.update(this.color))},E2.plugins.color_picker=e}();
;
E2.p=E2.plugins.concatenate_matrix_modulator=function(t){this.desc="Combine two matrices. Order is significant.",this.input_slots=[{name:"a",dt:t.datatypes.MATRIX,desc:"The first matrix operand.",def:t.renderer.matrix_identity},{name:"b",dt:t.datatypes.MATRIX,desc:"The second matrix operand.",def:t.renderer.matrix_identity}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"Emits <b>first</b> * <b>second</b>."}]},E2.p.prototype.update_input=function(t,i){this.matrices[t.index]=i},E2.p.prototype.update_state=function(){var t=this.matrices;null!==t[0]&&null!==t[1]&&this.matrix.multiplyMatrices(t[0],t[1])},E2.p.prototype.update_output=function(){return this.matrix},E2.p.prototype.state_changed=function(t){t||(this.matrices=[new THREE.Matrix4,new THREE.Matrix4],this.matrix=THREE.Matrix4(),this.matrices[0].identity(),this.matrices[1].identity(),this.matrix.identity())};
;
!function(){var t=E2.plugins.const_float_generator=function(t){Plugin.apply(this,arguments),this.desc="Emits a float constant specified in an input field. If an invalid string in entered, the field is reset to the previous value.",this.input_slots=[],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The currently entered value.",def:1}],this.state={val:1}};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){var t=this,e=this.$input=$('<input type="number" step="0.1" value="1.0" style="width: 50px;" />');return e.css("border","1px solid #999"),e.on("change",function(){var i=t.state.val,n=t.state.val;try{var a=parseFloat(e.val());isNaN(a)||(n=a)}catch(s){return}t.undoableSetState("val",n,i)}),this.etf=new ExpandableTextfield(this.node,e,7),this.ui=e,this.node.on("pluginStateChanged",this.updateUi.bind(this)),this.ui},t.prototype.update_output=function(){return this.state.val},t.prototype.state_changed=function(t){t&&this.updateUi()},t.prototype.updateUi=function(){this.ui&&this.ui.val(""+this.state.val)}}();
;
!function(){var t=120,e=80,i=550,n=440,o=THREE.Math.clamp,u=E2.plugins.const_text_generator=function(i){Plugin.apply(this,arguments),this.desc="Enter a constant text string.",this.inp={},this.input_slots=[],this.output_slots=[{name:"text",dt:i.datatypes.TEXT,desc:"The currently entered text.",def:"Empty string"}],this.state={text:"",width:t,height:e}};u.prototype=Object.create(Plugin.prototype),u.prototype.reset=function(){this.updated=!0},u.prototype.create_ui=function(){var u=this,s={get text(){return u.state.text},set text(t){return u.state.text=t},get width(){return u.state.width},set width(e){return u.state.width=o(e,t,i)},get height(){return u.state.height},set height(t){return u.state.height=o(t,e,n)}},a=this.updateUi.bind(this),r=this.beginBatchModifyState.bind(this),c=function(){u.endBatchModifyState("Text")};this.ui=new UITextArea(s,r,a,c);var h=this.ui.dom.find("textarea"),p=null;return h.on("keyup",function(){p&&clearTimeout(p),p=setTimeout(function(){u.transientSetState("text",h.val())},300)}),this.node.on("pluginStateChanged",this.updateUi.bind(this)),this.ui.dom},u.prototype.update_output=function(){return this.state.text},u.prototype.state_changed=function(){this.updateUi()},u.prototype.updateUi=function(){this.ui&&this.ui.update()}}();
;
E2.p=E2.plugins.convert_bool_float_modulator=function(t){this.desc="Convert a bool to a float. True emits 1 and false 0.",this.input_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Input boolean to be converted.",def:!1}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Emits 0 when the input is false and 1 otherwise.",lo:0,hi:1,def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){this.value=e?1:0},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.convert_color_hsl_modulator=function(t){this.desc="Create an RGB color from hue, saturation and luminosity.",this.input_slots=[{name:"color",dt:t.datatypes.COLOR,desc:"The corresponding RGBA color.",def:t.renderer.color_black}],this.output_slots=[{name:"hue",dt:t.datatypes.FLOAT,desc:"The hue of the input <b>color</b>.",lo:0,hi:1,def:0},{name:"saturation",dt:t.datatypes.FLOAT,desc:"The saturation (color intensity) of the input <b>color</b>.",lo:0,hi:1,def:0},{name:"luminosity",dt:t.datatypes.FLOAT,desc:"The luminosity (brightness) of the input <b>color</b>.",lo:0,hi:1,def:0}]},E2.p.prototype.reset=function(){this.hsl=[1,1,1,1],this.color=new THREE.Color(1,1,1)},E2.p.prototype.update_input=function(t,o){this.color=o},E2.p.prototype.update_state=function(){var t=this.color;this.hsl[0]=this.hsl[1]=this.hsl[2]=0;var o=Math.max(Math.max(t.r,t.g),t.b),e=Math.min(Math.min(t.r,t.g),t.b),s=.5*(e+o);if(!(0>=s)){var i=o-e,r=i;if(this.hsl[2]=s,r>0){r/=.5>=s?e+o:2-o-e;var h=(o-t.r)/i,n=(o-t.g)/i,a=(o-t.b)/i,l=0;l=t.r===o?t.g===e?5+a:1-n:t.g===o?t.b===e?1+h:3-a:t.r===e?3+n:5-h,this.hsl[0]=l/6,this.hsl[1]=r}}},E2.p.prototype.update_output=function(t){return this.hsl[t.index]};
;
E2.p=E2.plugins.convert_color_rgb_modulator=function(e){this.desc="Convert a color to its individual RGB components so they can be individually manipulated.",this.input_slots=[{name:"color",dt:e.datatypes.COLOR,desc:"Input color to be split.",def:e.renderer.color_white}],this.output_slots=[{name:"red",dt:e.datatypes.FLOAT,desc:"Red channel value.",def:1},{name:"green",dt:e.datatypes.FLOAT,desc:"Green channel value.",def:1},{name:"blue",dt:e.datatypes.FLOAT,desc:"Blue channel value.",def:1}]},E2.p.prototype.reset=function(){this.color=new THREE.Color(1,1,1)},E2.p.prototype.update_input=function(e,t){this.color=t},E2.p.prototype.update_output=function(e){return 0===e.index?this.color.r:1===e.index?this.color.g:2===e.index?this.color.b:void 0};
;
E2.p=E2.plugins.convert_float_bool_modulator=function(t){this.desc="Convert a float to a boolean. 0 is false, everything else is true.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input float to be converted.",def:0}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits false when the input value is zero and true otherwise.",def:!1}]},E2.p.prototype.reset=function(){this.value=!1},E2.p.prototype.update_input=function(t,e){this.value=0===e?!1:!0},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.convert_hsl_color_modulator=function(t){this.desc="Create an RGB color from hue, saturation and luminosity.",this.input_slots=[{name:"hue",dt:t.datatypes.FLOAT,desc:"The hue of the output color.",lo:0,hi:1,def:1},{name:"saturation",dt:t.datatypes.FLOAT,desc:"The saturation (color intensity) of the output color.",lo:0,hi:1,def:1},{name:"luminosity",dt:t.datatypes.FLOAT,desc:"The luminosity (brightness) of the output color.",lo:0,hi:1,def:1}],this.output_slots=[{name:"color",dt:t.datatypes.COLOR,desc:"The corresponding RGB color.",def:t.renderer.color_white}]},E2.p.prototype.reset=function(){this.hsl=[1,1,1],this.color=new THREE.Color(1,1,1)},E2.p.prototype.update_input=function(t,o){this.hsl[t.index]=0>o?0:o>1?1:o},E2.p.prototype.update_state=function(){var t=this.hsl[1],o=this.hsl[2],e=[];if(0===t)return void(e[0]=e[1]=e[2]=o);for(var s=this.hsl[0],i=.5>=o?o*(1+t):o+t-o*t,r=2*o-i,n=[s+1/3,s,s-1/3],u=0;3>u;u++){n[u]<0&&(n[u]+=1),n[u]>1&&(n[u]-=1);var h=n[u];e[u]=1>6*h?r+(i-r)*h*6:1>2*h?i:2>3*h?r+(i-r)*(2/3-h)*6:r}this.color.setRGB(e[0],e[1],e[2])},E2.p.prototype.update_output=function(){return this.color};
;
E2.p=E2.plugins.convert_oscilator_unit_modulator=function(t){this.desc="Rescales and offsets a number in the range -1;1 to the range 0;1.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The input value.",lo:-1,hi:1,def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The output value: (I + 1) / 2",lo:0,hi:1,def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){var u=.5*(e+1);this.value=0>u?0:u>1?1:u},E2.p.prototype.update_output=function(){return this.value};
;
!function(){ConvertRGBColorModulator=E2.plugins.convert_rgb_color_modulator=function(o){this.desc="Creates a new color from individual RGB components.",this.input_slots=[{name:"red",dt:o.datatypes.FLOAT,desc:"Red channel value.",lo:0,hi:1,def:1},{name:"green",dt:o.datatypes.FLOAT,desc:"Green channel value.",lo:0,hi:1,def:1},{name:"blue",dt:o.datatypes.FLOAT,desc:"Blue channel value.",lo:0,hi:1,def:1}],this.output_slots=[{name:"color",dt:o.datatypes.COLOR,desc:"The output color",def:new THREE.Color(16777215)}]},ConvertRGBColorModulator.prototype.reset=function(){this.color=new THREE.Color(16777215)},ConvertRGBColorModulator.prototype.update_input=function(o,t){0===o.index&&(this.color.r=t),1===o.index&&(this.color.g=t),2===o.index&&(this.color.b=t)},ConvertRGBColorModulator.prototype.update_output=function(){return this.color}}();
;
E2.p=E2.plugins.convert_string_float_modulator=function(t){this.desc="Convert a string to a float.",this.input_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"Input string to be converted.",def:"0.0"}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The parsed float value of the input string or 0",def:0}],this.value=0},E2.p.prototype.reset=function(){this.value=!1},E2.p.prototype.update_input=function(t,e){this.value=0;try{this.value=parseFloat(e)}catch(o){}},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.convert_vector_xyz_modulator=function(t){this.desc="Decompose a vector to its individual XYZ components so they can be manipulated individually.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Input vector.",def:new THREE.Vector3}],this.output_slots=[{name:"x",dt:t.datatypes.FLOAT,desc:"The x-component.",def:0},{name:"y",dt:t.datatypes.FLOAT,desc:"The y-component.",def:0},{name:"z",dt:t.datatypes.FLOAT,desc:"The z-component.",def:0}]},E2.p.prototype.reset=function(){this.value=new THREE.Vector3},E2.p.prototype.update_input=function(t,e){this.value=e},E2.p.prototype.update_output=function(t){return 0===t.index?this.value.x:1===t.index?this.value.y:this.value.z};
;
E2.p=E2.plugins.cos_modulator=function(t){this.desc="Cos(x).",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"cos(<b>value</b>).",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.value=Math.cos(e))},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.cosine_modulator=function(t){this.desc="Cosine oscilator. A <b>time</b> value incrementing by one unit per second will yield a 1Hz output signal.",this.input_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"Time in seconds",def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Emits cos(<b>time</b> * 2pi)",def:0}]},E2.p.prototype.reset=function(){this.time=0,this.result=0},E2.p.prototype.update_input=function(t,e){this.time=e},E2.p.prototype.update_state=function(){this.result=Math.cos(2*this.time*Math.PI)},E2.p.prototype.update_output=function(){return this.result};
;
E2.p=E2.plugins.crypto_cw_get_balances=function(t){this.desc="Obtain information about the current balances of a CounterWallet address.",this.input_slots=[{name:"address",dt:t.datatypes.TEXT,desc:"Address of the wallet to query.",def:""}],this.output_slots=[{name:"balances",dt:t.datatypes.OBJECT,desc:"The CounterWallet response."}]},E2.p.prototype.update_input=function(t,e){if(0===t.index){if(this.address=e,""===this.address)return;var s='{"jsonrpc":"2.0","id":0,"method":"proxy_to_counterpartyd","params":{"method":"get_balances", "params":{"filters":{"field":"address","op":"==","value":"'+this.address+'"}}}}';$.ajax({url:"https://counterwallet.io/_api",type:"POST",data:s,cache:!1,success:function(t){return function(e){t.balances=e,t.updated=!0}}(this)})}},E2.p.prototype.update_state=function(){""===this.address&&(this.balances={})},E2.p.prototype.update_output=function(){return this.balances},E2.p.prototype.state_changed=function(t){t||(this.balances={},this.address="")};
;
E2.p=E2.plugins.crypto_dw_get_balances=function(t){this.desc="Obtain information about the current balances of a DogeWallet address.",this.input_slots=[{name:"address",dt:t.datatypes.TEXT,desc:"Address of the wallet to query.",def:""}],this.output_slots=[{name:"balances",dt:t.datatypes.OBJECT,desc:"The DogeWallet response."}]},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.address=e)},E2.p.prototype.update_state=function(){if(""===this.address)return void(this.balances={});var t='{"jsonrpc":"2.0","id":0,"method":"get_normalized_balances","params":{"addresses":["'+this.address+'"]}}';$.ajax({url:"https://wallet.dogeparty.io/_api",type:"POST",data:t,cache:!1,success:function(t){return function(e){t.balances=e,t.updated=!0}}(this)})},E2.p.prototype.update_output=function(){return this.balances},E2.p.prototype.state_changed=function(t){t||(this.balances={},this.address="")};
;
E2.p=E2.plugins.curve_interpolate_modulator=function(t){this.desc="Interpolates the keypoints of a curve JSON object over time and loops if the bounds of the keypoints are exceeded.",this.input_slots=[{name:"curve",dt:t.datatypes.OBJECT,desc:"The curve object to interpolate.",def:null},{name:"time",dt:t.datatypes.FLOAT,desc:"The time to use for interpolation.",def:0}],this.output_slots=[{name:"position",dt:t.datatypes.VECTOR,desc:"The interpolated position.",def:[0,0,0]}]},E2.p.prototype.reset=function(){this.curve=null,this.time=0,this.vector=[0,0,0]},E2.p.prototype.update_input=function(t,e){if(0===t.index){var o="The supplied curve object is invalid: ";this.curve=null;for(var i=["count","x","y","z"],r=0;r<i.length;r++)if(!e.hasOwnProperty(i[r]))return void msg(o+'No "'+i[r]+'" property');i=["x","y","z"];for(var r=0;r<i.length;r++)if("[object Array]"!==Object.prototype.toString.call(e[i[r]]))return void msg(o+'The "'+i[r]+'" property is not an array');this.curve=e}else this.time=e},E2.p.prototype.update_state=function(){if(!this.curve)return void(this.x=this.y=this.z=0);var t=this.curve.count-1,e=Math.floor(this.time)%t,o=(e+1)%t,i=(e+2)%t,r=(e+3)%t,s=this.time%t-e,n=this.curve.x,p=this.curve.y,u=this.curve.z,c=.5*(n[i]-n[e]),h=.5*(n[r]-n[o]);this.vector[0]=n[o]+c*s+(3*(n[i]-n[o])-2*c-h)*s*s+(c+h+2*(-n[i]+n[o]))*s*s*s,c=.5*(p[i]-p[e]),h=.5*(p[r]-p[o]),this.vector[1]=p[o]+c*s+(3*(p[i]-p[o])-2*c-h)*s*s+(c+h+2*(-p[i]+p[o]))*s*s*s,c=.5*(u[i]-u[e]),h=.5*(u[r]-u[o]),this.vector[2]=u[o]+c*s+(3*(u[i]-u[o])-2*c-h)*s*s+(c+h+2*(-u[i]+u[o]))*s*s*s},E2.p.prototype.update_output=function(){return this.vector};
;
E2.p=E2.plugins.data_info_display=function(t){this.desc="Displays metrics about the input value and its type.",this.input_slots=[{name:"any",dt:t.datatypes.ANY,desc:"Input value to be analyzed.",def:null}],this.output_slots=[]},E2.p.prototype.reset=function(){this.update_value(null)},E2.p.prototype.create_ui=function(){return this.label=make("pre"),this.update_value(null),this.label},E2.p.prototype.update_input=function(t,e){this.update_value(e)},E2.p.prototype.update_value=function(t){if(this.label){var e=function(t){return type=typeof t,"object"!==type||t?type:"null"},n=function(t,u,i,a){i=i||"  ","number"!==e(a)&&(a=1);var p=e(u);if("function"===p)return"";var l=i+t+"("+p+") :";if("object"===p){if(a>0){i+="  ";for(r in u){var r=n(r,u[r],i,a-1);l+="\n"+r}return l}return l+" ..."}return"null"===p?l+" null":l+" "+u};this.label[0].innerHTML=n("",t)}};
;
E2.p=E2.plugins.delta_modulator=function(t){this.desc="Emits the derivative of the incoming <b>value</b>.",this.input_slots=[{name:"reset",dt:t.datatypes.BOOL,desc:"Send true to this slot to clear the internal state.",def:!1},{name:"value",dt:t.datatypes.FLOAT,desc:"Input value.",def:0}],this.output_slots=[{name:"delta",dt:t.datatypes.FLOAT,desc:"The delta value from the last frame update.",def:0}]},E2.p.prototype.reset=function(){this.input_val=0,this.last_val=0,this.output_val=0,this.clear=!1},E2.p.prototype.update_input=function(t,e){0===t.index?this.clear=e:1===t.index&&(this.input_val=e)},E2.p.prototype.update_state=function(){this.clear?(this.output_val=0,this.clear=!1):this.output_val=this.input_val-this.last_val,this.last_val=this.input_val},E2.p.prototype.update_output=function(){return this.output_val};
;
E2.p=E2.plugins.delta_t_generator=function(t){this.desc="Emits the current frame delta time in seconds.",this.input_slots=[],this.output_slots=[{name:"seconds",dt:t.datatypes.FLOAT,desc:"Last frame delta time in seconds."}],this.core=t},E2.p.prototype.update_state=function(){this.updated=!0},E2.p.prototype.update_output=function(){return this.core.delta_t};
;
E2.p=E2.plugins.divide_modulator=function(t){this.desc="Divides <b>value</b> by <b>scalar</b> and emits the result.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to be divided.",def:0},{name:"scalar",dt:t.datatypes.FLOAT,desc:"Factor to divide <b>value</b> by.",def:1}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"Emits <b>value</b> / <b>scalar</b>.",def:0}]},E2.p.prototype.reset=function(){this.value=0,this.scalar=1,this.result=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.value=e:this.scalar=e},E2.p.prototype.update_state=function(){this.result=this.value/this.scalar},E2.p.prototype.update_output=function(){return this.result};
;
!function(){var t=E2.plugins.envelope_modulator=function(t,e){Plugin.apply(this,arguments),this.desc="Envelope modulator",this.input_slots=[{name:"x",dt:t.datatypes.FLOAT,desc:"X value to pick Y with",def:0}],this.output_slots=[{name:"y",dt:t.datatypes.FLOAT,desc:"The value at x",def:0}],this.x=this.value=0,this.state={points:[[0,0],[1,1]]},this.node=e,this._core=t,this.loaded=!1};t.prototype=Object.create(Plugin.prototype),t.prototype.create_ui=function(){var t=this;if(this._$ui)return this._$ui;var e=this._$ui=$('<div class="envelope-editor">');return this._loadScripts(function(){t._loaded=!0,t._redrawEditor(),t.node.on("pluginStateChanged",function(){t.dirty=t.updated=!0,t._editor.data(t.state.points).redraw()})}),e},t.prototype.update_input=function(t,e){this.x=e%1},t.prototype.update_state=function(){for(var t,e,i=0,o=1,s=this.x,n=0;n<this.state.points.length;n++){var a=this.state.points[n];if(a[0]===s){t=e=a[1];break}if(a[0]<s)i=a[0],t=a[1];else if(a[0]>s){o=a[0],e=a[1];break}}this.value=(s-i)*(e-t)/(o-i)+t},t.prototype.update_output=function(){return this.value},t.prototype.state_changed=function(t){t&&!this._loaded},t.prototype._redrawEditor=function(){var t=this;this._editor&&this._editor.destroy(),this._editor=new E2.EnvelopeEditor,this._editor.data(t.state.points).render(this._$ui).on("changed",function(e){t.undoableSetState("points",e,t.state.points)})},t.prototype._loadScripts=function(t){var e=this;this._core.add_aux_script("d3/d3.v3.min.js",function(){e._core.add_aux_script("envelope/envelopeEditor.js",t)})}}();
;
E2.p=E2.plugins.equals_modulator=function(t,e){this.desc="Emits true if <b>value</b> equals <b>reference</b> and false otherwise.",this.input_slots=[{name:"value",dt:t.datatypes.ANY,desc:"Input value.",def:null},{name:"reference",dt:t.datatypes.ANY,desc:"Reference value to comprate <b>value</b> to.",def:null}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"True if <b>value</b> equals <b>reference</b> and false otherwise.",def:!1}],this.lsg=new LinkedSlotGroup(t,e,[this.input_slots[0],this.input_slots[1]],[]),this.value=null},E2.p.prototype.reset=function(){this.ref=null,this.state=!1},E2.p.prototype.connection_changed=function(t,e,s){this.lsg.connection_changed(t,e,s)&&(this.value=this.ref=this.lsg.core.get_default_value(this.lsg.dt))},E2.p.prototype.update_input=function(t,e){0===t.index?this.value=e:this.ref=e},E2.p.prototype.update_state=function(){this.state=null===this.value||null===this.ref?!1:this.value===this.ref},E2.p.prototype.update_output=function(){return this.state},E2.p.prototype.state_changed=function(t){t||(this.value=this.lsg.infer_dt())};
;
E2.p=E2.plugins.exp_modulator=function(t){this.desc="Exp(x).",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"exp(<b>value</b>).",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.value=Math.exp(e))},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.float_display=function(t){this.desc="Display the supplied float value on the plugin surface.",this.input_slots=[{name:"float",dt:t.datatypes.FLOAT,desc:"Input value to be displayed.",def:null}],this.output_slots=[]},E2.p.prototype.reset=function(){this.update_value(null)},E2.p.prototype.create_ui=function(){return this.label=make("div"),this.label.css("text-align","right"),this.update_value(null),this.label},E2.p.prototype.update_input=function(t,e){this.update_value(e)},E2.p.prototype.update_value=function(t){this.label?this.label[0].innerHTML=null===t?"-":t.toFixed(2):this.value=t};
;
E2.p=E2.plugins.floor_modulator=function(t){this.desc="Round <b>value</b> to the closest lower interger.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Value to be rounded.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"The rounded result.",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.value=Math.floor(e))},E2.p.prototype.update_output=function(){return this.value};
;
!function(){var t=E2.plugins.format_string_float=function(t){this.desc="Formats a float as a string.",this.input_slots=[{name:"float",dt:t.datatypes.FLOAT,desc:"Input float to be formatted.",def:0},{name:"decimals",dt:t.datatypes.FLOAT,desc:"Number of decimals to output.",def:4}],this.output_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"The input float as a string.",def:"0.0"}]};t.prototype.reset=function(){this.value=0,this.d_count=4,this.result="0.0"},t.prototype.update_input=function(t,e){0===t.index?this.value=e:this.d_count=Math.round(e)},t.prototype.update_state=function(){this.result=this.value.toFixed(this.d_count)},t.prototype.update_output=function(){return this.result}}();
;
!function(){var t=E2.plugins.from_mesh_custom_shader=function(t,e){Plugin.apply(this,arguments);var i=this;this.desc="Auto-generate a shader embedding user-defined main bodies tailored to correctly and optimally render the supplied mesh.",this.input_slots=[{name:"mesh",dt:t.datatypes.MESH,desc:"Mesh to adapt the shader to.",def:null},{name:"material",dt:t.datatypes.MATERIAL,desc:"The surface material.",def:null}],this.output_slots=[{name:"shader",dt:t.datatypes.SHADER,desc:"The resulting shader."}],this.state={vs_src:"",ps_src:""},this.core=t,this.node=e,this.gl=t.renderer.context,this.shader=null,this.slot_data={},this.node.on("slotAdded",function(t){i.slot_data[t.uid]=i.core.get_default_value(E2.slot_type.input,t.dt),i.updated=i.dirty=!0,i._refreshEditor()}),this.node.on("slotRemoved",function(){i.updated=i.dirty=!0,i._refreshEditor()})};t.prototype=Object.create(Plugin.prototype),t.prototype._refreshEditor=function(){var t=this;this._editors&&_.each(this._editors,function(e){e.setInputs(t.node.getDynamicInputSlots())})},t.prototype.destroy_ui=function(){var t=this;_.each(this._editors,function(e,i){e.close&&(e.close(),delete t._editors[i])})},t.prototype.create_ui=function(){function t(t){E2.app.graphApi.removeSlot(s.node.parent_graph,s.node,t)}function e(t,e){E2.app.graphApi.addSlot(s.node.parent_graph,s.node,{type:E2.slot_type.input,name:t,dt:e})}function i(i,o){if(s._editors[i])return void s._editors[i].show();var r=[i,"shader"].join(" ");s._editors[i]=E2.ShaderEditor.open(r,s.state[o],s.node.getDynamicInputSlots()).on("closed",function(){delete s._editors[i]}).on("inputRemoved",function(e,i){t(e,i)}).on("inputAdded",function(t,i){e(t,i)}).on("build",function(){s.updated=s.dirty=!0}).on("changed",function(t){t!==s.state[o]&&s.undoableSetState(o,t,s.state[o])}),s._editors[i].stateKey=o,s._editors[i]._ace}var s=this,o=make("div"),r=makeButton("Vertex","Click to edit the vertex shader source."),n=makeButton("Pixel","Click to edit the pixel shader source.");return this._editors={},r.css("width","55px"),n.css({width:"55px","margin-top":"5px"}),r.click(function(){i("vertex","vs_src")}),n.click(function(){i("pixel","ps_src")}),o.append(r,"<br />",n),o},t.prototype.connection_changed=function(t,e,i){t||i.type!==E2.slot_type.input||0===i.index&&(this.shader=null)},t.prototype.rebuild_shader=function(){function t(t){return function(e){if(a.updated=a.dirty=!1,a._editors&&a._editors[t]){var i=a._editors[t].getAce();i.getSession().clearAnnotations(),e&&i.getSession().setAnnotations(e)}}}var e,i,s=[],o=[],r=this.state,n=this.gl,d=this.core.datatypes,a=this;e=this.node.getDynamicInputSlots();for(var h=0;h<e.length;h++){var u="";i=e[h];var p=i.dt.id;p===d.FLOAT.id?u="float":p===d.TEXTURE.id?u="sampler2D":p===d.COLOR.id?u="vec4":p===d.MATRIX.id?u="mat4":p===d.VECTOR.id&&(u="vec3");var c="uniform "+u+" "+i.name+";";s.push(c),o.push(c)}if(this.shader=ComposeShader(null,this.mesh,this.material,s,o,r.vs_src,r.ps_src,t("vertex"),t("pixel")),this.shader.linked){for(e=this.node.getDynamicInputSlots(),h=0;h<e.length;h++)i=e[h],i.uniform=n.getUniformLocation(this.shader.program,i.name);this.shader.apply_uniforms_custom=function(){var t=1,i=a.slot_data,s=a.core.datatypes;e=a.node.getDynamicInputSlots();for(var o=0;o<e.length;o++){var r=e[o];if(r.uniform&&void 0!==i[r.uid]&&null!==i[r.uid]){var d=r.dt.id;d===s.FLOAT.id?n.uniform1f(r.uniform,i[r.uid]):d===s.TEXTURE.id?(n.uniform1i(r.uniform,t),i[r.uid].enable(n.TEXTURE0+t),t++):d===s.COLOR.id?n.uniform4fv(r.uniform,i[r.uid]):d===s.MATRIX.id?n.uniformMatrix4fv(r.uniform,!1,i[r.uid]):d===s.VECTOR.id&&n.uniform3fv(r.uniform,i[r.uid])}}}}""===r.vs_src&&(r.vs_src=this.shader.vs_c_src),""===r.ps_src&&(r.ps_src=this.shader.ps_c_src)},t.prototype.update_input=function(t,e){void 0===t.uid?0===t.index?this.mesh!==e&&(this.mesh=e,this.dirty=!0):1===t.index&&(this.material=e):this.slot_data[t.uid]=e},t.prototype.update_state=function(){if(this.mesh){var t=Material.get_caps_hash(this.mesh,this.material);if(!this.dirty&&this.caps_hash===t)return void(this.shader&&(this.shader.material=this.material));(this.dirty||this.caps_hash!==t)&&this.rebuild_shader(),this.caps_hash=t,this.updated=!0,this.dirty=!1}},t.prototype.update_output=function(){return this.shader},t.prototype.state_changed=function(t){t?this.core.add_aux_script("ace/src-noconflict/ace.js"):(this.mesh=null,this.material=null,this.caps_mask="",this.dirty=!1)}}();
;
E2.p=E2.plugins.from_mesh_shader=function(t){this.desc="Auto-generate a shader tailored to correctly and optimally render the supplied mesh.",this.input_slots=[{name:"mesh",dt:t.datatypes.MESH,desc:"Mesh to adapt the shader to.",def:null},{name:"material",dt:t.datatypes.MATERIAL,desc:"The surface material.",def:null}],this.output_slots=[{name:"shader",dt:t.datatypes.SHADER,desc:"The resulting shader."}],this.shader=null},E2.p.prototype.connection_changed=function(t,s,e){t||e.type!==E2.slot_type.input||0===e.index&&(this.shader=null)},E2.p.prototype.update_input=function(t,s){0===t.index?this.mesh!==s&&(this.mesh=s,this.dirty=!0):1===t.index&&(this.material=s)},E2.p.prototype.update_state=function(){if(this.mesh){var t=Material.get_caps_hash(this.mesh,this.material);if(!this.dirty&&this.caps_hash===t)return void(this.shader.material=this.material);(this.dirty||this.caps_hash!==t)&&(msg("Recomposing shader with caps: "+t),this.shader=ComposeShader(null,this.mesh,this.material,null,null,null,null)),this.caps_hash=t,this.updated=!0,this.dirty=!1}},E2.p.prototype.update_output=function(){return this.shader},E2.p.prototype.state_changed=function(t){t||(this.mesh=null,this.material=null,this.caps_hash="",this.dirty=!0)};
;
E2.p=E2.plugins.gamepad_generator=function(t){function e(e,a){return{name:e,dt:a?t.datatypes.FLOAT:t.datatypes.BOOL,desc:e,def:a?0:!1}}this._core=t,this.desc="Buttons and axes from HTML5 standard gamepad (supports only Chrome and XBOX 360 controller atm).",this.input_slots=[{name:"pad number",dt:t.datatypes.FLOAT,desc:"Gamepad number",def:0}],this.output_slots=[e("button 0"),e("button 1"),e("button 2"),e("button 3"),e("left bumper"),e("right bumper"),e("left trigger",!0),e("right trigger",!0),e("select"),e("start"),e("left stick button"),e("right stick button"),e("D-pad top"),e("D-pad bottom"),e("D-pad left"),e("D-pad right"),e("extra"),e("left stick X",!0),e("left stick Y",!0),e("right stick X",!0),e("right stick Y",!0)],this._gamepadIndex=0},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_input=function(t,e){this._gamepadIndex=e},E2.p.prototype.update_output=function(t){function e(t){return"object"==typeof t?t.pressed:1===t}var a=navigator.getGamepads();if(!a)return 0;var n=a[this._gamepadIndex];return n?(this.updated=!0,t.index<17?this.output_slots[t.index].dt.id===this._core.datatypes.FLOAT.id?n.buttons[t.index].value:e(n.buttons[t.index]):n.axes[t.index-17]):0};
;
E2.p=E2.plugins.get_matrix_modulator=function(t){this.desc="Get matrix component.",this.input_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"Matrix to get component of.",def:t.renderer.matrix_identity},{name:"row",dt:t.datatypes.FLOAT,desc:"Row to get.",def:0},{name:"column",dt:t.datatypes.FLOAT,desc:"Column to get.",def:0}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The input matrix."},{name:"value",dt:t.datatypes.FLOAT,desc:"The value.",def:0}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.matrix=e:1===t.index?this.row=0>e?0:e>3?3:e:2===t.index&&(this.column=0>e?0:e>3?3:e)},E2.p.prototype.update_state=function(){this.value=this.matrix[4*this.row+this.column]},E2.p.prototype.update_output=function(t){return 0===t.index?this.matrix:this.value},E2.p.prototype.state_changed=function(t){t||(this.matrix=mat4.create(),mat4.identity(this.matrix),this.row=0,this.column=0,this.value=0)};
;
!function(){var t=E2.plugins.graph=function(){SubGraphPlugin.apply(this,arguments),this.desc="Encapsulate a nested graph into- and out of which arbitrary data can be routed and the encapsulated logic. Add input / output proxies inside the graph to feed data in / out of the graph.",this.input_slots=[],this.output_slots=[],this.state={always_update:!0,input_sids:{},output_sids:{}},this.is_reset=!0};t.prototype=Object.create(SubGraphPlugin.prototype),t.prototype.open_inspector=function(t){var a=make("div"),e=$('<input id="always_upd" name="alwaysupdate" type="checkbox" title="If false, this graph is updated only when one of its inputs updates." />'),p=$('<label for="always_upd"><span><svg class="icon-checked"><use xlink:href="#icon-checked"></use></svg></span>Always update</div>'),i=make("div"),s={"font-size":"14px","float":"left",padding:"8px 0px 2px 2px"},d={"float":"right",margin:"2px",padding:"2px",width:"70px"};a.css({margin:"0px",padding:"2px"}),i.css("clear","both"),i.addClass("clearfix"),e.css(d),p.css(s),e.css({width:"13px","margin-top":"8px"}),e.attr("checked",t.state.always_update),i.append(e),i.append(p),a.append(i);var n=function(t,a){return function(){t.state.always_update=a.is(":checked")}};t.core.create_dialog(a,"Edit Preferences",460,250,n(t,e))},t.prototype.drilldown=function(){return NodeUI.drilldown(this)},t.prototype.update_input=function(t,a){void 0===t.uid?console.log("graph.plugin undefined uid"):this.input_nodes[t.uid].plugin.input_updated(a)},t.prototype.update_state=function(){this.updated=!1,this.updated_sids.length=0,this.graph&&this.graph.update()&&this.graph===E2.app.player.core.active_graph&&E2.app.updateCanvas(!1)},t.prototype.state_changed=function(t){var a=(this.core,this.parent_node);return t?void a.ui.dom.addClass("graph"):void this.setupProxies()}}();
;
E2.p=E2.plugins.grid_mesh_generator=function(t){this.desc="Create a planar grid mesh in the XY-plane of unit size.",this.input_slots=[{name:"x res",dt:t.datatypes.FLOAT,desc:"X resolution.",lo:2,hi:250,def:10},{name:"y res",dt:t.datatypes.FLOAT,desc:"Y resolution.",lo:2,hi:250,def:10}],this.output_slots=[{name:"mesh",dt:t.datatypes.MESH,desc:"Grid mesh."}],this.gl=t.renderer.context,this.state={x_res:10,y_res:10},this.mesh=null},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_input=function(t,e){var s=Math.floor(e);2>s||(s=s>250?250:s,0===t.index&&this.state.x_res!==s?(this.state.x_res=s,this.dirty=!0):1===t.index&&this.state.y_res!==s&&(this.state.y_res=s,this.dirty=!0))},E2.p.prototype.update_state=function(){this.dirty&&this.generate_mesh()},E2.p.prototype.update_output=function(){return this.mesh},E2.p.prototype.generate_mesh=function(){var t=this.gl;this.mesh=new Mesh(t,t.LINES,null);for(var e=[],s=0;s<this.state.y_res+1;s++){var r=s/(this.state.y_res/2)-1;e.push(-1),e.push(r),e.push(0),e.push(1),e.push(r),e.push(0)}for(var h=0;h<this.state.x_res+1;h++){var r=h/(this.state.x_res/2)-1;e.push(r),e.push(-1),e.push(0),e.push(r),e.push(1),e.push(0)}(this.mesh.vertex_buffers.VERTEX=new VertexBuffer(t,VertexBuffer.vertex_type.VERTEX)).bind_data(e),this.mesh.generate_shader(),this.dirty=!1},E2.p.prototype.state_changed=function(t){t||this.generate_mesh()};
;
E2.p=E2.plugins.gte_modulator=function(t){this.desc="Emits true if the supplied <b>value</b> is larger than or equal to <b>reference</b> and false otherwise.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to be compared.",def:0},{name:"reference",dt:t.datatypes.FLOAT,desc:"Reference to compare <b>value</b> to.",def:0}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true if <b>value</b> is larger than or equal to <b>reference</b>.",def:!1}]},E2.p.prototype.reset=function(){this.value=0,this.ref=0,this.state=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.value=e:this.ref=e},E2.p.prototype.update_state=function(){var t=this.value>=this.ref;t!==this.state?this.state=t:this.updated=!1},E2.p.prototype.update_output=function(){return this.state};
;
E2.p=E2.plugins.if_else_modulator=function(t,e){this.desc="Emits <b>true value</b> if <b>condition</b> is true and <b>false value</b> otherwise. The output only updates when the <b>condition</b> or relavant input value does. Any incoming data-flow to the value slot excluded by <b>condition</b> does not result in data emission.",this.input_slots=[{name:"condition",dt:t.datatypes.BOOL,desc:"Send true to route <b>true value</b> to the output and false to route <b>false value</b>.",def:!1},{name:"true value",dt:t.datatypes.ANY,desc:"Value to be send to output if <b>condition</b> is true",def:null},{name:"false value",dt:t.datatypes.ANY,desc:"Value to be send to output if <b>condition</b> is false",def:null}],this.output_slots=[{name:"value",dt:t.datatypes.ANY,desc:"Emits <b>true value</b> if <b>condition</b> is true and <b>false value</b> otherwise.",def:"False value"}],this.lsg=new LinkedSlotGroup(t,e,[this.input_slots[1],this.input_slots[2]],[this.output_slots[0]]),this.yes=this.no=null,this.initial_run=!0},E2.p.prototype.reset=function(){this.initial_run=!0,delete this.input_slots[1].inactive,delete this.input_slots[2].inactive},E2.p.prototype.connection_changed=function(t,e,i){this.lsg.connection_changed(t,e,i)&&(this.yes=this.no=this.lsg.core.get_default_value(this.lsg.dt))},E2.p.prototype.update_input=function(t,e){0===t.index?(this.condition=e,this.initial_run?this.initial_run=!1:(delete this.input_slots[this.condition?1:2].inactive,this.input_slots[this.condition?2:1].inactive=!0)):1===t.index?this.yes=e:this.no=e},E2.p.prototype.update_output=function(){return this.condition?this.yes:this.no},E2.p.prototype.state_changed=function(t){t||(this.yes=this.no=this.lsg.infer_dt())};
;
E2.p=E2.plugins.if_modulator=function(t,i){this.desc="Allows <b>value</b> though if <b>condition</b> is true and inhibits futher data-flow otherwise.",this.input_slots=[{name:"condition",dt:t.datatypes.BOOL,desc:"Condition that, if true, allows <b>value</b> to be emitted.",def:!1},{name:"value",dt:t.datatypes.ANY,desc:"Value to be emitted if <b>condition</b> is true.",def:null}],this.output_slots=[{name:"value",dt:t.datatypes.ANY,desc:"Emits <b>value</b> if <b>condition</b> is true and nothing otherwise."}],this.lsg=new LinkedSlotGroup(t,i,[this.input_slots[1]],[this.output_slots[0]]),this.value=null},E2.p.prototype.connection_changed=function(t,i,e){this.lsg.connection_changed(t,i,e)&&(this.value=this.lsg.core.get_default_value(this.lsg.dt))},E2.p.prototype.update_input=function(t,i){0===t.index?(this.condition=i,this.condition?delete this.input_slots[1].inactive:this.input_slots[1].inactive=!0):this.value=i},E2.p.prototype.update_output=function(){return this.value},E2.p.prototype.state_changed=function(t){t||(this.value=this.lsg.infer_dt())};
;
E2.p=E2.plugins.initialise_generator=function(t){this.desc="Emits true the first frame after playback is started, then false for one frame and stop emitting. Can be used to run initialisation logic on the first frame of playback only.",this.input_slots=[],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true on first frame of playback, then false for one frame, then stops emitting."}],this.core=t,this.st=[!1,!1],this.val=!1},E2.p.prototype.stop=function(){this.st[0]=this.st[1]=!0},E2.p.prototype.update_state=function(){this.val=this.st[0]&&this.st[1],this.updated=this.st[0],this.st[0]=this.st[1],this.st[1]=!1},E2.p.prototype.update_output=function(){return this.val};
;
!function(){var t=E2.plugins.input_proxy=function(t,e){this.desc="Create a new type-less slot to route data into the current graph from its parent. When connected to a slot, it will assume its type until disconnected. Renaming this plugin will rename the corresponding parent slot.",this.input_slots=[],this.output_slots=[],e.add_slot(E2.slot_type.output,{name:"input",dt:t.datatypes.ANY,desc:"Connect this to a slot of any type, to have the parent slot assume its datatype and forward data from the parent graph."}),this.core=t,this.node=e,this.data=null,e.title||(e.title="input")};t.prototype.reset=function(){this.updated=!0},t.prototype.input_updated=function(t){this.data=t,this.updated=!0},t.prototype.connection_changed=function(t,e,n){var o=this.node.parent_graph.plugin;o&&o.proxy_connection_changed(t,this.node,e.dst_node,n,e.dst_slot)},t.prototype.update_output=function(){return this.data},t.prototype.state_changed=function(){}}();
;
!function(){var t=E2.plugins.inputs_to_array=function(t,n){var s=this;this.desc="Combine all the input slots into an output array of the same datatype",this.input_slots=[],this.output_slots=[{name:"array",dt:E2.dt.ANY,array:!0,desc:"The array."},{name:"length",dt:E2.dt.FLOAT,desc:"The number of inputs ie. the length of the array."}],this.core=t,this.node=n,this.lsg=new AutoSlotGroup(t,n,[],[this.output_slots[0]]),this.array=[],this.node.on("slotAdded",function(){s.dynInputs=n.getDynamicInputSlots(),s.updated=!0}),this.node.on("slotRemoved",function(){s.dynInputs=n.getDynamicInputSlots(),s.updated=!0})};t.prototype.update_input=function(t,n){null===n||void 0===n?this.array.splice(t.index,1):this.array[t.index]=n instanceof Array?n[0]:n},t.prototype.update_output=function(t){return 1===t.index?this.dynInputs.length-1:this.array},t.prototype.connection_changed=function(t,n,s){this.lsg.connection_changed(t,n,s)&&this.lsg.infer_dt(),this.updated=!0},t.prototype.state_changed=function(t){if(!t){this.dynInputs=this.node.getDynamicInputSlots(),this.dynInputs.length||(this.node.add_slot(E2.slot_type.input,{name:"0",dt:E2.dt.ANY,array:!1}),this.dynInputs=this.node.getDynamicInputSlots());for(var n=0,s=this.dynInputs.length;s>n;n++)this.lsg.add_dyn_slot(this.dynInputs[n]);this.lsg.infer_dt()}}}();
;
E2.p=E2.plugins.invert_matrix_modulator=function(t){this.desc="Emits the inverse of the supplied <b>matrix</b>.",this.input_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The input matrix to be inverted.",def:t.renderer.matrix_identity}],this.output_slots=[{name:"inverse",dt:t.datatypes.MATRIX,desc:"Emits the inverse of the input <b>matrix</b>.",def:t.renderer.matrix_identity}]},E2.p.prototype.reset=function(){this.matrix=mat4.create(),this.inverse=mat4.create(),mat4.identity(this.matrix),mat4.identity(this.inverse)},E2.p.prototype.update_input=function(t,e){this.matrix=e},E2.p.prototype.update_state=function(){mat4.inverse(this.matrix,this.inverse)},E2.p.prototype.update_output=function(){return this.inverse};
;
!function(){var t=E2.plugins.key_press_generator=function(t){Plugin.apply(this,arguments),this.desc="Emits true on the next update after the key matching the set filter has been pressed and false once after it has been released.",this.input_slots=[],this.output_slots=[{name:"signal",dt:t.datatypes.BOOL,desc:"Emits true once when the set key is pressed."}],this.state={key:0,type:0}};t.prototype=Object.create(Plugin.prototype),t.prototype.update_output=function(){return this.key_state},t.prototype.create_ui=function(){for(var t=this,e=[[-1,"[Pick a key]"],[8,"Backspace"],[9,"Tab"],[13,"Enter"],[32,"Space"],[33,"Page up"],[34,"Page down"],[35,"End"],[36,"Home"],[37,"Left arrow"],[38,"Up arrow"],[39,"Right arrow"],[40,"Down arrow"],[45,"Insert"],[46,"Delete"],[48,"0"],[49,"1"],[50,"2"],[51,"3"],[52,"4"],[53,"5"],[54,"6"],[55,"7"],[56,"8"],[57,"9"],[65,"a"],[66,"b"],[67,"c"],[68,"d"],[69,"e"],[70,"f"],[71,"g"],[72,"h"],[73,"i"],[74,"j"],[75,"k"],[76,"l"],[77,"m"],[78,"n"],[79,"o"],[80,"p"],[81,"q"],[82,"r"],[83,"s"],[84,"t"],[85,"u"],[86,"v"],[87,"w"],[88,"x"],[89,"y"],[90,"z"]],s=make("div"),n=$('<select id="key" title="Select key" />',{selectedIndex:0}),a=$('<select id="o_type" title="Select output signal type" />',{selectedIndex:0}),o=0,p=e.length;p>o;o++){var i=e[o];$("<option />",{value:i[0],text:i[1]}).appendTo(n)}return $("<option />",{value:0,text:"Impulse"}).appendTo(a),$("<option />",{value:1,text:"Continuous"}).appendTo(a),n.change(function(){t.undoableSetState("key",parseInt(n.val()),t.state.key)}),a.change(function(){t.undoableSetState("type",parseInt(a.val()),t.state.type)}),n.css("width","100px"),a.css("width","100px"),s.append(n),s.append(make("br")),s.append(a),s},t.prototype.key_down=function(t){return function(e){E2.util.isTextInputInFocus(e)||e.originalEvent.keyCode===t.state.key&&(t.key_state=!0,t.updated=!0)}},t.prototype.key_up=function(t){return function(e){E2.util.isTextInputInFocus(e)||e.originalEvent.keyCode===t.state.key&&(t.key_state=!1,t.updated=!0)}},t.prototype.reset_keystate=function(){this.last_state=this.key_state=!1},t.prototype.update_state=function(){0===this.state.type&&this.key_state===this.last_state&&(this.updated=!1),this.last_state=this.key_state},t.prototype.state_changed=function(t){t?(t.find("#key").val(this.state.key),t.find("#o_type").val(this.state.type)):(this.reset_keystate(),$(document).keydown(this.key_down(this)),$(document).keyup(this.key_up(this)))}}();
;
!function(){var t=44,e=22,a="translate(-"+e+"px,-"+e+"px) scale(0.5) rotate(",s=30,i=300,o=E2.plugins.knob_float_generator=function(t){Plugin.apply(this,arguments),this.desc="Emits a user controllable float value between 0 and 1.",this.input_slots=[],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Emits the current value when the knob is adjusted.",lo:0,hi:1,def:0}],this.state={val:0},this.knob=null};o.prototype=Object.create(Plugin.prototype),o.prototype.reset=function(){},o.prototype.setRotation=function(){var t=s+Math.floor(this.state.val*i),e=a+t+"deg)";this.knob.css({"-webkit-transform":e,"-moz-transform":e,transform:e})},o.prototype.create_ui=function(){var e=this,a=make("div");this.readout=make("span"),this.knob=make("div"),this.knob.css({width:2*t+"px",height:2*t+"px"}),this.readout.css({height:t-2+"px",width:t-2+"px","line-height":t+"px"}),a.append(this.knob,this.readout);var s=e.state.val,i=function(){e.undoableSetState("val",e.state.val,s)},o=function(t){e.state.val=t,e.update_ui(),e.updated=!0},n=function(){s=e.state.val};this.ui=this.knob;var u={cssCursor:"ns-resize",getValue:function(){return e.state.val},min:0,max:1,step:.01};return NodeUI.makeUIAdjustableValue(this.knob[0],n,o,i,u),NodeUI.makeUIAdjustableValue(this.readout[0],n,o,i,u),this.node.on("pluginStateChanged",this.update_ui.bind(this)),this.update_ui(),a},o.prototype.update_output=function(){return this.state.val},o.prototype.updateReadout=function(){this.readout.text(this.state.val.toFixed(2))},o.prototype.update_ui=function(){this.ui&&(this.setRotation(),this.updateReadout())}}();
;
!function(){var t=E2.plugins.label_generator=function(t,e){Plugin.apply(this,arguments),this.desc="Emits a string specified in an input field.",this.input_slots=[],this.output_slots=[{name:"value",dt:t.datatypes.TEXT,desc:"The currently entered text."}],this.state={text:""},this.core=t,this.node=e};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){var t=$('<input type="text" value="1.0" style="width: 50px;" />');return t.css("border","1px solid #999"),t.change(function(e){return function(){e.undoableSetState("text",t.val(),e.state.text)}}(this)),this.etf=new ExpandableTextfield(this.node,t,7),t},t.prototype.update_output=function(){return this.state.text},t.prototype.state_changed=function(t){t&&t.val(""+this.state.text)}}();
;
E2.p=E2.plugins.led_display=function(t){this.desc="Displays the supplied normalised float value as a red LED, with a 8 bit color granularity.",this.input_slots=[{name:"float",dt:t.datatypes.FLOAT,desc:"Normalised input value.",lo:0,hi:1,def:0}],this.output_slots=[]},E2.p.prototype.reset=function(){this.update_value(0)},E2.p.prototype.create_ui=function(){return this.label=make("span"),this.label.html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"),this.update_value(0),this.label},E2.p.prototype.update_input=function(t,s){this.update_value(0>s?0:s>1?1:s)},E2.p.prototype.update_value=function(t){this.label&&this.label.css("background-color","rgb("+Math.round(255*t)+", 40, 40)")};
;
E2.p=E2.plugins.less_than_modulator=function(t){this.desc="Emits true if the supplied <b>value</b> is less than <b>reference</b> and false otherwise.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to compare.",def:0},{name:"reference",dt:t.datatypes.FLOAT,desc:"Reference to compare <b>value</b> to.",def:0}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true if <b>value</b> is less than <b>reference</b> and false otherwise.",def:!1}]},E2.p.prototype.reset=function(){this.value=0,this.ref=0,this.state=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.value=e:this.ref=e},E2.p.prototype.update_state=function(){var t=this.value<this.ref;t!==this.state?this.state=t:this.updated=!1},E2.p.prototype.update_output=function(){return this.state};
;
!function(){var e,p=E2.plugins.load_graph=function(e){this.desc="Instructs the player to play the graph (replacing the current graph) when enabled",this.input_slots=[{name:"back key",dt:e.datatypes.FLOAT,desc:"If set, pressing this key will load the previous graph (space=32)",def:null},{name:"graph",dt:e.datatypes.OBJECT,desc:"Graph to play",def:null}],this._keyCode=this._graph=null,this.output_slots=[]};p.prototype.update_input=function(p,a){function t(){function p(a){a.keyCode===s._keyCode&&($(window).off("keypress",p),E2.app.player.stop(),E2.app.player.load_from_json(e),E2.app.player.play())}e||(e=E2.app.player.core.serialise()),s._keyCode&&$(window).on("keypress",p),E2.app.player.stop(),E2.app.player.load_from_object(s._graph),E2.app.player.play()}var s=this;switch(p.index){case 0:this._keyCode=Math.floor(a);break;case 1:if(!a||!Object.keys(a).length)return;this._graph=a,t()}}}();
;
!function(){var t=E2.plugins.load_graph_on_trigger=function(t){Plugin.apply(this,arguments),this.desc="Loads and plays the Vizor file (replacing the current one) on trigger",this.input_slots=[{name:"trigger",dt:t.datatypes.BOOL,desc:"When trigger is true, the URL will be loaded in the player",def:null},{name:"url",dt:t.datatypes.TEXT,desc:"Relative URL to published Vizor file, eg. /fthr/moon",def:null}],this.output_slots=[]};t.prototype=Object.create(Plugin.prototype),t.prototype.update_state=function(){if(this.inputValues.trigger&&this.inputValues.url){var t=this.inputValues.url.split("/"),e="/"+t.splice(-2,2).join("/");if(E2.app&&E2.app.navigateToPublishedGraph)return E2.app.navigateToPublishedGraph(e);var a="/data/graph"+e+".min.json";E2.app.player.load_from_url(a,function(){history.pushState({},"",e),E2.app.player.play()})}}}();
;
E2.p=E2.plugins.log_display=function(t){this.desc="Pipes the supplied text to the browser console log.",this.input_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"Input text to be logged in the browsers console.",def:null}],this.output_slots=[]},E2.p.prototype.update_input=function(t,e){e&&console.log(e)};
;
E2.p=E2.plugins.log_modulator=function(t){this.desc="Log(x).",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"log(<b>value</b>).",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.value=Math.log(e))},E2.p.prototype.update_output=function(){return this.value};
;
!function(){var t=E2.plugins.loop=function(t){SubGraphPlugin.apply(this,arguments),this.desc="Encapsulate a nested graph into- and out of which arbitrary data can be routed and run the enclosed logic once per loop iteration. The loop counter is made available to enclosing logic as a local variable with the name <b>index</b>.",this.input_slots=[{name:"first",dt:t.datatypes.FLOAT,desc:"The start index.",def:0},{name:"last",dt:t.datatypes.FLOAT,desc:"The end index.",def:0},{name:"step",dt:t.datatypes.FLOAT,desc:"Loop index increment.",def:1}],this.output_slots=[],this.state={input_sids:{},output_sids:{},always_update:!0}};t.prototype=Object.create(SubGraphPlugin.prototype),t.prototype.open_inspector=function(t){var e=make("div"),a=$('<input id="always_upd" type="checkbox" title="If false, this graph is updated only when one of its inputs updates." />'),s=$('<label for="always_upd"><span><svg class="icon-checked"><use xlink:href="#icon-checked"></use></svg></span>Always update</div>'),i=make("div"),p={"font-size":"14px","float":"left",padding:"8px 0px 2px 2px"},d={"float":"right",margin:"2px",padding:"2px",width:"13px","margin-top":"8px"};e.css({margin:"0px",padding:"2px"}),i.css("clear","both"),i.addClass("clearfix"),a.css(d),s.css(p),a.css({width:"13px","margin-top":"8px"}),a.attr("checked",t.state.always_update),i.append(a),i.append(s),e.append(i);var n=function(t,e){return function(){t.state.always_update=e.is(":checked")}};t.core.create_dialog(e,"Edit Preferences.",460,250,n(t,a))},t.prototype.drilldown=function(){return NodeUI.drilldown(this)},t.prototype.update_input=function(t,e){void 0===t.uid?0===t.index?this.first=Math.floor(e):1===t.index?this.last=Math.floor(e):(this.step=Math.abs(e),this.step=this.step<1?1:Math.floor(this.step)):this.input_nodes[t.uid].plugin.input_updated(e)},t.prototype.update_state=function(){if(this.updated=!1,this.updated_sids.length=0,this.first>this.last){var t=this.first;this.first=this.last,this.last=t}if(this.graph&&this.step>0){for(var e=!1,a=this.first;a<this.last;a+=this.step)this.graph.variables.write("index",a),this.graph.reset(),this.graph.update()&&(e=!0);e&&this===E2.app.player.core.active_graph&&E2.app.updateCanvas(!1)}},t.prototype.variable_dt_changed=function(){},t.prototype.state_changed=function(t){{var e=this.core;this.parent_node}if(!t){this.setupProxies(),this.first=0,this.last=0,this.step=1,this.graph.variables.lock(this,"index");var a=this.graph.variables.variables.index.dt;a.id===this.core.datatypes.ANY.id&&this.graph.variables.set_datatype("index",e.datatypes.FLOAT)}}}();
;
E2.p=E2.plugins.lowpass_filter_modulator=function(t){this.desc="Perform simple 1st-order lowpass filtering of the supplied value.\n\n<b>Caution:</b> Do not use this plugin to filter infrequently updated values. This plugin expects continuous input every frame; if necessary, a clock or another cheap continuous float provider can be multiplied by zero and added to the lowpass input to drive updates.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value. Must be updated every frame for correct operation of the filter.",def:0},{name:"amount",dt:t.datatypes.FLOAT,desc:"Filter amount. Zero is pure passthrough, 0.999 maximum filtering.",lo:0,hi:.999,def:.9}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"The smoothed output value",def:0}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.input_val=e:this.amount=0>e?0:e>.999?.999:e},E2.p.prototype.update_state=function(){this.output_val=this.input_val*(1-this.amount)+this.last_val*this.amount,this.last_val=this.output_val},E2.p.prototype.update_output=function(){return this.output_val},E2.p.prototype.state_changed=function(t){t||(this.input_val=0,this.amount=.9,this.output_val=0,this.last_val=0)};
;
E2.p=E2.plugins.lte_modulator=function(t){this.desc="Emits true if the supplied <b>value</b> is less than or equal to <b>reference</b> and false otherwise.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to be compared.",def:0},{name:"reference",dt:t.datatypes.FLOAT,desc:"Reference to compare <b>value</b> to.",def:0}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true if <b>value</b> is less than or equal to <b>reference</b>.",def:!1}]},E2.p.prototype.reset=function(){this.value=0,this.ref=0,this.state=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.value=e:this.ref=e},E2.p.prototype.update_state=function(){var t=this.value<=this.ref;t!==this.state?this.state=t:this.updated=!1},E2.p.prototype.update_output=function(){return this.state};
;
E2.p=E2.plugins.matrix_clone_modulator=function(t){this.desc="Makes a physical copy of the input matrix reference, to allow side-effect free transform chain branching.",this.input_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"Input matrix reference.",def:t.renderer.matrix_identity}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The cloned matrix."}]},E2.p.prototype.update_input=function(t,e){this.matrix=mat4.create(e)},E2.p.prototype.update_output=function(){return this.matrix},E2.p.prototype.state_changed=function(t){t||(this.matrix=mat4.create(),mat4.identity(this.matrix))};
;
E2.p=E2.plugins.matrix_display=function(t){this.desc="Displays the supplied matrix as a 4x4 grid of values.",this.input_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The input matrix to be displayed.",def:null}],this.output_slots=[]},E2.p.prototype.reset=function(){this.cell_vals=["-","-","-","-","-","-","-","-","-","-","-","-","-","-","-","-"],this.update_values()},E2.p.prototype.create_ui=function(){var t=make("table"),e={"text-align":"right","padding-left":"10px"};this.columns=[];for(var s=0;4>s;s++){for(var i=make("tr"),a=0;4>a;a++){var p=make("td");p.text("-"),p.css(e),this.columns.push(p[0]),i.append(p)}t.append(i)}return t},E2.p.prototype.update_input=function(t,e){if(!e)return void this.reset();for(var s=0;16>s;s++)this.cell_vals[s]=e[s].toFixed(2);this.update_values()},E2.p.prototype.update_values=function(){if(this.columns)for(var t=0;16>t;t++)this.columns[t].innerHTML=this.cell_vals[t]};
;
E2.p=E2.plugins.max_modulator=function(t){this.desc="Emit the greater of the two input values.",this.input_slots=[{name:"a",dt:t.datatypes.FLOAT,desc:"The first input value",def:0},{name:"b",dt:t.datatypes.FLOAT,desc:"The second input value",def:0}],this.output_slots=[{name:"max",dt:t.datatypes.FLOAT,desc:"The larger of the two supplied values.",def:0}]},E2.p.prototype.reset=function(){this.val_a=0,this.val_b=0,this.output_val=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.val_a=e:this.val_b=e},E2.p.prototype.update_state=function(){this.output_val=Math.max(this.val_a,this.val_b)},E2.p.prototype.update_output=function(){return this.output_val};
;
E2.p=E2.plugins.member_array_length_modulator=function(t){this.desc="Emits the length of an array member of the supplied object.",this.input_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"Input object containing an array.",def:null},{name:"member",dt:t.datatypes.TEXT,desc:"Name of the array to emit the length of.",def:null}],this.output_slots=[{name:"length",dt:t.datatypes.FLOAT,desc:"The length of the specified array or 0.",def:0}]},E2.p.prototype.reset=function(){this.len=0,this.object=null,this.array_name=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.object=e:1===t.index&&(this.array_name=e)},E2.p.prototype.update_state=function(){if(this.len=0,null!==this.object&&null!==this.array_name){if(!this.object.hasOwnProperty(this.array_name))return void msg('ERROR: Cannot index unknown array "'+this.array_name+'".');var t=this.object[this.array_name];return"[object Array]"!==Object.prototype.toString.call(t)?void msg('ERROR: Object member "'+this.array_name+'" is not an array.'):void(this.len=t.length)}},E2.p.prototype.update_output=function(){return this.len};
;
E2.p=E2.plugins.member_to_bool_modulator=function(e){this.desc="Emits a boolean representation of specified member of the supplied object.",this.input_slots=[{name:"object",dt:e.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:e.datatypes.TEXT,desc:"Name of the member to be converted.",def:null}],this.output_slots=[{name:"bool",dt:e.datatypes.BOOL,desc:"The boolean representation of the specified member.",def:"Empty array"}]},E2.p.prototype.reset=function(){this.value=!1,this.object=null,this.member=null},E2.p.prototype.update_input=function(e,t){0===e.index?this.object=t:1===e.index&&(this.member=t)},E2.p.prototype.update_state=function(){return null!==this.object&&null!==this.member?this.object.hasOwnProperty(this.member)?void(this.value=this.object[this.member]?!0:!1):void msg('ERROR: Cannot convert unknown member "'+this.member+'".'):void 0},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.member_to_float_modulator=function(e){this.desc="Emits a float representation of specified member of the supplied object.",this.input_slots=[{name:"object",dt:e.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:e.datatypes.TEXT,desc:"Name of the member to be converted.",def:null}],this.output_slots=[{name:"value",dt:e.datatypes.FLOAT,desc:"The float representation of the specified member.",def:"Empty array"}]},E2.p.prototype.reset=function(){this.value=0,this.object=null,this.member=null},E2.p.prototype.update_input=function(e,t){0===e.index?this.object=t:1===e.index&&(this.member=t)},E2.p.prototype.update_state=function(){if(null!==this.object&&null!==this.member){if(!this.object.hasOwnProperty(this.member))return void msg('ERROR: Cannot convert unknown member "'+this.member+'".');var e=this.object[this.member];return isNaN(e)?void msg('ERROR: The member "'+this.member+'" is not a float.'):void(this.value=e)}},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.member_to_object_modulator=function(e){this.desc="Emits an object representation of specified member of the supplied object.",this.input_slots=[{name:"object",dt:e.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:e.datatypes.TEXT,desc:"Name of the member to be converted.",def:null}],this.output_slots=[{name:"object",dt:e.datatypes.OBJECT,desc:"The object representation of the specified member.",def:"Empty array"}]},E2.p.prototype.reset=function(){this.value={},this.object=null,this.member=null},E2.p.prototype.update_input=function(e,t){0===e.index?this.object=t:1===e.index&&(this.member=t)},E2.p.prototype.update_state=function(){if(null!==this.object&&null!==this.member){if(!this.object.hasOwnProperty(this.member))return void msg('ERROR: Cannot convert unknown member "'+this.member+'".');var e=this.object[this.member];return null===e||"object"!=typeof e?void msg('ERROR: The member "'+this.member+'" is not an object.'):void(this.value=e)}},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.member_to_string_modulator=function(t){this.desc="Emits a string representation of specified member of the supplied object.",this.input_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:t.datatypes.TEXT,desc:"Name of the member to be converted.",def:null}],this.output_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"The string representation of the specified member.",def:"Empty array"}]},E2.p.prototype.reset=function(){this.value="",this.object=null,this.member=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.object=e:1===t.index&&(this.member=e)},E2.p.prototype.update_state=function(){return null!==this.object&&null!==this.member?this.object.hasOwnProperty(this.member)?void(this.value=this.object[this.member].toString()):void msg('ERROR: Cannot convert unknown member "'+this.member+'".'):void 0},E2.p.prototype.update_output=function(){return this.value};
;
!function(){var t=E2.plugins.member_to_typed_array_modulator=function(t){Plugin.apply(this,arguments),this.desc="Emits an typed array representation of specified member of the supplied object.",this.input_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:t.datatypes.TEXT,desc:"Name of the member to be converted.",def:null}],this.output_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The typed array representation of the specified member.",def:"Empty array"}],this.state={datatype:6}};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){this.array=new ArrayBuffer(0),this.object=null,this.member=null},t.prototype.create_ui=function(){var t=$("<select />",{selectedIndex:1});return $("<option />",{value:0,text:"Int8"}).appendTo(t),$("<option />",{value:1,text:"Uint8"}).appendTo(t),$("<option />",{value:2,text:"Int16"}).appendTo(t),$("<option />",{value:3,text:"Uint16"}).appendTo(t),$("<option />",{value:4,text:"Int32"}).appendTo(t),$("<option />",{value:5,text:"Uint32"}).appendTo(t),$("<option />",{value:6,text:"Float32"}).appendTo(t),t.change(function(e){return function(){e.undoableSetState("datatype",parseInt(t.val()),e.state.datatype)}}(this)),t},t.prototype.update_input=function(t,e){0===t.index?this.object=e:1===t.index&&(this.member=e)},t.prototype.update_state=function(){if(null!==this.object&&null!==this.member){if(!this.object.hasOwnProperty(this.member))return void msg('ERROR: Cannot convert unknown member "'+this.member+'".');var t=this.object[this.member];if("[object array]"!==Object.prototype.toString.call(t).toLowerCase())return void msg('ERROR: The member "'+this.member+'" is not an array.');switch(this.state.datatype){case 0:this.array=new Int8Array(t);break;case 1:this.array=new Uint8Array(t);break;case 2:this.array=new Int16Array(t);break;case 3:this.array=new Uint16Array(t);break;case 4:this.array=new Int32Array(t);break;case 5:this.array=new Uint32Array(t);break;case 6:this.array=new Float32Array(t)}this.array=this.array.buffer,this.array.datatype=this.state.datatype,this.array.stride=[1,1,2,2,4,4,4][this.state.datatype]}},t.prototype.update_output=function(){return this.array},t.prototype.state_changed=function(t){t&&t.val(""+this.state.datatype)}}();
;
E2.p=E2.plugins.mesh_get_primitive_count=function(t){this.desc="Gets the number of primitives in the supplied mesh.",this.input_slots=[{name:"mesh",dt:t.datatypes.MESH,desc:"Input mesh.",def:null}],this.output_slots=[{name:"mesh",dt:t.datatypes.MESH,desc:"The input mesh."},{name:"prim count",dt:t.datatypes.FLOAT,desc:"The number of primitives in the specified mesh."}]},E2.p.prototype.update_input=function(t,e){this.mesh=e},E2.p.prototype.update_state=function(){return this.mesh?(this.count=this.mesh.index_buffer?this.mesh.index_buffer.count:this.mesh.vertex_buffers.VERTEX.count,void(this.count/=this.mesh.get_stride())):void(this.count=0)},E2.p.prototype.update_output=function(t){return 0===t.index?this.mesh:this.count},E2.p.prototype.state_changed=function(t){t||(this.mesh=null,this.count=0)};
;
E2.p=E2.plugins.mesh_renderer_emitter=function(e){this.desc="Render the supplied <b>mesh</b>. If no <b>shader</b> is specified, the internal shader (if any) of the <b>mesh</b> is used.",this.input_slots=[{name:"mesh",dt:e.datatypes.MESH,desc:"The input mesh to be rendered.",def:null},{name:"shader",dt:e.datatypes.SHADER,desc:"Connect to this slot to use the supplied shader in favor of the one specified by the mesh (if any).",def:null},{name:"camera",dt:e.datatypes.CAMERA,desc:"Camera to use for rendering.",def:e.renderer.camera_screenspace},{name:"transform",dt:e.datatypes.MATRIX,desc:"Mesh transform.",def:e.renderer.matrix_identity}],this.output_slots=[],this.gl=e.renderer.context},E2.p.prototype.reset=function(){this.mesh=null,this.shader=null},E2.p.prototype.update_input=function(e,t){0===e.index?this.mesh=t:1===e.index?this.shader=t:2===e.index?this.camera=t:3===e.index&&(this.transform=t)},E2.p.prototype.update_state=function(){var e=this.mesh;e&&(this.shader?e.render(this.camera,this.transform,this.shader,this.shader.material):e.render(this.camera,this.transform,e.shader,e.material))},E2.p.prototype.state_changed=function(e){e||(this.camera=new Camera,this.transform=mat4.create(),mat4.identity(this.transform))};
;
E2.p=E2.plugins.mesh_set_max_primitive_count=function(t){this.desc="Sets the maximumber number of primitives in the supplied mesh to render.",this.input_slots=[{name:"mesh",dt:t.datatypes.MESH,desc:"Input mesh.",def:null},{name:"max",dt:t.datatypes.FLOAT,desc:"Maximum number of primitives to draw (-1 = all).",def:-1}],this.output_slots=[{name:"mesh",dt:t.datatypes.MESH,desc:"The input mesh."}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.mesh=e:this.max_count=-1===e?null:e},E2.p.prototype.update_state=function(){this.mesh&&(this.mesh.max_prims=this.max_count)},E2.p.prototype.update_output=function(){return this.mesh},E2.p.prototype.state_changed=function(t){t||(this.mesh=null,this.max_count=null)};
;
E2.p=E2.plugins.min_modulator=function(t){this.desc="Emit the lesser of the two input values.",this.input_slots=[{name:"a",dt:t.datatypes.FLOAT,desc:"The first input value",def:0},{name:"b",dt:t.datatypes.FLOAT,desc:"The second input value",def:0}],this.output_slots=[{name:"min",dt:t.datatypes.FLOAT,desc:"The smaller of the two supplied values.",def:0}]},E2.p.prototype.reset=function(){this.val_a=0,this.val_b=0,this.output_val=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.val_a=e:this.val_b=e},E2.p.prototype.update_state=function(){this.output_val=Math.min(this.val_a,this.val_b)},E2.p.prototype.update_output=function(){return this.output_val};
;
E2.p=E2.plugins.modulate_modulator=function(t){this.desc="Modulate <b>value</b> such that the result will always be never be negative and less than or equal to <b>limit</b>.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to be modulated.",def:0},{name:"limit",dt:t.datatypes.FLOAT,desc:"Divisor.",lo:">0",def:1}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"Emits the remainder of <b>value</b> divided by <b>limit</b>",def:0}]},E2.p.prototype.reset=function(){this.input_val=0,this.limit_val=1,this.output_val=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.input_val=e:this.limit_val=0==e?1:e},E2.p.prototype.update_state=function(){this.output_val=this.input_val%this.limit_val},E2.p.prototype.update_output=function(){return this.output_val};
;
E2.p=E2.plugins.module_player=function(t){this.desc="Play a protracker-compatible .mod file using library by firehawk/tda (firehawk@haxor.fi).",this.input_slots=[{name:"url",dt:t.datatypes.TEXT,desc:"The url of the module to play.",def:null},{name:"play",dt:t.datatypes.BOOL,desc:"Send true to start playback and false to stop.",def:!1}],this.output_slots=[],t.add_aux_script("module_player/pt.js",function(t){return function(){t.player=new Protracker}}(this)),this.audio=null,this.playing=!1,this.should_play=!1},E2.p.prototype.play=function(){this.audio&&!this.playing&&this.should_play&&(this.playing=this.should_play=!0,this.player.play())},E2.p.prototype.pause=function(){this.player&&this.playing&&(this.playing=!1,this.should_play=!0,this.player.pause())},E2.p.prototype.stop=function(){this.player&&this.playing&&(this.playing=this.should_play=!1,this.player.stop())},E2.p.prototype.update_input=function(t,p){0===t.index?(this.player.load(p),this.playing=!1):1===t.index&&(this.should_play=p)},E2.p.prototype.update_state=function(){var t=this.player;this.player&&this.player.ready&&(this.playing!==this.should_play&&(this.should_play?t.play():t.pause(),this.playing=this.should_play),this.playing&&(this.updated=!0))};
;
E2.p=E2.plugins.more_than_modulator=function(t){this.desc="Emits true if the supplied <b>value</b> is larger than <b>reference</b> and false otherwise.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to be compared.",def:0},{name:"reference",dt:t.datatypes.FLOAT,desc:"Reference to compare <b>value</b> to.",def:0}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true if <b>value</b> is larger than <b>reference</b>.",def:!1}]},E2.p.prototype.reset=function(){this.value=0,this.ref=0,this.state=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.value=e:this.ref=e},E2.p.prototype.update_state=function(){var t=this.value>this.ref;t!==this.state?this.state=t:this.updated=!1},E2.p.prototype.update_output=function(){return this.state};
;
!function(){var t=E2.plugins.mouse_button_generator=function(t){this.desc="Emits the current mouse button state.",this.input_slots=[],this.output_slots=[{name:"Left",dt:t.datatypes.BOOL,desc:"True if the left mouse button is pressed and false otherwise.",def:!1},{name:"Middle",dt:t.datatypes.BOOL,desc:"True if the middle mouse button is pressed and false otherwise.",def:!1},{name:"Right",dt:t.datatypes.BOOL,desc:"True if the right mouse button is pressed and false otherwise.",def:!1}]};t.prototype.update_output=function(t){return this.buttons[t.index]},t.prototype.mouse_down=function(t){t.preventDefault(),this.buttons[t.which-1]=!0,this.updated=!0},t.prototype.mouse_up=function(t){this.buttons[t.which-1]=!1,this.updated=!0},t.prototype.state_changed=function(t){t||(this.buttons=[],this.buttons[0]=this.buttons[1]=this.buttons[2]=!1,E2.dom.webgl_canvas.on("mousedown",this.mouse_down.bind(this)),E2.dom.webgl_canvas.on("mouseup",this.mouse_up.bind(this)))}}();
;
E2.p=E2.plugins.mouse_position_generator=function(e){this.desc="Emits the current mouse position in clip space mapped to the canvas.",this.input_slots=[],this.output_slots=[{name:"x",dt:e.datatypes.FLOAT,desc:"-1 at left edge of canvas and 1 at the right edge. Can be both smaller than -1 and larger than 1 if the mouse is outside the canvas bounds.",def:0},{name:"y",dt:e.datatypes.FLOAT,desc:"-1 at top edge of canvas and 1 at the bottom edge. Can be both smaller than -1 and larger than 1 if the mouse is outside the canvas bounds.",def:0}],this.renderer=e.renderer},E2.p.prototype.update_output=function(e){return 0===e.index?this.x:this.y},E2.p.prototype.mouse_moved=function(e){return function(t){var s=E2.dom.webgl_canvas[0],n=e.renderer.fullscreen,o=n?s.clientWidth:s.width,a=n?s.clientHeight:s.height;e.x=(t.pageX-s.offsetLeft)/o*2-1,e.y=2*(1-(t.pageY-s.offsetTop)/a)-1,e.updated=!0}},E2.p.prototype.state_changed=function(e){e||(this.x=this.y=0,$(document).mousemove(this.mouse_moved(this)))};
;
E2.p=E2.plugins.mouse_wheel_generator=function(e){this.desc="Emits the current mouse wheel state.",this.input_slots=[],this.output_slots=[{name:"delta",dt:e.datatypes.FLOAT,desc:"The delta mouse wheel movement.",def:0}]},E2.p.prototype.update_output=function(){return this.delta},E2.p.prototype.mouse_wheel=function(e){var t=e.originalEvent.wheelDelta;this.delta=-t,this.updated=!0},E2.p.prototype.state_changed=function(e){e||(this.delta=0,E2.dom.webgl_canvas.bind("mousewheel",this.mouse_wheel.bind(this)))};
;
!function(){var t=E2.plugins.multiply_modulator=function(t){this.desc="Multiplies the two supplied values and emits the result.",this.input_slots=[{name:"a",dt:t.datatypes.FLOAT,desc:"The first operand.",def:0},{name:"b",dt:t.datatypes.FLOAT,desc:"The second operand.",def:1}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"The product of the two supplied values.",def:0}]};t.prototype.reset=function(){this.vals=[0,1],this.outputVal=0},t.prototype.update_input=function(t,e){this.vals[t.index]=e},t.prototype.update_state=function(){this.outputVal=this.vals[0]*this.vals[1]},t.prototype.update_output=function(){return this.outputVal}}();
;
E2.p=E2.plugins.nand_modulator=function(t){this.desc="Emits false when both inputs are true and false otherwise.",this.input_slots=[{name:"a",dt:t.datatypes.BOOL,desc:"The first operand.",def:!1},{name:"b",dt:t.datatypes.BOOL,desc:"The second operand.",def:!1}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits false if <b>first</b> and <b>second</b> are true and false otherwise.",def:!1}]},E2.p.prototype.reset=function(){this.conds=[!1,!1],this.state=!1},E2.p.prototype.update_input=function(t,e){this.conds[t.index]=e},E2.p.prototype.update_state=function(){this.state=!(this.conds[0]&&this.conds[1])},E2.p.prototype.update_output=function(){return this.state};
;
E2.p=E2.plugins.ne_modulator=function(t){this.desc="Emits true if the supplied <b>value</b> is not equal to <b>reference</b> and false otherwise.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to be compared.",def:0},{name:"reference",dt:t.datatypes.FLOAT,desc:"Reference to compare <b>value</b> to.",def:0}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true if <b>value</b> is not equal to <b>reference</b>.",def:!1}]},E2.p.prototype.reset=function(){this.value=0,this.ref=0,this.state=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.value=e:this.ref=e},E2.p.prototype.update_state=function(){var t=this.value!=this.ref;t!==this.state?this.state=t:this.updated=!1},E2.p.prototype.update_output=function(){return this.state};
;
E2.p=E2.plugins.near_eq_modulator=function(t){this.desc="Emits true if the difference between <b>value</b> and <b>reference</b> is less than or equal to <b>proximity</b>.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to be compared.",def:0},{name:"proximity",dt:t.datatypes.FLOAT,desc:"Proximity value for comparison.",def:0},{name:"reference",dt:t.datatypes.FLOAT,desc:"Reference to compare <b>value</b> to.",def:0}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:this.desc,def:!1}]},E2.p.prototype.reset=function(){this.value=0,this.proximity=0,this.ref=0,this.state=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.value=e:1===t.index?this.proximity=e:this.ref=e},E2.p.prototype.update_state=function(){var t=Math.abs(this.value-this.ref)<=this.proximity;t!==this.state?this.state=t:this.updated=!1},E2.p.prototype.update_output=function(){return this.state};
;
E2.p=E2.plugins.negate_modulator=function(t){this.desc="Emits the sign inverted input value.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to be negated.",def:0}],this.output_slots=[{name:"-value",dt:t.datatypes.FLOAT,desc:"The sign-inverted input value.",def:-0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){this.value=-e},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.not_modulator=function(t){this.desc="Emits true if the input is false and vice versa.",this.input_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Input boolean to be inverted.",def:!1}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Truth-inverted input value.",def:!0}]},E2.p.prototype.update_input=function(t,e){this.input=e},E2.p.prototype.update_state=function(){this.output=!this.input},E2.p.prototype.update_output=function(){return this.output},E2.p.prototype.state_changed=function(t){t&&(this.input=!1,this.output=!0)};
;
E2.p=E2.plugins.object_add=function(t){this.desc="Object composition",this.input_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"Optional existing object"},{name:"key",dt:t.datatypes.TEXT,desc:"The key"},{name:"value",dt:t.datatypes.ANY,desc:"The value: A float, text or object."}],this.output_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"The created object"}],this._object={}},E2.p.prototype.reset=function(){this._key=null,this._object={}},E2.p.prototype.update_input=function(t,e){switch(t.index){case 0:var s=this._object[this._key];this._object=e||{},s&&this._key&&(this._object[this._key]=s);break;case 1:this._key=e;break;case 2:this._object[this._key]=e}},E2.p.prototype.update_output=function(){return this._object};
;
E2.p=E2.plugins.object_display=function(t){this.desc="Displays Objects and Arrays.",this.input_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"Input object to be analyzed.",def:null}],this.output_slots=[]},E2.p.prototype.reset=function(){this.update_value(null)},E2.p.prototype.create_ui=function(){return this.label=make("pre"),this.update_value(null),this.label},E2.p.prototype.update_input=function(t,e){this.update_value(e)},E2.p.prototype.update_value=function(t){if(this.label)try{this.label.html(JSON.stringify(t,null,"  "))}catch(e){this.label.html(e)}};
;
E2.p=E2.plugins.object_stringify=function(t){this.desc="Serialize object to JSON (stringify)",this.input_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"Object to serialize"}],this.output_slots=[{name:"json",dt:t.datatypes.TEXT,desc:"The serialized object"}]},E2.p.prototype.reset=function(){this._json=""},E2.p.prototype.update_input=function(t,e){switch(t.index){case 0:this._json=JSON.stringify(e)}},E2.p.prototype.update_output=function(){return this._json};
;
!function(){var t=E2.plugins.on_three_object_gaze_clicked=function(){AbstractObjectGazePlugin.apply(this,arguments),this.desc="Emits an impulse or continuous signal when the selected object is gazed. The name in the pulldown refers to the name of a Mesh patch."};t.prototype=Object.create(AbstractObjectGazePlugin.prototype),t.prototype.onGazeClicked=function(){this.triggerState=!0,this.updated=!0,this.node.queued_update=1},t.prototype.onGazeOut=function(){this.triggerState=!1,this.updated=!0,this.node.queued_update=1},t.prototype.update_state=function(){this.lastState===this.triggerState&&0===this.state.type&&(this.triggerState=!1),this.focused||(this.triggerState=!1),this.lastState=this.triggerState}}();
;
!function(){var t=E2.plugins.on_three_object_gaze_in=function(){AbstractObjectGazePlugin.apply(this,arguments),this.desc="Emits an impulse or continuous signal when the viewer's gaze is selected object is gazed. The name in the pulldown refers to the name of a Mesh patch."};t.prototype=Object.create(AbstractObjectGazePlugin.prototype),t.prototype.onGazeIn=function(){this.focused=!0,this.triggerState=!0,this.updated=!0,this.node.queued_update=1},t.prototype.onGazeOut=function(){this.focused=!1,this.triggerState=!1,this.updated=!0,this.node.queued_update=1},t.prototype.update_state=function(){this.lastState===this.triggerState&&0===this.state.type&&(this.triggerState=!1),this.focused||(this.triggerState=!1),this.lastState=this.triggerState}}();
;
!function(){var t=E2.plugins.on_three_object_gaze_out=function(){AbstractObjectGazePlugin.apply(this,arguments),this.desc="Emits an impulse or continuous signal when the viewer's gaze leaves the selected object. The name in the pulldown refers to the name of a Mesh patch.",this.triggerState=!0};t.prototype=Object.create(AbstractObjectGazePlugin.prototype),t.prototype.onGazeIn=function(){this.focused=!0,this.updated=!0,this.node.queued_update=1},t.prototype.onGazeOut=function(){this.focused=!1,this.updated=!0,this.node.queued_update=1},t.prototype.update_state=function(){this.triggerState=!this.focused,this.lastState===this.triggerState&&0===this.state.type&&(this.triggerState=!1),this.lastState=this.triggerState}}();
;
E2.p=E2.plugins.or_modulator=function(t){this.desc="Emits true if either input value is true and false otherwise.",this.input_slots=[{name:"a",dt:t.datatypes.BOOL,desc:"The first operand.",def:!1},{name:"b",dt:t.datatypes.BOOL,desc:"The second operand.",def:!1}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true if <b>first</b> <i>or</i> <b>second</b> are true and false otherwise.",def:!1}]},E2.p.prototype.reset=function(){this.conds=[!1,!1],this.state=!1},E2.p.prototype.update_input=function(t,e){this.conds[t.index]=e},E2.p.prototype.update_state=function(){this.state=this.conds[0]||this.conds[1]},E2.p.prototype.update_output=function(){return this.state};
;
E2.p=E2.plugins.osc_float=function(t){this.desc="Emits float value sent via OSC to address.",this.input_slots=[{name:"address",dt:t.datatypes.TEXT,desc:'OSC address to listen to, eg. "/1/rotary23"',def:null}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Float value from OSC message",def:0}],t.add_aux_script("osc/osc-proxy.js")},E2.p.prototype.update_input=function(t,s){if(s){var e=this;OscProxy.listen(s,function(t){e.updated=!0,e.value=t[0].value})}},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.osc_receiver=function(s){this.desc="Emits all messages received via OSC.",this.input_slots=[],this.output_slots=[{name:"address",dt:s.datatypes.TEXT,desc:"Recipient address"},{name:"message",dt:s.datatypes.OBJECT,desc:"Actual OSC message"}],s.add_aux_script("osc/osc-proxy.js")},E2.p.prototype.play=function(){var s=this;OscProxy.listen("*",function(e,t){s.updated=!0,s._address=e,s._message=t})},E2.p.prototype.reset=function(){this._address=this._message=null},E2.p.prototype.update_output=function(s){return 0===s.index?this._address:this._message};
;
E2.p=E2.plugins.osc_xy_float=function(t,s){this.desc="Emits two float values sent via OSC to address.",this.input_slots=[{name:"address",dt:t.datatypes.TEXT,desc:'OSC address to listen to, eg. "/1/xy1"',def:null}],this.output_slots=[{name:"x",dt:t.datatypes.FLOAT,desc:"First float value from OSC message"},{name:"y",dt:t.datatypes.FLOAT,desc:"Second float value from OSC message"}],t.add_aux_script("osc/osc-proxy.js"),this.node=s},E2.p.prototype.update_input=function(t,s){if(null!==s){var e=this;OscProxy.listen(s,function(t){e.updated=!0,e.x=t[0].value,e.y=t[1].value})}},E2.p.prototype.reset=function(){this.x=this.y=0},E2.p.prototype.update_output=function(t){return 0===t.index?this.x:this.y};
;
E2.p=E2.plugins.osc_xyz_float=function(t,s){this.desc="Emits three float values sent via OSC to address.",this.input_slots=[{name:"address",dt:t.datatypes.TEXT,desc:'OSC address to listen to, eg. "/accxyz"',def:"/accxyz"}],this.output_slots=[{name:"x",dt:t.datatypes.FLOAT,desc:"First float value from OSC message"},{name:"y",dt:t.datatypes.FLOAT,desc:"Second float value from OSC message"},{name:"z",dt:t.datatypes.FLOAT,desc:"Third float value from OSC message"}],t.add_aux_script("osc/osc-proxy.js"),this.node=s},E2.p.prototype.update_input=function(t,s){if(null!==s){var e=this;OscProxy.listen(s,function(t){e.updated=!0,e.x=t[0].value,e.y=t[1].value,e.z=t[2].value})}},E2.p.prototype.reset=function(){this.x=this.y=this.z=0},E2.p.prototype.update_output=function(t){return 0===t.index?this.x:1===t.index?this.y:this.z};
;
E2.p=E2.plugins.output_proxy=function(t,e){this.desc="Create a new type-less slot to route data out of the current graph to its parent. When connected to a slot, it will assume its type until disconnected. Renaming this plugin will rename the corresponding parent slot.",this.input_slots=[],this.output_slots=[],e.add_slot(E2.slot_type.input,{name:"output",dt:t.datatypes.ANY,desc:"Connect a slot of any type to this plugin, to have the parent slot assume its datatype and forward data from this plugin.",def:null}),this.core=t,this.node=e,this.data=null,this.changed=!1,e.title||(e.title="output")},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.connection_changed=function(t,e,n){var o=this.node.parent_graph.plugin;o&&o.proxy_connection_changed(t,this.node,e.src_node,n,e.src_slot)},E2.p.prototype.update_input=function(t,e){var n=this.node;if(this.data=e,this.changed=!0,n.parent_graph.plugin){var o=n.parent_graph.plugin;o.updated_sids.push(o.state.output_sids[n.uid]),o.updated=!0}},E2.p.prototype.state_changed=function(){};
;
E2.p=E2.plugins.parse_json_modulator=function(t){this.desc="Emits an object representation of the supplied JSON string.",this.input_slots=[{name:"json",dt:t.datatypes.TEXT,desc:"Input string to be parsed.",def:null}],this.output_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"The object representation of the supplied json.",def:"Empty object"}]},E2.p.prototype.reset=function(){this.obj={}},E2.p.prototype.update_input=function(t,e){if(!e)return void(this.obj={});try{this.obj=JSON.parse(e)}catch(s){msg("ERROR: Failed to parse JSON: "+s.message),this.obj={}}},E2.p.prototype.update_output=function(){return this.obj};
;
E2.p=E2.plugins.perspective_camera=function(e){this.desc="Create a new perspective (3D) camera.",this.input_slots=[{name:"FOV",dt:e.datatypes.FLOAT,desc:"Field of view in degrees.",def:45},{name:"near",dt:e.datatypes.FLOAT,desc:"Depth of the near clipping plane.",def:.01},{name:"far",dt:e.datatypes.FLOAT,desc:"Depth of the far clipping plane.",def:1e3},{name:"position",dt:e.datatypes.VECTOR,desc:"Camera position.",def:[0,0,2]},{name:"rotation",dt:e.datatypes.VECTOR,desc:"Camera rotation.",def:[0,0,0]},{name:"aspect ratio",dt:e.datatypes.FLOAT,desc:"Aspect Ratio"}],this.output_slots=[{name:"camera",dt:e.datatypes.CAMERA,desc:"The resulting camera."}]},E2.p.prototype.update_input=function(e,t){0===e.index?this.camera.fov=t:1===e.index?this.camera.near=t:2===e.index?this.camera.far=t:3===e.index?this.camera.position.set(t.x,t.y,t.z):4===e.index?this.camera.rotation.set(t.x,t.y,t.z):5===e.index&&(this.camera.aspectRatio=t),this.camera.updateProjectionMatrix()},E2.p.prototype.update_state=function(){},E2.p.prototype.update_output=function(){return this.camera},E2.p.prototype.state_changed=function(e){e||(this.camera=new THREE.PerspectiveCamera(45,1,.1,100),this.camera.position.set(0,0,-2),this.camera.rotation.set(0,0,0))};
;
E2.p=E2.plugins.pi_generator=function(t){this.desc="Emits the constant ∏ (pi).",this.input_slots=[],this.output_slots=[{name:"pi",dt:t.datatypes.FLOAT,desc:"The constant ∏ (pi)."}]},E2.p.prototype.reset=function(){},E2.p.prototype.update_output=function(){return Math.PI};
;
E2.p=E2.plugins.planar_projection_matrix=function(t){this.desc="Create a matrix that represent a planar projection.",this.input_slots=[{name:"plane offset",dt:t.datatypes.FLOAT,desc:"Plane offset from the origin.",def:[0,0,0]},{name:"plane normal",dt:t.datatypes.VECTOR,desc:"Plane orientation.",def:[0,0,-1]},{name:"light pos",dt:t.datatypes.VECTOR,desc:"Light position in world space.",def:[0,0,-2]}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The resulting projection matrix.",def:t.renderer.matrix_identity}]},E2.p.prototype.reset=function(){this.plane_offset=0,this.plane_normal=[0,0,-1],this.light_pos=[0,0,-2],this.matrix=mat4.create(),mat4.identity(this.matrix)},E2.p.prototype.update_input=function(t,e){0===t.index?this.plane_offset=e:1===t.index?this.plane_normal=e:1===t.index&&(this.light_pos=e)},E2.p.prototype.update_state=function(){var t=this.plane_normal,e=this.light_pos,i=this.matrix,a=this.plane_offset,n=t[0]*e[0]+t[1]*e[1]+t[2]*e[2];n=n>0?1/n:1,i[0]=1-t[0]*e[0]*n,i[4]=-t[0]*e[1]*n,i[8]=-t[0]*e[2]*n,i[1]=-t[1]*e[0]*n,i[5]=-1-t[1]*e[1]*n,i[9]=-t[1]*e[2]*n,i[2]=-t[2]*e[0]*n,i[6]=-t[2]*e[2]*n,i[10]=1-t[2]*e[2]*n,i[2]=a*e[0]*n,i[6]=a*e[1]*n,i[10]=1-e[2]*n},E2.p.prototype.update_output=function(){return this.matrix};
;
E2.p=E2.plugins.plot_display=function(t){this.desc="Displays the supplied coordiate on a XY plot.",this.input_slots=[{name:"x",dt:t.datatypes.FLOAT,desc:"The location on the x-axis.",lo:0,hi:1,def:0},{name:"y",dt:t.datatypes.FLOAT,desc:"The location on the y-axis.",lo:0,hi:1,def:0}],this.output_slots=[]},E2.p.prototype.reset=function(){this.coord=[0,0],this.update_values()},E2.p.prototype.create_ui=function(){var t=make("div");t.css({width:"64px",height:"64px",background:"url('images/plot_display/bg.png')","z-index":"1000",position:"relative"});var o=this.coord_div=make("div");return o.css({width:"7px",height:"7px",background:"url('images/plot_display/point.png')","z-index":"1001",position:"absolute"}),t.append(o),this.reset(),t},E2.p.prototype.update_input=function(t,o){this.coord[t.index]=0>o?0:o>1?1:o,this.update_values()},E2.p.prototype.update_values=function(){this.coord_div&&this.coord_div.css({left:Math.round(55*this.coord[0]),top:Math.round(55-55*this.coord[1])+2})};
;
E2.p=E2.plugins.random_float_generator=function(t){this.desc="Emits a random float constant in a specified range.",this.input_slots=[{name:"min",dt:t.datatypes.FLOAT,desc:"Minimum output value.",def:0},{name:"max",dt:t.datatypes.FLOAT,desc:"Maximum output value.",def:1}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Random output value between <b>min</b> and <b>max</b>."}],this.always_update=!0,this.lo=0,this.hi=1,this.value=0},E2.p.prototype.update_input=function(t,a){0===t.index?this.lo=a:1===t.index&&(this.hi=a)},E2.p.prototype.update_state=function(){var t=this.lo,a=this.hi;if(t>a){var e=t;t=a,a=e}this.value=t+Math.random()*(a-t),this.updated=!0},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.record_framebuffer=function(t){this.desc="Grab the current framebuffer and transmit frame size and RGB data to a specified recording server.",this.input_slots=[{name:"record",dt:t.datatypes.BOOL,desc:"Switch recording on or off.",def:!1},{name:"texture",dt:t.datatypes.TEXTURE,desc:"The texture output of a graph.",def:null}],this.output_slots=[],this.gl=t.renderer.context,this.url="http://"+window.location.host+"/fd/frame"},E2.p.prototype.reset=function(){this.texture=null,this.img_data=null,this.conv_data=null,this.xhr=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.record=e:1===t.index&&(this.texture=e)},E2.p.prototype.update_state=function(){if(this.record&&this.url&&this.texture&&this.texture.framebuffer){var t=this.gl,e=this.texture.width,i=this.texture.height,r=e*i*4;this.img_data&&this.img_data.byteLength===r||(this.img_data=new Uint8Array(r),this.conv_data=new Uint8Array(e*i*3),this.xhr=new XMLHttpRequest),t.bindFramebuffer(t.FRAMEBUFFER,this.texture.framebuffer),t.readPixels(0,0,e,i,t.RGBA,t.UNSIGNED_BYTE,this.img_data),t.bindFramebuffer(t.FRAMEBUFFER,null);for(var a=this.img_data,s=this.conv_data,h=0,n=0;e*i*3>h;h+=3,n+=4)s[h+2]=a[n],s[h+1]=a[n+1],s[h]=a[n+2];this.xhr.open("POST",this.url+"?width="+e+"&height="+i,!1),this.xhr.setRequestHeader("Content-Type","application/octet-stream"),this.xhr.send(this.conv_data)}};
;
E2.p=E2.plugins.reset_framebuffer_recorder=function(t){this.desc="Instruct the specified framedump server to clear its cache and start recording at from zero.",this.input_slots=[{name:"reset",dt:t.datatypes.BOOL,desc:"Send true to this slot to reset the specified server.",def:!1}],this.output_slots=[],this.url="http://"+window.location.host+"/fd/reset",this.clear=!1},E2.p.prototype.reset=function(){},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.clear=e)},E2.p.prototype.update_state=function(){this.clear&&($.get(this.url).done(function(){msg("Framdumping reset to frame 0")}).fail(function(){msg("ERROR: Failed to reset the speficied framedumping server: "+this.url)}),this.clear=!1)};
;
E2.p=E2.plugins.rotation_matrix=function(t){this.desc="Create a matrix that performs a rotation around an arbitrary axis.",this.input_slots=[{name:"angle",dt:t.datatypes.FLOAT,desc:"Number of degrees to rotate.",lo:-360,hi:360,def:0},{name:"axis",dt:t.datatypes.VECTOR,desc:"Normalized vector describing the axis around which the rotation is performed.",def:[0,0,1]}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The resulting rotation matrix.",def:t.renderer.metrix_identity}]},E2.p.prototype.reset=function(){this.angle=0,this.axis=[0,0,1],this.matrix=mat4.create(),mat4.identity(this.matrix)},E2.p.prototype.update_input=function(t,i){0===t.index?this.angle=i%360/180*Math.PI:this.axis=i},E2.p.prototype.update_state=function(){mat4.identity(this.matrix),mat4.rotate(this.matrix,this.angle,this.axis)},E2.p.prototype.update_output=function(){return this.matrix};
;
E2.p=E2.plugins.rotation_xyz_matrix=function(t){this.desc="Create a matrix that rotates individually around the X, Y and Z axis.",this.input_slots=[{name:"x",dt:t.datatypes.FLOAT,desc:"Number of degrees to rotate around the X-axis.",lo:-360,hi:360,def:0},{name:"y",dt:t.datatypes.FLOAT,desc:"Number of degrees to rotate around the Y-axis.",lo:-360,hi:360,def:0},{name:"z",dt:t.datatypes.FLOAT,desc:"Number of degrees to rotate around the Z-axis.",lo:-360,hi:360,def:0}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The resulting rotation matrix.",def:t.renderer.matrix_identity}]},E2.p.prototype.reset=function(){this.angles=[0,0,0],this.matrix=mat4.create(),mat4.identity(this.matrix)},E2.p.prototype.update_input=function(t,e){this.angles[t.index]=e%360/180*Math.PI},E2.p.prototype.update_state=function(){mat4.identity(this.matrix),mat4.rotateX(this.matrix,this.angles[0]),mat4.rotateY(this.matrix,this.angles[1]),mat4.rotateZ(this.matrix,this.angles[2])},E2.p.prototype.update_output=function(){return this.matrix};
;
E2.p=E2.plugins.round_modulator=function(t){this.desc="Emits the input <b>value</b> rounded to the nearest integer.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The input value to be rounded.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"The rounded integer.",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){this.value=Math.round(e)},E2.p.prototype.update_output=function(){return this.value};
;
!function(){function t(t,e){this.input_slots=[{name:"eventName",dt:E2.dt.TEXT}],this.output_slots=[{name:"triggered",dt:E2.dt.BOOL},{name:"data",dt:E2.dt.ANY}],this.node=e,this.value=null,this.frames=0,this.triggered=!1,this._handleMessageBound=this._handleMessage.bind(this),this.lsg=new LinkedSlotGroup(t,e,[],[this.output_slots[0]])}t.prototype.connection_changed=function(t,e,s){this.lsg.connection_changed(t,e,s)&&(this.value=this.lsg.core.get_default_value(this.lsg.dt)),this.output_slots[0].array=!1},t.prototype._handleMessage=function(t){this.value=t,this.frames=0,this.triggered=!0,this.node.queued_update=1,this.updated=!0},t.prototype.update_input=function(t,e){"eventName"===t.name&&(this.eventName&&E2.core.runtimeEvents.off(this.eventName,this._handleMessageBound),this.eventName=e,E2.core.runtimeEvents.on(this.eventName,this._handleMessageBound))},t.prototype.update_state=function(){this.frames++>0&&(this.triggered=!1,this.value=this.lsg.core.get_default_value(this.lsg.dt))},t.prototype.update_output=function(t){return 0===t.index?this.triggered:this.value},t.prototype.state_changed=function(){this.lsg.infer_dt(),this.value=this.lsg.core.get_default_value(this.lsg.dt)},E2.plugins.runtime_event_read=t}();
;
!function(){function t(){this.input_slots=[{name:"emit",dt:E2.dt.BOOL,desc:"disable / enable emitting",def:!0},{name:"eventName",dt:E2.dt.TEXT},{name:"data",dt:E2.dt.ANY}],this.output_slots=[],this.desc="Emit a single runtime event when the data-input changes behaviour can be controlled by the emit-input. When emit becomes true, any data not yet sent will be emitted."}t.prototype.update_input=function(t,e){"emit"===t.name&&(this.emitActive=e),"eventName"===t.name&&(this.eventName=e),"data"===t.name&&(this.value=e),this.hasNewData=!0},t.prototype.update_state=function(){this.hasNewData&&this.eventName&&this.value&&this.emitActive&&(E2.core.runtimeEvents.emit(this.eventName,this.value),this.hasNewData=!1)},E2.plugins.runtime_event_write=t}();
;
!function(){function t(){this.input_slots=[{name:"emit",dt:E2.dt.BOOL,desc:"disable / enable emitting",def:!0},{name:"eventName",dt:E2.dt.TEXT},{name:"data",dt:E2.dt.ANY}],this.output_slots=[],this.desc="Emit one event on every frame for as long as the emit-input remaing true."}t.prototype.update_input=function(t,e){"emit"===t.name&&(this.emitActive=e),"eventName"===t.name&&(this.eventName=e),"data"===t.name&&(this.value=e)},t.prototype.update_state=function(){this.eventName&&this.value&&this.emitActive&&E2.core.runtimeEvents.emit(this.eventName,this.value)},E2.plugins.runtime_event_write_continuous=t}();
;
E2.p=E2.plugins.sample_and_hold_modulator=function(t){this.desc="Emits the input value when 'sample' is true and emits the last sampled value otherwise. Emits zero by default.",this.input_slots=[{name:"sample",dt:t.datatypes.BOOL,desc:"Sending true to this slot updated the output value to match the input value, false inhibits input sampling.",def:!0},{name:"value",dt:t.datatypes.FLOAT,desc:"The input value.",def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The output value.",def:0}],this.state={value:0}},E2.p.prototype.reset=function(){this.has_updated=!1,this.updated=!0,this.last_state=!0},E2.p.prototype.update_input=function(t,e){0===t.index?this.sample=e:this.buffer=e},E2.p.prototype.update_state=function(){this.sample?this.state.value=this.buffer:this.has_updated&&(this.updated=!1),!this.sample&&this.last_state&&(this.last_state=this.sample,this.has_updated=!1)},E2.p.prototype.update_output=function(){return this.has_updated=!0,this.state.value},E2.p.prototype.state_changed=function(t){t||(this.state.value=0,this.buffer=0,this.sample=!0)};
;
E2.p=E2.plugins.sawtooth_modulator=function(t){this.desc="Sawtooth oscilator. A <b>time</b> value incrementing by one unit per second will yield a 1Hz output signal.",this.input_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"Time in seconds.",def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Emits ((<b>time</b> % 1) - 0.5) * 2.",lo:-1,hi:1,def:0}]},E2.p.prototype.reset=function(){this.time=0,this.result=0},E2.p.prototype.update_input=function(t,e){this.time=e},E2.p.prototype.update_state=function(){this.result=2*(this.time%1-.5)},E2.p.prototype.update_output=function(){return this.result};
;
E2.p=E2.plugins.scale_matrix=function(t){this.desc="Create a matrix that scales by the supplied factors for each axis.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Factors to scale each axis by.",def:[1,1,1]}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The resulting scale matrix.",def:t.renderer.matrix_identity}]},E2.p.prototype.reset=function(){this.matrix=mat4.create(),mat4.identity(this.matrix)},E2.p.prototype.update_input=function(t,e){mat4.identity(this.matrix),mat4.scale(this.matrix,e)},E2.p.prototype.update_output=function(){return this.matrix};
;
E2.p=E2.plugins.scene_get_bounding_box=function(e){this.desc="Extract the <b>min</b> and <b>max</b> AABB vectors from a supplied <b>scene</b> for use in debugging, camera calibration or other calculations.",this.input_slots=[{name:"scene",dt:e.datatypes.SCENE,desc:"The input scene.",def:null}],this.output_slots=[{name:"min",dt:e.datatypes.VECTOR,desc:"The lowest <b>scene</b> extent.",def:e.renderer.vector_origin},{name:"max",dt:e.datatypes.VECTOR,desc:"The highest <b>scene</b> extent.",def:e.renderer.vector_origin}]},E2.p.prototype.update_input=function(e,t){0===e.index&&(this.scene=t)},E2.p.prototype.update_state=function(){if(this.scene){var e=this.scene.bounding_box;this.lo=e.lo,this.hi=e.hi}},E2.p.prototype.update_output=function(e){return 0===e.index?this.lo:this.hi},E2.p.prototype.state_changed=function(e){e||(this.scene=null,this.lo=[0,0,0],this.hi=[0,0,0])};
;
E2.p=E2.plugins.scene_get_mesh_by_index=function(e){this.desc="Extract a single <b>mesh</b> from a <b>scene</b> by <b>index</b> so it can be rendered individually.",this.input_slots=[{name:"scene",dt:e.datatypes.SCENE,desc:"The scene to extract a mesh reference from.",def:null},{name:"index",dt:e.datatypes.FLOAT,desc:"The desired mesh index.",def:0}],this.output_slots=[{name:"mesh",dt:e.datatypes.MESH,desc:"The extracted mesh reference."}]},E2.p.prototype.reset=function(){this.changed=!0},E2.p.prototype.update_input=function(e,t){0===e.index?this.scene=t:1===e.index&&(this.index=Math.floor(0>t?-t:t))},E2.p.prototype.update_state=function(){if(this.scene){var e=this.scene.meshes,t=e.length;if(1>t)return;var s=e[this.index%t];if(s!==this.mesh)return void(this.mesh=s)}this.changed||(this.updated=!1),this.changed=!1},E2.p.prototype.update_output=function(){return this.mesh},E2.p.prototype.state_changed=function(e){e||(this.scene=null,this.index=0,this.mesh=null,this.changed=!0)};
;
E2.p=E2.plugins.scene_get_mesh_count=function(e){this.desc="Emits the number of meshes in the supplied <b>scene</b>. Note that the maximum index is one less than the mesh <b>count</b>.",this.input_slots=[{name:"scene",dt:e.datatypes.SCENE,desc:"The scene to obtain the mesh count from.",def:null}],this.output_slots=[{name:"count",dt:e.datatypes.FLOAT,desc:"The number of meshes in the supplied <b>scene</b>. Note that mesh indices are zero-index, so the highest mesh index in a scene is count - 1.",def:0}]},E2.p.prototype.update_input=function(e,t){this.scene=t},E2.p.prototype.update_state=function(){this.count=this.scene?this.scene.meshes.length:0},E2.p.prototype.update_output=function(){return this.count},E2.p.prototype.state_changed=function(e){e||(this.scene=null,this.count=0)};
;
E2.p=E2.plugins.scene_renderer_emitter=function(e){this.desc="Render the supplied <b>scene</b>. If no <b>shader</b> is specified, the internal shaders of the scene meshes are used.",this.input_slots=[{name:"scene",dt:e.datatypes.SCENE,desc:"The scene to be rendered.",def:null},{name:"material",dt:e.datatypes.MATERIAL,desc:"If a material is specified, internal shaders are generated to render each scene mesh using this material as an overload.",def:null},{name:"camera",dt:e.datatypes.CAMERA,desc:"The camera to use for rendering.",def:null},{name:"transform",dt:e.datatypes.MATRIX,desc:"The scene transform to use for rendering.",def:e.renderer.matrix_identity},{name:"inv. transform",dt:e.datatypes.BOOL,desc:"Send true to this slot to apply <b>transform</b> in inverse order when rendering instances.",def:!1}],this.output_slots=[],this.gl=e.renderer.context},E2.p.prototype.reset=function(){this.scene=null,this.shader=null},E2.p.prototype.update_input=function(e,t){if(0===e.index)t!==this.scene&&(this.scene=t,this.ext_camera||(this.camera=this.scene.create_autofit_camera())),this.material_dirty=!0;else if(1===e.index){if(this.material=t,!t)return void(this.material_caps="");var a=Material.get_caps_hash(null,t);this.material_caps!==a&&(this.material_caps=a,this.material_dirty=!0)}else 2===e.index?(this.camera=t,this.ext_camera=t?!0:!1,!this.ext_camera&&this.scene&&(this.camera=this.scene.create_autofit_camera())):3===e.index&&(this.transform=t)},E2.p.prototype.connection_changed=function(e,t,a){e||(0===a.index?this.material_dirty=!0:1===a.index&&(this.material=null,this.material_caps="",this.overload_shaders=null))},E2.p.prototype.update_state=function(){this.scene&&(this.material_dirty&&this.material&&(this.overload_shaders=this.scene.build_overload_shaders(this.material),this.material_dirty=!1),this.transform.invert=this.inv_transform,this.scene.render(this.gl,this.camera,this.transform,this.overload_shaders,this.material))},E2.p.prototype.state_changed=function(e){e||(this.material=null,this.material_caps="",this.material_dirty=!1,this.overload_shaders=null,this.camera=new Camera,this.transform=mat4.create(),mat4.identity(this.transform),this.ext_camera=!1,this.inv_transform=!1)};
;
E2.p=E2.plugins.set_matrix_modulator=function(t){this.desc="Set matrix component.",this.input_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"Matrix to set component of.",def:t.renderer.matrix_identity},{name:"row",dt:t.datatypes.FLOAT,desc:"Row to set.",def:0},{name:"column",dt:t.datatypes.FLOAT,desc:"Column to set.",def:0},{name:"value",dt:t.datatypes.FLOAT,desc:"The value to set.",def:0}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"Modulated matrix."}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.matrix=e:1===t.index?this.row=0>e?0:e>3?3:e:2===t.index?this.column=0>e?0:e>3?3:e:3===t.index&&(this.value=e)},E2.p.prototype.update_state=function(){this.matrix[4*this.row+this.column]=this.value},E2.p.prototype.update_output=function(){return this.matrix},E2.p.prototype.state_changed=function(t){t||(this.matrix=mat4.create(),this.row=0,this.column=0,this.value=0,mat4.identity(this.matrix))};
;
E2.p=E2.plugins.sin_modulator=function(t){this.desc="Sin(x).",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"sin(<b>value</b>).",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.value=Math.sin(e))},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.sine_modulator=function(t){this.desc="Sine oscilator. A <b>time</b> value incrementing by one per second will yield a 1Hz output signal.",this.input_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"Time in seconds.",def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Emits sin(<b>time</b> * 2pi).",def:0}]},E2.p.prototype.reset=function(){this.time=0,this.result=0},E2.p.prototype.update_input=function(t,e){this.time=e},E2.p.prototype.update_state=function(){this.result=Math.sin(2*this.time*Math.PI)},E2.p.prototype.update_output=function(){return this.result};
;
!function(){var t=E2.plugins.slider_float_generator=function(t,s){Plugin.apply(this,arguments),this.desc="Emits a user controllable float value between two specified values.",this.input_slots=[],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Emits the current value when the slider is adjusted.",def:0}],this.state={val:0,min:0,max:1},this.node=s,this.v_col=null,this.slider=null,this.handle=null,this.pos=0,this.node.on("pluginStateChanged",this.updateUi.bind(this))};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){var t=this,s='<table class="slider-table"><tr><td colspan="3"><input class="slider" type="range" step="0.001" style="width:190px;"></td></tr><tr><td style="width: 50px;"><input class="min" type="number" step="0.2" style="width: 50px;"/></td><td class="slider-value" style="text-align:center;">0.0</td><td style="width: 50px;"><input class="max" type="number" step="0.2" style="width: 50px;"/></td></tr></table>',e=$(s),i=this.$min=e.find("input.min"),a=this.$max=e.find("input.max"),n=this.$slider=e.find("input.slider");this.$display=e.find("td.slider-value");var l=this.state.val;return n.on("input",function(){return t.$display.html(n.val()),t.transientSetState("val",parseFloat(n.val())),!0}),n.on("mousedown",function(){l=t.state.val}),n.on("mouseup",function(){var s=parseFloat(n.val());l!==s&&t.undoableSetState("val",s,l)}),i.on("change",function(){t.undoableSetState("min",parseFloat(i.val()),t.state.min)}),a.on("change",function(){t.undoableSetState("max",parseFloat(a.val()),t.state.max)}),this.updateUi(),e},t.prototype.updateUi=function(){if(this.$slider){if(this.$slider.val(this.state.val),this.$display.html(this.state.val),this.$min.val(this.state.min),this.$max.val(this.state.max),this.state.max<this.state.min){var t=this.state.max;this.state.max=this.state.min,this.state.min=t,this.$max.val(this.state.max),this.$min.val(this.state.min)}this.$slider.prop("step",(this.state.max-this.state.min)/1e3),this.$slider.prop("max",this.state.max),this.$slider.prop("min",this.state.min)}},t.prototype.update_output=function(){return this.state.val}}();
;
E2.p=E2.plugins.sqrt_modulator=function(t){this.desc="Sqrt(x).",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"sqrt(<b>value</b>).",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.value=Math.sqrt(e))},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.square_modulator=function(t){this.desc="Square oscilator. A <b>time</b> value incrementing by one unit per second will yield a 1Hz output signal.",this.input_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"Time in seconds.",def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Emits 1 if <b>time</b> % 1 is less than 0.5 and -1 otherwise.",def:0}]},E2.p.prototype.reset=function(){this.time=0,this.result=0},E2.p.prototype.update_input=function(t,e){this.time=e},E2.p.prototype.update_state=function(){this.result=this.time%1<.5?1:-1},E2.p.prototype.update_output=function(){return this.result};
;
!function(){var e=E2.plugins.stereo_cube_map=function(e){Plugin.apply(this,arguments),this.desc="Stereo Cube Map",this.input_slots=[{name:"url",dt:e.datatypes.TEXT,def:""}],this.output_slots=[{name:"cube",dt:e.datatypes.OBJECT3D,array:!0}];var t=E2.core.assetLoader.loadingTexture.image,r=new THREE.CubeTexture([t,t,t,t,t,t]);r.needsUpdate=!0;var a=THREE.ShaderLib.cube;a.uniforms.tCube.value=r;var i=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:a.uniforms,depthWrite:!1,side:THREE.BackSide});this.defaultObj=new THREE.Mesh(new THREE.BoxGeometry(50,50,50),i),this.leftChannel=1,this.rightChannel=2};e.prototype=Object.create(Plugin.prototype),e.prototype.loadTextures=function(){var e=[];if(this.url){var t=new THREE.ImageLoader(THREE.DefaultLoadingManager);t.setCrossOrigin("");var r=this;t.load(this.url,function(t){for(var a=t.width,i=t.height,n=12,u=a/n,d=i,s=0;n>s;++s){var o=document.createElement("canvas");o.width=u,o.height=d;var h=o.getContext("2d");h.drawImage(t,s*u,0,u,d,0,0,u,d),e.push(o)}var l=new THREE.CubeTexture(e.splice(0,6));l.needsUpdate=!0;var p=THREE.ShaderLib.cube,E={tCube:{type:"t",value:l},tFlip:{type:"f",value:1}},f=new THREE.ShaderMaterial({fragmentShader:p.fragmentShader,vertexShader:p.vertexShader,uniforms:E,depthWrite:!1,side:THREE.DoubleSide});r.leftObj=new THREE.Mesh(new THREE.BoxGeometry(50,50,50),f),r.leftObj.layers.set(r.leftChannel);var T=new THREE.CubeTexture(e.splice(0,6));T.needsUpdate=!0;var g={tCube:{type:"t",value:T},tFlip:{type:"f",value:1}},v=new THREE.ShaderMaterial({fragmentShader:p.fragmentShader,vertexShader:p.vertexShader,uniforms:g,depthWrite:!1,side:THREE.DoubleSide});r.rightObj=new THREE.Mesh(new THREE.BoxGeometry(50,50,50),v),r.rightObj.layers.set(r.rightChannel),r.updated=!0},void 0,function(e){console.log("failed to load "+r.url,e)})}},e.prototype.reset=function(){},e.prototype.update_input=function(e,t){"url"===e.name&&this.url!==t&&(delete this.leftObj,delete this.rightObj,this.url=t,this.loadTextures())},e.prototype.update_output=function(){return void 0===this.leftObj?[this.defaultObj]:[this.leftObj,this.rightObj]},e.prototype.state_changed=function(e){e||this.loadTextures()}}();
;
E2.p=E2.plugins.stop_emitter=function(t){this.desc="Stops graph playback when a true value is received by the <b>bool</b> slot.",this.input_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"When true is received by this slot, graph playback is stopped."}],this.output_slots=[],this.core=t,this.stop_seq=!1},E2.p.prototype.reset=function(){this.stop_seq=!1},E2.p.prototype.update_input=function(t,s){this.stop_seq=s},E2.p.prototype.update_state=function(){this.stop_seq&&(E2.app.onStopClicked?E2.app.onStopClicked():this.core.player.schedule_stop(),this.stop_seq=!1)};
;
E2.p=E2.plugins.string_concatenate_modulator=function(t){this.desc="Concatenates the two supplied strings.",this.input_slots=[{name:"a",dt:t.datatypes.TEXT,desc:"The first string.",def:""},{name:"b",dt:t.datatypes.TEXT,desc:"The second string.",def:""}],this.output_slots=[{name:"result",dt:t.datatypes.TEXT,desc:"The string representing the combination of <b>first</b> + <b>second</b>."}]},E2.p.prototype.reset=function(){this.text_a="",this.text_b="",this.output_val=""},E2.p.prototype.update_input=function(t,e){0===t.index?this.text_a=""+e:this.text_b=""+e},E2.p.prototype.update_state=function(){this.output_val=this.text_a+this.text_b},E2.p.prototype.update_output=function(){return this.output_val};
;
E2.p=E2.plugins.subtract_modulator=function(t){this.desc="Subtract the second value from the first and emit the result.",this.input_slots=[{name:"a",dt:t.datatypes.FLOAT,desc:"The first operand.",def:0},{name:"b",dt:t.datatypes.FLOAT,desc:"The second operand.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"The result of <b>first</b> - <b>second</b>.",def:0}]},E2.p.prototype.reset=function(){this.input_val=0,this.sub_val=0,this.output_val=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.input_val=e:this.sub_val=e},E2.p.prototype.update_state=function(){this.output_val=this.input_val-this.sub_val},E2.p.prototype.update_output=function(){return this.output_val};
;
!function(){var t=E2.plugins.switch_modulator=function(t,e){var n=this;this.desc="Given an <b>index</b>, emit the supplied <b>true</b> value on the output slot matching the index and the <b>false</b> value on all others. If the index is invalid, the <b>false</b> value is emitted on all outputs.",this.input_slots=[{name:"index",dt:t.datatypes.FLOAT,desc:"The selected index.",def:-1},{name:"true",dt:t.datatypes.ANY,desc:"The value to emit on the output slot matching the current index.",def:null},{name:"false",dt:t.datatypes.ANY,desc:"The value to emit on any slot not matching the current index",def:null}],this.output_slots=[],this.state={},this.core=t,this.node=e,this.lsg=new LinkedSlotGroup(t,e,[this.input_slots[1],this.input_slots[2]],[]),this.true_value=null,this.false_value=null,this.node.on("slotAdded",function(){n.updated=!0}),this.node.on("slotRemoved",function(){n.updated=!0})};t.prototype.create_ui=function(){var t=this,e=make("div"),n=makeButton("Remove","Click to remove the last output."),i=makeButton("Add","Click to add another output.");return n.css("width","65px"),i.css({width:"65px","margin-top":"5px"}),i.click(function(){E2.app.graphApi.addSlot(t.node.parent_graph,t.node,{type:E2.slot_type.output,name:t.dynOutputs.length+"",dt:t.core.datatypes.OBJECT})}),n.click(function(){var e=t.dynOutputs;if(e){var n=e[e.length-1].uid;E2.app.graphApi.removeSlot(t.node.parent_graph,t.node,n)}}),e.append(n,"<br />",i),e},t.prototype.reset=function(){this.index=-1},t.prototype.connection_changed=function(t,e,n){this.lsg.connection_changed(t,e,n)&&(this.true_value=this.false_value=this.lsg.core.get_default_value(this.lsg.dt))},t.prototype.update_input=function(t,e){0===t.index?this.index=Math.floor(e):1===t.index?this.true_value=e:this.false_value=e},t.prototype.update_output=function(t){return t.index===this.index?this.true_value:this.false_value},t.prototype.state_changed=function(t){if(!t){for(var e=this.dynOutputs=this.node.getDynamicOutputSlots(),n=0,i=e.length;i>n;n++)this.lsg.add_dyn_slot(this.node.find_dynamic_slot(E2.slot_type.output,e[n].uid));this.index=-1,this.true_value=this.false_value=this.lsg.infer_dt()}}}();
;
E2.p=E2.plugins.tan_modulator=function(t){this.desc="Tan(x).",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"tan(<b>value</b>).",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){this.value=Math.tan(e)},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.text_display=function(t){this.desc="Display the supplied text value on the plugin surface.",this.input_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"Input text to be displayed.",def:""}],this.output_slots=[]},E2.p.prototype.reset=function(){this.update_value(null)},E2.p.prototype.create_ui=function(){return this.label=make("div"),this.label},E2.p.prototype.connection_changed=function(t){t||this.update_value("")},E2.p.prototype.update_input=function(t,e){this.update_value(e)},E2.p.prototype.update_value=function(t){this.label&&(this.label[0].innerHTML=t)};
;
!function(){var t=E2.plugins.text_editor_generator=function(t){Plugin.apply(this,arguments),this.desc="Edit a block of text.",this.input_slots=[],this.output_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"The currently entered text.",def:"Empty string"}],this.state={text:"{\n\n}"},this.core=t};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){this.updated=!0},t.prototype.open_editor=function(t){return function(){var e=make("span"),o=$('<pre id="editor"></pre>');e.css({margin:"0px",padding:"2px"}),o.css({margin:"0px",padding:"0px","margin-top":"2px",border:"1px solid #bbb",width:"755px",height:"400px",resize:"none","font-size":"12px","font-family":"Monospace",scroll:"none"}),e.append(o);var n=ace.edit(o[0]);n.setTheme("ace/theme/chrome"),n.getSession().setUseWrapMode(!1),n.setBehavioursEnabled(!1),n.setShowPrintMargin(!1),n.getSession().setMode("ace/mode/json"),n.setValue(t.state.text),n.gotoLine(2),n.session.selection.clearSelection();var i=function(e){return function(o){return o&&"ace_text-input"===o.target.className?!1:void t.undoableSetState("text",e.getValue(),t.state.text)}};t.core.create_dialog(e,"Editor",760,150,i(n,e))}},t.prototype.create_ui=function(){var t=makeButton("Open","Click to edit the contents.");return t.css("width","55px"),t.click(this.open_editor(this)),t},t.prototype.update_output=function(){return this.state.text},t.prototype.state_changed=function(t){t||this.core.add_aux_script("ace/ace.js")}}();
;
E2.p=E2.plugins.texture_from_text_generator=function(t){this.desc="Create a texture of a (2^n closest to the) given size filled with a rendered version of the supplied text.",this.input_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"The text to be rendered to <b>texture</b>.",def:"Lorem ipsum\nDOLOR SIT AMET"},{name:"width",dt:t.datatypes.FLOAT,desc:"The width of the output <b>texture</b>. Will be rounded to nearest 2^n.",lo:2,hi:1024,def:128},{name:"height",dt:t.datatypes.FLOAT,desc:"The height of the output <b>texture</b>. Will be rounded to nearest 2^n.",lo:2,hi:1024,def:128},{name:"x",dt:t.datatypes.FLOAT,desc:"The x position of the text.",def:10},{name:"y",dt:t.datatypes.FLOAT,desc:"The y position of the text.",def:10},{name:"font style",dt:t.datatypes.TEXT,desc:"The desired font style (CSS standard).",def:"bold 16px arial"},{name:"fill style",dt:t.datatypes.TEXT,desc:"The desired fill style (CSS standard).",def:"#fff"},{name:"stroke style",dt:t.datatypes.TEXT,desc:"The desired stroke style (CSS standard).",def:"none"},{name:"stroke width",dt:t.datatypes.FLOAT,desc:"The desired stroke width in pixels.",def:0},{name:"align",dt:t.datatypes.TEXT,desc:"Text alignment.",def:"center"},{name:"baseline",dt:t.datatypes.TEXT,desc:"Text baseline.",def:"middle"},{name:"line height",dt:t.datatypes.FLOAT,desc:"Line height scalar.",def:1.2}],this.output_slots=[{name:"texture",dt:t.datatypes.TEXTURE,desc:"Output texture containing the rendered text."}],this.mesh=null,this.canvas2d=$('<canvas style="display:none" width="128" height="128"></canvas>')[0],this.context=this.canvas2d.getContext("2d")},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.sanitize_size=function(t){var e=Math.log(t)/Math.log(2),i=Math.floor(e);return 1>i?i=1:i>10&&(i=10),Math.pow(2,i)},E2.p.prototype.update_input=function(t,e){0===t.index?this.text=e:1===t.index?this.width=this.sanitize_size(e):2===t.index?this.height=this.sanitize_size(e):3===t.index?this.x=e:4===t.index?this.y=e:5===t.index?this.font_style=e:6===t.index?this.fill_style=e:7===t.index?this.stroke_style=e:8===t.index?this.stroke_width=e:9===t.index?this.align=e:10===t.index?this.baseline=e:11===t.index&&(this.line_height=e)},E2.p.prototype.update_state=function(){var t=this.text.split("\n"),e=this.canvas2d,i=this.context;e.width=this.width,e.height=this.height,i.clearRect(0,0,this.width,this.height),i.fillStyle=this.fill_style,i.lineWidth=this.stroke_width,i.strokeStyle=this.stroke_style,i.font=this.font_style,i.textAlign=this.align,i.textBaseline=this.baseline;for(var s=i.measureText("M").width*this.line_height,d=0,h=t.length;h>d;d++){var n=this.y+d*s,a=t[d];i.strokeText(a,this.x,n),i.fillText(a,this.x,n)}this.texture.needsUpdate=!0},E2.p.prototype.update_output=function(){return this.texture},E2.p.prototype.state_changed=function(t){t||(this.texture=new THREE.Texture(this.canvas2d),this.text="",this.width=128,this.height=128,this.x=10,this.y=10,this.font_style="bold 16px arial",this.fill_style="#fff",this.stroke_style="none",this.stroke_width=0,this.align="center",this.baseline="middle",this.line_height=1.2)};
;
E2.p=E2.plugins.texture_height_modulator=function(t){this.desc="Emits the supplied texture height.",this.input_slots=[{name:"texture",dt:t.datatypes.TEXTURE,desc:"The texture to emit the height of.",def:null}],this.output_slots=[{name:"height",dt:t.datatypes.FLOAT,desc:"The supplied texture height."}],this.height=0},E2.p.prototype.reset=function(){this.height=0},E2.p.prototype.update_input=function(t,e){this.height=e?parseInt(e.height,10):0},E2.p.prototype.update_output=function(){return this.height};
;
E2.p=E2.plugins.texture_width_modulator=function(t){this.desc="Emits the supplied texture width.",this.input_slots=[{name:"texture",dt:t.datatypes.TEXTURE,desc:"The texture to emit the width of.",def:null}],this.output_slots=[{name:"width",dt:t.datatypes.FLOAT,desc:"The supplied texture width."}],this.width=0},E2.p.prototype.reset=function(){this.width=0},E2.p.prototype.update_input=function(t,e){this.width=e?parseInt(e.width,10):0},E2.p.prototype.update_output=function(){return this.width};
;
!function(){var t=E2.plugins.three_ambient_light=function(t){ThreeObject3DPlugin.apply(this,arguments),this.input_slots=[{name:"color",dt:t.datatypes.COLOR}],this.desc="THREE.js Ambient Light"};t.prototype=Object.create(ThreeObject3DPlugin.prototype),t.prototype.reset=function(){ThreeObject3DPlugin.prototype.reset.apply(this),this.object3d=new THREE.AmbientLight(7829367),this.object3d.backReference=this},t.prototype.update_input=function(t,e){this.object3d&&(this.object3d.color=e)}}();
;
!function(){var t=E2.plugins.three_clickable_object=function(t){this.desc="Clickable object. When gaze clicking on this object, 'objectClicked' events are sent. objectClicked events can be received by using the 'On Runtime Event' plugin.",Plugin.apply(this,arguments),this.input_slots=[{name:"object3d",dt:t.datatypes.OBJECT3D},{name:"eventName",dt:t.datatypes.TEXT,def:"objectClicked"}],this.output_slots=[{name:"object3d",dt:t.datatypes.OBJECT3D}],this.eventName="objectClicked"};t.prototype.reset=function(){this.meshDirty=!1},t.prototype.update_input=function(t,e){switch(t.index){case 0:this.object3d=e,this.meshDirty=!0;break;case 1:this.eventName=e}},t.prototype.update_output=function(){return this.object3d},t.prototype.on_click=function(){E2.core.runtimeEvents.emit(this.eventName,this.object3d)},t.prototype.update_state=function(){if(this.meshDirty){if(this.object3d&&!this.object3d.clickable){var t=this.on_click.bind(this);this.object3d.clickable=!0,this.object3d.onClick=t}this.meshDirty=!1}}}();
;
!function(){var e=E2.plugins.three_cube_material=function(e){AbstractThreeMaterialPlugin.apply(this,arguments),this.desc="Cube Shader Material. ";var t=E2.core.assetLoader.loadingTexture.image,a=new THREE.CubeTexture([t,t,t,t,t,t]);a.needsUpdate=!0,this.input_slots=[{name:"cube texture",dt:e.datatypes.CUBETEXTURE,desc:"Cube Texture",def:a},{name:"depthWrite",dt:e.datatypes.BOOL,desc:"enable / disable writing to the depth buffer",def:!1}].concat(this.input_slots);for(var r=0;r<this.input_slots.length;++r)"side"===this.input_slots[r].name&&(this.input_slots[r].def=2);this.output_slots=[{name:"material",dt:e.datatypes.MATERIAL,desc:"Cube Shader Material"}];var i={tCube:{type:"t",value:a},tFlip:{type:"f",value:1}},s=THREE.ShaderLib.cube;this.material=new THREE.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:i,depthWrite:!1,side:THREE.DoubleSide})};e.prototype=Object.create(AbstractThreeMaterialPlugin.prototype),e.prototype.update_input=function(e,t){"cube texture"===e.name?(this.material.uniforms.tCube.value=t,this.material.needsUpdate=!0):AbstractThreeMaterialPlugin.prototype.update_input.apply(this,arguments)}}();
;
!function(){var t=E2.plugins.three_directional_light=function(t){ThreeObject3DPlugin.apply(this,arguments),this.desc="THREE.js Directional Light",this.params={color:new THREE.Color(16777215),intensity:1},this.input_slots=[{name:"intensity",dt:t.datatypes.FLOAT,def:this.params.intensity},{name:"color",dt:t.datatypes.COLOR,def:this.params.color}].concat(this.input_slots)};t.prototype=Object.create(ThreeObject3DPlugin.prototype),t.prototype.reset=function(){ThreeObject3DPlugin.prototype.reset.apply(this,arguments),this.object3d=new THREE.DirectionalLight(16777215,this.params.intensity),this.object3d.backReference=this}}();
;
!function(){var t=E2.plugins.three_environment_settings=function(t){Plugin.apply(this,arguments),this.desc="Environment Settings Description",this.input_slots=[{name:"fog color",dt:t.datatypes.COLOR,def:new THREE.Color(16777215)},{name:"fog near",dt:t.datatypes.FLOAT,def:.1},{name:"fog far",dt:t.datatypes.FLOAT,def:1e3}],this.output_slots=[{name:"environment",dt:t.datatypes.ENVIRONMENTSETTINGS}]};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){this.envSettings=new E2.EnvironmentSettings},t.prototype.update_input=function(t,e){"fog color"===t.name?this.envSettings.fog.color=e:"fog near"===t.name?this.envSettings.fog.near=e:"fog far"===t.name&&(this.envSettings.fog.far=e)},t.prototype.update_output=function(){return this.envSettings}}();
;
!function(){var e=E2.plugins.three_gaze_clicker=function(e){this.desc="Gaze Clicker",Plugin.apply(this,arguments),this.core=e,this.iconDistance=.02914,this.input_slots=[{name:"camera",dt:e.datatypes.CAMERA},{name:"scene",dt:e.datatypes.SCENE},{name:"delay",dt:e.datatypes.FLOAT,def:1},{name:"show icon",dt:e.datatypes.BOOL,def:!0},{name:"eye distance",dt:e.datatypes.FLOAT,def:this.iconDistance,desc:"Eye Distance for Gaze Clicker icon in VR"}],this.output_slots=[{name:"scene",dt:e.datatypes.SCENE},{name:"object",dt:e.datatypes.OBJECT3D}],this.always_update=!0,this.clickDelay=1,this.showIcon=!0};e.prototype=Object.create(Plugin.prototype),e.prototype.reset=function(){this.clickFactor=0,this.clickTime=0},e.prototype.update_input=function(e,t){switch(e.index){case 0:this.camera=t;break;case 1:this.scene=t;break;case 2:this.clickDelay=t;break;case 3:this.showIcon=t}"eye distance"===e.name&&(this.iconDistance=t,this.scene.children[1].children.indexOf(this.object3d)>=0&&this.scene.children[1].remove(this.object3d),this.object3d=void 0)},e.prototype.update_output=function(e){return 0===e.index?this.scene:1===e.index?this.lastObj:void 0},e.prototype.state_changed=function(e){},e.prototype.GeometryGenerator=function(e){this.type="Gaze Aim",this.segments=16,this.radialMarkers=[0,.3,.8,1];var t=this;this.initialise=function(){THREE.Geometry.call(t),t.dynamic=!0;var e,i,s;for(s=-1;2>s;s++)for(i=0;i<t.segments+1;i++)for(e=0;e<t.radialMarkers.length;e++)t.vertices.push(new THREE.Vector3);var a=new THREE.Vector3(0,0,1);for(s=-1;2>s;s++){var r=(s+1)*(t.segments+1)*t.radialMarkers.length;for(i=0;i<t.segments;i++)for(e=0;e<t.radialMarkers.length;e+=2){var c=r+i*t.radialMarkers.length+e,n=r+i*t.radialMarkers.length+e+1,h=r+(i+1)*t.radialMarkers.length+e,o=r+(i+1)*t.radialMarkers.length+e+1;t.faces.push(new THREE.Face3(c,n,h,a)),t.faces.push(new THREE.Face3(n,o,h,a)),t.faces.push(new THREE.Face3(c,h,n,a)),t.faces.push(new THREE.Face3(n,h,o,a))}}},this.initialise(),this.update=function(i,s){var a=0,r=this.radialMarkers.slice(0);r[2]=s>=1?this.radialMarkers[2]+(this.radialMarkers[1]-this.radialMarkers[2])*i:this.radialMarkers[1]+(this.radialMarkers[3]-this.radialMarkers[1])*(1-s);var c,n,h,o=-.01,l=8e-4;for(h=-1;2>h;h++){var d=e.iconDistance*h;for(n=0;n<t.segments+1;n++)for(c=0;c<r.length;c++){var p=n/t.segments;c>1&&(p=Math.min(p,i)),p*=6.28318;var m=Math.sin(p),u=Math.cos(p),y=r[c];t.vertices[a].set(m*y*l+d,u*y*l,o),a++}}t.verticesNeedUpdate=!0}},e.prototype.GeometryGenerator.prototype=Object.create(THREE.Geometry.prototype),e.prototype.GeometryGenerator.prototype.constructor=e.prototype.GeometryGenerator,e.prototype.get_mesh=function(){return this.object3d||(this.geometry=new this.GeometryGenerator(this),this.material=new THREE.MeshBasicMaterial({color:16777215}),this.object3d=new THREE.Mesh(this.geometry,this.material),this.object3d.matrixAutoUpdate=!1),this.object3d},e.prototype.update_click=function(){this.raycaster||(this.raycaster=new THREE.Raycaster),this.camera.updateMatrixWorld(),this.raycaster.setFromCamera(new THREE.Vector3(0,0,0),this.camera);var e=this.raycaster.intersectObjects(this.scene.children[0].children,!0),t=!1;if(e.length>0){for(var i=e[0].object;i&&!i.gazeClickerCount&&(!i.backReference||i.backReference.object3d!==i);)i=i.parent;i&&i.gazeClickerCount&&(i!==this.lastObj&&(this.objTimer=this.core.abs_t,this.lastObj=i,E2.core.runtimeEvents.emit("gazeIn:"+this.lastObj.uuid)),t=!0)}if(t||(this.lastObj&&E2.core.runtimeEvents.emit("gazeOut:"+this.lastObj.uuid),this.lastObj=void 0,this.objTimer=void 0),this.lastObj){this.clickTime=this.core.abs_t-this.objTimer;var s=Math.min(this.clickTime,this.clickDelay)/this.clickDelay;this.clickFactor<1&&s>=1&&(this.lastObj.onClick&&this.lastObj.onClick(),E2.core.runtimeEvents.emit("gazeClicked:"+this.lastObj.uuid)),this.clickFactor=s}else this.clickFactor=0,this.clickTime=0},e.prototype.update_state=function(){if(this.scene&&this.camera){this.update_click();var e=this.get_mesh();e.matrix.copy(this.camera.matrixWorld),this.scene.hasClickableObjects&&this.showIcon!==!1?(this.geometry.update(this.clickFactor,Math.max(1-10*Math.max(0,this.clickTime-this.clickDelay),0)),this.scene.children[1].children.indexOf(e)<0&&this.scene.children[1].add(e)):this.scene.children[1].children.indexOf(e)>=0&&this.scene.children[1].remove(e)}}}();
;
!function(){var t=E2.plugins.three_geometry_box=function(t){this.desc="THREE.js Box Geometry",this.input_slots=[{name:"subdivisions",dt:t.datatypes.FLOAT,def:1,validate:function(t){return Math.max(0,Math.min(t,50))}}],this.output_slots=[{name:"geometry",dt:t.datatypes.GEOMETRY}],this.subdivisions=1};t.prototype.reset=function(){this.geometry=(new THREE.BufferGeometry).fromGeometry(new THREE.BoxGeometry(1,1,1,this.subdivisions,this.subdivisions,this.subdivisions))},t.prototype.update_input=function(t,i){this.subdivisions!==i&&(this.subdivisions=i,this.geometry=(new THREE.BufferGeometry).fromGeometry(new THREE.BoxGeometry(1,1,1,this.subdivisions,this.subdivisions,this.subdivisions)))},t.prototype.update_output=function(){return this.geometry}}();
;
!function(){var t=E2.plugins.three_geometry_circle=function(t){this.desc="THREE.js Circle Geometry",this.input_slots=[{name:"radius",dt:t.datatypes.FLOAT,def:5},{name:"segments",dt:t.datatypes.FLOAT,def:8,validate:function(t){return Math.max(0,Math.min(t,100))}},{name:"thetaStart",dt:t.datatypes.FLOAT,def:0,desc:"Vertical starting angle"},{name:"thetaLength",dt:t.datatypes.FLOAT,def:2*Math.PI,desc:"Vertical sweep angle size"}],this.output_slots=[{name:"geometry",dt:t.datatypes.GEOMETRY}]};t.prototype.reset=function(){Plugin.prototype.reset.call(this),this.geometry=this.createGeometry()},t.prototype.createGeometry=function(){var t=new THREE.CircleGeometry(this.inputValues.radius,this.inputValues.segments,this.inputValues.thetaStart,this.inputValues.thetaLength);return(new THREE.BufferGeometry).fromGeometry(t)},t.prototype.update_input=function(){Plugin.prototype.update_input.apply(this,arguments),this.geometry=this.createGeometry()},t.prototype.update_output=function(){return this.geometry}}();
;
!function(){var t=E2.plugins.three_geometry_cylinder=function(t){this.desc="THREE.js Cylinder Geometry",this.input_slots=[{name:"radiusTop",dt:t.datatypes.FLOAT,def:20},{name:"radiusBottom",dt:t.datatypes.FLOAT,def:20},{name:"height",dt:t.datatypes.FLOAT,def:100},{name:"radiusSegments",dt:t.datatypes.FLOAT,def:8,validate:function(t){return Math.max(0,Math.min(t,50))}},{name:"heightSegments",dt:t.datatypes.FLOAT,def:1,validate:function(t){return Math.max(0,Math.min(t,25))}},{name:"openEnded",dt:t.datatypes.BOOL,def:!1},{name:"thetaStart",dt:t.datatypes.FLOAT,def:0,desc:"Vertical starting angle"},{name:"thetaLength",dt:t.datatypes.FLOAT,def:2*Math.PI,desc:"Vertical sweep angle size"}],this.output_slots=[{name:"geometry",dt:t.datatypes.GEOMETRY}]};t.prototype.reset=function(){Plugin.prototype.reset.call(this),this.geometry=this.createGeometry()},t.prototype.createGeometry=function(){var t=new THREE.CylinderGeometry(this.inputValues.radiusTop,this.inputValues.radiusBottom,this.inputValues.height,Math.floor(this.inputValues.radiusSegments),Math.floor(this.inputValues.heightSegments),this.inputValues.openEnded,this.inputValues.thetaStart,this.inputValues.thetaLength);return(new THREE.BufferGeometry).fromGeometry(t)},t.prototype.update_input=function(){Plugin.prototype.update_input.apply(this,arguments),this.geometry=this.createGeometry()},t.prototype.update_output=function(){return this.geometry}}();
;
!function(){var t=E2.plugins.three_geometry_dodecahedron=function(t){this.desc="THREE.js Dodecahedron Geometry",this.input_slots=[{name:"radius",dt:t.datatypes.FLOAT,def:5},{name:"detail",dt:t.datatypes.FLOAT,def:2,validate:function(t){return Math.max(0,Math.min(t,4))}}],this.output_slots=[{name:"geometry",dt:t.datatypes.GEOMETRY}]};t.prototype.reset=function(){Plugin.prototype.reset.call(this),this.geometry=this.createGeometry()},t.prototype.createGeometry=function(){var t=new THREE.DodecahedronGeometry(this.inputValues.radius,Math.floor(this.inputValues.detail));return(new THREE.BufferGeometry).fromGeometry(t)},t.prototype.update_input=function(){Plugin.prototype.update_input.apply(this,arguments),this.geometry=this.createGeometry()},t.prototype.update_output=function(){return this.geometry}}();
;
!function(){var t=E2.plugins.three_geometry_plane=function(t){this.desc="THREE.js Plane Geometry",this.input_slots=[{name:"width",dt:t.datatypes.FLOAT,def:5},{name:"height",dt:t.datatypes.FLOAT,def:5},{name:"widthSegments",dt:t.datatypes.FLOAT,def:1,desc:"Number of horizontal segments",validate:function(t){return Math.max(0,Math.min(t,50))}},{name:"heightSegments",dt:t.datatypes.FLOAT,def:1,desc:"Number of vertical segments",validate:function(t){return Math.max(0,Math.min(t,50))}}],this.output_slots=[{name:"geometry",dt:t.datatypes.GEOMETRY}]};t.prototype.reset=function(){Plugin.prototype.reset.call(this),this.geometry=this.createGeometry()},t.prototype.createGeometry=function(){var t=new THREE.PlaneGeometry(this.inputValues.width,this.inputValues.height,Math.floor(this.inputValues.widthSegments),Math.floor(this.inputValues.heightSegments));return(new THREE.BufferGeometry).fromGeometry(t)},t.prototype.update_input=function(){Plugin.prototype.update_input.apply(this,arguments),this.geometry=this.createGeometry()},t.prototype.update_output=function(){return this.geometry}}();
;
!function(){var t=E2.plugins.three_geometry_ring=function(t){Plugin.apply(this,arguments),this.desc="THREE.js Ring Geometry",this.input_slots=[{name:"innerRadius",dt:t.datatypes.FLOAT,def:0},{name:"outerRadius",dt:t.datatypes.FLOAT,def:1},{name:"thetaSegments",dt:t.datatypes.FLOAT,def:8},{name:"phiSegments",dt:t.datatypes.FLOAT,def:8},{name:"thetaStart",dt:t.datatypes.FLOAT,def:0},{name:"thetaLength",dt:t.datatypes.FLOAT,def:2*Math.PI}],this.output_slots=[{name:"geometry",dt:t.datatypes.GEOMETRY}],this.subdivisions=1,this.geometryDirty=!0};t.prototype=Object.create(Plugin.prototype),t.prototype.generateGeometry=function(){this.geometry=(new THREE.BufferGeometry).fromGeometry(new THREE.RingGeometry(this.inputValues.innerRadius,this.inputValues.outerRadius,this.inputValues.thetaSegments,this.inputValues.phiSegments,this.inputValues.thetaStart,this.inputValues.thetaLength)),this.geometryDirty=!1},t.prototype.update_input=function(t,e){this.inputValues[t.name]!==e&&(this.geometryDirty=!0),Plugin.prototype.update_input.apply(this,arguments)},t.prototype.update_state=function(){this.geometryDirty&&this.generateGeometry()},t.prototype.update_output=function(){return this.geometry}}();
;
!function(){var t=E2.plugins.three_geometry_sphere=function(t){this.desc="THREE.js Sphere Geometry",this.input_slots=[{name:"radius",dt:t.datatypes.FLOAT,def:1},{name:"widthSegments",dt:t.datatypes.FLOAT,def:8,desc:"Number of horizontal segments",validate:function(t){return Math.max(0,Math.min(t,50))}},{name:"heightSegments",dt:t.datatypes.FLOAT,def:6,desc:"Number of vertical segments",validate:function(t){return Math.max(0,Math.min(t,50))}},{name:"phiStart",dt:t.datatypes.FLOAT,def:0,desc:"Horizontal starting angle"},{name:"phiLength",dt:t.datatypes.FLOAT,def:2*Math.PI,desc:"Horizontal sweep angle size"},{name:"thetaStart",dt:t.datatypes.FLOAT,def:0,desc:"Vertical starting angle"},{name:"thetaLength",dt:t.datatypes.FLOAT,def:Math.PI,desc:"Vertical sweep angle size"}],this.output_slots=[{name:"geometry",dt:t.datatypes.GEOMETRY}]};t.prototype.reset=function(){Plugin.prototype.reset.call(this),this.geometry=this.createGeometry()},t.prototype.createGeometry=function(){return new THREE.SphereBufferGeometry(this.inputValues.radius,Math.floor(this.inputValues.widthSegments),Math.floor(this.inputValues.heightSegments),this.inputValues.phiStart,this.inputValues.phiLength,this.inputValues.thetaStart,this.inputValues.thetaLength)},t.prototype.update_input=function(){Plugin.prototype.update_input.apply(this,arguments),this.geometry=this.createGeometry()},t.prototype.update_output=function(){return this.geometry}}();
;
!function(){var t=E2.plugins.three_geometry_torus=function(t){Plugin.apply(this,arguments),this.desc="THREE.js Torus Geometry",this.input_slots=[{name:"radius",dt:t.datatypes.FLOAT,def:1},{name:"tube",dt:t.datatypes.FLOAT,def:.4},{name:"radialSegments",dt:t.datatypes.FLOAT,def:8},{name:"tubularSegments",dt:t.datatypes.FLOAT,def:6},{name:"arc",dt:t.datatypes.FLOAT,def:2*Math.PI}],this.output_slots=[{name:"geometry",dt:t.datatypes.GEOMETRY}],this.subdivisions=1,this.geometryDirty=!0};t.prototype=Object.create(Plugin.prototype),t.prototype.generateGeometry=function(){this.geometry=(new THREE.BufferGeometry).fromGeometry(new THREE.TorusGeometry(this.inputValues.radius,this.inputValues.tube,Math.floor(this.inputValues.radialSegments),Math.floor(this.inputValues.tubularSegments),this.inputValues.arc)),this.geometryDirty=!1},t.prototype.update_input=function(t,e){this.inputValues[t.name]!==e&&(this.geometryDirty=!0),Plugin.prototype.update_input.apply(this,arguments)},t.prototype.update_state=function(){this.geometryDirty&&this.generateGeometry()},t.prototype.update_output=function(){return this.geometry}}();
;
!function(){var t=E2.plugins.three_group=function(t,e){ThreeObject3DPlugin.apply(this,arguments),this.node=e,this.desc="Group several object3ds together so that they can be manipulated as one",this.input_slots=[].concat(this.input_slots),this.lsg=new AutoSlotGroup(t,e,[],[]),this.lsg.set_dt(t.datatypes.OBJECT3D);var n=this;this.node.on("slotAdded",function(){n.dynInputs=e.getDynamicInputSlots(),n.updated=!0}),this.node.on("slotRemoved",function(){n.dynInputs=e.getDynamicInputSlots(),n.updated=!0}),this.object3d=new THREE.Group,this.object3d.name="group_plugin",this.object3d.backReference=this,this.lastCenter=new THREE.Vector3};t.prototype=Object.create(ThreeObject3DPlugin.prototype),t.prototype.update_input=function(t,e){if(t.dynamic){var n=this.object3d.children[t.index];if(e)if(t.array){n.children=e;for(var i=0;i<e.length;++i)e[i].parent&&e[i].parent!==n&&e[i].parent.remove(e[i]),e[i].parent=n,e[i].dispatchEvent({type:"added"})}else e.parent&&e.parent!==this&&e.parent.remove(e),n.children=[e],e.parent=n,e.dispatchEvent({type:"added"});else for(;n.children.length>0;)n.remove(n.children[0]);this.pivotNeedsUpdate=!0}else ThreeObject3DPlugin.prototype.update_input.apply(this,arguments)},t.prototype.update_state=function(){this.pivotNeedsUpdate&&this.updatePivot(),ThreeObject3DPlugin.prototype.update_state.apply(this,arguments)},t.prototype.connection_changed=function(t,e,n){if(t&&n.dynamic)for(;this.object3d.children.length<this.dynInputs.length;)this.object3d.add(new THREE.Group);if(!t&&n.type===E2.slot_type.input&&n.dynamic)for(var i=this.object3d.children[n.index];i.children.length>0;)i.remove(i.children[0]);else t&&n.type===E2.slot_type.input&&n.dynamic&&(this.object3d.children[n.index].children=[]);this.pivotNeedsUpdate=!0},t.prototype.state_changed=function(t){if(!t){this.dynInputs=this.node.getDynamicInputSlots(),this.dynInputs.length||(this.node.add_slot(E2.slot_type.input,{name:"0",dt:E2.dt.OBJECT3D,array:!1}),this.dynInputs=this.node.getDynamicInputSlots());for(var e=0,n=this.dynInputs.length;n>e;e++)this.lsg.add_dyn_slot(this.dynInputs[e]),this.object3d.add(new THREE.Group);this.lsg.infer_dt()}},t.prototype.updatePivot=function(){for(var t=new THREE.Vector3,e=0,n=0;n<this.object3d.children.length;++n)for(var i=this.object3d.children[n],o=0;o<i.children.length;++o){var s=i.children[o];s.backReference&&(t.x+=s.backReference.state.position.x,t.y+=s.backReference.state.position.y,t.z+=s.backReference.state.position.z,++e)}e>1&&t.divideScalar(e);var d=new THREE.Quaternion(this.object3d.quaternion._x,this.object3d.quaternion._y,this.object3d.quaternion._z,this.object3d.quaternion._w),a=new THREE.Vector3(this.object3d.scale.x,this.object3d.scale.y,this.object3d.scale.z),r=(new THREE.Matrix4).makeRotationFromQuaternion(d).scale(a),p=t.clone().sub(this.lastCenter).applyMatrix4(r);this.pivot.x+=p.x,this.pivot.y+=p.y,this.pivot.z+=p.z;for(var h=0,o=0;o<this.object3d.children.length;++o){var c=this.object3d.children[o];c.position.x=-t.x,c.position.y=-t.y,c.position.z=-t.z,c.gazeClickerCount&&(h+=c.gazeClickerCount)}this.object3d.gazeClickerCount=h,this.matrixWorldNeedsUpdate=!0,this.lastCenter.copy(t),this.pivotNeedsUpdate=!1}}();
;
!function(){var t=E2.plugins.three_hemisphere_light=function(t){ThreeObject3DPlugin.apply(this,arguments),this.desc="THREE.js Hemisphere Light",this.params={skyColor:new THREE.Color(16777215),groundColor:new THREE.Color(6836032),intensity:1},this.input_slots=[{name:"intensity",dt:t.datatypes.FLOAT,def:this.params.intensity},{name:"color",dt:t.datatypes.COLOR,def:this.params.skyColor},{name:"groundColor",dt:t.datatypes.COLOR,def:this.params.groundColor}].concat(this.input_slots)};t.prototype=Object.create(ThreeObject3DPlugin.prototype),t.prototype.reset=function(){ThreeObject3DPlugin.prototype.reset.apply(this),this.object3d=new THREE.HemisphereLight(this.params.skyColor,this.params.groundColor),this.object3d.backReference=this}}();
;
!function(){var t=E2.plugins.three_line_material=function(t){AbstractThreeMaterialPlugin.apply(this,arguments),this.desc="THREE.js Line Material",this.input_slots=[{name:"color",dt:t.datatypes.COLOR},{name:"linewidth",dt:t.datatypes.FLOAT,def:1},{name:"fog",dt:t.datatypes.BOOL,def:!0,desc:"Define whether the material color is affected by global fog settings."}].concat(this.input_slots),this.output_slots=[{name:"material",dt:t.datatypes.MATERIAL}]};t.prototype=Object.create(AbstractThreeMaterialPlugin.prototype),t.prototype.reset=function(){AbstractThreeMaterialPlugin.prototype.reset.call(this),this.material=new THREE.LineBasicMaterial}}();
;
!function(){var e=function(){return new THREE.Object3D},t=function(e,t){var n=new THREE.LineSegments(e,t);return n},n=E2.plugins.three_line_segments=function(){AbstractThreeMeshPlugin.apply(this,arguments),this.desc="THREE.js Line Segments",this.createMeshRoot=e,this.createAnimatedMesh=t,this.createMesh=t};n.prototype=Object.create(AbstractThreeMeshPlugin.prototype),n.prototype.update_input=function(){AbstractThreeMeshPlugin.prototype.update_input.apply(this,arguments)}}();
;
!function(){var e=E2.plugins.three_loader_model=function(){AbstractThreeLoaderObjPlugin.apply(this,arguments)};e.prototype=Object.create(AbstractThreeLoaderObjPlugin.prototype),e.prototype.getDefaultMaterials=function(){return[new THREE.MeshBasicMaterial]},e.prototype.getDefaultGeometries=function(){return[new THREE.Geometry]},e.prototype.create_ui=function(){var e=makeButton("Change","No model selected.","url"),t=this;return e.click(function(){var r,a=t.state.url;FileSelectControl.createSceneSelector(t.state.url).onChange(function(a){r=t.state.url=a,t.state_changed(null),t.state_changed(e),t.updated=!0,mixpanel.track("ThreeLoaderModelPlugin Model Changed")}).on("closed",function(){r!==a&&t.undoableSetState("url",r,a)})}),e},e.prototype.update_state=function(){if(this.dirty&&this.state.url){var e=this;this.geometries=this.getDefaultGeometries(),this.materials=this.getDefaultMaterials(),console.log("AbstractThreeLoaderObjPlugin loading",this.state.url),E2.core.assetLoader.loadAsset("model",this.state.url).then(function(t){e.onObjLoaded(t.geometries,t.materials)}),this.dirty=!1}},e.prototype.update_output=function(e){return 0===e.index?this.geometries:1===e.index?this.materials:void 0}}();
;
!function(){var t=E2.plugins.three_loader_scene=function(t){ThreeObject3DPlugin.apply(this,arguments),this.core=t,this.desc="3D Object/Scene loader. Loads .obj and THREE.js .json object hierarchies.",this.urlDirty=!0,this.state.url="",this.loadedUrl="",this.input_slots=[].concat(this.input_slots),this.defaultObject=new THREE.Object3D(new THREE.BoxGeometry,new THREE.MeshBasicMaterial({color:7829367})),this.defaultObject.backReference=this,this.object3d=this.defaultObject,THREE.Loader.Handlers.add(/\.dds$/i,new THREE.DDSLoader),this.hasAnimation=!1,this.requiresScaling=!1};t.prototype=Object.create(ThreeObject3DPlugin.prototype),t.prototype.loadObject=function(t){var e=this;return t!==this.state.url&&this.undoableSetState("url",t,this.state.url),this.loadedUrl=t,this.object3d=this.defaultObject,this.updated=!0,this.loader=E2.core.assetLoader.loadAsset("scene",t),this.loader.then(function(t){e.object3d=t.clone(),e.postLoadFixUp()}).finally(function(){delete e.loader}),this.loader},t.prototype.create_ui=function(){var t=makeButton("Change","No model selected.","url"),e=this;return t.click(function(){var t,a=e.state.url;FileSelectControl.createSceneSelector(e.state.url).onChange(function(e){t=e}).on("closed",function(){t!==a&&0!==t.length&&(E2.app.undoManager.begin("Load Object"),e.loadObject(t).then(function(){e.scaleToUnitSize(),e.update_state(),e.updated=!0,mixpanel.track("ThreeLoaderScenePlugin Model Changed"),E2.app.undoManager.end()}))})}),t},t.prototype.scaleToUnitSize=function(){var t=new THREE.Box3;this.object3d.traverse(function(e){e.geometry&&(e.geometry.computeBoundingBox(),t.expandByPoint(e.geometry.boundingBox.min),t.expandByPoint(e.geometry.boundingBox.max))});var e=t.max.x-t.min.x,a=t.max.y-t.min.y,n=t.max.z-t.min.z,o=1;e>0&&e>a&&e>n?o/=e:a>0&&a>e&&a>n?o/=a:n>0&&n>e&&n>a&&(o/=n),this.undoableSetState("scale",new THREE.Vector3(o,o,o),new THREE.Vector3(this.state.scale.x,this.state.scale.y,this.state.scale.z)),this.requiresScaling=!1},t.prototype.postLoadFixUp=function(){this.hasAnimation=!1,this.always_update=!0;var t=this,e=[];this.object3d.traverse(function(a){(a instanceof THREE.Light||a instanceof THREE.Camera)&&e.push({parent:a.parent,object:a});var n=a.geometry;if(n){var o=n instanceof THREE.BufferGeometry&&void 0!==n.getAttribute("normal"),i=n.faces&&n.faces.length>0&&0!==n.faces[0].normal.lengthSq(),s=n.faces&&n.faces.length>0&&n.faces[0].vertexNormals.length>0;o||i||s||n.computeVertexNormals(!0),n.animations&&n.animations.length>0&&(a.playAnimation(n.animations[0].name,100),a.material.morphTargets=!0,t.hasAnimation=!0,t.always_update=!0)}});for(var a=0;a<e.length;++a)e[a].parent.remove(e[a].object);this.object3d.backReference=this},t.prototype.update_state=function(){if(this.loadedUrl!==this.state.url){var t=this,e=function(){t.loadObject(t.state.url).then(function(){t.requiresScaling&&t.scaleToUnitSize(),t.update_state(),t.updated=!0})};this.loader?this.loader.then(e):e()}ThreeObject3DPlugin.prototype.update_state.apply(this);var a=.001*this.core.delta_t;this.object3d&&this.hasAnimation&&this.object3d.traverse(function(t){t instanceof THREE.MorphAnimMesh&&t.updateAnimation(a)})},t.prototype.update_output=function(t){return 0===t.index?this.object3d:void 0}}();
;
!function(){var t=E2.plugins.three_material=function(t){AbstractThreeMaterialPlugin.apply(this,arguments),this.desc="THREE.js Mesh Basic Material",this.input_slots=[{name:"texture",dt:t.datatypes.TEXTURE},{name:"color",dt:t.datatypes.COLOR},{name:"wireframe",dt:t.datatypes.BOOL,def:!1},{name:"fog",dt:t.datatypes.BOOL,def:!0,desc:"Define whether the material color is affected by global fog settings."},{name:"shading",dt:t.datatypes.FLOAT,def:2,desc:"Define shading type. 0 = No Shading, 1 = Flat Shading, 2 = Smooth Shading."}].concat(this.input_slots),this.output_slots=[{name:"material",dt:t.datatypes.MATERIAL}]};t.prototype=Object.create(AbstractThreeMaterialPlugin.prototype),t.prototype.reset=function(){AbstractThreeMaterialPlugin.prototype.reset.call(this),this.material=new THREE.MeshBasicMaterial}}();
;
!function(){var t=E2.plugins.three_material_depth=function(t){AbstractThreeMaterialPlugin.apply(this,arguments),this.desc="THREE.js Mesh Depth Material",this.input_slots=[{name:"wireframe",dt:t.datatypes.BOOL,def:!1}].concat(this.input_slots),this.output_slots=[{name:"material",dt:t.datatypes.MATERIAL}]};t.prototype=Object.create(AbstractThreeMaterialPlugin.prototype),t.prototype.reset=function(){AbstractThreeMaterialPlugin.prototype.reset.call(this),this.material=new THREE.MeshDepthMaterial}}();
;
!function(){var t=E2.plugins.three_material_extractor=function(t){this.desc="THREE.js Material Extractor",this.input_slots=[{name:"material",dt:t.datatypes.MATERIAL}],this.output_slots=[{name:"texture",dt:t.datatypes.TEXTURE},{name:"lightMap",dt:t.datatypes.TEXTURE},{name:"bumpMap",dt:t.datatypes.TEXTURE},{name:"normalMap",dt:t.datatypes.TEXTURE},{name:"specularMap",dt:t.datatypes.TEXTURE},{name:"displacementMap",dt:t.datatypes.TEXTURE},{name:"alphaMap",dt:t.datatypes.TEXTURE},{name:"color",dt:t.datatypes.COLOR},{name:"wireframe",dt:t.datatypes.BOOL},{name:"fog",dt:t.datatypes.BOOL},{name:"shading",dt:t.datatypes.FLOAT},{name:"opacity",dt:t.datatypes.FLOAT},{name:"transparent",dt:t.datatypes.FLOAT},{name:"blending",dt:t.datatypes.FLOAT},{name:"side",dt:t.datatypes.FLOAT}]};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.update_input=function(t,a){this.material=a},t.prototype.update_output=function(t){return"texture"===t.name?this.material.map:this.material[t.name]}}();
;
!function(){var t=E2.plugins.three_material_lambert=function(t){AbstractThreeMaterialPlugin.apply(this,arguments),this.desc="THREE.js Lambert Material",this.input_slots=[{name:"texture",dt:t.datatypes.TEXTURE},{name:"specularMap",dt:t.datatypes.TEXTURE,def:void 0},{name:"alphaMap",dt:t.datatypes.TEXTURE,def:void 0},{name:"color",dt:t.datatypes.COLOR},{name:"wireframe",dt:t.datatypes.BOOL,def:!1},{name:"fog",dt:t.datatypes.BOOL,def:!0,desc:"Define whether the material color is affected by global fog settings."},{name:"shading",dt:t.datatypes.FLOAT,def:2,desc:"Define shading type. 0 = No Shading, 1 = Flat Shading, 2 = Smooth Shading."}].concat(this.input_slots)};t.prototype=Object.create(AbstractThreeMaterialPlugin.prototype),t.prototype.reset=function(){AbstractThreeMaterialPlugin.prototype.reset.call(this),this.material=new THREE.MeshLambertMaterial}}();
;
!function(){var t=E2.plugins.three_material_modifier=function(t,a){Plugin.apply(this,arguments),this.input_slots=[{name:"material",dt:t.datatypes.MATERIAL,array:!0,def:[new THREE.MeshBasicMaterial({name:"default material",color:65280})]}],this.output_slots=[{name:"material",dt:t.datatypes.MATERIAL,array:!0}],this.lsg=new LinkedSlotGroup(t,a,[],[]),this.lsg.set_dt(t.datatypes.MATERIAL);var i=this;this.node.on("slotAdded",function(){i.dynInputs=a.getDynamicInputSlots(),i.updated=!0,i.materialSlotsDirty=!0}),this.node.on("slotRemoved",function(){i.dynInputs=a.getDynamicInputSlots(),i.updated=!0,i.materialSlotsDirty=!0})};t.prototype=Object.create(Plugin.prototype),t.prototype.create_ui=function(){var t=this,a=make("div"),i=makeButton("Remove","Click to remove the last material input."),e=makeButton("Add Slot","Click to add another material input.");return i.css("width","65px"),e.css({width:"65px","margin-top":"5px"}),e.click(function(){E2.app.graphApi.addSlot(t.node.parent_graph,t.node,{type:E2.slot_type.input,name:t.dynInputs.length+"",dt:E2.dt.MATERIAL})}),i.click(function(){var a=t.dynInputs;if(a){var i=a[a.length-1].uid;E2.app.graphApi.removeSlot(t.node.parent_graph,t.node,i)}}),a.append(i,"<br />",e),a},t.prototype.reset=function(){this.inMaterialArray=[],this.outMaterialArray=[],this.materialOverride=[],this.materialSlotsDirty=!1,this.materialsDirty=!1},t.prototype.update_input=function(t,a){if(t.uid||0!==t.index)a?this.materialOverride[t.index]=a:this.materialOverride[t.index]&&delete this.materialOverride[t.index],this.materialsDirty=!0;else if(a&&a.length>0){this.inMaterialArray=a,this.materialNames=[];var i,e;for(e=0;e<a.length;++e){var r=!1;for(i=0;i<this.materialNames.length;++i)a[e].name===this.materialNames[i]&&(r=!0);r||this.materialNames.push(a[e].name)}this.outMaterialArray=[],this.materialSlotsDirty=!0,this.materialsDirty=!0}},t.prototype.state_changed=function(t){if(!t)for(var a=this.dynInputs=this.node.getDynamicInputSlots(),i=0,e=a.length;e>i;i++)this.lsg.add_dyn_slot(a[i])},t.prototype.update_state=function(){if(this.materialSlotsDirty&&(this.adjustMaterialSlots(),this.materialSlotsDirty=!1),this.materialsDirty){this.outMaterialArray=[];for(var t=0;t<this.inMaterialArray.length;t++){var a=this.inMaterialArray[t].name,i=this.materialNames.indexOf(a);this.outMaterialArray.push(i>=0&&this.materialOverride[i]?this.materialOverride[i]:this.inMaterialArray[t])}this.materialsDirty=!1}},t.prototype.update_output=function(){return this.outMaterialArray},t.prototype.adjustMaterialSlots=function(){for(var t=this.dynInputs=this.node.getDynamicInputSlots(),a=0,i=t.length;i>a;a++)this.node.rename_slot(t[a].type,t[a].uid,a<this.materialNames.length?this.materialNames[a]:"input "+a)}}();
;
!function(){var t=E2.plugins.three_material_phong=function(t){AbstractThreeMaterialPlugin.apply(this,arguments),this.desc="THREE.js Phong Material",this.input_slots=[{name:"texture",dt:t.datatypes.TEXTURE},{name:"lightMap",dt:t.datatypes.TEXTURE,def:void 0},{name:"bumpMap",dt:t.datatypes.TEXTURE,def:void 0},{name:"normalMap",dt:t.datatypes.TEXTURE,def:void 0},{name:"specularMap",dt:t.datatypes.TEXTURE,def:void 0},{name:"displacementMap",dt:t.datatypes.TEXTURE,def:void 0},{name:"alphaMap",dt:t.datatypes.TEXTURE,def:void 0},{name:"color",dt:t.datatypes.COLOR},{name:"wireframe",dt:t.datatypes.BOOL},{name:"fog",dt:t.datatypes.BOOL,def:!0,desc:"Define whether the material color is affected by global fog settings."},{name:"shading",dt:t.datatypes.FLOAT,def:2,desc:"Define shading type. 0 = No Shading, 1 = Flat Shading, 2 = Smooth Shading."}].concat(this.input_slots).concat([{name:"emissiveMap",dt:t.datatypes.TEXTURE,def:void 0},{name:"emissive",dt:t.datatypes.COLOR,def:void 0},{name:"specular",dt:t.datatypes.COLOR,def:void 0},{name:"shininess",dt:t.datatypes.FLOAT,def:30},{name:"metal",dt:t.datatypes.BOOL,def:!1},{name:"lightMapIntensity",dt:t.datatypes.FLOAT,def:1},{name:"normalScale",dt:t.datatypes.VECTOR,def:new THREE.Vector3(1,1,1)},{name:"bumpScale",dt:t.datatypes.FLOAT,def:1},{name:"displacementScale",dt:t.datatypes.FLOAT,def:1},{name:"displacementBias",dt:t.datatypes.FLOAT,def:1},{name:"reflectivity",dt:t.datatypes.FLOAT,def:1},{name:"refractionRatio",dt:t.datatypes.FLOAT,def:.98}])};t.prototype=Object.create(AbstractThreeMaterialPlugin.prototype),t.prototype.reset=function(){AbstractThreeMaterialPlugin.prototype.reset.call(this),this.material=new THREE.MeshPhongMaterial},t.prototype.update_input=function(t,e){return"normalScale"===t.name&&void 0!==e?void this.material.normalScale.set(e.x,e.y):void AbstractThreeMaterialPlugin.prototype.update_input.apply(this,arguments)}}();
;
!function(){var t=E2.plugins.three_material_shader=function(t,e){AbstractThreeMaterialPlugin.apply(this,arguments);var i=this;this.desc="Shader Material",this.input_slots=[{name:"depthTest",dt:t.datatypes.BOOL,def:!0},{name:"depthWrite",dt:t.datatypes.BOOL,def:!0}].concat(this.input_slots),this.state={vs_src:"",ps_src:""},this.core=t,this.node=e,this.slot_data={},this.node.on("slotAdded",function(t){i.slot_data[t.uid]=i.core.get_default_value(E2.slot_type.input,t.dt),i.updated=i.dirty=!0,i._refreshEditor()}),this.node.on("slotRemoved",function(){i.updated=i.dirty=!0,i._refreshEditor()}),this.shader_dirty=!0,this.uniforms_dirty=!0};t.prototype=Object.create(AbstractThreeMaterialPlugin.prototype),t.prototype._refreshEditor=function(){var t=this;this._editors&&_.each(this._editors,function(e){e.setInputs(t.node.getDynamicInputSlots())})},t.prototype.destroy_ui=function(){var t=this;_.each(this._editors,function(e,i){e.close&&(e.close(),delete t._editors[i])})},t.prototype.create_ui=function(){function t(t){E2.app.graphApi.removeSlot(s.node.parent_graph,s.node,t)}function e(t,e){E2.app.graphApi.addSlot(s.node.parent_graph,s.node,{type:E2.slot_type.input,name:t,dt:e})}function i(i,r){if(s._editors[i])return void s._editors[i].show();var a=[i,"shader"].join(" ");s._editors[i]=E2.ShaderEditor.open(a,s.state[r],s.node.getDynamicInputSlots()).on("closed",function(){delete s._editors[i]}).on("inputRemoved",function(e,i){t(e,i)}).on("inputAdded",function(t,i){e(t,i)}).on("build",function(){s.updated=s.shader_dirty=!0}).on("changed",function(t){t!==s.state[r]&&s.undoableSetState(r,t,s.state[r])}),s._editors[i].stateKey=r}var s=this,r=make("div"),a=makeButton("Vertex","Click to edit the vertex shader source."),o=makeButton("Pixel","Click to edit the pixel shader source.");return this._editors={},a.css("width","55px"),o.css({width:"55px","margin-top":"5px"}),a.click(function(){i("vertex","vs_src")}),o.click(function(){i("pixel","ps_src")}),r.append(a,"<br />",o),r},t.prototype.connection_changed=function(t,e,i){t||i.type!==E2.slot_type.input||(this.uniforms_dirty=!0)},t.prototype.update_input=function(t,e){void 0===t.uid?console.log("ThreeShaderMaterialPlugin: undefined uid for slot "+t.index):(this.slot_data[t.uid]=e,this.uniforms_dirty=!0),AbstractThreeMaterialPlugin.prototype.update_input.apply(this,arguments)},t.prototype.update_state=function(){if(this.uniforms_dirty||this.shader_dirty){this.uniforms_dirty=this.uniforms_dirty||this.shader_dirty;var t,e,i=this.core.datatypes;if(t=this.node.getDynamicInputSlots(),this.shader_dirty||!this.material){var s=this.state.vs_src.slice(0),r=this.state.ps_src.slice(0);this.uniforms={};for(var a=0;a<t.length;a++){var o="",n="";e=t[a];var d=e.dt.id;d===i.FLOAT.id?(o="f",n="float"):d===i.TEXTURE.id?(o="t",n="sampler2D"):d===i.CUBETEXTURE.id?(o="t",n="samplerCube"):d===i.COLOR.id?(o="v4",n="vec4"):d===i.MATRIX.id?(o="m4",n="mat4"):d===i.VECTOR.id&&(o="v3",n="vec3"),this.uniforms[e.name]={type:o},s="uniform "+n+" "+e.name+";\n"+s,r="uniform "+n+" "+e.name+";\n"+r}this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:s,fragmentShader:r})}if(this.uniforms_dirty)for(var a=0;a<t.length;a++){e=t[a];var d=e.dt.id,h=this.slot_data[e.uid];d===i.COLOR.id?h=h?new THREE.Color(h.x,h.y,h.z,h.w):new THREE.Color:d===i.MATRIX.id?h=h?new THREE.Matrix4(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8],h[9],h[10],h[11],h[12],h[13],h[14],h[15]):new THREE.Matrix4:d===i.VECTOR.id&&(h=h?new THREE.Vector3(h.x,h.y,h.z):new THREE.Vector3),this.uniforms[e.name].value=h}this.shader_dirty=!1,this.uniforms_dirty=!1}},t.prototype.reset=function(){this.material=new THREE.ShaderMaterial,this.state.vs_src?this.material.vertexShader=this.state.vs_src:this.state.vs_src=this.material.vertexShader,this.state.ps_src?this.material.fragmentShader=this.state.ps_src:this.state.ps_src=this.material.fragmentShader,this.uniforms_dirty=this.shader_dirty=!0},t.prototype.state_changed=function(t){t&&this.core.add_aux_script("ace/src-noconflict/ace.js")}}();
;
!function(){var t=function(){return new THREE.Object3D},e=function(t,e){return new THREE.MorphAnimMesh(t,e)},s=function(t,e){return new THREE.Mesh(t,e)},n=E2.plugins.three_mesh=function(n){AbstractThreeMeshPlugin.apply(this,arguments),this.input_slots=[{name:"object3d",dt:n.datatypes.OBJECT3D,desc:"Optional existing mesh to modify",def:null}].concat(this.input_slots),this.desc="THREE.js Mesh",this.createMeshRoot=t,this.createAnimatedMesh=e,this.createMesh=s};n.prototype=Object.create(AbstractThreeMeshPlugin.prototype),n.prototype.update_input=function(t,e){AbstractThreeMeshPlugin.prototype.update_input.apply(this,arguments),"object3d"===t.name&&e&&this.object3d!==e&&(this.object3d=e,this.geoms=[],this.mats=[],this.node.emit("meshChanged"))},n.prototype.update_state=function(){AbstractThreeMeshPlugin.prototype.update_state.apply(this);var t=.001*this.core.delta_t;this.object3d&&this.object3d.traverse(function(e){e instanceof THREE.MorphAnimMesh&&e.updateAnimation(t)})}}();
;
!function(){var t=E2.plugins.three_object3d_attribute_extractor=function(t){Plugin.apply(this,arguments),this.input_slots=[{name:"object3d",dt:t.datatypes.OBJECT3D,desc:"mesh to extract attributes from"}],this.output_slots=[{name:"position",dt:t.datatypes.VECTOR},{name:"rotation",dt:t.datatypes.VECTOR},{name:"scale",dt:t.datatypes.VECTOR},{name:"name",dt:t.datatypes.TEXT}],this.desc="Extract position, rotation and scale from a Mesh",this.euler=new THREE.Euler};t.prototype=Object.create(Plugin.prototype),t.prototype.constructor=Plugin.prototype,t.prototype.reset=function(){this.object3d=void 0,this.position=new THREE.Vector3(0,0,0),this.rotation=new THREE.Vector3(0,0,0),this.scale=new THREE.Vector3(1,1,1),this.name="",this.meshDirty=!1},t.prototype.update_output=function(t){return"position"===t.name?this.position:"rotation"===t.name?this.rotation:"scale"===t.name?this.scale:"name"===t.name?this.name:void 0},t.prototype.update_input=function(t,e){this.object3d=e,this.meshDirty=!0},t.prototype.update_state=function(){this.meshDirty&&(this.position.copy(this.object3d.position),this.euler.setFromQuaternion(this.object3d.quaternion),this.rotation.set(this.euler.x,this.euler.y,this.euler.z),this.scale.copy(this.object3d.scale),this.name=this.object3d.name,this.meshDirty=!1)}}();
;
!function(){var e=E2.plugins.three_particle_emitter=function(e){Plugin.apply(this,arguments),this.desc="Particle emitter generating a point cloud that can beused in a point cloud",this.input_slots=[{name:"particle count",dt:e.datatypes.FLOAT,def:100},{name:"spawn rate",desc:"the amount of particles to spawn per second",dt:e.datatypes.FLOAT,def:.1,validate:function(e){return 0>e?0:e>1?1:e}},{name:"random seed",desc:"seed to initialise the random number generator with",dt:e.datatypes.FLOAT,def:0},{name:"direction",dt:e.datatypes.VECTOR,def:new THREE.Vector3(0,1,0)},{name:"speed",desc:"speed along direction",dt:e.datatypes.FLOAT,def:1},{name:"spread",desc:"spread around direction",dt:e.datatypes.FLOAT,def:1},{name:"lifetime",desc:"particle lifetime",dt:e.datatypes.FLOAT,def:1},{name:"gravity",desc:"gravity vector",dt:e.datatypes.VECTOR,def:null},{name:"noise",desc:"amount of noise to apply to movement",dt:e.datatypes.FLOAT,def:.5},{name:"geometry",desc:"emit from this geometry",dt:e.datatypes.GEOMETRY,def:0}],this.output_slots=[{name:"geometry",dt:e.datatypes.GEOMETRY}],this.always_update=!0};e.prototype=Object.create(Plugin.prototype),e.prototype.reset=function(){this.buffersDirty=!0,this.positionsDirty=!0,this.particleCount=100,this.spawnRate=.1,this.direction=new THREE.Vector3,this.velocity=1,this.spread=1,this.lifetime=1,this.gravity=null,this.rngSeed=0},e.prototype.initialiseRandom=function(){this.random=new Random(Random.engines.mt19937().seed(this.rngSeed))},e.prototype.createBuffers=function(){this.random||this.initialiseRandom(),this.geometry=new THREE.Geometry,this.particles=[];for(var e=0;e<this.particleCount;++e)this.geometry.vertices.push(new THREE.Vector3),this.particles.push({position:new THREE.Vector3,velocity:new THREE.Vector3,lifetime:0});this.buffersDirty=!1},e.prototype.updateParticles=function(){var e,t=this.particleCount*this.spawnRate*E2.core.delta_t;this.gravity&&(e=this.gravity.clone(),e.multiplyScalar(E2.core.delta_t));for(var i=0;i<this.particles.length;++i){var s=this.particles[i];if(s.lifetime>0){if(s.position.add(s.velocity),s.lifetime-=E2.core.delta_t,this.gravity&&s.velocity.add(e),this.noise>0){var r=-E2.core.delta_t*this.noise,o=-r;s.velocity.x+=this.random.real(r,o),s.velocity.y+=this.random.real(r,o),s.velocity.z+=this.random.real(r,o)}}else if(t>=0){if(this.vertices){var a=this.random.uint32()%this.vertices.length,n=this.vertices[a];s.position.copy(n)}else s.position.set(0,0,0);s.velocity.set(this.random.real(-1,1)*this.spread,this.random.real(-1,1)*this.spread,this.random.real(-1,1)*this.spread),s.velocity.add(this.direction),s.velocity.multiplyScalar(this.velocity*(1+this.random.real(-1,1)*this.noise)),s.lifetime=this.lifetime,t--}else s.position.set(1e4,1e4,1e4);this.geometry.vertices[i].copy(s.position)}this.geometry.verticesNeedUpdate=!0,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()},e.prototype.update_input=function(e,t){if(0===e.index){var i=Math.floor(t);this.particleCount==i&&this.particles||(this.particleCount=i,this.buffersDirty=!0)}else if(1===e.index)this.spawnRate=t;else if(2===e.index)this.rngSeed!==t&&(this.rngSeed=t,this.initialiseRandom());else if(3===e.index)this.direction=t;else if(4===e.index)this.velocity=t;else if(5===e.index)this.spread=t;else if(6===e.index)this.lifetime=t;else if(7===e.index)this.gravity=t;else if(8===e.index)this.noise=t;else if(9===e.index)if(t instanceof THREE.BufferGeometry){var s=new THREE.Geometry;s.fromBufferGeometry(t),this.vertices=s.vertices.length>0?s.vertices:void 0}else this.vertices=t instanceof THREE.Geometry&&t.vertices.length>0?t.vertices:void 0},e.prototype.update_output=function(){return this.geometry},e.prototype.update_state=function(){this.buffersDirty&&this.createBuffers(),this.updateParticles()}}();
;
!function(){var e=E2.plugins.three_perspective_camera=function(e){ThreeObject3DPlugin.apply(this,arguments),this.desc="THREE.js Perspective Camera",this.input_slots=[{name:"fov",dt:e.datatypes.FLOAT,def:45},{name:"aspectRatio",dt:e.datatypes.FLOAT,def:1},{name:"near",dt:e.datatypes.FLOAT,def:1},{name:"far",dt:e.datatypes.FLOAT,def:1e3}].concat(this.input_slots),this.output_slots=[{name:"camera",dt:e.datatypes.CAMERA}]};e.prototype=Object.create(ThreeObject3DPlugin.prototype),e.prototype.reset=function(){ThreeObject3DPlugin.prototype.reset.apply(this,arguments),this.object3d=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1e3),this.object3d.position.z=5},e.prototype.update_input=function(e,t){switch(e.index){case 0:this.object3d.fov=t;break;case 1:this.object3d.aspectRatio=t;break;case 2:this.object3d.near=t;break;case 3:this.object3d.far=t;break;default:return ThreeObject3DPlugin.prototype.update_input.apply(this,arguments)}}}();
;
!function(){var t=E2.plugins.three_point_cloud_material=function(t){AbstractThreeMaterialPlugin.apply(this,arguments),this.desc="THREE.js Point Cloud Material",this.input_slots=[{name:"texture",dt:t.datatypes.TEXTURE},{name:"color",dt:t.datatypes.COLOR},{name:"size",dt:t.datatypes.FLOAT,def:1},{name:"sizeAttenuation",dt:t.datatypes.FLOAT,def:1},{name:"fog",dt:t.datatypes.BOOL,def:!0,desc:"Define whether the material color is affected by global fog settings."},{name:"depthTest",dt:t.datatypes.BOOL,def:!0}].concat(this.input_slots),this.output_slots=[{name:"material",dt:t.datatypes.MATERIAL}]};t.prototype=Object.create(AbstractThreeMaterialPlugin.prototype),t.prototype.reset=function(){AbstractThreeMaterialPlugin.prototype.reset.call(this),this.material=new THREE.PointCloudMaterial}}();
;
!function(){var t=function(){return new THREE.Object3D},e=function(t,e){var n=new THREE.PointCloud(t,e);return n},n=E2.plugins.three_point_cloud_mesh=function(){AbstractThreeMeshPlugin.apply(this,arguments),this.desc="THREE.js Point Cloud Mesh",this.createMeshRoot=t,this.createAnimatedMesh=e,this.createMesh=e};n.prototype=Object.create(AbstractThreeMeshPlugin.prototype),n.prototype.update_input=function(t,e){if(1===t.index){var n=e.transparent?!0:!1;this.sortParticles!==n&&(this.object3d.traverse(function(t){t instanceof THREE.PointCloud&&(t.sortParticles=n)}),this.sortParticles=n)}AbstractThreeMeshPlugin.prototype.update_input.apply(this,arguments)}}();
;
!function(){var t=E2.plugins.three_point_light=function(t){ThreeObject3DPlugin.apply(this,arguments),this.desc="THREE.js Point Light",this.params={color:new THREE.Color(16777215),intensity:1,distance:0,decay:1},this.input_slots=[{name:"intensity",dt:t.datatypes.FLOAT,def:this.params.intensity},{name:"distance",dt:t.datatypes.FLOAT,def:this.params.distance},{name:"decay",dt:t.datatypes.FLOAT,def:this.params.decay},{name:"color",dt:t.datatypes.COLOR,def:this.params.color}].concat(this.input_slots)};t.prototype=Object.create(ThreeObject3DPlugin.prototype),t.prototype.reset=function(){ThreeObject3DPlugin.prototype.reset.apply(this),this.object3d=new THREE.PointLight(16777215),this.object3d.backReference=this}}();
;
!function(){var t=E2.plugins.three_procedural_ground=function(t){ThreeObject3DPlugin.apply(this,arguments),this.desc="THREE.js Procedural Ground",this.input_slots=[{name:"x size",dt:t.datatypes.FLOAT,def:40},{name:"y size",dt:t.datatypes.FLOAT,def:10},{name:"z size",dt:t.datatypes.FLOAT,def:40},{name:"seed",dt:t.datatypes.FLOAT,def:0},{name:"noise factor",dt:t.datatypes.FLOAT,def:.25},{name:"noise octaves",dt:t.datatypes.FLOAT,def:3},{name:"noise scale",dt:t.datatypes.FLOAT,def:1},{name:"ground height",dt:t.datatypes.FLOAT,def:0},{name:"rock height",dt:t.datatypes.FLOAT,def:3}].concat(this.input_slots),this.xSize=20,this.ySize=20,this.zSize=20,this.rngSeed=10,this.noiseFactor=.25,this.noiseOctaves=1,this.noiseScale=1,this.groundHeight=0,this.rockHeight=3,this.dirty=!0};t.prototype=Object.create(ThreeObject3DPlugin.prototype),t.prototype.reset=function(){ThreeObject3DPlugin.prototype.reset.apply(this,arguments),this.dirty&&this.generate_mesh()},t.prototype.GeometryGenerator=function(t){this.type="VizorProceduralGround";var e,a;that=this,this.initialise=function(t,s,r){for(THREE.Geometry.call(that),that.dynamic=!0,that.xSegments=t,that.zSegments=r,that.xSize=t,that.ySize=s,that.zSize=r,a=0;a<that.zSegments+1;a++)for(e=0;e<that.xSegments+1;e++)that.vertices.push(new THREE.Vector3);for(a=0;a<that.zSegments;a++)for(e=0;e<that.xSegments;e++)that.faces.push(new THREE.Face3),that.faceVertexUvs[0].push([0,0,0]),that.faces.push(new THREE.Face3),that.faceVertexUvs[0].push([0,0,0])},this.getNormal=function(t,e,a,s,r){var i=s*(e+1)+a,h=s*(e+1)+a+1,o=(s+1)*(e+1)+a,n=(s+1)*(e+1)+a+1,c=new THREE.Vector3,d=new THREE.Vector3;0==r?(c.subVectors(t[h],t[i]),d.subVectors(t[o],t[i])):(c.subVectors(t[h],t[o]),d.subVectors(t[n],t[o])),c.normalize(),d.normalize();var m=new THREE.Vector3;return m.crossVectors(c,d),m},this.getYPos=function(t,e,a,s,r){var i=s*(e+1)+a,h=s*(e+1)+a+1,o=(s+1)*(e+1)+a,n=(s+1)*(e+1)+a+1,c=0;return c=0==r?t[i].y+t[h].y+t[o].y:t[h].y+t[o].y+t[n].y},this.needsReinitialising=function(t,e,a){return!(t==that.xSize&&e==that.ySize&&a==that.zSize)},this.update=function(){var s=0;for(a=0;a<that.zSegments+1;a++)for(e=0;e<that.xSegments+1;e++){var r=2*(-.5+1*e/that.xSegments),i=2*(.5-1*a/that.zSegments),h=Math.abs(r)<Math.abs(i)?1/Math.abs(i):1/Math.abs(r);h=isNaN(h)||h>10?10:h;var o=Math.min(Math.max(0,1-h/10),1),n=1+(Math.sqrt(r*h*r*h+i*h*i*h)-1)*o;r/=n,i/=n;var c=Math.abs(r),d=Math.abs(i),m=Math.sqrt(c*c+d*d);m*=m;var g=t.noise.noise2D(e*t.noiseScale,a*t.noiseScale,Math.floor(t.noiseOctaves),that.xSegments)*t.noiseFactor*m,y=1;r*=y,g*=y,i*=y,that.vertices[s].x=r*that.xSize*.5,that.vertices[s].y=g*that.ySize*.5,that.vertices[s].z=i*that.zSize*.5,s++}var p=new THREE.Color;s=0;var f=0;for(a=0;a<that.zSegments;a++){for(e=0;e<that.xSegments;e++){var l=new THREE.Vector2(e/that.xSegments,1-a/that.zSegments),S=new THREE.Vector2(e/that.xSegments,1-(a+1)/that.zSegments),u=new THREE.Vector2((e+1)/that.xSegments,1-(a+1)/that.zSegments),z=new THREE.Vector2((e+1)/that.xSegments,1-a/that.zSegments),x=that.getNormal(that.vertices,that.xSegments,e,a,0),E=that.getYPos(that.vertices,that.xSegments,e,a,0),v=E<t.groundHeight?2:E>t.rockHeight?0:1;that.faces[f].a=s,that.faces[f].b=s+1,that.faces[f].c=s+(that.xSegments+1),that.faces[f].normal=x,that.faces[f].color=p,that.faces[f].vertexNormals=[x.clone(),x.clone(),x.clone()],that.faces[f].materialIndex=v,that.faceVertexUvs[0][f][0]=l,that.faceVertexUvs[0][f][1]=S,that.faceVertexUvs[0][f][2]=u,f++,x=that.getNormal(that.vertices,that.xSegments,e,a,1),that.faces[f].a=s+(that.xSegments+1),that.faces[f].b=s+1,that.faces[f].c=s+(that.xSegments+2),that.faces[f].normal=x,that.faces[f].color=p,that.faces[f].vertexNormals=[x.clone(),x.clone(),x.clone()],that.faces[f].materialIndex=v,that.faceVertexUvs[0][f][0]=u,that.faceVertexUvs[0][f][1]=S,that.faceVertexUvs[0][f][2]=z,s++,f++}s++}that.verticesNeedUpdate=!0,that.normalsNeedUpdate=!0,that.colorsNeedUpdate=!0,t.dirty=!1}},t.prototype.GeometryGenerator.prototype=Object.create(THREE.Geometry.prototype),t.prototype.GeometryGenerator.prototype.constructor=t.prototype.GeometryGenerator,t.prototype.generate_mesh=function(){this.noise&&this.noise.rngSeed==this.rngSeed||(this.noise=new E2.Noise(2048,this.rngSeed));var t=!this.geometry||this.geometry.needsReinitialising(this.xSize,this.ySize,this.zSize);t&&(this.geometry=new this.GeometryGenerator(this),this.geometry.initialise(this.xSize,this.ySize,this.zSize),this.material=new THREE.MeshFaceMaterial([new THREE.MeshLambertMaterial({color:11705996}),new THREE.MeshLambertMaterial({color:13397268}),new THREE.MeshLambertMaterial({color:7189107})]),this.object3d=new THREE.Mesh(this.geometry,this.material)),this.geometry.update(),this.object3d.backReference=this},t.prototype.update_input=function(t,e){switch(t.index){case 0:this.xSize=Math.floor(e),this.dirty=!0;break;case 1:this.ySize=Math.floor(e),this.dirty=!0;break;case 2:this.zSize=Math.floor(e),this.dirty=!0;break;case 3:this.rngSeed=e,this.dirty=!0;break;case 4:this.noiseFactor=e,this.dirty=!0;break;case 5:this.noiseOctaves=e,this.dirty=!0;break;case 6:this.noiseScale=e,this.dirty=!0;break;case 7:this.groundHeight=e,this.dirty=!0;break;case 8:this.rockHeight=e,this.dirty=!0;break;default:return ThreeObject3DPlugin.prototype.update_input.apply(this,arguments)}},t.prototype.state_changed=function(t){t||this.generate_mesh()},t.prototype.update_state=function(){this.dirty&&this.generate_mesh()}}();
;
!function(){var e=E2.plugins.three_scene=function(e,t){this.desc="THREE.js Scene",this.input_slots=[{name:"environment",dt:e.datatypes.ENVIRONMENTSETTINGS,def:new E2.EnvironmentSettings}],this.output_slots=[{name:"scene",dt:e.datatypes.SCENE}],this.node=t,this.lsg=new AutoSlotGroup(e,t,[],[]),this.lsg.set_dt(e.datatypes.OBJECT3D);var n=this;this.node.on("slotAdded",function(){n.dynInputs=t.getDynamicInputSlots(),n.updated=!0}),this.node.on("slotRemoved",function(){n.dynInputs=t.getDynamicInputSlots(),n.updated=!0}),this.clickableObjectsInSlot=[],this.createScene()};e.prototype.createScene=function(){this.scene=new THREE.Scene,this.scene.backReference=this,this.sceneRoot=new THREE.Group,this.scene.add(this.sceneRoot),this.overlayRoot=new THREE.Group,this.scene.add(this.overlayRoot)},e.prototype.update_meshes=function(){this.scene.fog=this.envSettings?this.envSettings.fog:null,this.scene&&this.scene.traverse(function(e){void 0!==e.material&&(e.material.needsUpdate=!0)})},e.prototype.reset=function(){},e.prototype.update_input=function(e,t){var n,s=this;if(this.clickableObjectsInSlot[e.index]=0,e.dynamic){var i=this.scene.children[0].children[e.index];if(t)if(e.array)for(i.children=t,n=0;n<t.length;++n)t[n].parent&&t[n].parent!==i&&t[n].parent.remove(t[n]),t[n].parent=i,t[n].dispatchEvent({type:"added"}),t[n].gazeClickerCount&&(s.clickableObjectsInSlot[e.index]+=t[n].gazeClickerCount);else t.parent&&t.parent!==this&&t.parent.remove(t),i.children=[t],t.parent=i,t.dispatchEvent({type:"added"}),t.gazeClickerCount&&(s.clickableObjectsInSlot[e.index]+=t.gazeClickerCount);else for(;i.children.length>0;)i.remove(i.children[0]);this.update_meshes()}else this.envSettings=t;var o=0;for(n=0;n<this.clickableObjectsInSlot.length;n++)o+=this.clickableObjectsInSlot[n]||0;this.scene.hasClickableObjects=o>0},e.prototype.connection_changed=function(e,t,n){if(e&&n.dynamic)for(var s=this.scene.children[0];s.children.length<this.dynInputs.length;)s.add(new THREE.Group);if(!e&&n.type===E2.slot_type.input&&n.dynamic)for(var i=this.scene.children[0].children[n.index];i.children.length>0;)i.remove(i.children[0]);else e&&n.type===E2.slot_type.input&&n.dynamic&&(this.scene.children[0].children[n.index].children=[]);this.update_meshes()},e.prototype.update_output=function(){return this.scene},e.prototype.state_changed=function(e){if(!e){this.dynInputs=this.node.getDynamicInputSlots(),this.dynInputs.length||(this.node.add_slot(E2.slot_type.input,{name:"0",dt:E2.dt.OBJECT3D,array:!1}),this.dynInputs=this.node.getDynamicInputSlots());for(var t=0,n=this.dynInputs.length;n>t;t++)this.lsg.add_dyn_slot(this.dynInputs[t]),this.scene.children[0].add(new THREE.Group)}},e.prototype.update_state=function(){}}();
;
!function(){var t=E2.plugins.three_screen_space_transform_extractor=function(t){Plugin.apply(this,arguments),this.desc="Extract transformation from a vr camera for orienting objects to screen space",this.input_slots=[{name:"camera",dt:t.datatypes.CAMERA}],this.output_slots=[{name:"position",dt:t.datatypes.VECTOR},{name:"rotation",dt:t.datatypes.VECTOR},{name:"scale",dt:t.datatypes.VECTOR}]};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){this.position=new THREE.Vector3(0,0,0),this.rotation=new THREE.Vector3(1,1,1),this.scale=new THREE.Vector3(1,1,1)},t.prototype.update_input=function(t,o){if(0===t.index){this.position=o.position.clone(),o.updateMatrixWorld();var e=o.matrixWorld.elements,i=(o.fov||45)/180*3.1415926,n=1/Math.tan(i);this.position.x-=e[8]*n,this.position.y-=e[9]*n,this.position.z-=e[10]*n,this.rotation=o.rotation,this.scale=o.scale}},t.prototype.state_changed=function(t){},t.prototype.update_state=function(){},t.prototype.update_output=function(t){return 0===t.index?this.position:1===t.index?this.rotation:2===t.index?this.scale:void 0}}();
;
!function(){var t=E2.plugins.three_spot_light=function(t){ThreeObject3DPlugin.apply(this,arguments),this.desc="THREE.js Spot Light",this.params={color:new THREE.Color(16777215),intensity:1,distance:0,angle:Math.PI/3,exponent:10,decay:1},this.input_slots=[{name:"intensity",dt:t.datatypes.FLOAT,def:this.params.intensity},{name:"color",dt:t.datatypes.COLOR,def:this.params.color},{name:"distance",dt:t.datatypes.FLOAT,def:this.params.distance},{name:"angle",dt:t.datatypes.FLOAT,def:this.params.angle},{name:"exponent",dt:t.datatypes.FLOAT,def:this.params.exponent},{name:"decay",dt:t.datatypes.FLOAT,def:this.params.decay}].concat(this.input_slots)};t.prototype=Object.create(ThreeObject3DPlugin.prototype),t.prototype.reset=function(){ThreeObject3DPlugin.prototype.reset.apply(this),this.object3d=new THREE.SpotLight(16777215),this.object3d.backReference=this}}();
;
!function(){var t=E2.plugins.three_uv_modifier=function(t){Plugin.apply(this,arguments),this.desc="Adjust a texture's UV coordinates",this.input_slots=[{name:"texture",dt:t.datatypes.TEXTURE,def:new THREE.Texture},{name:"u offset",dt:t.datatypes.FLOAT,def:0},{name:"v offset",dt:t.datatypes.FLOAT,def:0},{name:"u repeat",dt:t.datatypes.FLOAT,def:1},{name:"v repeat",dt:t.datatypes.FLOAT,def:1}],this.output_slots=[{name:"texture",dt:t.datatypes.TEXTURE}]};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){this.texture=void 0,this.uOffset=0,this.vOffset=0,this.uRepeat=1,this.vRepeat=1,this.dirty=!1},t.prototype.update_input=function(t,e){0===t.index?e?(this.texture=e.clone(),this.dirty=!0):this.texture=void 0:1===t.index?(this.uOffset=e,this.dirty=!0):2===t.index?(this.vOffset=e,this.dirty=!0):3===t.index?(this.uRepeat=e,this.dirty=!0):4===t.index&&(this.vRepeat=e,this.dirty=!0)},t.prototype.state_changed=function(t){},t.prototype.update_state=function(){this.dirty&&this.texture&&(this.texture.offset.set(this.uOffset,this.vOffset),this.texture.repeat.set(this.uRepeat,this.vRepeat),this.texture.needsUpdate=!0,this.dirty=!1)},t.prototype.update_output=function(){return this.texture}}();
;
!function(){var t=E2.plugins.three_vr_camera=function(t){if(Plugin.apply(this,arguments),this.desc="THREE.js VR Camera",this.defaultFOV=90,window.HMDVRDevice&&window.HMDVRDevice.getEyeParameters){var e=window.HMDVRDevice.getEyeParameters();e.recommendedFieldOfView?this.defaultFOV=e.recommendedFieldOfView:e.leftDegrees&&e.rightDegrees&&(this.defaultFOV=e.leftDegrees+e.rightDegrees)}this.input_slots=[{name:"position",dt:t.datatypes.VECTOR},{name:"rotation",dt:t.datatypes.VECTOR},{name:"fov",dt:t.datatypes.FLOAT,def:this.defaultFOV},{name:"aspectRatio",dt:t.datatypes.FLOAT,def:1},{name:"near",dt:t.datatypes.FLOAT,def:.001},{name:"far",dt:t.datatypes.FLOAT,def:1e3}],this.output_slots=[{name:"camera",dt:t.datatypes.CAMERA},{name:"position",dt:t.datatypes.VECTOR},{name:"rotation",dt:t.datatypes.VECTOR}],this.always_update=!0,this.dirty=!1,this.state={position:{x:0,y:0,z:0},quaternion:{_x:0,_y:0,_z:0,_w:1}},this.rotationFromGraph=new THREE.Euler,this.positionFromGraph=new THREE.Vector3,this.outputRotationEuler=new THREE.Euler,this.outputPosition=new THREE.Vector3};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){Plugin.prototype.reset.apply(this,arguments),this.domElement=E2.dom.webgl_canvas[0],this.dolly||(this.dolly=new THREE.PerspectiveCamera),this.vrControlCamera||(this.vrControlCamera=new THREE.PerspectiveCamera(this.defaultFOV,this.domElement.clientWidth/this.domElement.clientHeight,.001,1e3),this.vrControlCamera.layers.enable(1),this.dolly.add(this.vrControlCamera)),this.object3d=this.dolly,this.object3d.backReference=this,this.object3d.backReference=this,this.controls||(this.controls=new THREE.VRControls(this.vrControlCamera)),this.object3d.position.set(this.state.position.x,this.state.position.y,this.state.position.z),this.object3d.quaternion.set(this.state.quaternion._x,this.state.quaternion._y,this.state.quaternion._z,this.state.quaternion._w)},t.prototype.play=function(){this.resize()},t.prototype.resize=function(){var t=!(!document.mozFullScreenElement&&!document.webkitFullscreenElement),e={width:window.innerWidth,height:window.innerHeight};t||(e.width=this.domElement.clientWidth,e.height=this.domElement.clientHeight,"undefined"!=typeof E2.app.calculateCanvasArea&&(e=E2.app.calculateCanvasArea())),this.vrControlCamera.aspect=e.width/e.height,this.vrControlCamera.updateProjectionMatrix()},t.prototype.update_state=function(){this.object3d.position.set(this.positionFromGraph.x+this.state.position.x,this.positionFromGraph.y+this.state.position.y,this.positionFromGraph.z+this.state.position.z),this.object3d.quaternion.setFromEuler(this.rotationFromGraph),this.object3d.quaternion.multiply(this.state.quaternion),this.dirty&&this.vrControlCamera.updateProjectionMatrix(),this.controls.update(new THREE.Vector3,new THREE.Quaternion),this.object3d.updateMatrixWorld(),this.updated=!0},t.prototype.update_input=function(t,e){if(this.object3d)switch(t.index){case 0:this.positionFromGraph.copy(e),this.dirty=!0;break;case 1:this.rotationFromGraph.set(e.x,e.y,e.z),this.dirty=!0;break;case 2:this.vrControlCamera.fov=e,this.dirty=!0;break;case 3:this.vrControlCamera.aspect=e,this.dirty=!0;break;case 4:this.vrControlCamera.near=e,this.dirty=!0;break;case 5:this.vrControlCamera.far=e,this.dirty=!0}},t.prototype.update_output=function(t){if(0===t.index)return this.vrControlCamera;if(1===t.index)return this.outputPosition.copy(this.vrControlCamera.position),this.outputPosition.applyMatrix4(this.vrControlCamera.matrixWorld),this.outputPosition;if(2===t.index){var e=this.vrControlCamera.quaternion.clone();return e.multiply(this.object3d.quaternion),this.outputRotationEuler.setFromQuaternion(e,"YZX"),this.outputRotationEuler}},t.prototype.state_changed=function(t){t||E2.core.on("resize",this.resize.bind(this))}}();
;
!function(){var e=E2.plugins.three_webgl_renderer=function(e){this.desc="THREE.js WebGL renderer",this.input_slots=[{name:"camera",dt:e.datatypes.CAMERA,desc:"Camera to use for rendering."},{name:"scene",dt:e.datatypes.SCENE,desc:"Scene to render"},{name:"bgcolor",dt:e.datatypes.COLOR,desc:"Background color"}],this.output_slots=[],this.always_update=!0,this.state={always_update:!0},this.clearColor=new THREE.Color(0,0,0)};e.prototype.stop=function(){this.renderer&&this.renderer.clear()},e.prototype.reset=function(){this.domElement=E2.dom.webgl_canvas[0],console.log("reset",this.domElement.clientWidth,this.domElement.clientHeight,this.domElement.clientWidth/this.domElement.clientHeight),this.scene=new THREE.Scene,this.perspectiveCamera=new THREE.PerspectiveCamera(90,this.domElement.clientWidth/this.domElement.clientHeight,.1,1e3)},e.prototype.update_input=function(e,t){switch(e.index){case 0:this.perspectiveCamera=t;break;case 1:this.scene=t,this.patchSceneForWorldEditor(this.scene);break;case 2:this.clearColor=new THREE.Color(t.r,t.g,t.b)}},e.prototype.update_state=function(){return this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setClearColor(this.clearColor),this.scene&&this.perspectiveCamera?(this.manager.isVRMode()&&this.perspectiveCamera.updateMatrixWorld(),void(E2.app.worldEditor.isActive()?(E2.app.worldEditor.preRenderUpdate(),this.manager.render(this.scene,E2.app.worldEditor.getCamera())):this.manager.render(this.scene,this.perspectiveCamera))):void this.renderer.clear()},e.prototype.patchSceneForWorldEditor=function(){E2.app.worldEditor.updateScene&&E2.app.worldEditor.updateScene(this.scene,this.perspectiveCamera)},e.prototype.play=function(){this.resize()},e.prototype.resize=function(){console.log("ThreeWebGLRendererPlugin.resize");var e=!(!document.mozFullScreenElement&&!document.webkitFullscreenElement),t={width:window.innerWidth,height:window.innerHeight};e||(t.width=this.domElement.clientWidth,t.height=this.domElement.clientHeight,"undefined"!=typeof E2.app.calculateCanvasArea&&(t=E2.app.calculateCanvasArea())),this.effect.setSize(t.width,t.height)},e.prototype.onFullScreenChanged=function(){var e=!(!document.mozFullScreenElement&&!document.webkitFullscreenElement);console.log("ThreeWebGLRendererPlugin.onFullScreenChanged",e),e?this.manager.exitVR():this.manager.enterVR()},e.prototype.toggleFullScreen=function(){var e=!(!document.mozFullScreenElement&&!document.webkitFullscreenElement);console.log("ThreeWebGLRendererPlugin.toggleFullScreen",!e),this.manager.toggleFullScreen()},e.prototype.state_changed=function(e){e||(console.log("state_changed"),this.domElement=E2.dom.webgl_canvas[0],this.renderer=E2.core.renderer,this.renderer.setPixelRatio(window.devicePixelRatio),this.effect=new THREE.VREffect(this.renderer),this.manager=new WebVRManager(this.renderer,this.effect,{hideButton:!0}),E2.core.webVRManager=this.manager,E2.core.on("resize",this.resize.bind(this)),E2.core.on("fullScreenChangeRequested",this.toggleFullScreen.bind(this)),this.resize())}}();
;
!function(){var e=E2.plugins.three_webgl_texture_renderer=function(e){this.desc="THREE.js WebGL Texture renderer",this.input_slots=[{name:"camera",dt:e.datatypes.CAMERA,desc:"Camera to use for rendering."},{name:"scene",dt:e.datatypes.SCENE,desc:"Scene to render"},{name:"bgcolor",dt:e.datatypes.COLOR,desc:"Background color"},{name:"width",dt:e.datatypes.FLOAT,desc:"texture width",def:256},{name:"height",dt:e.datatypes.FLOAT,desc:"texture height",def:256}],this.output_slots=[{name:"texture",dt:e.datatypes.TEXTURE,desc:"render target texture"}],this.width=256,this.height=256,this.texture_dirty=!0,this.clearColor=new THREE.Color(0,0,0)};e.prototype.reset=function(){this.scene=new THREE.Scene,this.perspectiveCamera=new THREE.PerspectiveCamera(90,1,.1,1e3),this.renderer=E2.core.renderer},e.prototype.update_input=function(e,t){switch(e.index){case 0:this.perspectiveCamera=t;break;case 1:this.scene=t;break;case 2:this.clearColor=new THREE.Color(t.r,t.g,t.b);break;case 3:this.width=t,this.texture_dirty=!0;break;case 4:this.height=t,this.texture_dirty=!0}},e.prototype.create_texture=function(){this.texture=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat}),this.texture_dirty=!1},e.prototype.update_state=function(){return this.renderer.setPixelRatio(1),this.texture_dirty&&this.create_texture(),this.renderer.setClearColor(this.clearColor),this.renderer.setRenderTarget(this.texture),this.scene&&this.perspectiveCamera?(this.renderer.render(this.scene,this.perspectiveCamera,this.texture),void this.renderer.setRenderTarget(null)):void this.renderer.clear()},e.prototype.state_changed=function(e){e||console.log("state_changed")},e.prototype.update_output=function(){return this.texture}}();
;
!function(){var t=E2.plugins.toggle_button=function(t,e){Plugin.apply(this,arguments),this.desc="Toggle button that emits true and false as it is clicked.",this.input_slots=[],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"True or false is emitted on the next update after the buttons has been clicked.",def:"False"}],this.state={enabled:!1},this.core=t,this.node=e};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){var t=this,e=this.ui=makeButton("Off");return e.click(function(){t.undoableSetState("enabled",!t.state.enabled,t.state.enabled)}),this.node.on("pluginStateChanged",this.updateUi.bind(this)),e},t.prototype.update_output=function(){return this.state.enabled},t.prototype.updateUi=function(){if(this.ui){var t=this.ui;t.html(this.state.enabled?"On":"Off"),this.state.enabled?t.removeClass("state_off").addClass("state_on"):t.addClass("state_off").removeClass("state_on")}},t.prototype.state_changed=function(t){t&&(this.core.add_aux_style("toggle-button/style.css"),this.updateUi())}}();
;
E2.p=E2.plugins.toggle_modulator=function(t){this.desc="For every continous sequence of 'true' values sent to the 'trigger' input slot the emitted value will switch from true to false and visa versa. The initial value is true.",this.input_slots=[{name:"trigger",dt:t.datatypes.BOOL,desc:"Every time true is sent one or more times in a row, the emitted value will switch between true and false, starting with true.",def:!1}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"The current state.",def:!0}],this.state={value:!0}},E2.p.prototype.update_input=function(t,e){e&&(this.triggered=!0,this.state.value=!this.state.value)},E2.p.prototype.update_state=function(){this.triggered||(this.updated=!1),this.triggered=!1},E2.p.prototype.update_output=function(){return this.state.value},E2.p.prototype.state_changed=function(t){t||(this.state.value=!0,this.triggered=!0)};
;
!function(){var t=E2.plugins.touch_end_generator=function(t,e){this.desc="When a touch on eg. a mobile device ends, this outputs a boolean true value for one frame.",this.input_slots=[],this.output_slots=[{name:"trigger",dt:t.datatypes.BOOL,desc:"True when the touch ends.",def:!1}],this.triggered=!1,this.frames=0,this.endListener=function(){this.frames=0,this.triggered=!0,this.updated=!0,e.queued_update=1}.bind(this)};t.prototype.update_output=function(){return this.triggered},t.prototype.update_state=function(){this.frames++>0&&(this.triggered=!1)},t.prototype.destroy=function(){E2.dom.webgl_canvas.off("touchend",this.endListener)},t.prototype.state_changed=function(t){t||E2.dom.webgl_canvas.on("touchend",this.endListener)}}();
;
!function(){var t=E2.plugins.touch_start_generator=function(t,e){this.desc="When a touch on eg. a mobile device starts, this outputs a boolean true value for one frame.",this.input_slots=[],this.output_slots=[{name:"trigger",dt:t.datatypes.BOOL,desc:"True when the touch starts.",def:!1}],this.triggered=!1,this.frames=0,this.startListener=function(){this.frames=0,this.triggered=!0,this.updated=!0,e.queued_update=1}.bind(this)};t.prototype.update_output=function(){return this.triggered},t.prototype.update_state=function(){this.frames++>0&&(this.triggered=!1)},t.prototype.destroy=function(){E2.dom.webgl_canvas.off("touchstart",this.startListener)},t.prototype.state_changed=function(t){t||E2.dom.webgl_canvas.on("touchstart",this.startListener)}}();
;
!function(){var t=E2.plugins.touching_generator=function(t){this.desc="While touching eg. a mobile device, this outputs a boolean true.",this.input_slots=[],this.output_slots=[{name:"trigger",dt:t.datatypes.BOOL,desc:"True while the touch is ongoing.",def:!1}],this.touching=!1,this.startListener=function(){this.touching=!0,this.updated=!0}.bind(this),this.endListener=function(){this.touching=!1,this.updated=!0}.bind(this)};t.prototype.update_output=function(){return this.touching},t.prototype.destroy=function(){E2.dom.webgl_canvas.off("touchstart",this.startListener),E2.dom.webgl_canvas.off("touchend",this.endListener)},t.prototype.state_changed=function(t){t||(E2.dom.webgl_canvas.on("touchstart",this.startListener),E2.dom.webgl_canvas.on("touchend",this.endListener))}}();
;
E2.p=E2.plugins.translation_matrix=function(t){this.desc="Create a matrix that represent a translation.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Translation vector.",def:[0,0,0]}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The resulting translation matrix.",def:t.renderer.matrix_identity}]},E2.p.prototype.reset=function(){this.matrix=mat4.create(),mat4.identity(this.matrix)},E2.p.prototype.update_input=function(t,a){var e=this.matrix;e[12]=a[0],e[13]=a[1],e[14]=a[2]},E2.p.prototype.update_output=function(){return this.matrix};
;
E2.p=E2.plugins.translation_xyz_matrix=function(t){this.desc="Create a matrix that tranlates along the X, Y and Z axis.",this.input_slots=[{name:"x",dt:t.datatypes.FLOAT,desc:"Amount to translate along the X-axis.",def:0},{name:"y",dt:t.datatypes.FLOAT,desc:"Amount to translate along the Y-axis.",def:0},{name:"z",dt:t.datatypes.FLOAT,desc:"Amount to translate along the Z-axis.",def:0}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The resulting translation matrix.",def:t.renderer.matrix_identity}]},E2.p.prototype.reset=function(){this.components=[0,0,0],this.matrix=mat4.create(),mat4.identity(this.matrix)},E2.p.prototype.update_input=function(t,a){this.components[t.index]=a},E2.p.prototype.update_state=function(){var t=this.matrix;mat4.identity(this.matrix),t[12]=this.components[0],t[13]=this.components[1],t[14]=this.components[2]},E2.p.prototype.update_output=function(){return this.matrix};
;
E2.p=E2.plugins.transpose_matrix_modulator=function(t){this.desc="Emits the transposed version of the supplied <b>matrix</b>.",this.input_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The input matrix to be transposed.",def:t.renderer.matrix_identity}],this.output_slots=[{name:"transposed",dt:t.datatypes.MATRIX,desc:"Emits the transposed input <b>matrix</b>.",def:t.renderer.matrix_identity}]},E2.p.prototype.reset=function(){this.matrix=mat4.create(),this.transposed=mat4.create(),mat4.identity(this.matrix),mat4.identity(this.transposed)},E2.p.prototype.connection_changed=function(t,e,i){t||i.type!==E2.slot_type.input||(mat4.identity(this.matrix),mat4.identity(this.transposed))},E2.p.prototype.update_input=function(t,e){this.matrix=e},E2.p.prototype.update_state=function(){mat4.transpose(this.matrix,this.transposed)},E2.p.prototype.update_output=function(){return this.transposed};
;
E2.p=E2.plugins.triangle_modulator=function(t){this.desc="Triangle oscilator. A <b>time</b> value incrementing by one per second will yield a 1Hz output signal.",this.input_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"The current time in seconds.",def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Emits ((0.5 - |(<b>time</b> % 1.0) - 0.5|) - 0.25) * 4.",def:0}]},E2.p.prototype.reset=function(){this.time=0,this.result=0},E2.p.prototype.update_input=function(t,e){this.time=e},E2.p.prototype.update_state=function(){this.result=4*(.5-Math.abs(this.time%1-.5)-.25)},E2.p.prototype.update_output=function(){return this.result};
;
!function(){var t=E2.plugins.tween_in_modulator=function(t){Plugin.apply(this,arguments),this.desc="Perform tween in over time.",this.input_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"Time ranging from zero to one.",def:0,lo:0,hi:1}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"Emits a tween in over <b>time</b>.",def:0}],this.state={type:0}};t.prototype=Object.create(Plugin.prototype),t.prototype.create_ui=function(){var t=$("<select />",{selectedIndex:0}),e=function(e,a){$("<option />",{value:e,text:a}).appendTo(t)};return e(0,"Circular"),e(1,"Cubic"),e(2,"Exponential"),e(3,"Quadratic"),e(4,"Quartic"),e(5,"Quintic"),e(6,"Sinusoidal"),t.change(function(e){return function(){e.undoableSetState("type",t.val(),e.state.type)}}(this)),t},t.prototype.reset=function(){this.result=0,this.time=0},t.prototype.update_input=function(t,e){this.time=0>e?0:e>1?1:e},t.prototype.update_state=function(){var t=0,e=this.time;switch(this.state.type){case 0:t=1-Math.sqrt(1-e*e);break;case 1:t=e*e*e;break;case 2:t=0===e?0:Math.pow(1024,e-1);break;case 3:t=e*e;break;case 4:t=e*e*e*e;break;case 5:t=e*e*e*e*e;break;case 6:t=1-Math.cos(e*Math.PI/2)}this.result=t},t.prototype.update_output=function(){return this.result},t.prototype.state_changed=function(t){t&&t.val(""+this.state.type)}}();
;
!function(){var t=E2.plugins.tween_out_modulator=function(t){Plugin.apply(this,arguments),this.desc="Perform tween out over time.",this.input_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"Time ranging from zero to one.",def:0,lo:0,hi:1}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"Emits a tween out over <b>time</b>.",def:0}],this.state={type:0}};t.prototype=Object.create(Plugin.prototype),t.prototype.create_ui=function(){var t=$("<select />",{selectedIndex:0}),e=function(e,a){$("<option />",{value:e,text:a}).appendTo(t)};return e(0,"Circular"),e(1,"Cubic"),e(2,"Exponential"),e(3,"Quadratic"),e(4,"Quartic"),e(5,"Quintic"),e(6,"Sinusoidal"),t.change(function(e){return function(){e.undoableSetState("type",t.val(),e.state.type)}}(this)),t},t.prototype.reset=function(){this.result=0,this.time=0},t.prototype.update_input=function(t,e){this.time=0>e?0:e>1?1:e},t.prototype.update_state=function(){var t=0,e=this.time;switch(this.state.type){case 0:t=Math.sqrt(1- --e*e);break;case 1:t=--e*e*e+1;break;case 2:t=1===e?1:1-Math.pow(2,-10*e);break;case 3:t=e*(2-e);break;case 4:t=1- --e*e*e*e;break;case 5:t=--e*e*e*e*e+1;break;case 6:t=Math.sin(e*Math.PI/2)}this.result=t},t.prototype.update_output=function(){return this.result},t.prototype.state_changed=function(t){t&&t.val(""+this.state.type)}}();
;
E2.p=E2.plugins.typed_array_generator=function(t){this.desc="Create a zeroed out array of a given size (in bytes).",this.input_slots=[{name:"size",dt:t.datatypes.FLOAT,desc:"Size if array in number of elements.",def:0}],this.output_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The resulting array."}],this.state={datatype:1},this.size=0,this.update_array()},E2.p.prototype.create_ui=function(){var t=$("<select />",{selectedIndex:1});return $("<option />",{value:0,text:"Int8"}).appendTo(t),$("<option />",{value:1,text:"Uint8"}).appendTo(t),$("<option />",{value:2,text:"Int16"}).appendTo(t),$("<option />",{value:3,text:"Uint16"}).appendTo(t),$("<option />",{value:4,text:"Int32"}).appendTo(t),$("<option />",{value:5,text:"Uint32"}).appendTo(t),$("<option />",{value:6,text:"Float32"}).appendTo(t),t.change(function(e){return function(){e.state.datatype=parseInt(t.val()),e.update_array(),e.updated=!0}}(this)),t},E2.p.prototype.update_array=function(){if(0===this.size)return void(this.array=null);var t=[1,1,2,2,4,4,4][this.state.datatype];this.array=new ArrayBuffer(t*this.size),this.array.datatype=this.state.datatype,this.array.stride=t},E2.p.prototype.update_input=function(t,e){this.size=Math.floor(e),this.update_array()},E2.p.prototype.update_output=function(){return this.array},E2.p.prototype.state_changed=function(t){t&&t.val(""+this.state.datatype)};
;
E2.p=E2.plugins.typed_array_get_as_modulator=function(t,e){this.desc="Gets an item value from an array.",this.input_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The array to obtain a value from.",def:null},{name:"index",dt:t.datatypes.FLOAT,desc:"The index of the item to get.",def:0}],this.output_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The modified array."},{name:"value",dt:t.datatypes.FLOAT,desc:"The value of the chosen item."}],this.state={datatype:1},this.node=e,this.reset()},E2.p.prototype.reset=function(){this.array=null,this.dv=null,this.accessor=null,this.index=0,this.value=0},E2.p.prototype.create_ui=function(){var t=$("<select />",{selectedIndex:1});return $("<option />",{value:0,text:"Int8"}).appendTo(t),$("<option />",{value:1,text:"Uint8"}).appendTo(t),$("<option />",{value:2,text:"Int16"}).appendTo(t),$("<option />",{value:3,text:"Uint16"}).appendTo(t),$("<option />",{value:4,text:"Int32"}).appendTo(t),$("<option />",{value:5,text:"Uint32"}).appendTo(t),$("<option />",{value:6,text:"Float32"}).appendTo(t),t.change(function(e){return function(){e.state.datatype=parseInt(t.val()),e.update_view(),e.updated=!0,e.node.queued_update=1}}(this)),t},E2.p.prototype.update_view=function(){if(!this.array)return void(this.dv=null);var t=this.dv=new DataView(this.array);this.accessor=[t.getInt8,t.getUint8,t.getInt16,t.getUint16,t.getInt32,t.getUint32,t.getFloat32][this.state.datatype].bind(t),this.stride=[1,1,2,2,4,4,4][this.state.datatype]},E2.p.prototype.update_input=function(t,e){0===t.index?this.array!==e&&(this.array=e,this.update_view()):this.index=Math.floor(e)},E2.p.prototype.update_state=function(){if(!this.dv)return void(this.value=0);var t=this.index*this.stride;0>t||t>=this.array.byteLength||(this.value=this.state.datatype<2?this.accessor(t):this.accessor(t,!0))},E2.p.prototype.update_output=function(t){return 0===t.index?this.array:this.value},E2.p.prototype.state_changed=function(t){t&&t.val(""+this.state.datatype)};
;
E2.p=E2.plugins.typed_array_get_modulator=function(t,e){this.desc="Gets an item value from an array.",this.input_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The array to obtain a value from.",def:null},{name:"index",dt:t.datatypes.FLOAT,desc:"The index of the item to get.",def:0}],this.output_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The modified array."},{name:"value",dt:t.datatypes.FLOAT,desc:"The value of the chosen item.",def:0}],this.node=e,this.reset()},E2.p.prototype.reset=function(){this.array=null,this.dv=null,this.accessor=null,this.index=0,this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.array!==e&&(this.array=e,this.update_view()):this.index=Math.floor(e)},E2.p.prototype.update_view=function(){if(!this.array)return void(this.dv=null);var t=this.dv=new DataView(this.array);this.accessor=[t.getInt8,t.getUint8,t.getInt16,t.getUint16,t.getInt32,t.getUint32,t.getFloat32][this.array.datatype].bind(t)},E2.p.prototype.update_state=function(){if(!this.dv)return void(this.value=0);var t=this.index*this.array.stride;0>t||t>=this.array.byteLength||(this.value=this.array.datatype<2?this.accessor(t):this.accessor(t,!0))},E2.p.prototype.update_output=function(t){return 0===t.index?this.array:this.value};
;
E2.p=E2.plugins.typed_array_item_to_bool_modulator=function(e){this.desc="Emits a boolean representation of the specified item in the named array member of the supplied object.",this.input_slots=[{name:"object",dt:e.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:e.datatypes.TEXT,desc:"Name of the array to be accessed.",def:null},{name:"index",dt:e.datatypes.FLOAT,desc:"Index of the array item to be converted.",def:0}],this.output_slots=[{name:"bool",dt:e.datatypes.BOOL,desc:"The boolean representation of the specified array item.",def:!1}]},E2.p.prototype.reset=function(){this.value=!1,this.object=null,this.member=null,this.index=0},E2.p.prototype.update_input=function(e,t){0===e.index?this.object=t:1===e.index?this.member=t:2===e.index&&(this.index=Math.floor(t),this.index=this.index<0?0:this.index)},E2.p.prototype.update_state=function(){if(null!==this.object&&null!==this.member){if(!this.object.hasOwnProperty(this.member))return void msg('ERROR: Cannot index unknown array "'+this.member+'".');var e=this.object[this.member];return"[object Array]"!==Object.prototype.toString.call(e)?void msg('ERROR: Object member "'+this.member+'" is not an array.'):void(this.value=e.length>0&&e[this.index%e.length]?!0:!1)}},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.typed_array_item_to_float_modulator=function(e){this.desc="Emits a float representation of the specified item in the named array member of the supplied object.",this.input_slots=[{name:"object",dt:e.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:e.datatypes.TEXT,desc:"Name of the array to be accessed.",def:null},{name:"index",dt:e.datatypes.FLOAT,desc:"Index of the array item to be converted.",def:0}],this.output_slots=[{name:"value",dt:e.datatypes.FLOAT,desc:"The float representation of the specified array item.",def:0}]},E2.p.prototype.reset=function(){this.value=0,this.object=null,this.member=null,this.index=0},E2.p.prototype.update_input=function(e,t){0===e.index?this.object=t:1===e.index?this.member=t:2===e.index&&(this.index=Math.floor(t),this.index=this.index<0?0:this.index)},E2.p.prototype.update_state=function(){if(null!==this.object&&null!==this.member){if(!this.object.hasOwnProperty(this.member))return void msg('ERROR: Cannot convert unknown member "'+this.member+'".');var e=this.object[this.member];if("[object Array]"!==Object.prototype.toString.call(e))return void msg('ERROR: Object member "'+this.member+'" is not an array.');if(e.length<1)return void(this.value=0);var t=this.index%e.length,i=e[t];return isNaN(i)?void msg("ERROR: The item at index "+t+' of "'+this.member+'" is not a float.'):void(this.value=i)}},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.typed_array_item_to_object_modulator=function(e){this.desc="Emits an object representation of the specified item in the named array member of the supplied object.",this.input_slots=[{name:"object",dt:e.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:e.datatypes.TEXT,desc:"Name of the array to be accessed.",def:null},{name:"index",dt:e.datatypes.FLOAT,desc:"Index of the array item to be converted.",def:0}],this.output_slots=[{name:"object",dt:e.datatypes.OBJECT,desc:"The object representation of the specified array item."}]},E2.p.prototype.reset=function(){this.value={},this.object=null,this.member=null,this.index=0},E2.p.prototype.update_input=function(e,t){0===e.index?this.object=t:1===e.index?this.member=t:2===e.index&&(this.index=Math.floor(t),this.index=this.index<0?0:this.index)},E2.p.prototype.update_state=function(){if(null!==this.object&&null!==this.member){if(!this.object.hasOwnProperty(this.member))return void msg('ERROR: Cannot convert unknown member "'+this.member+'".');var e=this.object[this.member];if("[object Array]"!==Object.prototype.toString.call(e))return void msg('ERROR: Object member "'+this.member+'" is not an array.');var t=e.length>0?e[this.index%e.length]:null;return null===t||"object"!=typeof t?void msg('ERROR: The member "'+this.member+'" is not an object.'):void(this.value=t)}},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.typed_array_item_to_string_modulator=function(t){this.desc="Emits an string representation of the specified item in the named array member of the supplied object.",this.input_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:t.datatypes.TEXT,desc:"Name of the array to be accessed.",def:null},{name:"index",dt:t.datatypes.FLOAT,desc:"Index of the array item to be converted.",def:0}],this.output_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"The string representation of the specified array item."}]},E2.p.prototype.reset=function(){this.value="",this.object=null,this.member=null,this.index=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.object=e:1===t.index?this.member=e:2===t.index&&(this.index=Math.floor(e),this.index=this.index<0?0:this.index)},E2.p.prototype.update_state=function(){if(null!==this.object&&null!==this.member){if(!this.object.hasOwnProperty(this.member))return void msg('ERROR: Cannot convert unknown member "'+this.member+'".');var t=this.object[this.member];return"[object Array]"!==Object.prototype.toString.call(t)?void msg('ERROR: Object member "'+this.member+'" is not an array.'):void(this.value=t.length>0?t[this.index%t.length].toString():"")}},E2.p.prototype.update_output=function(){return this.value};
;
E2.p=E2.plugins.typed_array_item_to_typed_array_modulator=function(t){this.desc="Emits an typed array representation of the specified item in the named array member of the supplied object.",this.input_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:t.datatypes.TEXT,desc:"Name of the array to be accessed.",def:null},{name:"index",dt:t.datatypes.FLOAT,desc:"Index of the array item to be converted.",def:0}],this.output_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The string representation of the specified array item."}],this.state={datatype:6}},E2.p.prototype.reset=function(){this.array=new ArrayBuffer(0),this.object=null,this.member=null,this.index=0},E2.p.prototype.create_ui=function(){var t=$("<select />",{selectedIndex:1});return $("<option />",{value:0,text:"Int8"}).appendTo(t),$("<option />",{value:1,text:"Uint8"}).appendTo(t),$("<option />",{value:2,text:"Int16"}).appendTo(t),$("<option />",{value:3,text:"Uint16"}).appendTo(t),$("<option />",{value:4,text:"Int32"}).appendTo(t),$("<option />",{value:5,text:"Uint32"}).appendTo(t),$("<option />",{value:6,text:"Float32"}).appendTo(t),t.change(function(e){return function(){e.state.datatype=parseInt(t.val()),e.updated=!0}}(this)),t},E2.p.prototype.update_input=function(t,e){0===t.index?this.object=e:1===t.index?this.member=e:2===t.index&&(this.index=Math.floor(e),this.index=this.index<0?0:this.index)},E2.p.prototype.update_state=function(){if(null!==this.object&&null!==this.member){if(!this.object.hasOwnProperty(this.member))return void msg('ERROR: Cannot convert unknown member "'+this.member+'".');var t=this.object[this.member];if("[object Array]"!==Object.prototype.toString.call(t))return void msg('ERROR: Object member "'+this.member+'" is not an array.');var e=t.length>0?t[this.index%t.length]:null;if(null===e||"[object array]"!==Object.prototype.toString.call(e).toLowerCase())return void msg('ERROR: The member "'+this.member+'" is not an array.');switch(this.state.datatype){case 0:this.array=new Int8Array(e);break;case 1:this.array=new Uint8Array(e);break;case 2:this.array=new Int16Array(e);break;case 3:this.array=new Uint16Array(e);break;case 4:this.array=new Int32Array(e);break;case 5:this.array=new Uint32Array(e);break;case 6:this.array=new Float32Array(e)}this.array=this.array.buffer,this.array.datatype=this.state.datatype,this.array.stride=[1,1,2,2,4,4,4][this.state.datatype]}},E2.p.prototype.update_output=function(){return this.array},E2.p.prototype.state_changed=function(t){t&&t.val(""+this.state.datatype)};
;
E2.p=E2.plugins.typed_array_length_modulator=function(t,e){this.desc="Gets the length of an array (in bytes).",this.input_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The array to obtain the length of.",def:null}],this.output_slots=[{name:"length",dt:t.datatypes.FLOAT,desc:"The length (in bytes) of the supplied array."}],this.node=e,this.reset()},E2.p.prototype.reset=function(){this.array=null},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.array=e)},E2.p.prototype.update_output=function(){return this.array?this.array.byteLength/this.array.stride:0},E2.p.prototype.state_changed=function(){};
;
E2.p=E2.plugins.typed_array_set_as_modulator=function(t,e){this.desc="Sets an item value in an array.",this.input_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The array to set a value in.",def:null},{name:"index",dt:t.datatypes.FLOAT,desc:"The index of the item to set.",def:0},{name:"value",dt:t.datatypes.FLOAT,desc:"The value to set the item to.",def:0}],this.output_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The modified array."}],this.state={datatype:1},this.node=e,this.reset()},E2.p.prototype.reset=function(){this.array=null,this.dv=null,this.accessor=null,this.index=0,this.value=0,this.stride=0},E2.p.prototype.create_ui=function(){var t=$("<select />",{selectedIndex:1});return $("<option />",{value:0,text:"Int8"}).appendTo(t),$("<option />",{value:1,text:"Uint8"}).appendTo(t),$("<option />",{value:2,text:"Int16"}).appendTo(t),$("<option />",{value:3,text:"Uint16"}).appendTo(t),$("<option />",{value:4,text:"Int32"}).appendTo(t),$("<option />",{value:5,text:"Uint32"}).appendTo(t),$("<option />",{value:6,text:"Float32"}).appendTo(t),t.change(function(e){return function(){e.state.datatype=parseInt(t.val()),e.update_view(),e.updated=!0,e.node.queued_update=1}}(this)),t},E2.p.prototype.update_input=function(t,e){0===t.index?this.array!==e&&(this.array=e,this.update_view()):1===t.index?this.index=Math.floor(e):this.value=6===this.state.datatype?e:Math.floor(e)},E2.p.prototype.update_view=function(){if(!this.array)return void(this.dv=null);var t=this.dv=new DataView(this.array);this.stride=[1,1,2,2,4,4,4][this.state.datatype],this.accessor=[t.setInt8,t.setUint8,t.setInt16,t.setUint16,t.setInt32,t.setUint32,t.setFloat32][this.state.datatype].bind(t)},E2.p.prototype.update_state=function(){if(this.dv){var t=this.index*this.stride;if(!(0>t||t>=this.array.byteLength)){var e=this.state.datatype;2>e?this.accessor(t,Math.floor(this.value)):this.accessor(t,6===e?this.value:Math.floor(this.value),!0)}}},E2.p.prototype.update_output=function(){return this.array},E2.p.prototype.state_changed=function(t){t&&t.val(""+this.state.datatype)};
;
E2.p=E2.plugins.typed_array_set_modulator=function(t,e){this.desc="Sets an item value in an array.",this.input_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The array to set a value in.",def:null},{name:"index",dt:t.datatypes.FLOAT,desc:"The index of the item to set.",def:0},{name:"value",dt:t.datatypes.FLOAT,desc:"The value to set the item to.",def:0}],this.output_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The modified array."}],this.node=e,this.reset()},E2.p.prototype.reset=function(){this.array=null,this.dv=null,this.accessor=null,this.index=0,this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.array!==e&&(this.array=e,this.update_view()):1===t.index?this.index=Math.floor(e):this.value=e},E2.p.prototype.update_view=function(){if(!this.array)return void(this.dv=null);var t=this.dv=new DataView(this.array);this.accessor=[t.setInt8,t.setUint8,t.setInt16,t.setUint16,t.setInt32,t.setUint32,t.setFloat32][this.array.datatype].bind(t)},E2.p.prototype.update_state=function(){if(this.dv){var t=this.index*this.array.stride;if(!(0>t||t>=this.array.byteLength)){var e=this.array.datatype;2>e?this.accessor(t,Math.floor(this.value)):this.accessor(t,6===e?this.value:Math.floor(this.value),!0)}}},E2.p.prototype.update_output=function(){return this.array};
;
E2.p=E2.plugins.typed_array_to_texture_modulator=function(t){this.desc="Converts the supplied array to a texture.",this.input_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The array to convert.",def:null},{name:"width",dt:t.datatypes.FLOAT,desc:"The desired width of the resulting texture.",def:0}],this.output_slots=[{name:"texture",dt:t.datatypes.TEXTURE,desc:"The resulting texture."}]},E2.p.prototype.reset=function(){this.texture=new THREE.Texture,this.array=null,this.width=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.array=new Uint8Array(e):this.width=Math.floor(e)},E2.p.prototype.update_state=function(){if(this.array&&this.width){if(this.array.byteLength/4%this.width)return void msg("ERROR: Cannot create texture. The supplied width does not divide evenly into the array size in pixels.");var e=this.width,r=this.array.byteLength/4/this.width;if(!t.isPow2(e))return void msg("WARNING: The width ("+e+") of the texture is not a power of two.");if(!t.isPow2(r))return void msg("WARNING: The height ("+r+") of the texture is not a power of two.");msg("Uploading texture from array with size "+e+"x"+r),this.texture=new THREE.DataTexture(this.array,e,r)}},E2.p.prototype.update_output=function(){return this.texture};
;
!function(){var t=E2.plugins.url_array_generator=function(t){Plugin.apply(this,arguments),this.desc="Load arbitrary data packed in an PNG from an URL.",this.input_slots=[],this.output_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The loaded array."}],this.state={url:""},this.gl=t.renderer.context,this.core=t,this.array=null,this.dirty=!1};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){function t(){function t(t){i.state.url=a=t,i.updated=!0,i.state_changed()}var e=i.state.url,a=e;FileSelectControl.createTextureSelector(e,function(r){r.template("texture").selected(e).onChange(t.bind(this)).buttons({Cancel:t.bind(this,e),Select:t.bind(this)}).on("closed",function(){a!==e&&i.undoableSetState("url",a,e)}).modal()})}var e=makeButton("Source","No texture selected.","url"),i=this;return e.click(t),e},t.prototype.update_input=function(t,e){this.state.url=e,this.state_changed(null)},t.prototype.update_state=function(){this.dirty&&(this.img=new Image,this.img.onload=function(){var t=document.createElement("canvas"),e=t.getContext("2d");t.width=this.img.width,t.height=this.img.height,e.imageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.globalCompositeOperation="copy",e.drawImage(this.img,0,0);var i=e.getImageData(0,0,this.img.width,this.img.height);this.array=i.data.buffer,this.array.stride=1,this.array.datatype=1,this.updated=!0,msg("INFO: Finished loading data array from "+this.img.src)}.bind(this),this.img.onerror=function(t){console.error(t)},this.img.onabort=function(){},this.img.src=this.state.url,this.dirty=!1)},t.prototype.update_output=function(){return this.array},t.prototype.state_changed=function(t){""!==this.state.url&&(t?t.attr("title",this.state.url):this.dirty=!0)}}();
;
!function(){var t=E2.plugins.url_audio_buffer_generator=function(t){Plugin.apply(this,arguments),this.desc="Load an audio sample from an URL.",this.input_slots=[{name:"url",dt:t.datatypes.TEXT,desc:"Use this to load from a URL supplied as a string.",def:""}],this.output_slots=[{name:"buffer",dt:t.datatypes.OBJECT,desc:"An audio buffer."}],this.state={url:null},this.core=t,this.buffer=null,this.dirty=!1};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){this.updated=!1},t.prototype.create_ui=function(){var t=makeButton("Source","No audio selected.","url"),e=this;return t.click(function(){FileSelectControl.createAudioSelector(e.state.url).onChange(function(t){e.undoableSetState("url",t,e.state.url)})}),t},t.prototype.update_input=function(t,e){this.state.url=e,this.state_changed(null)},t.prototype.update_state=function(){var t=this;this.dirty&&(this.core.audioContext?E2.core.assetLoader.loadAsset("audiobuffer",this.state.url).then(function(e){t.buffer=e,t.updated=!0}):msg("ERROR: Cannot create audio buffer. This browser does not support the required API."),this.dirty=!1)},t.prototype.update_output=function(){return this.buffer},t.prototype.state_changed=function(t){""!==this.state.url&&(t?t.attr("title",this.state.url):this.dirty=!0)}}();
;
!function(){var t=E2.plugins.url_audio_generator=function(t){Plugin.apply(this,arguments),this.desc="Load a sample from an URL. Each sample should be encoded as .wav, .mp3, .mp4 and .ogg, and no extension should be specified. This plugin will load the appropriate filetype for the current execution environment. Hover over the Source button to see the url of the current file.",this.input_slots=[{name:"url",dt:t.datatypes.TEXT,desc:"Use this to load from a URL supplied as a string.",def:""}],this.output_slots=[{name:"audio",dt:t.datatypes.AUDIO,desc:"An audio stream."}],this.state={url:""},this.core=t,this.audio=null,this.dirty=!1};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){function t(){function t(t){i.state.url=o=t,i.updated=!0,i.state_changed()}var e=i.state.url,o=e;FileSelectControl.createModelSelector("audio",e,function(u){u.selected(e).onChange(t.bind(this)).buttons({Cancel:t.bind(this,e),Select:t.bind(this)}).on("closed",function(){o!==e&&(i.undoableSetState("url",o,e),mixpanel.track("UrlAudio Model Changed"))}).modal()})}var e=makeButton("Source","No audio selected.","url"),i=this;return e.click(t),e},t.prototype.update_input=function(t,e){this.state.url=e,this.state_changed(null)},t.prototype.update_state=function(){var t=this;if(this.dirty){if("undefined"==typeof Audio)return msg("Audio: This browser does not support the Audio API.");this.audio&&(this.audio.pause(),delete this.audio),this.audio=new Audio,this.audio.loop=!0,this.audio.preload=!0,this.state.url&&(this.audio.addEventListener("error",function(){msg("ERROR: Audio: Failed to load '"+t.state.url+"'."),t.state.url="",t.audio=null}),msg("Audio: Loading "+this.state.url+"."),this.audio.src=this.state.url),this.dirty=!1}},t.prototype.update_output=function(){return this.audio},t.prototype.state_changed=function(t){this.state.url&&(t?t.attr("title",this.state.url):this.dirty=!0)}}();
;
!function(){var t=E2.plugins.url_json_generator=function(t){Plugin.apply(this,arguments),this.desc="Load JSON as an object from an URL. Hover over the Source button to see the url of the current file.",this.input_slots=[{name:"url",dt:t.datatypes.TEXT,desc:"Use this to load from a URL supplied as a string.",def:""}],this.output_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"The object if one has been selected."}],this.state={url:""},this.core=t,this.object={},this.dirty=!1};t.prototype=Object.create(Plugin.prototype),t.prototype.create_ui=function(){function t(){function t(t){o.state.url=s=t,o.updated=!0,o.state_changed()}var e=o.state.url,s=e;FileSelectControl.createModelSelector("json",e,function(n){n.selected(e).onChange(t.bind(this)).buttons({Cancel:t.bind(this,e),Select:t.bind(this)}).on("closed",function(){s!==e&&o.undoableSetState("url",s,e)}).modal()})}var e=makeButton("Source","No JSON selected.","url"),o=this;return e.click(t),e},t.prototype.update_input=function(t,e){this.state.url!==e&&(this.state.url=e,this.state_changed())},t.prototype.update_state=function(){if(this.dirty){var t=this;this.object={},$.ajax({url:this.state.url,dataType:"json",success:function(t){return function(e){t.object=e,t.updated=!0}}(t),error:function(t){return function(e,o,s){msg('ERROR: Failed to load JSON "'+t.state.url+'": '+o+", "+s),t.state.url="",t.object={}}}(t)}),this.dirty=!1}},t.prototype.update_output=function(){return this.object},t.prototype.state_changed=function(t){""!==this.state.url?(t&&t.attr("title",this.state.url),this.dirty=!0):this.object={}}}();
;
!function(){var t=E2.plugins.url_stereo_cubemap_generator=function(t){Plugin.apply(this,arguments),this.desc="Load a stereo cubemap from a URL. JPEG and PNG supported. Hover over the Browse button to select an existing image from the library.",this.input_slots=[],this.output_slots=[{name:"left",dt:t.datatypes.CUBETEXTURE,desc:"The left side of the loaded stereo cubemap."},{name:"right",dt:t.datatypes.CUBETEXTURE,desc:"The right side of the loaded stereo cubemap."}],this.state={url:""};var e=E2.core.assetLoader.loadingTexture.image;this.loadingTexture=new THREE.CubeTexture([e,e,e,e,e,e]),this.loadingTexture.needsUpdate=!0;var i=E2.core.assetLoader.defaultTexture.image;this.defaultTexture=new THREE.CubeTexture([i,i,i,i,i,i]),this.defaultTexture.needsUpdate=!0,this.leftTexture=this.loadingTexture,this.rightTexture=this.loadingTexture,this.dirty=!1,this.thumbnail=null};t.prototype=Object.create(Plugin.prototype),t.prototype.create_ui=function(){var t=make("div"),e=NodeUI.makeSpriteSVGButton(NodeUI.makeSpriteSVG("vp-edit-icon","cmd_edit_graph"),"No texture selected");e.addClass("p_round"),this.thumbnail=make("div").addClass("p_thumbnail"),this.thumbnail.css({"background-image":"url('images/no_texture.png')","background-size":"cover"});var i=function(){var t=this,e=t.state.url,i=e,a=function(e){return t.state.url=i=e,t.updated=!0,t.state_changed(),!0};return FileSelectControl.createStereoCubeMapSelector(e,function(r){r.template("texture").selected(e).onChange(a).buttons({Cancel:a.bind(this,e),Select:a}).on("closed",function(){i!==e&&(mixpanel.track("UrlStereoCubeMap Texture Changed"),t.undoableSetState("url",i,e))}).modal()}),!1}.bind(this);return e.click(i),this.thumbnail.click(i),t.append(this.thumbnail),t.append(e),this.node.on("pluginStateChanged",this.updateUi.bind(this)),t},t.prototype.update_input=function(){},t.prototype.update_state=function(){if(this.dirty){var t=this;this.waitingToLoad=!0,this.leftTexture=this.loadingTexture,this.rightTexture=this.loadingTexture,E2.core.assetLoader.loadAsset("image",this.state.url).then(function(e){t.makeTexturesFromImage(e)}).catch(function(){t.leftTexture=t.defaultTexture,t.rightTexture=t.defaultTexture,t.waitingToLoad=!1,t.updated=!0}),this.dirty=!1}},t.prototype.makeTexturesFromImage=function(t){for(var e=t.width,i=t.height,a=12,r=e/a,u=i,s=[],n=0;a>n;++n){var o=document.createElement("canvas");o.width=r,o.height=u;var d=o.getContext("2d");d.drawImage(t,n*r,0,r,u,0,0,r,u),s.push(o)}var h=new THREE.CubeTexture(s.splice(0,6));h.needsUpdate=!0;var l=new THREE.CubeTexture(s.splice(0,6));l.needsUpdate=!0,this.leftTexture=h,this.rightTexture=l,this.updated=!0},t.prototype.update_output=function(t){return this.waitingToLoad&&this.leftTexture&&this.rightTexture&&this.leftTexture.image&&0!==this.leftTexture.image.width&&this.rightTexture.image&&0!==this.rightTexture.image.width&&(this.waitingToLoad=!1,this.updated=!0),0===t.index?this.leftTexture:this.rightTexture},t.prototype.state_changed=function(){this.state.url&&(this.updateUi(),this.dirty=!0)},t.prototype.updateUi=function(){this.thumbnail&&this.thumbnail.css({"background-image":"url('"+this.state.url+"')"})}}();
;
!function(){var t=E2.plugins.url_texture_generator=function(t){Plugin.apply(this,arguments),this.desc="Load a texture from a URL. JPEG and PNG supported. Hover over the Browse button to select an existing image from the library.",this.input_slots=[],this.output_slots=[{name:"texture",dt:t.datatypes.TEXTURE,desc:"The loaded texture."}],this.state={url:""},this.texture=E2.core.assetLoader.defaultTexture,this.dirty=!0,this.thumbnail=null};t.prototype=Object.create(Plugin.prototype),t.prototype.create_ui=function(){var t=make("div"),e=NodeUI.makeSpriteSVGButton(NodeUI.makeSpriteSVG("vp-edit-icon","cmd_edit_graph"),"No texture selected");e.addClass("p_round");this.thumbnail=make("div").addClass("p_thumbnail"),this.thumbnail.css({"background-image":"url('images/no_texture.png')","background-size":"cover"});var i=function(){var t=this,e=t.state.url,i=e,a=function(e){return t.state.url=i=e,t.updated=!0,t.state_changed(),!0};return FileSelectControl.createTextureSelector(e,function(u){u.template("texture").selected(e).onChange(a).buttons({Cancel:a.bind(this,e),Select:a}).on("closed",function(){i!==e&&(mixpanel.track("UrlTexture Texture Changed"),t.undoableSetState("url",i,e),t.dirty=!0)}).modal()}),!1}.bind(this);return e.click(i),this.thumbnail.click(i),t.append(this.thumbnail),t.append(e),this.node.on("pluginStateChanged",this.updateUi.bind(this)),t},t.prototype.update_input=function(){},t.prototype.update_state=function(){this.dirty&&(""!==this.state.url?this.loadTexture():this.texture=E2.core.assetLoader.defaultTexture,this.dirty=!1)},t.prototype.loadTexture=function(){var t=this;this.waitingToLoad=!0,E2.core.assetLoader.loadAsset("texture",this.state.url).then(function(e){t.texture=e,t.waitingToLoad=!1,t.updated=!0}).catch(function(){t.texture=E2.core.assetLoader.defaultTexture,t.waitingToLoad=!1,t.updated=!0})},t.prototype.update_output=function(){return this.waitingToLoad&&this.texture&&this.texture.image&&0!==this.texture.image.width&&(this.waitingToLoad=!1,this.updated=!0),this.texture},t.prototype.state_changed=function(t){if(this.state.url){t||this.loadTexture(),this.updateUi()}},t.prototype.updateUi=function(){this.thumbnail&&this.thumbnail.css({"background-image":"url('"+this.state.url+"')"})}}();
;
!function(){var t=E2.plugins.url_video_generator=function(t){Plugin.apply(this,arguments),this.desc="Load a Ogg/Theora video from an URL.",this.input_slots=[{name:"url",dt:t.datatypes.TEXT,desc:"Use this to load from a URL supplied as a string.",def:""}],this.output_slots=[{name:"video",dt:t.datatypes.VIDEO,desc:"An video stream."}],this.state={url:""},this.gl=t.renderer.context,this.core=t,this.URL_VIDEO_ROOT="data/video/",this.video=null,this.dirty=!1};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){function t(){function t(t){i.state.url=o=t,i.updated=!0,i.state_changed()}var e=i.state.url,o=e;FileSelectControl.createModelSelector("video",e,function(s){s.selected(e).onChange(t.bind(this)).buttons({Cancel:t.bind(this,e),Select:t.bind(this)}).on("closed",function(){o!==e&&i.undoableSetState("url",o,e)}).modal()})}var e=makeButton("Source","No video selected.","url"),i=this;return e.click(t),e},t.prototype.update_input=function(t,e){this.state.url=e,this.state_changed(null)},t.prototype.update_state=function(){this.dirty&&(null!==this.video&&(this.video.pause(),delete this.video),this.video=document.createElement("video"),this.video.crossOrigin="Anonymous","undefined"!==this.video?(this.video.loop=!0,this.video.preload="auto",this.video.controls=!1,this.video.addEventListener("error",function(t){return function(){msg("ERROR: Video: Failed to load '"+t.state.url+"'."),t.video=null,t.state.url=""}}(this)),msg("Video: Loading "+this.state.url+"."),this.video.src=this.state.url):(msg("Video: This browser does not support the Video API."),this.video=null),this.dirty=!1)},t.prototype.update_output=function(){return this.video},t.prototype.state_changed=function(t){""!==this.state.url&&(t&&t.attr("title",this.state.url),this.dirty=!0)}}();
;
!function(){var t=E2.plugins.variable_local_read=function(t,e){this.desc="Read from a local variable using the name of the node.",this.input_slots=[],this.output_slots=[],this.core=t,this.node=e,this.data=null,this.old_title=e.title?e.title:e.title="Variable "+(e.parent_graph.variables.count()+1)};t.prototype.reset=function(){this.updated=!0},t.prototype.destroy=function(){this.variables.unlock(this,this.node.title)},t.prototype.renamed=function(){this.variables.unlock(this,this.old_title),this.target_reg(this.node.title)},t.prototype.variable_dt_changed=function(t,e){this.dt=t,this.node.change_slot_datatype(E2.slot_type.output,this.slotId,t,e)},t.prototype.variable_updated=function(t){this.updated=!0,this.node.queued_update=1,this.data=t},t.prototype.connection_changed=function(t,e){this.variables.connection_changed(this.node.title,t),this.dt.id===E2.dt.ANY.id&&this.variables.set_datatype(this.node.title,e.dst_slot.dt,e.dst_slot.array)},t.prototype.update_output=function(){return this.data},t.prototype.target_reg=function(t){this.variables.lock(this,t,this.node.getConnections().length);var e=this.variables.variables[t];this.dt=e.dt,e.dt.id!==E2.dt.ANY.id&&(this.variable_dt_changed(e.dt,e.array),this.data=this.variables.variables[t].value)},t.prototype.state_changed=function(t){if(!t){var e=this.node.getDynamicOutputSlots();this.variables=this.node.parent_graph.variables,e.length||(this.node.add_slot(E2.slot_type.output,{name:"value",dt:this.core.datatypes.ANY,desc:""}),e=this.node.getDynamicOutputSlots()),this.dt=e[0].dt,this.slotId=e[0].uid,this.target_reg(this.node.title),this.dt.id!==E2.dt.ANY.id&&this.variables.set_datatype(this.node.title,this.dt,e[0].array)}}}();
;
!function(){var t=E2.plugins.variable_local_write=function(t,i){this.desc="Write to a local variable using name of the node.",this.input_slots=[],this.output_slots=[],this.core=t,this.node=i,this.old_title=i.title?i.title:i.title="Variable "+(i.parent_graph.variables.count()+1)};t.prototype.reset=function(){this.updated=!0},t.prototype.destroy=function(){this.variables.unlock(this,this.node.title)},t.prototype.variable_dt_changed=function(t,i){this.node.change_slot_datatype(E2.slot_type.input,this.slotId,t,i)},t.prototype.renamed=function(){this.variables.unlock(this,this.old_title),this.target_reg(this.node.title)},t.prototype.connection_changed=function(t,i){this.variables.connection_changed(this.node.title,t),this.dt.id===E2.dt.ANY.id&&this.variables.set_datatype(this.node.title,i.src_slot.dt,i.src_slot.array)},t.prototype.update_input=function(t,i){this.variables.write(this.node.title,i)},t.prototype.target_reg=function(t){var i=this.node.find_dynamic_slot(E2.slot_type.input,this.slotId);this.variables.lock(this,t,this.node.getConnections().length);var e=this.variables.variables[t];e.dt.id!==this.core.datatypes.ANY.id&&this.variable_dt_changed(i.dt,e.array)},t.prototype.state_changed=function(t){if(!t){var i=this.node.getDynamicInputSlots();this.variables=this.node.parent_graph.variables,i.length||(this.node.add_slot(E2.slot_type.input,{name:"value",dt:this.core.datatypes.ANY,desc:""}),i=this.node.getDynamicInputSlots()),this.dt=i[0].dt,this.slotId=i[0].uid,this.target_reg(this.node.title),this.dt.id!==E2.dt.ANY.id&&this.variables.set_datatype(this.node.title,this.dt,i[0].array)}}}();
;
!function(){var t=E2.plugins.vector=function(t){this.desc="Create a vector from individual X, Y and Z components.",this.input_slots=[{name:"x",dt:t.datatypes.FLOAT,desc:"The input x-component.",def:0},{name:"y",dt:t.datatypes.FLOAT,desc:"The input y-component.",def:0},{name:"z",dt:t.datatypes.FLOAT,desc:"The input z-component.",def:0}],this.output_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"The resulting vector.",def:new THREE.Vector3(0,0,0)}]};t.prototype.reset=function(){this.xyz=new THREE.Vector3(0,0,0)},t.prototype.update_input=function(t,e){0===t.index?this.xyz.setX(e):1===t.index?this.xyz.setY(e):this.xyz.setZ(e)},t.prototype.update_output=function(){return this.xyz},t.prototype.state_changed=function(){}}();
;
E2.p=E2.plugins.vector_add=function(t){this.desc="Adds the X, Y and Z components of the supplied vectors and emits the result.",this.input_slots=[{name:"a",dt:t.datatypes.VECTOR,desc:"The first operand.",def:t.renderer.vector_origin},{name:"b",dt:t.datatypes.VECTOR,desc:"The second operand.",def:t.renderer.vector_origin}],this.output_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Emits Fx + Sx, Fy + Sy, Fz + Sz.",def:t.renderer.vector_origin}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.vector_a=e:1===t.index&&(this.vector_b=e)},E2.p.prototype.update_state=function(){var t=this.result,e=this.vector_a,o=this.vector_b;t.set(e.x+o.x,e.y+o.y,e.z+o.z)},E2.p.prototype.update_output=function(){return this.result},E2.p.prototype.state_changed=function(t){t||(this.vector_a=new THREE.Vector3(0,0,0),this.vector_b=new THREE.Vector3(0,0,0),this.result=new THREE.Vector3(0,0,0))};
;
E2.p=E2.plugins.vector_cross=function(t){this.desc="Emits the cross products of the two supplied vectors.",this.input_slots=[{name:"a",dt:t.datatypes.VECTOR,desc:"The first operand.",def:t.renderer.vector_origin},{name:"b",dt:t.datatypes.VECTOR,desc:"The second operand.",def:t.renderer.vector_origin}],this.output_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Emits F cross S.",def:t.renderer.vector_origin}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.vector_a=e:1===t.index&&(this.vector_b=e)},E2.p.prototype.update_state=function(){this.result.crossVectors(this.vector_a,this.vector_b)},E2.p.prototype.update_output=function(){return this.result},E2.p.prototype.state_changed=function(t){t||(this.vector_a=new THREE.Vector3(0,0,0),this.vector_b=new THREE.Vector3(0,0,0),this.result=new THREE.Vector3(0,0,0))};
;
!function(){var t=E2.plugins.vector_display=function(t){this.desc="Displays the supplied vector as a three-cell row of values.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"The vector to be displayed.",def:t.renderer.vector_origin}],this.output_slots=[]};t.prototype.reset=function(){this.vec=new THREE.Vector3(0,0,0),this.update_values()},t.prototype.create_ui=function(){var t=make("table"),e=make("tr"),s={"text-align":"right","padding-left":"10px"};this.columns=[make("td"),make("td"),make("td")];for(var o=0;3>o;o++){var i=this.columns[o];i.text("-"),i.css(s),e.append(i)}return t.append(e),t},t.prototype.connection_changed=function(t){t||this.reset()},t.prototype.update_input=function(t,e){this.vec=e,this.update_values()},t.prototype.update_values=function(){this.columns&&(this.columns[0].text(this.vec.x),this.columns[1].text(this.vec.y),this.columns[2].text(this.vec.z))}}();
;
E2.p=E2.plugins.vector_dot=function(t){this.desc="Emits the dot products of the two supplied vectors.",this.input_slots=[{name:"a",dt:t.datatypes.VECTOR,desc:"The first operand.",def:t.renderer.vector_origin},{name:"b",dt:t.datatypes.VECTOR,desc:"The second operand.",def:t.renderer.vector_origin}],this.output_slots=[{name:"float",dt:t.datatypes.FLOAT,desc:"Emits F dot S.",def:0}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.vector_a=e:1===t.index&&(this.vector_b=e)},E2.p.prototype.update_state=function(){this.result=this.vector_a.dot(this.vector_b)},E2.p.prototype.update_output=function(){return this.result},E2.p.prototype.state_changed=function(t){t||(this.vector_a=new THREE.Vector3(0,0,0),this.vector_b=new THREE.Vector3(0,0,0),this.result=new THREE.Vector3(0,0,0))};
;
E2.p=E2.plugins.vector_magnitude=function(t){this.desc="Emits the magnitude (length) of the supplied vector.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Input vector to compute the length of.",def:t.renderer.vector_origin}],this.output_slots=[{name:"mag",dt:t.datatypes.FLOAT,desc:"Emits the magnitude of the input vector.",def:0}]},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.vector=e)},E2.p.prototype.update_state=function(){var t=this.vector.x,e=this.vector.y,o=this.vectorz;this.mag=Math.sqrt(t*t+e*e+o*o)},E2.p.prototype.update_output=function(){return this.mag},E2.p.prototype.state_changed=function(t){t||(this.vector=new THREE.Vector3(0,0,0),this.mag=0)};
;
E2.p=E2.plugins.vector_multiply=function(t){this.desc="Multiples the X, Y and Z components of the supplied vectors and emits the result.",this.input_slots=[{name:"a",dt:t.datatypes.VECTOR,desc:"The first operand.",def:t.renderer.vector_origin},{name:"b",dt:t.datatypes.VECTOR,desc:"The second operand.",def:t.renderer.vector_origin}],this.output_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Emits Fx * Sx, Fy * Sy, Fz * Sz.",def:t.renderer.vector_origin}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.vector_a=e:1===t.index&&(this.vector_b=e)},E2.p.prototype.update_state=function(){this.result.multiplyVectors(this.vector_a,this.vector_b)},E2.p.prototype.update_output=function(){return this.result},E2.p.prototype.state_changed=function(t){t||(this.vector_a=new THREE.Vector3(0,0,0),this.vector_b=new THREE.Vector3(0,0,0),this.result=new THREE.Vector3(0,0,0))};
;
E2.p=E2.plugins.vector_normalize=function(t){this.desc="Emit a normalized version of the supplied vector with a magnitude of 1.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"The input vector to be normalised.",def:t.renderer.vector_origin}],this.output_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Emits the normalised input vector.",def:t.renderer.vector_origin}]},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.vector=e)},E2.p.prototype.update_state=function(){var t=this.vector.x,e=this.vector.y,o=this.vectory,i=this.normalized,r=Math.sqrt(t*t+e*e+o*o);r?1===r?(i.x=t,i.y=e,i.z=o):(r=1/r,i.x=t*r,i.y=e*r,i.z=o*r):(i.x=0,i.y=0,i.z=0)},E2.p.prototype.update_output=function(){return this.normalized},E2.p.prototype.state_changed=function(t){t||(this.vector=new THREE.Vector3(0,0,0),this.normalized=new THREE.Vector3(0,0,0))};
;
E2.p=E2.plugins.vector_scale=function(t){this.desc="Scale the X, Y and Z components of the supplied vector by the supplied factor.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"The input vector to be scaled.",def:t.renderer.vector_origin},{name:"scale",dt:t.datatypes.FLOAT,desc:"The scale factor.",def:1}],this.output_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Emits Vx * s, Vy *s, Vz * s.",def:t.renderer.vector_origin}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.vector=e:1===t.index&&(this.scale=e)},E2.p.prototype.update_state=function(){var t=this.scale,e=this.scaled,s=this.vector;e.x=s.x*t,e.y=s.y*t,e.z=s.z*t},E2.p.prototype.update_output=function(){return this.scaled},E2.p.prototype.state_changed=function(t){t||(this.vector=new THREE.Vector3(0,0,0),this.scaled=new THREE.Vector3(0,0,0),this.scale=1)};
;
E2.p=E2.plugins.vector_to_screenspace=function(t){this.desc="Transform a vector from world to screenspace given a specified camera.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Input vector (in worldspace) to transform."},{name:"camera",dt:t.datatypes.CAMERA,desc:"Camera to use for transformation."}],this.output_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Emits the transformed input vector."}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.vector=e:1===t.index&&(this.camera=e)},E2.p.prototype.update_state=function(){this.camera.updateMatrixWorld(),this.camera.updateProjectionMatrix();var t=new THREE.Matrix4;this.camera.matrixWorldInverse.getInverse(this.camera.matrixWorld),t.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),this.transformed.copy(this.vector),this.transformed.applyMatrix4(t)},E2.p.prototype.update_output=function(){return this.transformed},E2.p.prototype.state_changed=function(t){t||(this.vector=new THREE.Vector3,this.transformed=new THREE.Vector3,this.camera=new THREE.Camera)};
;
E2.p=E2.plugins.vector_transform=function(t){this.desc="Transform a vector by the supplied matrix.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Input vector to transform."},{name:"matrix",dt:t.datatypes.MATRIX,desc:"Transformation matrix to multiply the vector by."}],this.output_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Emits the transformed input vector."}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.vector=e:1===t.index&&(this.matrix=e)},E2.p.prototype.update_state=function(){this.transformed.copy(this.vector),this.transformed.applyMatrix4(this.matrix)},E2.p.prototype.update_output=function(){return this.transformed},E2.p.prototype.state_changed=function(t){t||(this.vector=new THREE.Vector3,this.transformed=new THREE.Vector3,this.matrix=new THREE.Matrix4,this.matrix.identity())};
;
E2.p=E2.plugins.video_get_current_time_modulator=function(t){this.desc="Get the current playback time of the supplied video in seconds.",this.input_slots=[{name:"video",dt:t.datatypes.VIDEO,desc:"Input video.",def:null}],this.output_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"Current playback time.",def:0}]},E2.p.prototype.reset=function(){this.time=0},E2.p.prototype.update_input=function(t,e){this.time=e?e.currentTime:0},E2.p.prototype.update_output=function(){return this.time};
;
E2.p=E2.plugins.video_get_duration_modulator=function(t){this.desc="Get the duration of the supplied video in seconds.",this.input_slots=[{name:"video",dt:t.datatypes.VIDEO,desc:"Input video.",def:null}],this.output_slots=[{name:"duration",dt:t.datatypes.FLOAT,desc:"Duration in seconds.",def:0}]},E2.p.prototype.reset=function(){this.duration=0},E2.p.prototype.update_input=function(t,o){this.duration=o?o.duration:0},E2.p.prototype.update_output=function(){return this.duration};
;
E2.p=E2.plugins.video_player=function(t,e){this.desc="Play a video stream. Playback loops by default.",this.input_slots=[{name:"video",dt:t.datatypes.VIDEO,desc:"The video stream to play.",def:null},{name:"play",dt:t.datatypes.BOOL,desc:"Send true to start playback and false to stop.",def:!0},{name:"muted",dt:t.datatypes.BOOL,desc:"Is audio muted?",def:!0},{name:"volume",dt:t.datatypes.FLOAT,desc:"Set playback volume.",lo:0,hi:0,def:.5},{name:"time",dt:t.datatypes.FLOAT,desc:"Set playback time.",def:0}],this.output_slots=[{name:"texture",dt:t.datatypes.TEXTURE,desc:"The current video frame."}],this.core=t,this.node=e,this.video=null,this.playing=!1,this.should_play=!1,this.muted=!0,this.volume=.5,this.time=null,this.texture=null},E2.p.prototype.play=function(){this.video&&!this.playing&&this.should_play&&(this.playing=this.should_play=!0,this.video.play())},E2.p.prototype.pause=function(){this.video&&this.playing&&(this.playing=!1,this.should_play=!0,this.video.pause())},E2.p.prototype.stop=function(){this.video&&(this.playing&&(this.playing=this.should_play=!1,this.video.pause()),this.video.readyState>=2&&(this.video.currentTime=0))},E2.p.prototype.update_input=function(t,e){0===t.index?(this.video=e,this.texture=null,this.playing=!1):1===t.index?this.should_play=e:2===t.index?this.muted=e:3===t.index?this.volume=0>e?0:e>1?1:e:4===t.index&&(this.time=e)},E2.p.prototype.update_state=function(){var t=this.video;!t||t.readyState<2||(this.playing!==this.should_play&&t&&(this.should_play?t.play():t.pause(),this.playing=this.should_play),this.playing&&(t&&(t.videoWidth>0&&t.videoHeight>0&&(this.videoImage&&this.videoImage.width==t.videoWidth&&this.videoImage.height==t.videoHeight||(this.videoImage=document.createElement("canvas"),this.videoImage.width=t.videoWidth,this.videoImage.height=t.videoHeight,this.videoImageContext=this.videoImage.getContext("2d"),this.videoImageContext.fillStyle="#000000",this.videoImageContext.fillRect(0,0,this.videoImage.width,this.videoImage.height),this.texture=new THREE.Texture(this.videoImage),this.texture.minFilter=THREE.LinearFilter,this.texture.magFilter=THREE.LinearFilter),t.readyState===t.HAVE_ENOUGH_DATA&&this.texture&&(this.videoImageContext.drawImage(t,0,0),this.texture.needsUpdate=!0)),t.muted=this.muted,t.volume=this.volume,this.time&&t.readyState>=2&&(t.currentTime=this.time,this.time=null)),this.updated=!0))},E2.p.prototype.update_output=function(){return this.node.queued_update=1,this.texture?this.texture:new THREE.Texture};
;
E2.p=E2.plugins.vr_acceleration_generator=function(e){this.desc="Supplies linear and angular acceleration data from the current VR sensor device.",this.input_slots=[],this.output_slots=[{name:"linear",dt:e.datatypes.VECTOR,desc:"The current linear acceleration of the sensor.",def:[0,0,0]},{name:"angular",dt:e.datatypes.VECTOR,desc:"The current angular acceleration of the sensor.",def:[0,0,0]}],this.renderer=e.renderer},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_output=function(e){var t=this.renderer.vr_sensor;if(t){var r=t.getState(),n=null;return n=0===e.index?r.linearAcceleration:r.angularAcceleration,[n.x,n.y,n.z]}return[0,0,0]};
;
E2.p=E2.plugins.vr_camera_info_generator=function(e){this.desc="Supplies left / right FOV and translation of the current VR device camera.",this.input_slots=[],this.output_slots=[{name:"left FOV",dt:e.datatypes.FLOAT,desc:"Left eye FOV.",def:75},{name:"right FOV",dt:e.datatypes.FLOAT,desc:"Right eye FOV.",def:75},{name:"left offset",dt:e.datatypes.FLOAT,desc:"Left eye translation.",def:0},{name:"right offset",dt:e.datatypes.FLOAT,desc:"Right eye translation.",def:0}],this.renderer=e.renderer},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_output=function(e){var t=this.renderer.vr_hmd,r={eyeTranslation:0,recommendedFieldOfView:{leftDegrees:75,rightDegrees:75}},i=r,d=r;return t&&(void 0!==t.getEyeParameters?(i=t.getEyeParameters("left"),d=t.getEyeParameters("right")):(i={eyeTranslation:t.getEyeTranslation("left"),recommendedFieldOfView:t.getRecommendedEyeFieldOfView("left")},d={eyeTranslation:t.getEyeTranslation("right"),recommendedFieldOfView:t.getRecommendedEyeFieldOfView("right")})),0===e.index?i.recommendedFieldOfView.leftDegrees:1===e.index?d.recommendedFieldOfView.rightDegrees:2===e.index?i.eyeTranslation:d.getEyeTranslation};
;
E2.p=E2.plugins.vr_hmd_available_generator=function(e){this.desc="Emits true if a VR Head Mounted Device is available and false otherwise.",this.input_slots=[],this.output_slots=[{name:"bool",dt:e.datatypes.BOOL,desc:"True if a VR display device is available."}],this.renderer=e.renderer},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_output=function(){return this.renderer.vr_hmd?!0:!1};
;
E2.p=E2.plugins.vr_hmd_info_generator=function(e){this.desc="Supplies various information about the current VR HMD device.",this.input_slots=[],this.output_slots=[{name:"device name",dt:e.datatypes.TEXT,desc:"The active VR device name.",def:""},{name:"display width",dt:e.datatypes.FLOAT,desc:"The HMD display width in pixels.",def:0},{name:"display height",dt:e.datatypes.FLOAT,desc:"The HMD display height in pixels.",def:0},{name:"render width",dt:e.datatypes.FLOAT,desc:"The HMD render target width in pixels.",def:0},{name:"render height",dt:e.datatypes.FLOAT,desc:"The HMD render target height in pixels.",def:0}],this.renderer=e.renderer},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_output=function(e){var t=this.renderer.vr_hmd;return 0===e.index?t?t.deviceName:"":1===e.index?t?t.displaySize.width:0:2===e.index?t?t.displaySize.height:0:3===e.index?t?t.renderTargetSize.width:0:t?t.renderTargetSize.height:0};
;
E2.p=E2.plugins.vr_sensor_available_generator=function(e){this.desc="Emits true if a VR position sensor is available and false otherwise.",this.input_slots=[],this.output_slots=[{name:"bool",dt:e.datatypes.BOOL,desc:"True if a VR position sensor is available."}],this.renderer=e.renderer},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_output=function(){return this.renderer.vr_sensor?!0:!1};
;
E2.p=E2.plugins.vr_sensor_info_generator=function(t){this.desc="Supplies the position and orientation of the current VR HMD.",this.input_slots=[],this.output_slots=[{name:"position",dt:t.datatypes.VECTOR,desc:"The position of the current HMD device."},{name:"orientation",dt:t.datatypes.MATRIX,desc:"The orientation of the current HMD device."}],this.renderer=t.renderer},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_output=function(t){var e=this.renderer.vr_sensor;if(this.updated=!0,0===t.index){if(e){var r=e.getState();if(!r.position)return[0,0,0];var i=r.position;return[i.x,i.y,i.z]}return[0,0,0]}if(e){var r=e.getState();if(!r.orientation){var n=mat4.create();return mat4.identity(n),n}var o=r.orientation;return quat4.toMat4(quat4.createFrom(o.x,o.y,o.z,o.w))}var n=mat4.create();return mat4.identity(n),n};
;
E2.p=E2.plugins.vr_velocity_generator=function(e){this.desc="Supplies linear and angular velocity data from the current VR sensor device.",this.input_slots=[],this.output_slots=[{name:"linear",dt:e.datatypes.VECTOR,desc:"The current linear velocity of the sensor.",def:[0,0,0]},{name:"angular",dt:e.datatypes.VECTOR,desc:"The current angular velocity of the sensor.",def:[0,0,0]}],this.renderer=e.renderer},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_output=function(e){var t=this.renderer.vr_sensor;if(t){var r=t.getState(),n=null;return n=0===e.index?r.linearVelocity:r.angularVelocity,[n.x,n.y,n.z]}return[0,0,0]};
;
E2.p=E2.plugins.wschannel_receive=function(e){this.desc="Emits all messages received via a Web Socket PubSub Channel sent by other peers in that channel.",this.input_slots=[{name:"channelName",dt:e.datatypes.TEXT,desc:"Channel name"}],this.output_slots=[{name:"message",dt:e.datatypes.OBJECT,desc:"Messages received"}],e.add_aux_script("wschannel/wschannel.js")},E2.p.prototype.update_input=function(e,n){var t=this;wsChannel.off(this._channelName),this._channelName=n,wsChannel.join(this._channelName),wsChannel.on(this._channelName,function(e){t.updated=!0,t._message=e})},E2.p.prototype.reset=function(){this._message=null},E2.p.prototype.update_output=function(){return this._message};
;
E2.p=E2.plugins.wschannel_send=function(e){this.desc="Sends messages to Web Socket PubSub Channel for other peers in the channel to receive.",this.input_slots=[{name:"channelName",dt:e.datatypes.TEXT,desc:"Channel name"},{name:"message",dt:e.datatypes.OBJECT,desc:"Message to send"}],this.output_slots=[],e.add_aux_script("wschannel/wschannel.js")},E2.p.prototype.update_input=function(e,n){switch(e.index){case 0:this._channelName=n,wsChannel.join(this._channelName);break;case 1:this._channelName&&wsChannel.send(this._channelName,n)}},E2.p.prototype.reset=function(){this._channelName=null};
;
E2.p=E2.plugins.xor_modulator=function(t){this.desc="Emits true when the values of the two inputs are different and false when they're identical.",this.input_slots=[{name:"a",dt:t.datatypes.BOOL,desc:"The first operand.",def:!1},{name:"b",dt:t.datatypes.BOOL,desc:"The second operand.",def:!1}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true if <b>first</b> does not equal <b>second</b> and false otherwise.",def:!1}]},E2.p.prototype.reset=function(){this.conds=[!1,!1],this.state=!1},E2.p.prototype.update_input=function(t,e){this.conds[t.index]=e},E2.p.prototype.update_state=function(){this.state=this.conds[0]?!this.conds[1]:this.conds[1]},E2.p.prototype.update_output=function(){return this.state};
;
function Player(){var e=this;this.state={STOPPED:0,PLAYING:1,PAUSED:2},this.app=E2.app,this.core=E2.core,this.interval=null,this.abs_time=0,this.last_time=(new Date).getTime(),this.current_state=this.state.STOPPED,this.frames=0,this.scheduled_stop=null,this.core.active_graph=this.core.root_graph=new Graph(this.core,null,"root"),this.core.graphs.push(this.core.root_graph),E2.core.on("ready",function(){e.select_active_graph()})}function CreatePlayer(e,t){$(document).ajaxError(function(e,t,a,r){if("string"==typeof r)return void console.log(r);var o="ERROR: Script exception:\n";r.fileName&&(o+="	Filename: "+r.fileName),r.lineNumber&&(o+="	Line number: "+r.lineNumber),r.message&&(o+="	Message: "+r.message),console.log(o)}),E2.core=new Core(e),E2.dom.webgl_canvas=$("#webgl-canvas"),E2.app={},E2.app.player=new Player(e,E2.dom.webgl_canvas,null),E2.app.worldEditor={update:function(){},isActive:function(){return!1}},E2.app.isVRCameraActive=function(){return!0};var a={alpha:!1,depth:!0,stencil:!0,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1};E2.core.glContext=E2.dom.webgl_canvas[0].getContext("webgl",a)||E2.dom.webgl_canvas[0].getContext("experimental-webgl",a),E2.core.renderer=new THREE.WebGLRenderer({context:E2.core.glContext,canvas:E2.dom.webgl_canvas[0]}),E2.core.on("ready",t)}Player.prototype.play=function(){this.current_state!==this.state.PLAYING&&(this.core.root_graph.play(),this.current_state=this.state.PLAYING,this.last_time=(new Date).getTime(),this.interval=requestAnimFrame(this.on_anim_frame.bind(this)))},Player.prototype.pause=function(){this.current_state=this.state.PAUSED,null!==this.interval&&(cancelAnimFrame(this.interval),this.interval=null),this.core.root_graph.pause()},Player.prototype.schedule_stop=function(e){this.scheduled_stop=e},Player.prototype.stop=function(){null!==this.interval&&(cancelAnimFrame(this.interval),this.interval=null),this.core.root_graph.stop(),this.abs_time=0,this.frames=0,this.current_state=this.state.STOPPED,this.core.abs_t=0,this.core.root_graph.reset(),E2.app&&E2.app.updateCanvas&&E2.app.updateCanvas(!1)},Player.prototype.on_anim_frame=function(){this.interval=requestAnimFrame(this.on_anim_frame.bind(this)),this.on_update()},Player.prototype.on_update=function(){if(this.scheduled_stop)return this.stop(),this.scheduled_stop(),void(this.scheduled_stop=null);var e=(new Date).getTime(),t=.001*(e-this.last_time);this.core.update(this.abs_time,t)&&E2.app.updateCanvas&&E2.app.updateCanvas(!1),E2.app.worldEditor.update(),this.last_time=e,this.abs_time+=t,this.frames++},Player.prototype.select_active_graph=function(){E2.app&&E2.app.onGraphSelected&&E2.app.onGraphSelected(this.core.active_graph)},Player.prototype.load_from_json=function(e,t){this.load_from_object(JSON.parse(e),t)},Player.prototype.load_from_object=function(e,t){var a=this.core;a.deserialiseObject(e),E2.core.assetLoader.loadAssetsForGraph(e.root).then(function(){t&&t()}).catch(function(e){console.error("Player preload failed: "+e),t&&t(e)})},Player.prototype.load_from_url=function(e,t){var a=this;$.ajax({url:e,cache:!0,dataType:"text",headers:{},success:function(e){a.load_from_json(e,t)}})},Player.prototype.getVariableValue=function(e){return this.core.root_graph.variables.read(e)},Player.prototype.setVariableValue=function(e,t){this.core.root_graph.variables.write(e,t)},Player.prototype.add_parameter_listener=function(e,t){var a={variable_dt_changed:function(){},variable_updated:function(e){return function(t){e(t)}}(t)};return this.core.root_graph.variables.lock(a,e),a},Player.prototype.remove_parameter_listener=function(e,t){this.core.variables.unlock(t,e)},Player.prototype.loadAndPlay=function(e,t){var a=when.defer();return E2.app.player.load_from_url(e,function(e){return E2.core.emit("assetsLoaded"),e&&t!==!0||E2.app.player.play(),e?a.reject(e):void a.resolve()}),a.promise};
;
!function(){function a(a){var e=document.getElementById("progressbar");if(e&&(e.value=a),100==a){if(n)return;$("body").addClass("assetsLoaded"),n=!0}}function e(){var e=$("canvas[data-graph-url]"),r=e.data("autoplay");if(E2.core.on("progress",a),E2.app.player.stop(),E2.app.player.on_update(),mixpanel.track("Player Opened"),r){var n=e.data("graph-url");E2.app.player.loadAndPlay(n,r)}$(window).trigger("vizorLoaded")}function r(a){var r=null,n=null;a.some(function(a){return a instanceof HMDVRDevice?(r=a,!0):void 0}),r&&a.some(function(a){return a instanceof PositionSensorVRDevice&&a.hardwareUnitId===r.hardwareUnitId?(n=a,!0):void 0}),CreatePlayer([r,n],e)}var n=!1;window.playVizorFile=function(){var a=$("canvas[data-graph-url]"),e=a.data("graph-url");return E2.app.player.loadAndPlay(e)},$(document).ready(function(){VizorUI.replaceSVGButtons(jQuery("header")),navigator.getVRDevices?navigator.getVRDevices().then(r):navigator.mozGetVRDevices?navigator.mozGetVRDevices(r):CreatePlayer([null,null],e)}),window.addEventListener("message",function(a){function e(e){a.source.postMessage(e,a.origin)}switch(a.data.command){case"getVariable":e({value:E2.app.player.getVariableValue(a.data.name)});break;case"setVariable":E2.app.player.setVariableValue(a.data.name,a.data.value)}},!1)}();